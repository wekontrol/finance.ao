import{r as Sl,a as Cl,g as _o,c as Is}from"./react-vendor-B9D_A6Vq.js";import{r as T,R as wt,A as No,C as zt,X as qt,Y as Gt,T as _t,a as ws,P as ko,b as So,c as Co,d as Xn,e as El,f as Tl,S as gr,L as Zn,g as Eo,h as To,B as Ao,i as Js}from"./charts-DnE0oZWi.js";import{U as Qn,X as at,I as Al,M as Io,L as Ut,S as ut,a as Il,Z as Rl,W as Ro,P as rn,b as Pl,T as At,C as Po,c as Ws,d as Ks,e as jl,A as Ml,f as Dl,H as Fl,g as ze,B as It,h as os,i as Et,K as qs,j as Cs,k as Ll,l as st,m as jo,n as Ul,o as Ys,p as zl,q as Rs,r as Mo,s as ql,R as _s,F as Do,t as Gl,D as er,u as xr,v as Fo,w as Bt,x as Bl,y as yn,z as Ol,E as Vl,G as $l,J as Gs,N as Qe,O as br,Q as Hl,V as Lo,Y as Uo,_ as Tn,$ as An,a0 as yr,a1 as is,a2 as vt,a3 as In,a4 as Xs,a5 as zo,a6 as Rn,a7 as Zs,a8 as Jl,a9 as vr,aa as Wl,ab as nt,ac as rt,ad as Kl,ae as vn,af as wn,ag as qo,ah as Yl,ai as wr,aj as Xl,ak as Zl,al as Pn,am as Ql,an as ed,ao as Go,ap as td,aq as _n,ar as sd,as as nd,at as rd,au as ad,av as od,aw as id,ax as ld,ay as dd,az as cd,aA as ud}from"./ui-icons-D3vExpS3.js";import{E as Bo,a as Oo}from"./pdf-Bzq8QQY9.js";import{c as Ps}from"./auth-TDtrdbi3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();var Nn={exports:{}},ms={};var _r;function fd(){if(_r)return ms;_r=1;var t=Sl(),e=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(d,u,f){var m,p={},h=null,g=null;f!==void 0&&(h=""+f),u.key!==void 0&&(h=""+u.key),u.ref!==void 0&&(g=u.ref);for(m in u)r.call(u,m)&&!o.hasOwnProperty(m)&&(p[m]=u[m]);if(d&&d.defaultProps)for(m in u=d.defaultProps,u)p[m]===void 0&&(p[m]=u[m]);return{$$typeof:e,type:d,key:h,ref:g,props:p,_owner:a.current}}return ms.Fragment=s,ms.jsx=i,ms.jsxs=i,ms}var Nr;function md(){return Nr||(Nr=1,Nn.exports=fd()),Nn.exports}var n=md(),js={},kr;function hd(){if(kr)return js;kr=1;var t=Cl();return js.createRoot=t.createRoot,js.hydrateRoot=t.hydrateRoot,js}var pd=hd();const gd=_o(pd);var Re=(t=>(t.SUPER_ADMIN="SUPER_ADMIN",t.ADMIN="ADMIN",t.MANAGER="MANAGER",t.TRANSLATOR="TRANSLATOR",t.MEMBER="MEMBER",t))(Re||{}),bs=(t=>(t.PENDING="PENDING",t.APPROVED="APPROVED",t.REJECTED="REJECTED",t))(bs||{}),Ze=(t=>(t.INCOME="RECEITA",t.EXPENSE="DESPESA",t))(Ze||{});const Vo=T.createContext(void 0),xd={pt:{"login.title":"GestÃ£o Financeira","login.subtitle":"GestÃ£o Financeira Familiar","login.username":"UsuÃ¡rio","login.password":"Senha","login.enter":"Entrar","login.forgotPassword":"Esqueci minha senha","login.createFamily":"Criar FamÃ­lia","login.language":"Idioma","login.select_language":"Selecionar idioma...","login.portuguese":"PortuguÃªs","login.english":"English","login.spanish":"EspaÃ±ol","login.umbundu":"Umbundu","login.lingala":"Lingala","sidebar.dashboard":"Dashboard","sidebar.transactions":"TransaÃ§Ãµes","sidebar.budget":"OrÃ§amentos","sidebar.goals":"Metas","sidebar.inflation":"InflaÃ§Ã£o","sidebar.simulations":"SimulaÃ§Ãµes","sidebar.family":"FamÃ­lia","sidebar.translations":"TraduÃ§Ãµes","sidebar.settings":"ConfiguraÃ§Ãµes","sidebar.logout":"Sair","sidebar.role.superadmin":"Super Admin","sidebar.role.admin":"Administrador","sidebar.role.manager":"Gestor Familiar","sidebar.role.translator":"Tradutor","sidebar.role.member":"Membro","dashboard.title":"Painel Geral","dashboard.overview":"VisÃ£o Geral","dashboard.financial_health":"SaÃºde financeira.","dashboard.behavioral_analysis":"AnÃ¡lise Comportamental","dashboard.waste_analysis":"AnÃ¡lise de DesperdÃ­cio","dashboard.expenses_by_category":"ðŸ“Š Despesas por Categoria","dashboard.income":"Receitas","dashboard.expenses":"Despesas","dashboard.balance":"Saldo","dashboard.balance_liquid":"Saldo LÃ­quido","dashboard.aiAdvice":"Conselho de IA","dashboard.analyzing":"Analisando suas finanÃ§as com IA...","dashboard.analyzing_dot":"Analisando...","dashboard.analyze":"Analisar","dashboard.analyzeBehavior":"Analisar PadrÃ£o","dashboard.analyzeWaste":"Analisar DesperdÃ­cio","dashboard.forecast":"Prever","dashboard.predicting":"Prevendo...","dashboard.alerts":"Alertas","dashboard.excellent":"âœ¨ Ã“timo","dashboard.good":"âš ï¸ Bom","dashboard.critical":"ðŸš¨ CrÃ­tico","dashboard.thisMonth":"Este MÃªs","dashboard.thisYear":"Este Ano","dashboard.7days":"7 Dias","dashboard.current_month":"MÃªs Atual","dashboard.current_year":"Ano Atual","dashboard.allTime":"Tudo","dashboard.monthly":"Mensal","dashboard.annual":"Anual","dashboard.last7days":"Ãšltimos 7 Dias","dashboard.myNotifications":"Minhas NotificaÃ§Ãµes","dashboard.waste_indicators":"Sinais de DesperdÃ­cio","dashboard.click_analyze":'Clique em "Analisar" para detectar desperdÃ­cios',"dashboard.click_forecast":'Clique em "Prever" para anÃ¡lise dos prÃ³ximos 3 meses',"transactions.title":"TransaÃ§Ãµes","transactions.new":"Nova TransaÃ§Ã£o","transactions.history":"HistÃ³rico","transactions.subscriptions":"SubscriÃ§Ãµes","transactions.search":"Pesquisar","transactions.edit":"Editar TransaÃ§Ã£o","transactions.delete":"Excluir?","transactions.description":"DescriÃ§Ã£o","transactions.amount":"Valor","transactions.type":"Tipo","transactions.category":"Categoria","transactions.date":"Data","transactions.attachment":"Anexo","transactions.recurring":"Repetindo","transactions.frequency":"FrequÃªncia","transactions.monthly":"Mensal","transactions.weekly":"Semanal","transactions.biweekly":"Quinzenal","transactions.quarterly":"Trimestral","transactions.yearly":"Anual","transactions.add":"Adicionar","transactions.update":"Atualizar","transactions.cancel":"Cancelar","transactions.export":"Exportar","transactions.csv":"CSV","transactions.pdf":"PDF","transactions.note":"VocÃª sÃ³ pode editar suas prÃ³prias transaÃ§Ãµes.","budget.title":"OrÃ§amentos","budget.add":"Adicionar OrÃ§amento","budget.category":"Categoria","budget.limit":"Limite","budget.spent":"Gasto","budget.remaining":"Restante","budget.delete":"Excluir","budget.save":"Guardar","goals.title":"Metas","goals.new":"Nova Meta","goals.name":"Nome","goals.target":"Alvo","goals.current":"Atual","goals.contribution":"ContribuiÃ§Ã£o","goals.delete":"Excluir","goals.addContribution":"Adicionar ContribuiÃ§Ã£o","admin.title":"AdministraÃ§Ã£o","admin.appName":"Nome da App","admin.users":"Utilizadores","admin.backup":"Backup","admin.settings":"ConfiguraÃ§Ãµes","admin.addUser":"Adicionar Utilizador","admin.editUser":"Editar Utilizador","admin.deleteUser":"Excluir Utilizador","admin.manualBackup":"Backup Manual","admin.lastBackup":"Ãšltimo Backup","admin.autoBackup":"Auto Backup","admin.aiIntegration":"IntegraÃ§Ã£o IA","admin.geminiKey":"Chave Gemini","admin.save":"Guardar","admin.saved":"Guardado!","family.title":"FamÃ­lia","family.tasks":"Tarefas","family.events":"Eventos","family.addTask":"Adicionar Tarefa","family.addEvent":"Adicionar Evento","family.complete":"Concluir","family.delete":"Excluir","family.selectMembers":"Selecionar Membros","family.noData":"Dados Mascarados","inflation.title":"InflaÃ§Ã£o","inflation.purchaseAmount":"Valor de Compra","inflation.realValue":"Valor Real","inflation.currentRate":"Taxa Atual","inflation.baseCurrency":"Moeda Base","inflation.targetCurrency":"Moeda Alvo","inflation.period":"PerÃ­odo","inflation.swap":"Trocar","simulations.title":"SimulaÃ§Ãµes","simulations.loanAmount":"Valor do EmprÃ©stimo","simulations.interestRate":"Taxa de Juros","simulations.termMonths":"DuraÃ§Ã£o (Meses)","simulations.calculate":"Calcular","simulations.save":"Guardar","simulations.delete":"Excluir","simulations.system":"Sistema","simulations.uploadPDF":"Carregar PDF","inflation.maintainsRates":"BNA mantÃ©m taxas inalteradas.","inflation.basketRises":"Cesta bÃ¡sica sobe 2.3%.","inflation.highVolatility":"Alta volatilidade no mercado paralelo.","inflation.transportInflation":"Transportes impulsionam inflaÃ§Ã£o.","app.dashboard":"Dashboard","app.transactions":"TransaÃ§Ãµes","app.goals":"Metas","app.family":"FamÃ­lia","app.admin":"Administrador","app.budget":"OrÃ§amento","app.inflation":"InflaÃ§Ã£o","app.simulations":"SimulaÃ§Ãµes","app.logout":"Sair","app.settings":"ConfiguraÃ§Ãµes"},en:{"login.title":"Financial Management","login.subtitle":"Family Financial Management","login.username":"Username","login.password":"Password","login.enter":"Login","login.forgotPassword":"Forgot password","login.createFamily":"Create Family","login.language":"Language","login.select_language":"Select language...","login.portuguese":"PortuguÃªs","login.english":"English","login.spanish":"EspaÃ±ol","login.umbundu":"Umbundu","login.lingala":"Lingala","sidebar.dashboard":"Dashboard","sidebar.transactions":"Transactions","sidebar.budget":"Budget","sidebar.goals":"Goals","sidebar.inflation":"Inflation","sidebar.simulations":"Simulations","sidebar.family":"Family","sidebar.settings":"Settings","sidebar.logout":"Logout","sidebar.role.superadmin":"Super Admin","sidebar.role.admin":"Administrator","sidebar.role.manager":"Family Manager","sidebar.role.member":"Member","dashboard.title":"Dashboard","dashboard.income":"Income","dashboard.expenses":"Expenses","dashboard.balance":"Balance","dashboard.aiAdvice":"AI Advice","dashboard.analyzing":"Analyzing your finances with AI...","dashboard.analyzing_dot":"Analyzing...","dashboard.analyze":"Analyze","dashboard.analyzeBehavior":"Analyze Pattern","dashboard.analyzeWaste":"Analyze Waste","dashboard.forecast":"Forecast","dashboard.predicting":"Predicting...","dashboard.alerts":"Alerts","dashboard.excellent":"âœ¨ Excellent","dashboard.good":"âš ï¸ Good","dashboard.critical":"ðŸš¨ Critical","dashboard.thisMonth":"This Month","dashboard.thisYear":"This Year","dashboard.7days":"7 Days","dashboard.allTime":"All Time","dashboard.monthly":"Monthly","dashboard.annual":"Annual","transactions.title":"Transactions","transactions.new":"New Transaction","transactions.history":"History","transactions.subscriptions":"Subscriptions","transactions.search":"Search","transactions.edit":"Edit Transaction","transactions.delete":"Delete?","transactions.description":"Description","transactions.amount":"Amount","transactions.type":"Type","transactions.category":"Category","transactions.date":"Date","transactions.attachment":"Attachment","transactions.recurring":"Recurring","transactions.frequency":"Frequency","transactions.monthly":"Monthly","transactions.weekly":"Weekly","transactions.biweekly":"Biweekly","transactions.quarterly":"Quarterly","transactions.yearly":"Yearly","transactions.add":"Add","transactions.update":"Update","transactions.cancel":"Cancel","transactions.export":"Export","transactions.csv":"CSV","transactions.pdf":"PDF","transactions.note":"You can only edit your own transactions.","budget.title":"Budget","budget.add":"Add Budget","budget.category":"Category","budget.limit":"Limit","budget.spent":"Spent","budget.remaining":"Remaining","budget.delete":"Delete","budget.save":"Save","goals.title":"Goals","goals.new":"New Goal","goals.name":"Name","goals.target":"Target","goals.current":"Current","goals.contribution":"Contribution","goals.delete":"Delete","goals.addContribution":"Add Contribution","admin.title":"Administration","admin.appName":"App Name","admin.users":"Users","admin.backup":"Backup","admin.settings":"Settings","admin.addUser":"Add User","admin.editUser":"Edit User","admin.deleteUser":"Delete User","admin.manualBackup":"Manual Backup","admin.lastBackup":"Last Backup","admin.autoBackup":"Auto Backup","admin.aiIntegration":"AI Integration","admin.geminiKey":"Gemini Key","admin.save":"Save","admin.saved":"Saved!","family.title":"Family","family.tasks":"Tasks","family.events":"Events","family.addTask":"Add Task","family.addEvent":"Add Event","family.complete":"Complete","family.delete":"Delete","family.selectMembers":"Select Members","family.noData":"Masked Data","inflation.title":"Inflation","inflation.purchaseAmount":"Purchase Amount","inflation.realValue":"Real Value","inflation.currentRate":"Current Rate","inflation.baseCurrency":"Base Currency","inflation.targetCurrency":"Target Currency","inflation.period":"Period","inflation.swap":"Swap","simulations.title":"Simulations","simulations.loanAmount":"Loan Amount","simulations.interestRate":"Interest Rate","simulations.termMonths":"Duration (Months)","simulations.calculate":"Calculate","simulations.save":"Save","simulations.delete":"Delete","simulations.system":"System","simulations.uploadPDF":"Upload PDF","inflation.maintainsRates":"BNA maintains rates unchanged.","inflation.basketRises":"Basic basket rises 2.3%.","inflation.highVolatility":"High market volatility.","inflation.transportInflation":"Transport drives inflation.","app.dashboard":"Dashboard","app.transactions":"Transactions","app.goals":"Goals","app.family":"Family","app.admin":"Admin","app.budget":"Budget","app.inflation":"Inflation","app.simulations":"Simulations","app.logout":"Logout","app.settings":"Settings"},es:{"login.title":"GestiÃ³n Financiera","login.subtitle":"GestiÃ³n Financiera Familiar","login.username":"Usuario","login.password":"ContraseÃ±a","login.enter":"Entrar","login.forgotPassword":"OlvidÃ© mi contraseÃ±a","login.createFamily":"Crear Familia","login.language":"Idioma","login.select_language":"Seleccionar idioma...","login.portuguese":"PortuguÃªs","login.english":"English","login.spanish":"EspaÃ±ol","login.umbundu":"Umbundu","login.lingala":"Lingala","sidebar.dashboard":"Panel de Control","sidebar.transactions":"Transacciones","sidebar.budget":"Presupuesto","sidebar.goals":"Objetivos","sidebar.inflation":"InflaciÃ³n","sidebar.simulations":"Simulaciones","sidebar.family":"Familia","sidebar.settings":"ConfiguraciÃ³n","sidebar.logout":"Cerrar SesiÃ³n","sidebar.role.superadmin":"Super Admin","sidebar.role.admin":"Administrador","sidebar.role.manager":"Gestor Familiar","sidebar.role.member":"Miembro","dashboard.title":"Panel de Control","dashboard.income":"Ingresos","dashboard.expenses":"Gastos","dashboard.balance":"Saldo","dashboard.aiAdvice":"Consejo de IA","dashboard.analyzing":"Analizando sus finanzas con IA...","dashboard.analyzing_dot":"Analizando...","dashboard.analyze":"Analizar","dashboard.analyzeBehavior":"Analizar PatrÃ³n","dashboard.analyzeWaste":"Analizar Desperdicio","dashboard.forecast":"Pronosticar","dashboard.predicting":"Pronosticando...","dashboard.alerts":"Alertas","dashboard.excellent":"âœ¨ Excelente","dashboard.good":"âš ï¸ Bueno","dashboard.critical":"ðŸš¨ CrÃ­tico","dashboard.thisMonth":"Este Mes","dashboard.thisYear":"Este AÃ±o","dashboard.7days":"7 DÃ­as","dashboard.allTime":"Todos los Tiempos","dashboard.monthly":"Mensual","dashboard.annual":"Anual","transactions.title":"Transacciones","transactions.new":"Nueva TransacciÃ³n","transactions.history":"Historial","transactions.subscriptions":"Suscripciones","transactions.search":"Buscar","transactions.edit":"Editar TransacciÃ³n","transactions.delete":"Â¿Eliminar?","transactions.description":"DescripciÃ³n","transactions.amount":"Cantidad","transactions.type":"Tipo","transactions.category":"CategorÃ­a","transactions.date":"Fecha","transactions.attachment":"Archivo","transactions.recurring":"Repetible","transactions.frequency":"Frecuencia","transactions.monthly":"Mensual","transactions.weekly":"Semanal","transactions.biweekly":"Quincenal","transactions.quarterly":"Trimestral","transactions.yearly":"Anual","transactions.add":"Agregar","transactions.update":"Actualizar","transactions.cancel":"Cancelar","transactions.export":"Exportar","transactions.csv":"CSV","transactions.pdf":"PDF","transactions.note":"Solo puede editar sus propias transacciones.","budget.title":"Presupuesto","budget.add":"Agregar Presupuesto","budget.category":"CategorÃ­a","budget.limit":"LÃ­mite","budget.spent":"Gastado","budget.remaining":"Restante","budget.delete":"Eliminar","budget.save":"Guardar","goals.title":"Objetivos","goals.new":"Nuevo Objetivo","goals.name":"Nombre","goals.target":"Meta","goals.current":"Actual","goals.contribution":"ContribuciÃ³n","goals.delete":"Eliminar","goals.addContribution":"Agregar ContribuciÃ³n","admin.title":"AdministraciÃ³n","admin.appName":"Nombre de la App","admin.users":"Usuarios","admin.backup":"Respaldo","admin.settings":"ConfiguraciÃ³n","admin.addUser":"Agregar Usuario","admin.editUser":"Editar Usuario","admin.deleteUser":"Eliminar Usuario","admin.manualBackup":"Respaldo Manual","admin.lastBackup":"Ãšltimo Respaldo","admin.autoBackup":"Respaldo AutomÃ¡tico","admin.aiIntegration":"IntegraciÃ³n IA","admin.geminiKey":"Clave Gemini","admin.save":"Guardar","admin.saved":"Â¡Guardado!","family.title":"Familia","family.tasks":"Tareas","family.events":"Eventos","family.addTask":"Agregar Tarea","family.addEvent":"Agregar Evento","family.complete":"Completar","family.delete":"Eliminar","app.dashboard":"Panel de Control","app.transactions":"Transacciones","app.goals":"Objetivos","app.family":"Familia","app.admin":"Administrador","app.budget":"Presupuesto","app.inflation":"InflaciÃ³n","app.simulations":"Simulaciones","app.logout":"Cerrar SesiÃ³n","app.settings":"ConfiguraciÃ³n"},um:{"login.title":"Okusundila Ovimali","login.subtitle":"Okusundila Ovimali wa Elamba","login.username":"Olusungu","login.password":"Okusipi","login.enter":"Okuyingila","login.forgotPassword":"Nayiseka okusipi","login.createFamily":"Okwambula Elamba","login.language":"Oluvali","sidebar.dashboard":"Oyilo","sidebar.transactions":"Otegulelo","sidebar.budget":"Omanyumba","sidebar.goals":"Ondanda","sidebar.inflation":"Okuwanduka","sidebar.family":"Elamba","sidebar.logout":"Okupumbula","dashboard.title":"Oyilo","dashboard.income":"Ongonji","dashboard.expenses":"Omansende","dashboard.balance":"Okuwatala","dashboard.analyzing":"Okusundila ovimali vako...","dashboard.alerts":"Okulumuka","transactions.title":"Otegulelo","transactions.new":"Otegulelo okiliki","transactions.search":"Okukundeka","budget.title":"Omanyumba","goals.title":"Ondanda","goals.new":"Ondanda iliki","family.title":"Elamba","admin.title":"Omusunga"},ln:{"login.title":"Boyambisi ya Mbongo","login.subtitle":"Boyambisi ya Mbongo ya Libota","login.username":"Nkombo ya Mosepe","login.password":"Motele","login.enter":"Kota","login.forgotPassword":"Nabosani motele","login.createFamily":"Wumela Libota","login.language":"Lokota","sidebar.dashboard":"Plateau","sidebar.transactions":"Bandumba","sidebar.budget":"Mpakatano","sidebar.goals":"Makanisi","sidebar.inflation":"Mbalela","sidebar.family":"Libota","sidebar.logout":"KamatÃ¡","dashboard.title":"Plateau","dashboard.income":"Mbongo ya Koya","dashboard.expenses":"Mbongo ya Tumba","dashboard.balance":"Mbongo Oyo Bakala","dashboard.analyzing":"Kotalaka mbongo na yo...","dashboard.alerts":"Binduni","transactions.title":"Bandumba","transactions.new":"Bandumba ya Sika","transactions.search":"Yanda","budget.title":"Mpakatano","goals.title":"Makanisi","goals.new":"Kanisi ya Sika","family.title":"Libota","admin.title":"Mosepe Monene"},fr:{"login.title":"Gestion FinanciÃ¨re","login.subtitle":"Gestion FinanciÃ¨re Familiale","login.username":"Utilisateur","login.password":"Mot de passe","login.enter":"Connexion","login.forgotPassword":"Mot de passe oubliÃ©","login.createFamily":"CrÃ©er une Famille","login.language":"Langue","sidebar.dashboard":"Tableau de Bord","sidebar.transactions":"Transactions","sidebar.budget":"Budgets","sidebar.goals":"Objectifs","sidebar.inflation":"Inflation","sidebar.family":"Famille","sidebar.translations":"Traductions","sidebar.settings":"ParamÃ¨tres","sidebar.logout":"DÃ©connexion","dashboard.title":"Tableau de Bord","dashboard.income":"Revenus","dashboard.expenses":"DÃ©penses","dashboard.balance":"Solde","dashboard.analyzing":"Analyse de vos finances avec l'IA...","dashboard.alerts":"Alertes","transactions.title":"Transactions","transactions.new":"Nouvelle Transaction","transactions.search":"Rechercher","budget.title":"Budgets","goals.title":"Objectifs","goals.new":"Nouvel Objectif","family.title":"Famille","admin.title":"Administration"}},bd=({children:t,initialLanguage:e="pt"})=>{const[s,r]=T.useState(e),[a,o]=T.useState({}),[i,d]=T.useState(!0);T.useEffect(()=>{(async()=>{try{d(!0);const p=await fetch(`/locales/${s}.json`);if(p.ok){const h=await p.json();o(h)}else console.warn(`Failed to load ${s}.json`),o({})}catch(p){console.warn(`Error loading translations for ${s}:`,p),o({})}finally{d(!1)}})()},[s]),T.useEffect(()=>{e&&e!==s&&!localStorage.getItem("app_language")&&r(e)},[]),T.useEffect(()=>{localStorage.setItem("app_language",s),document.documentElement.lang=s==="um"?"pt":s},[s]);const u=m=>a[m]?a[m]:xd[s][m]||m,f=m=>{r(m)};return n.jsx(Vo.Provider,{value:{language:s,setLanguage:f,t:u},children:t})},He=()=>{const t=T.useContext(Vo);if(!t)throw new Error("useLanguage must be used within LanguageProvider");return t},yd=({user:t,onClose:e,onSave:s})=>{const{t:r}=He(),a=T.useRef(null),[o,i]=T.useState({name:t.name,email:t.email||"",username:t.username,avatar:t.avatar||"/default-avatar.svg"}),[d,u]=T.useState({current:"",new:"",confirm:""}),[f,m]=T.useState(!1),[p,h]=T.useState(""),g=()=>{a.current?.click()},y=w=>{if(w.target.files&&w.target.files[0]){const N=w.target.files[0],v=new FileReader;v.onloadend=()=>{i({...o,avatar:v.result})},v.readAsDataURL(N)}},b=()=>{const w={name:o.name,email:o.email,avatar:o.avatar};if(d.current||d.new||d.confirm){if(!d.current){h(r("profile.password_error_required_current"));return}if(!d.new||!d.confirm){h(r("profile.password_error_required_new"));return}if(d.new!==d.confirm){h(r("profile.password_error_mismatch"));return}if(d.new.length<4){h(r("profile.password_error_min_length"));return}w.password=d.new}s(w),m(!0),setTimeout(()=>{m(!1),e()},1500)};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in",children:n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-100 dark:border-slate-700 w-full max-w-md p-6 animate-scale-in max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6 sticky top-0 bg-white dark:bg-slate-800",children:[n.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:n.jsx(Qn,{size:24,className:"text-purple-600 dark:text-purple-400"})}),r("profile.title")]}),n.jsx("button",{onClick:e,className:"text-slate-400 hover:text-slate-600",children:n.jsx(at,{size:24})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-bold text-slate-600 dark:text-slate-400 mb-2 flex items-center gap-2",children:[n.jsx(Al,{size:16}),r("profile.avatar_label")]}),n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("img",{src:o.avatar,alt:"Avatar",className:"w-16 h-16 rounded-full border-2 border-slate-200 dark:border-slate-600 object-cover"}),n.jsx("button",{type:"button",onClick:g,className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 hover:opacity-100 transition text-white text-xs font-bold",children:r("profile.avatar_change")}),n.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:y,className:"hidden"})]}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:r("profile.avatar_hint")})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-bold text-slate-600 dark:text-slate-400 mb-2",children:r("profile.name_label")}),n.jsx("input",{type:"text",value:o.name,onChange:w=>i({...o,name:w.target.value}),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none"})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"block text-sm font-bold text-slate-600 dark:text-slate-400 mb-2 flex items-center gap-2",children:[n.jsx(Io,{size:16}),r("profile.email_label")]}),n.jsx("input",{type:"email",value:o.email,onChange:w=>i({...o,email:w.target.value}),placeholder:r("profile.email_placeholder"),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-bold text-slate-600 dark:text-slate-400 mb-2",children:r("profile.username_label")}),n.jsx("input",{type:"text",value:o.username,disabled:!0,className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-400 cursor-not-allowed opacity-60"}),n.jsx("p",{className:"text-xs text-slate-400 mt-1",children:r("profile.username_disabled")})]}),n.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4 mt-4",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 flex items-center gap-2",children:[n.jsx(Ut,{size:16}),r("profile.password_section")]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:r("profile.current_password")}),n.jsx("input",{type:"password",value:d.current,onChange:w=>{u({...d,current:w.target.value}),h("")},placeholder:r("profile.current_password_hint"),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:r("profile.new_password")}),n.jsx("input",{type:"password",value:d.new,onChange:w=>{u({...d,new:w.target.value}),h("")},placeholder:r("profile.new_password"),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-1",children:r("profile.confirm_password")}),n.jsx("input",{type:"password",value:d.confirm,onChange:w=>{u({...d,confirm:w.target.value}),h("")},placeholder:r("profile.confirm_password_hint"),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"})]})]}),p&&n.jsxs("p",{className:"text-xs text-rose-600 dark:text-rose-400 mt-2 font-bold",children:["âš ï¸ ",p]})]}),n.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[n.jsxs("button",{onClick:b,className:"flex-1 p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold transition flex items-center justify-center gap-2",children:[n.jsx(ut,{size:18}),r("profile.save_button")]}),n.jsx("button",{onClick:e,className:"flex-1 p-3 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-xl hover:bg-slate-200 font-bold transition",children:r("common.close")})]}),f&&n.jsx("div",{className:"p-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg",children:n.jsx("p",{className:"text-xs text-emerald-700 dark:text-emerald-400 font-bold",children:r("profile.success_message")})})]})]})})},vd=({appName:t,currentUser:e,currentView:s,setCurrentView:r,isMobileOpen:a,setIsMobileOpen:o,logout:i,onUpdateUser:d})=>{const{t:u}=He();T.useRef(null);const[f,m]=T.useState(!1),p=[{id:"dashboard",label:u("sidebar.dashboard"),icon:Il},{id:"ai_planning",label:u("sidebar.ai_planning"),icon:Rl},{id:"transactions",label:u("sidebar.transactions"),icon:Ro},{id:"budget",label:u("sidebar.budget"),icon:rn},{id:"goals",label:u("sidebar.goals"),icon:Pl},{id:"inflation",label:u("sidebar.inflation"),icon:At},{id:"simulations",label:u("sidebar.simulations"),icon:Po},{id:"family",label:u("sidebar.family"),icon:Ws}];(e.role===Re.TRANSLATOR||e.role===Re.SUPER_ADMIN)&&p.push({id:"translations",label:u("sidebar.translations")||"TraduÃ§Ãµes",icon:Ks}),(e.role===Re.ADMIN||e.role===Re.SUPER_ADMIN||e.role===Re.MANAGER)&&p.push({id:"admin",label:u("sidebar.settings"),icon:jl});const h=w=>{r(w),o(!1)},g=()=>{m(!0)},y=w=>{d&&d({...e,...w})},b=()=>e.role===Re.SUPER_ADMIN?u("sidebar.role.superadmin"):e.role===Re.ADMIN?u("sidebar.role.admin"):e.role===Re.MANAGER?u("sidebar.role.manager"):e.role===Re.TRANSLATOR?u("sidebar.role.translator")||"Tradutor":u("sidebar.role.member");return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:`
          fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-sm md:hidden transition-opacity duration-300
          ${a?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}
        `,onClick:()=>o(!1)}),n.jsxs("aside",{className:`
        fixed inset-y-0 left-0 z-[101] w-72 bg-white dark:bg-slate-900 border-r border-slate-100 dark:border-slate-800 transform transition-transform duration-300 ease-[cubic-bezier(0.16,1,0.3,1)]
        ${a?"translate-x-0 shadow-2xl":"-translate-x-full"}
        md:translate-x-0 md:static md:inset-0 flex flex-col md:shadow-none
      `,children:[n.jsxs("div",{className:"h-16 md:h-20 flex items-center px-4 md:px-6 border-b border-slate-50 dark:border-slate-800",children:[n.jsx("div",{className:"w-9 md:w-10 h-9 md:h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-lg md:rounded-xl flex items-center justify-center text-white shadow-glow mr-2 md:mr-3 shrink-0",children:n.jsx(Ml,{size:20,className:"md:w-6 md:h-6"})}),n.jsx("h1",{className:"text-base md:text-lg font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-slate-600 dark:from-white dark:to-slate-400 truncate tracking-tight min-w-0",children:t}),n.jsx("button",{onClick:()=>o(!1),className:"md:hidden ml-auto text-slate-400 p-1.5 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg shrink-0 active:scale-95 transition-transform",children:n.jsx(at,{size:18})})]}),n.jsx("div",{className:"p-3 md:p-4 flex-1 overflow-y-auto scrollbar-thin",children:n.jsxs("div",{className:"mb-6 md:mb-8","data-tour":"sidebar-menu",children:[n.jsx("p",{className:"px-3 md:px-4 text-[9px] md:text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2",children:"Menu Principal"}),n.jsx("nav",{className:"space-y-1",children:p.map(w=>{const N=w.icon,v=s===w.id;return n.jsxs("button",{onClick:()=>h(w.id),className:`
                      w-full flex items-center px-3 md:px-4 py-2.5 md:py-3 text-xs md:text-sm font-semibold rounded-lg md:rounded-xl transition-all duration-300 group active:scale-95 hover:scale-[1.02]
                      ${v?"bg-gradient-to-r from-primary-50 to-primary-100 dark:from-primary-900/30 dark:to-primary-900/10 text-primary-700 dark:text-primary-300 shadow-sm":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800/70 hover:text-primary-600 dark:hover:text-primary-400"}
                    `,children:[n.jsx(N,{size:16,className:`md:w-5 md:h-5 mr-2 md:mr-3 shrink-0 transition-all duration-300 ${v?"text-primary-600 dark:text-primary-400 scale-110":"text-slate-400 group-hover:text-primary-500 group-hover:scale-125"}`}),n.jsx("span",{className:"truncate",children:w.label}),v&&n.jsx("div",{className:"ml-auto w-2 h-2 rounded-full bg-primary-600 dark:bg-primary-400 animate-pulse-soft"})]},w.id)})})]})}),n.jsxs("div",{className:"p-4 border-t border-slate-50 dark:border-slate-800",children:[n.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl p-3 flex items-center mb-2 border border-slate-100 dark:border-slate-700 group transition-colors hover:border-slate-200 dark:hover:border-slate-600 active:scale-95 cursor-pointer",onClick:g,children:[n.jsxs("div",{className:"relative shrink-0",title:"Editar perfil",children:[n.jsx("img",{src:e.avatar,alt:"Avatar",className:"w-9 h-9 rounded-full border border-white dark:border-slate-600 shadow-sm object-cover group-hover:opacity-80 transition"}),n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-full opacity-0 group-hover:opacity-100 transition",children:n.jsx("span",{className:"text-xs text-white font-bold",children:"Edit"})})]}),n.jsxs("div",{className:"ml-3 overflow-hidden min-w-0",children:[n.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white truncate group-hover:text-primary-600 dark:group-hover:text-primary-400 transition",title:e.name,children:e.name}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 font-medium truncate",children:b()})]})]}),n.jsxs("button",{onClick:i,className:"flex items-center justify-center w-full px-4 py-2.5 text-xs font-bold text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/10 rounded-xl transition-all active:scale-95",children:[n.jsx(Dl,{size:16,className:"mr-2 shrink-0"}),"Encerrar SessÃ£o"]})]})]}),f&&n.jsx(yd,{user:e,onClose:()=>m(!1),onSave:y})]})};let wd,_d;function Nd(){return{geminiUrl:wd,vertexUrl:_d}}function kd(t,e,s,r){var a,o;if(!t?.baseUrl){const i=Nd();return e?(a=i.vertexUrl)!==null&&a!==void 0?a:s:(o=i.geminiUrl)!==null&&o!==void 0?o:r}return t.baseUrl}class kt{}function ge(t,e){const s=/\{([^}]+)\}/g;return t.replace(s,(r,a)=>{if(Object.prototype.hasOwnProperty.call(e,a)){const o=e[a];return o!=null?String(o):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function c(t,e,s){for(let o=0;o<e.length-1;o++){const i=e[o];if(i.endsWith("[]")){const d=i.slice(0,-2);if(!(d in t))if(Array.isArray(s))t[d]=Array.from({length:s.length},()=>({}));else throw new Error(`Value must be a list given an array path ${i}`);if(Array.isArray(t[d])){const u=t[d];if(Array.isArray(s))for(let f=0;f<u.length;f++){const m=u[f];c(m,e.slice(o+1),s[f])}else for(const f of u)c(f,e.slice(o+1),s)}return}else if(i.endsWith("[0]")){const d=i.slice(0,-3);d in t||(t[d]=[{}]);const u=t[d];c(u[0],e.slice(o+1),s);return}(!t[i]||typeof t[i]!="object")&&(t[i]={}),t=t[i]}const r=e[e.length-1],a=t[r];if(a!==void 0){if(!s||typeof s=="object"&&Object.keys(s).length===0||s===a)return;if(typeof a=="object"&&typeof s=="object"&&a!==null&&s!==null)Object.assign(a,s);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else r==="_self"&&typeof s=="object"&&s!==null&&!Array.isArray(s)?Object.assign(t,s):t[r]=s}function l(t,e,s=void 0){try{if(e.length===1&&e[0]==="_self")return t;for(let r=0;r<e.length;r++){if(typeof t!="object"||t===null)return s;const a=e[r];if(a.endsWith("[]")){const o=a.slice(0,-2);if(o in t){const i=t[o];return Array.isArray(i)?i.map(d=>l(d,e.slice(r+1),s)):s}else return s}else t=t[a]}return t}catch(r){if(r instanceof TypeError)return s;throw r}}function Sd(t,e){for(const[s,r]of Object.entries(e)){const a=s.split("."),o=r.split("."),i=new Set;let d=-1;for(let u=0;u<a.length;u++)if(a[u]==="*"){d=u;break}if(d!==-1&&o.length>d)for(let u=d;u<o.length;u++){const f=o[u];f!=="*"&&!f.endsWith("[]")&&!f.endsWith("[0]")&&i.add(f)}jn(t,a,o,0,i)}}function jn(t,e,s,r,a){if(r>=e.length||typeof t!="object"||t===null)return;const o=e[r];if(o.endsWith("[]")){const i=o.slice(0,-2),d=t;if(i in d&&Array.isArray(d[i]))for(const u of d[i])jn(u,e,s,r+1,a)}else if(o==="*"){if(typeof t=="object"&&t!==null&&!Array.isArray(t)){const i=t,d=Object.keys(i).filter(f=>!f.startsWith("_")&&!a.has(f)),u={};for(const f of d)u[f]=i[f];for(const[f,m]of Object.entries(u)){const p=[];for(const h of s.slice(r))h==="*"?p.push(f):p.push(h);c(i,p,m)}for(const f of d)delete i[f]}}else{const i=t;o in i&&jn(i[o],e,s,r+1,a)}}function tr(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function Cd(t){const e={},s=l(t,["operationName"]);s!=null&&c(e,["operationName"],s);const r=l(t,["resourceName"]);return r!=null&&c(e,["_url","resourceName"],r),e}function Ed(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response","generateVideoResponse"]);return i!=null&&c(e,["response"],Ad(i)),e}function Td(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response"]);return i!=null&&c(e,["response"],Id(i)),e}function Ad(t){const e={},s=l(t,["generatedSamples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(i=>Rd(i))),c(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const a=l(t,["raiMediaFilteredReasons"]);return a!=null&&c(e,["raiMediaFilteredReasons"],a),e}function Id(t){const e={},s=l(t,["videos"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(i=>Pd(i))),c(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const a=l(t,["raiMediaFilteredReasons"]);return a!=null&&c(e,["raiMediaFilteredReasons"],a),e}function Rd(t){const e={},s=l(t,["video"]);return s!=null&&c(e,["video"],Ud(s)),e}function Pd(t){const e={},s=l(t,["_self"]);return s!=null&&c(e,["video"],zd(s)),e}function jd(t){const e={},s=l(t,["operationName"]);return s!=null&&c(e,["_url","operationName"],s),e}function Md(t){const e={},s=l(t,["operationName"]);return s!=null&&c(e,["_url","operationName"],s),e}function Dd(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response"]);return i!=null&&c(e,["response"],Fd(i)),e}function Fd(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["parent"]);r!=null&&c(e,["parent"],r);const a=l(t,["documentName"]);return a!=null&&c(e,["documentName"],a),e}function $o(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response"]);return i!=null&&c(e,["response"],Ld(i)),e}function Ld(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["parent"]);r!=null&&c(e,["parent"],r);const a=l(t,["documentName"]);return a!=null&&c(e,["documentName"],a),e}function Ud(t){const e={},s=l(t,["uri"]);s!=null&&c(e,["uri"],s);const r=l(t,["encodedVideo"]);r!=null&&c(e,["videoBytes"],tr(r));const a=l(t,["encoding"]);return a!=null&&c(e,["mimeType"],a),e}function zd(t){const e={},s=l(t,["gcsUri"]);s!=null&&c(e,["uri"],s);const r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],tr(r));const a=l(t,["mimeType"]);return a!=null&&c(e,["mimeType"],a),e}var Sr;(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Sr||(Sr={}));var Cr;(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Cr||(Cr={}));var Er;(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Er||(Er={}));var Tt;(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Tt||(Tt={}));var Tr;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Tr||(Tr={}));var Ar;(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Ar||(Ar={}));var Ir;(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Ir||(Ir={}));var Rr;(function(t){t.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",t.HTTP_IN_QUERY="HTTP_IN_QUERY",t.HTTP_IN_HEADER="HTTP_IN_HEADER",t.HTTP_IN_PATH="HTTP_IN_PATH",t.HTTP_IN_BODY="HTTP_IN_BODY",t.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Rr||(Rr={}));var Pr;(function(t){t.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",t.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",t.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",t.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Pr||(Pr={}));var jr;(function(t){t.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",t.LOW="LOW",t.HIGH="HIGH"})(jr||(jr={}));var Mr;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Mr||(Mr={}));var Dr;(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Dr||(Dr={}));var Fr;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(Fr||(Fr={}));var Lr;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"})(Lr||(Lr={}));var Ur;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Ur||(Ur={}));var zr;(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(zr||(zr={}));var qr;(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(qr||(qr={}));var Gr;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"})(Gr||(Gr={}));var Br;(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Br||(Br={}));var Qs;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Qs||(Qs={}));var Or;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Or||(Or={}));var Vr;(function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Vr||(Vr={}));var $r;(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})($r||($r={}));var Mn;(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Mn||(Mn={}));var Hr;(function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V",t.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Hr||(Hr={}));var Jr;(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Jr||(Jr={}));var Wr;(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(Wr||(Wr={}));var Kr;(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(Kr||(Kr={}));var Yr;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(Yr||(Yr={}));var Xr;(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Xr||(Xr={}));var Zr;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"})(Zr||(Zr={}));var Qr;(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(Qr||(Qr={}));var ea;(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(ea||(ea={}));var ta;(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(ta||(ta={}));var sa;(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(sa||(sa={}));var na;(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(na||(na={}));var ra;(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(ra||(ra={}));var aa;(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(aa||(aa={}));var oa;(function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"})(oa||(oa={}));var ia;(function(t){t.ASSET="ASSET",t.STYLE="STYLE"})(ia||(ia={}));var la;(function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"})(la||(la={}));var da;(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(da||(da={}));var ca;(function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"})(ca||(ca={}));var ua;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.STATE_PENDING="STATE_PENDING",t.STATE_ACTIVE="STATE_ACTIVE",t.STATE_FAILED="STATE_FAILED"})(ua||(ua={}));var fa;(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(fa||(fa={}));var ma;(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(ma||(ma={}));var ha;(function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"})(ha||(ha={}));var pa;(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(pa||(pa={}));var ga;(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(ga||(ga={}));var xa;(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(xa||(xa={}));var ba;(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(ba||(ba={}));var ya;(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(ya||(ya={}));var va;(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(va||(va={}));var wa;(function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"})(wa||(wa={}));var Zt;(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(Zt||(Zt={}));class Dn{constructor(e){const s={};for(const r of e.headers.entries())s[r[0]]=r[1];this.headers=s,this.responseInternal=e}json(){return this.responseInternal.json()}}class hs{get text(){var e,s,r,a,o,i,d,u;if(((a=(r=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let f="",m=!1;const p=[];for(const h of(u=(d=(i=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content)===null||d===void 0?void 0:d.parts)!==null&&u!==void 0?u:[]){for(const[g,y]of Object.entries(h))g!=="text"&&g!=="thought"&&g!=="thoughtSignature"&&(y!==null||y!==void 0)&&p.push(g);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;m=!0,f+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),m?f:void 0}get data(){var e,s,r,a,o,i,d,u;if(((a=(r=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let f="";const m=[];for(const p of(u=(d=(i=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content)===null||d===void 0?void 0:d.parts)!==null&&u!==void 0?u:[]){for(const[h,g]of Object.entries(p))h!=="inlineData"&&(g!==null||g!==void 0)&&m.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(f+=atob(p.inlineData.data))}return m.length>0&&console.warn(`there are non-data parts ${m} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),f.length>0?btoa(f):void 0}get functionCalls(){var e,s,r,a,o,i,d,u;if(((a=(r=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const f=(u=(d=(i=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content)===null||d===void 0?void 0:d.parts)===null||u===void 0?void 0:u.filter(m=>m.functionCall).map(m=>m.functionCall).filter(m=>m!==void 0);if(f?.length!==0)return f}get executableCode(){var e,s,r,a,o,i,d,u,f;if(((a=(r=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const m=(u=(d=(i=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content)===null||d===void 0?void 0:d.parts)===null||u===void 0?void 0:u.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if(m?.length!==0)return(f=m?.[0])===null||f===void 0?void 0:f.code}get codeExecutionResult(){var e,s,r,a,o,i,d,u,f;if(((a=(r=(s=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||s===void 0?void 0:s.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const m=(u=(d=(i=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content)===null||d===void 0?void 0:d.parts)===null||u===void 0?void 0:u.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if(m?.length!==0)return(f=m?.[0])===null||f===void 0?void 0:f.output}}class _a{}class Na{}class qd{}class Gd{}class Bd{}class Od{}class ka{}class Sa{}class Ca{}class Vd{}class en{_fromAPIResponse({apiResponse:e,_isVertexAI:s}){const r=new en;let a;const o=e;return s?a=Td(o):a=Ed(o),Object.assign(r,a),r}}class Ea{}class Ta{}class Aa{}class $d{}class Hd{}class Jd{}class sr{_fromAPIResponse({apiResponse:e,_isVertexAI:s}){const r=new sr,o=Dd(e);return Object.assign(r,o),r}}class Wd{}class Kd{}class Yd{}class Ia{}class Xd{get text(){var e,s,r;let a="",o=!1;const i=[];for(const d of(r=(s=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||s===void 0?void 0:s.parts)!==null&&r!==void 0?r:[]){for(const[u,f]of Object.entries(d))u!=="text"&&u!=="thought"&&f!==null&&i.push(u);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;o=!0,a+=d.text}}return i.length>0&&console.warn(`there are non-text parts ${i} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?a:void 0}get data(){var e,s,r;let a="";const o=[];for(const i of(r=(s=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||s===void 0?void 0:s.parts)!==null&&r!==void 0?r:[]){for(const[d,u]of Object.entries(i))d!=="inlineData"&&u!==null&&o.push(d);i.inlineData&&typeof i.inlineData.data=="string"&&(a+=atob(i.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}class Zd{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class nr{_fromAPIResponse({apiResponse:e,_isVertexAI:s}){const r=new nr,o=$o(e);return Object.assign(r,o),r}}function Pe(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const s=e.split("/",2);return`publishers/${s[0]}/models/${s[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Ho(t,e){const s=Pe(t,e);return s?s.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${s}`:s.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${s}`:s:""}function Jo(t){return Array.isArray(t)?t.map(e=>tn(e)):[tn(t)]}function tn(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Wo(t){const e=tn(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ko(t){const e=tn(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ra(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Yo(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Ra(e)):[Ra(t)]}function Fn(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function Pa(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function ja(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function Ke(t){if(t==null)throw new Error("ContentUnion is required");return Fn(t)?t:{role:"user",parts:Yo(t)}}function rr(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(s=>{const r=Ke(s);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(t.isVertexAI()){const s=Ke(e);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]}return Array.isArray(e)?e.map(s=>Ke(s)):[Ke(e)]}function lt(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(Pa(t)||ja(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ke(t)]}const e=[],s=[],r=Fn(t[0]);for(const a of t){const o=Fn(a);if(o!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(a);else{if(Pa(a)||ja(a))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");s.push(a)}}return r||e.push({role:"user",parts:Yo(s)}),e}function Qd(t,e){t.includes("null")&&(e.nullable=!0);const s=t.filter(r=>r!=="null");if(s.length===1)e.type=Object.values(Tt).includes(s[0].toUpperCase())?s[0].toUpperCase():Tt.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of s)e.anyOf.push({type:Object.values(Tt).includes(r.toUpperCase())?r.toUpperCase():Tt.TYPE_UNSPECIFIED})}}function ss(t){const e={},s=["items"],r=["anyOf"],a=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=t.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,t=o[1]):o[1].type==="null"&&(e.nullable=!0,t=o[0])),t.type instanceof Array&&Qd(t.type,e);for(const[i,d]of Object.entries(t))if(d!=null)if(i=="type"){if(d==="null")throw new Error("type: null can not be the only possible type for the field.");if(d instanceof Array)continue;e.type=Object.values(Tt).includes(d.toUpperCase())?d.toUpperCase():Tt.TYPE_UNSPECIFIED}else if(s.includes(i))e[i]=ss(d);else if(r.includes(i)){const u=[];for(const f of d){if(f.type=="null"){e.nullable=!0;continue}u.push(ss(f))}e[i]=u}else if(a.includes(i)){const u={};for(const[f,m]of Object.entries(d))u[f]=ss(m);e[i]=u}else{if(i==="additionalProperties")continue;e[i]=d}return e}function ar(t){return ss(t)}function or(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function ir(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function ls(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=ss(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=ss(e.response));return t}function ds(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const s of t)e.push(s);return e}function ec(t,e,s,r=1){const a=!e.startsWith(`${s}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${s}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:a?`projects/${t.getProject()}/locations/${t.getLocation()}/${s}/${e}`:e:a?`${s}/${e}`:e}function St(t,e){if(typeof e!="string")throw new Error("name must be a string");return ec(t,e,"cachedContents")}function Xo(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function Rt(t){return tr(t)}function tc(t){return t!=null&&typeof t=="object"&&"name"in t}function sc(t){return t!=null&&typeof t=="object"&&"video"in t}function nc(t){return t!=null&&typeof t=="object"&&"uri"in t}function Zo(t){var e;let s;if(tc(t)&&(s=t.name),!(nc(t)&&(s=t.uri,s===void 0))&&!(sc(t)&&(s=(e=t.video)===null||e===void 0?void 0:e.uri,s===void 0))){if(typeof t=="string"&&(s=t),s===void 0)throw new Error("Could not extract file name from the provided input.");if(s.startsWith("https://")){const a=s.split("files/")[1].match(/[a-z0-9]+/);if(a===null)throw new Error(`Could not extract file name from URI ${s}`);s=a[0]}else s.startsWith("files/")&&(s=s.split("files/")[1]);return s}}function Qo(t,e){let s;return t.isVertexAI()?s=e?"publishers/google/models":"models":s=e?"models":"tunedModels",s}function ei(t){for(const e of["models","tunedModels","publisherModels"])if(rc(t,e))return t[e];return[]}function rc(t,e){return t!==null&&typeof t=="object"&&e in t}function ac(t,e={}){const s=t,r={name:s.name,description:s.description,parametersJsonSchema:s.inputSchema};return s.outputSchema&&(r.responseJsonSchema=s.outputSchema),e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function oc(t,e={}){const s=[],r=new Set;for(const a of t){const o=a.name;if(r.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);r.add(o);const i=ac(a,e);i.functionDeclarations&&s.push(...i.functionDeclarations)}return{functionDeclarations:s}}function ti(t,e){let s;if(typeof e=="string")if(t.isVertexAI())if(e.startsWith("gs://"))s={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))s={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))s={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");s={inlinedRequests:e}}else s=e;const r=[s.gcsUri,s.bigqueryUri].filter(Boolean).length,a=[s.inlinedRequests,s.fileName].filter(Boolean).length;if(t.isVertexAI()){if(a>0||r!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||a!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return s}function ic(t){if(typeof t!="string")return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function si(t){if(typeof t!="object"||t===null)return{};const e=t,s=e.inlinedResponses;if(typeof s!="object"||s===null)return t;const a=s.inlinedResponses;if(!Array.isArray(a)||a.length===0)return t;let o=!1;for(const i of a){if(typeof i!="object"||i===null)continue;const u=i.response;if(typeof u!="object"||u===null)continue;if(u.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function cs(t,e){const s=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(s))return s.split("/").pop();throw new Error(`Invalid batch job name: ${s}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(s))return s.split("/").pop();if(/^\d+$/.test(s))return s;throw new Error(`Invalid batch job name: ${s}.`)}function ni(t){const e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function lc(t){const e={},s=l(t,["responsesFile"]);s!=null&&c(e,["fileName"],s);const r=l(t,["inlinedResponses","inlinedResponses"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>Bc(i))),c(e,["inlinedResponses"],o)}const a=l(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["inlinedEmbedContentResponses"],o)}return e}function dc(t){const e={},s=l(t,["predictionsFormat"]);s!=null&&c(e,["format"],s);const r=l(t,["gcsDestination","outputUriPrefix"]);r!=null&&c(e,["gcsUri"],r);const a=l(t,["bigqueryDestination","outputUri"]);return a!=null&&c(e,["bigqueryUri"],a),e}function cc(t){const e={},s=l(t,["format"]);s!=null&&c(e,["predictionsFormat"],s);const r=l(t,["gcsUri"]);r!=null&&c(e,["gcsDestination","outputUriPrefix"],r);const a=l(t,["bigqueryUri"]);if(a!=null&&c(e,["bigqueryDestination","outputUri"],a),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(l(t,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Bs(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata","displayName"]);r!=null&&c(e,["displayName"],r);const a=l(t,["metadata","state"]);a!=null&&c(e,["state"],ni(a));const o=l(t,["metadata","createTime"]);o!=null&&c(e,["createTime"],o);const i=l(t,["metadata","endTime"]);i!=null&&c(e,["endTime"],i);const d=l(t,["metadata","updateTime"]);d!=null&&c(e,["updateTime"],d);const u=l(t,["metadata","model"]);u!=null&&c(e,["model"],u);const f=l(t,["metadata","output"]);return f!=null&&c(e,["dest"],lc(si(f))),e}function Ln(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);const a=l(t,["state"]);a!=null&&c(e,["state"],ni(a));const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["createTime"]);i!=null&&c(e,["createTime"],i);const d=l(t,["startTime"]);d!=null&&c(e,["startTime"],d);const u=l(t,["endTime"]);u!=null&&c(e,["endTime"],u);const f=l(t,["updateTime"]);f!=null&&c(e,["updateTime"],f);const m=l(t,["model"]);m!=null&&c(e,["model"],m);const p=l(t,["inputConfig"]);p!=null&&c(e,["src"],uc(p));const h=l(t,["outputConfig"]);h!=null&&c(e,["dest"],dc(si(h)));const g=l(t,["completionStats"]);return g!=null&&c(e,["completionStats"],g),e}function uc(t){const e={},s=l(t,["instancesFormat"]);s!=null&&c(e,["format"],s);const r=l(t,["gcsSource","uris"]);r!=null&&c(e,["gcsUri"],r);const a=l(t,["bigquerySource","inputUri"]);return a!=null&&c(e,["bigqueryUri"],a),e}function fc(t,e){const s={};if(l(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(l(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=l(e,["fileName"]);r!=null&&c(s,["fileName"],r);const a=l(e,["inlinedRequests"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>Gc(t,i))),c(s,["requests","requests"],o)}return s}function mc(t){const e={},s=l(t,["format"]);s!=null&&c(e,["instancesFormat"],s);const r=l(t,["gcsUri"]);r!=null&&c(e,["gcsSource","uris"],r);const a=l(t,["bigqueryUri"]);if(a!=null&&c(e,["bigquerySource","inputUri"],a),l(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(l(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function hc(t){const e={},s=l(t,["data"]);if(s!=null&&c(e,["data"],s),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function pc(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],cs(t,r)),s}function gc(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],cs(t,r)),s}function xc(t){const e={},s=l(t,["content"]);s!=null&&c(e,["content"],s);const r=l(t,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],bc(r));const a=l(t,["tokenCount"]);a!=null&&c(e,["tokenCount"],a);const o=l(t,["finishReason"]);o!=null&&c(e,["finishReason"],o);const i=l(t,["avgLogprobs"]);i!=null&&c(e,["avgLogprobs"],i);const d=l(t,["groundingMetadata"]);d!=null&&c(e,["groundingMetadata"],d);const u=l(t,["index"]);u!=null&&c(e,["index"],u);const f=l(t,["logprobsResult"]);f!=null&&c(e,["logprobsResult"],f);const m=l(t,["safetyRatings"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(g=>g)),c(e,["safetyRatings"],h)}const p=l(t,["urlContextMetadata"]);return p!=null&&c(e,["urlContextMetadata"],p),e}function bc(t){const e={},s=l(t,["citationSources"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),c(e,["citations"],r)}return e}function ri(t){const e={},s=l(t,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>Kc(o))),c(e,["parts"],a)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function yc(t,e){const s={},r=l(t,["displayName"]);if(e!==void 0&&r!=null&&c(e,["batch","displayName"],r),l(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return s}function vc(t,e){const s={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);const a=l(t,["dest"]);return e!==void 0&&a!=null&&c(e,["outputConfig"],cc(ic(a))),s}function Ma(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["src"]);a!=null&&c(s,["batch","inputConfig"],fc(t,ti(t,a)));const o=l(e,["config"]);return o!=null&&yc(o,s),s}function wc(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["model"],Pe(t,r));const a=l(e,["src"]);a!=null&&c(s,["inputConfig"],mc(ti(t,a)));const o=l(e,["config"]);return o!=null&&vc(o,s),s}function _c(t,e){const s={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&c(e,["batch","displayName"],r),s}function Nc(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["src"]);a!=null&&c(s,["batch","inputConfig"],Ic(t,a));const o=l(e,["config"]);return o!=null&&_c(o,s),s}function kc(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],cs(t,r)),s}function Sc(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],cs(t,r)),s}function Cc(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);return o!=null&&c(e,["error"],o),e}function Ec(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);return o!=null&&c(e,["error"],o),e}function Tc(t,e){const s={},r=l(e,["contents"]);if(r!=null){let o=rr(t,r);Array.isArray(o)&&(o=o.map(i=>i)),c(s,["requests[]","request","content"],o)}const a=l(e,["config"]);return a!=null&&(c(s,["_self"],Ac(a,s)),Sd(s,{"requests[].*":"requests[].request.*"})),s}function Ac(t,e){const s={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);const a=l(t,["title"]);e!==void 0&&a!=null&&c(e,["requests[]","title"],a);const o=l(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&c(e,["requests[]","outputDimensionality"],o),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return s}function Ic(t,e){const s={},r=l(e,["fileName"]);r!=null&&c(s,["file_name"],r);const a=l(e,["inlinedRequests"]);return a!=null&&c(s,["requests"],Tc(t,a)),s}function Rc(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=l(t,["fileUri"]);s!=null&&c(e,["fileUri"],s);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Pc(t){const e={},s=l(t,["id"]);s!=null&&c(e,["id"],s);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const a=l(t,["name"]);if(a!=null&&c(e,["name"],a),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function jc(t){const e={},s=l(t,["mode"]);s!=null&&c(e,["mode"],s);const r=l(t,["allowedFunctionNames"]);if(r!=null&&c(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Mc(t,e,s){const r={},a=l(e,["systemInstruction"]);s!==void 0&&a!=null&&c(s,["systemInstruction"],ri(Ke(a)));const o=l(e,["temperature"]);o!=null&&c(r,["temperature"],o);const i=l(e,["topP"]);i!=null&&c(r,["topP"],i);const d=l(e,["topK"]);d!=null&&c(r,["topK"],d);const u=l(e,["candidateCount"]);u!=null&&c(r,["candidateCount"],u);const f=l(e,["maxOutputTokens"]);f!=null&&c(r,["maxOutputTokens"],f);const m=l(e,["stopSequences"]);m!=null&&c(r,["stopSequences"],m);const p=l(e,["responseLogprobs"]);p!=null&&c(r,["responseLogprobs"],p);const h=l(e,["logprobs"]);h!=null&&c(r,["logprobs"],h);const g=l(e,["presencePenalty"]);g!=null&&c(r,["presencePenalty"],g);const y=l(e,["frequencyPenalty"]);y!=null&&c(r,["frequencyPenalty"],y);const b=l(e,["seed"]);b!=null&&c(r,["seed"],b);const w=l(e,["responseMimeType"]);w!=null&&c(r,["responseMimeType"],w);const N=l(e,["responseSchema"]);N!=null&&c(r,["responseSchema"],ar(N));const v=l(e,["responseJsonSchema"]);if(v!=null&&c(r,["responseJsonSchema"],v),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const k=l(e,["safetySettings"]);if(s!==void 0&&k!=null){let S=k;Array.isArray(S)&&(S=S.map(G=>Yc(G))),c(s,["safetySettings"],S)}const A=l(e,["tools"]);if(s!==void 0&&A!=null){let S=ds(A);Array.isArray(S)&&(S=S.map(G=>Zc(ls(G)))),c(s,["tools"],S)}const C=l(e,["toolConfig"]);if(s!==void 0&&C!=null&&c(s,["toolConfig"],Xc(C)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=l(e,["cachedContent"]);s!==void 0&&P!=null&&c(s,["cachedContent"],St(t,P));const D=l(e,["responseModalities"]);D!=null&&c(r,["responseModalities"],D);const B=l(e,["mediaResolution"]);B!=null&&c(r,["mediaResolution"],B);const R=l(e,["speechConfig"]);if(R!=null&&c(r,["speechConfig"],or(R)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const U=l(e,["thinkingConfig"]);U!=null&&c(r,["thinkingConfig"],U);const Q=l(e,["imageConfig"]);return Q!=null&&c(r,["imageConfig"],qc(Q)),r}function Dc(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>xc(f))),c(e,["candidates"],u)}const a=l(t,["modelVersion"]);a!=null&&c(e,["modelVersion"],a);const o=l(t,["promptFeedback"]);o!=null&&c(e,["promptFeedback"],o);const i=l(t,["responseId"]);i!=null&&c(e,["responseId"],i);const d=l(t,["usageMetadata"]);return d!=null&&c(e,["usageMetadata"],d),e}function Fc(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],cs(t,r)),s}function Lc(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],cs(t,r)),s}function Uc(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=l(t,["enableWidget"]);return s!=null&&c(e,["enableWidget"],s),e}function zc(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=l(t,["timeRangeFilter"]);return s!=null&&c(e,["timeRangeFilter"],s),e}function qc(t){const e={},s=l(t,["aspectRatio"]);s!=null&&c(e,["aspectRatio"],s);const r=l(t,["imageSize"]);if(r!=null&&c(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function Gc(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["request","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let d=lt(a);Array.isArray(d)&&(d=d.map(u=>ri(u))),c(s,["request","contents"],d)}const o=l(e,["metadata"]);o!=null&&c(s,["metadata"],o);const i=l(e,["config"]);return i!=null&&c(s,["request","generationConfig"],Mc(t,i,l(s,["request"],{}))),s}function Bc(t){const e={},s=l(t,["response"]);s!=null&&c(e,["response"],Dc(s));const r=l(t,["error"]);return r!=null&&c(e,["error"],r),e}function Oc(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);if(e!==void 0&&a!=null&&c(e,["_query","pageToken"],a),l(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return s}function Vc(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);e!==void 0&&a!=null&&c(e,["_query","pageToken"],a);const o=l(t,["filter"]);return e!==void 0&&o!=null&&c(e,["_query","filter"],o),s}function $c(t){const e={},s=l(t,["config"]);return s!=null&&Oc(s,e),e}function Hc(t){const e={},s=l(t,["config"]);return s!=null&&Vc(s,e),e}function Jc(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["operations"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>Bs(i))),c(e,["batchJobs"],o)}return e}function Wc(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["batchPredictionJobs"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>Ln(i))),c(e,["batchJobs"],o)}return e}function Kc(t){const e={},s=l(t,["mediaResolution"]);s!=null&&c(e,["mediaResolution"],s);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const a=l(t,["executableCode"]);a!=null&&c(e,["executableCode"],a);const o=l(t,["fileData"]);o!=null&&c(e,["fileData"],Rc(o));const i=l(t,["functionCall"]);i!=null&&c(e,["functionCall"],Pc(i));const d=l(t,["functionResponse"]);d!=null&&c(e,["functionResponse"],d);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],hc(u));const f=l(t,["text"]);f!=null&&c(e,["text"],f);const m=l(t,["thought"]);m!=null&&c(e,["thought"],m);const p=l(t,["thoughtSignature"]);p!=null&&c(e,["thoughtSignature"],p);const h=l(t,["videoMetadata"]);return h!=null&&c(e,["videoMetadata"],h),e}function Yc(t){const e={},s=l(t,["category"]);if(s!=null&&c(e,["category"],s),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function Xc(t){const e={},s=l(t,["functionCallingConfig"]);s!=null&&c(e,["functionCallingConfig"],jc(s));const r=l(t,["retrievalConfig"]);return r!=null&&c(e,["retrievalConfig"],r),e}function Zc(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>p)),c(e,["functionDeclarations"],m)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const a=l(t,["computerUse"]);a!=null&&c(e,["computerUse"],a);const o=l(t,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);const i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=l(t,["googleMaps"]);d!=null&&c(e,["googleMaps"],Uc(d));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],zc(u));const f=l(t,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}var Nt;(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",t.PAGED_ITEM_DOCUMENTS="documents"})(Nt||(Nt={}));class $t{constructor(e,s,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=s,this.init(e,r,a)}init(e,s,r){var a,o;this.nameInternal=e,this.pageInternal=s[this.nameInternal]||[],this.sdkHttpResponseInternal=s?.sdkHttpResponse,this.idxInternal=0;let i={config:{}};!r||Object.keys(r).length===0?i={config:{}}:typeof r=="object"?i=Object.assign({},r):i=r,i.config&&(i.config.pageToken=s.nextPageToken),this.paramsInternal=i,this.pageInternalSize=(o=(a=i.config)===null||a===void 0?void 0:a.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}let Qc=class extends kt{constructor(e){super(),this.apiClient=e,this.create=async s=>(this.apiClient.isVertexAI()&&(s.config=this.formatDestination(s.src,s.config)),this.createInternal(s)),this.createEmbeddings=async s=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(s)},this.list=async(s={})=>new $t(Nt.PAGED_ITEM_BATCH_JOBS,r=>this.listInternal(r),await this.listInternal(s),s)}createInlinedGenerateContentRequest(e){const s=Ma(this.apiClient,e),r=s._url,a=ge("{model}:batchGenerateContent",r),d=s.batch.inputConfig.requests,u=d.requests,f=[];for(const m of u){const p=Object.assign({},m);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const g=p.request;g.systemInstruction=h,p.request=g}f.push(p)}return d.requests=f,delete s.config,delete s._url,delete s._query,{path:a,body:s}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,s){const r=s?Object.assign({},s):{},a=Date.now().toString();if(r.displayName||(r.displayName=`genaiBatchJob_${a}`),r.dest===void 0){const o=this.getGcsUri(e),i=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?r.dest=`${o.slice(0,-6)}/dest`:r.dest=`${o}_dest_${a}`;else if(i)r.dest=`${i}_dest_${a}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return r}async createInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=wc(this.apiClient,e);return d=ge("batchPredictionJobs",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>Ln(m))}else{const f=Ma(this.apiClient,e);return d=ge("{model}:batchGenerateContent",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>Bs(m))}}async createEmbeddingsInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Nc(this.apiClient,e);return o=ge("{model}:asyncBatchEmbedContent",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>Bs(u))}}async get(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Lc(this.apiClient,e);return d=ge("batchPredictionJobs/{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>Ln(m))}else{const f=Fc(this.apiClient,e);return d=ge("batches/{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>Bs(m))}}async cancel(e){var s,r,a,o;let i="",d={};if(this.apiClient.isVertexAI()){const u=gc(this.apiClient,e);i=ge("batchPredictionJobs/{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const u=pc(this.apiClient,e);i=ge("batches/{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Hc(e);return d=ge("batchPredictionJobs",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Wc(m),h=new Ia;return Object.assign(h,p),h})}else{const f=$c(e);return d=ge("batches",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Jc(m),h=new Ia;return Object.assign(h,p),h})}}async delete(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Sc(this.apiClient,e);return d=ge("batchPredictionJobs/{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>Ec(m))}else{const f=kc(this.apiClient,e);return d=ge("batches/{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>Cc(m))}}};function eu(t){const e={},s=l(t,["data"]);if(s!=null&&c(e,["data"],s),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Da(t){const e={},s=l(t,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>Nu(o))),c(e,["parts"],a)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function tu(t,e){const s={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const a=l(t,["expireTime"]);e!==void 0&&a!=null&&c(e,["expireTime"],a);const o=l(t,["displayName"]);e!==void 0&&o!=null&&c(e,["displayName"],o);const i=l(t,["contents"]);if(e!==void 0&&i!=null){let m=lt(i);Array.isArray(m)&&(m=m.map(p=>Da(p))),c(e,["contents"],m)}const d=l(t,["systemInstruction"]);e!==void 0&&d!=null&&c(e,["systemInstruction"],Da(Ke(d)));const u=l(t,["tools"]);if(e!==void 0&&u!=null){let m=u;Array.isArray(m)&&(m=m.map(p=>Su(p))),c(e,["tools"],m)}const f=l(t,["toolConfig"]);if(e!==void 0&&f!=null&&c(e,["toolConfig"],ku(f)),l(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return s}function su(t,e){const s={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const a=l(t,["expireTime"]);e!==void 0&&a!=null&&c(e,["expireTime"],a);const o=l(t,["displayName"]);e!==void 0&&o!=null&&c(e,["displayName"],o);const i=l(t,["contents"]);if(e!==void 0&&i!=null){let p=lt(i);Array.isArray(p)&&(p=p.map(h=>h)),c(e,["contents"],p)}const d=l(t,["systemInstruction"]);e!==void 0&&d!=null&&c(e,["systemInstruction"],Ke(d));const u=l(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(h=>Cu(h))),c(e,["tools"],p)}const f=l(t,["toolConfig"]);e!==void 0&&f!=null&&c(e,["toolConfig"],f);const m=l(t,["kmsKeyName"]);return e!==void 0&&m!=null&&c(e,["encryption_spec","kmsKeyName"],m),s}function nu(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["model"],Ho(t,r));const a=l(e,["config"]);return a!=null&&tu(a,s),s}function ru(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["model"],Ho(t,r));const a=l(e,["config"]);return a!=null&&su(a,s),s}function au(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],St(t,r)),s}function ou(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],St(t,r)),s}function iu(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function lu(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function du(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=l(t,["fileUri"]);s!=null&&c(e,["fileUri"],s);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function cu(t){const e={},s=l(t,["id"]);s!=null&&c(e,["id"],s);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const a=l(t,["name"]);if(a!=null&&c(e,["name"],a),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function uu(t){const e={},s=l(t,["mode"]);s!=null&&c(e,["mode"],s);const r=l(t,["allowedFunctionNames"]);if(r!=null&&c(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function fu(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=l(t,["description"]);s!=null&&c(e,["description"],s);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const a=l(t,["parameters"]);a!=null&&c(e,["parameters"],a);const o=l(t,["parametersJsonSchema"]);o!=null&&c(e,["parametersJsonSchema"],o);const i=l(t,["response"]);i!=null&&c(e,["response"],i);const d=l(t,["responseJsonSchema"]);return d!=null&&c(e,["responseJsonSchema"],d),e}function mu(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],St(t,r)),s}function hu(t,e){const s={},r=l(e,["name"]);return r!=null&&c(s,["_url","name"],St(t,r)),s}function pu(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=l(t,["enableWidget"]);return s!=null&&c(e,["enableWidget"],s),e}function gu(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=l(t,["timeRangeFilter"]);return s!=null&&c(e,["timeRangeFilter"],s),e}function xu(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);return e!==void 0&&a!=null&&c(e,["_query","pageToken"],a),s}function bu(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);return e!==void 0&&a!=null&&c(e,["_query","pageToken"],a),s}function yu(t){const e={},s=l(t,["config"]);return s!=null&&xu(s,e),e}function vu(t){const e={},s=l(t,["config"]);return s!=null&&bu(s,e),e}function wu(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["cachedContents"],o)}return e}function _u(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["cachedContents"],o)}return e}function Nu(t){const e={},s=l(t,["mediaResolution"]);s!=null&&c(e,["mediaResolution"],s);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const a=l(t,["executableCode"]);a!=null&&c(e,["executableCode"],a);const o=l(t,["fileData"]);o!=null&&c(e,["fileData"],du(o));const i=l(t,["functionCall"]);i!=null&&c(e,["functionCall"],cu(i));const d=l(t,["functionResponse"]);d!=null&&c(e,["functionResponse"],d);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],eu(u));const f=l(t,["text"]);f!=null&&c(e,["text"],f);const m=l(t,["thought"]);m!=null&&c(e,["thought"],m);const p=l(t,["thoughtSignature"]);p!=null&&c(e,["thoughtSignature"],p);const h=l(t,["videoMetadata"]);return h!=null&&c(e,["videoMetadata"],h),e}function ku(t){const e={},s=l(t,["functionCallingConfig"]);s!=null&&c(e,["functionCallingConfig"],uu(s));const r=l(t,["retrievalConfig"]);return r!=null&&c(e,["retrievalConfig"],r),e}function Su(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>p)),c(e,["functionDeclarations"],m)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const a=l(t,["computerUse"]);a!=null&&c(e,["computerUse"],a);const o=l(t,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);const i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=l(t,["googleMaps"]);d!=null&&c(e,["googleMaps"],pu(d));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],gu(u));const f=l(t,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function Cu(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(h=>fu(h))),c(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&c(e,["retrieval"],r);const a=l(t,["googleSearchRetrieval"]);a!=null&&c(e,["googleSearchRetrieval"],a);const o=l(t,["computerUse"]);if(o!=null&&c(e,["computerUse"],o),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=l(t,["codeExecution"]);i!=null&&c(e,["codeExecution"],i);const d=l(t,["enterpriseWebSearch"]);d!=null&&c(e,["enterpriseWebSearch"],d);const u=l(t,["googleMaps"]);u!=null&&c(e,["googleMaps"],u);const f=l(t,["googleSearch"]);f!=null&&c(e,["googleSearch"],f);const m=l(t,["urlContext"]);return m!=null&&c(e,["urlContext"],m),e}function Eu(t,e){const s={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const a=l(t,["expireTime"]);return e!==void 0&&a!=null&&c(e,["expireTime"],a),s}function Tu(t,e){const s={},r=l(t,["ttl"]);e!==void 0&&r!=null&&c(e,["ttl"],r);const a=l(t,["expireTime"]);return e!==void 0&&a!=null&&c(e,["expireTime"],a),s}function Au(t,e){const s={},r=l(e,["name"]);r!=null&&c(s,["_url","name"],St(t,r));const a=l(e,["config"]);return a!=null&&Eu(a,s),s}function Iu(t,e){const s={},r=l(e,["name"]);r!=null&&c(s,["_url","name"],St(t,r));const a=l(e,["config"]);return a!=null&&Tu(a,s),s}class Ru extends kt{constructor(e){super(),this.apiClient=e,this.list=async(s={})=>new $t(Nt.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(s),s)}async create(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=ru(this.apiClient,e);return d=ge("cachedContents",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>m)}else{const f=nu(this.apiClient,e);return d=ge("cachedContents",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async get(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=hu(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>m)}else{const f=mu(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async delete(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=ou(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=lu(m),h=new Ta;return Object.assign(h,p),h})}else{const f=au(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=iu(m),h=new Ta;return Object.assign(h,p),h})}}async update(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Iu(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>m)}else{const f=Au(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>m)}}async listInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=vu(e);return d=ge("cachedContents",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=_u(m),h=new Aa;return Object.assign(h,p),h})}else{const f=yu(e);return d=ge("cachedContents",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=wu(m),h=new Aa;return Object.assign(h,p),h})}}}function Fa(t){var e=typeof Symbol=="function"&&Symbol.iterator,s=e&&t[e],r=0;if(s)return s.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Le(t){return this instanceof Le?(this.v=t,this):new Le(t)}function ns(t,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=s.apply(t,e||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",i),a[Symbol.asyncIterator]=function(){return this},a;function i(g){return function(y){return Promise.resolve(y).then(g,p)}}function d(g,y){r[g]&&(a[g]=function(b){return new Promise(function(w,N){o.push([g,b,w,N])>1||u(g,b)})},y&&(a[g]=y(a[g])))}function u(g,y){try{f(r[g](y))}catch(b){h(o[0][3],b)}}function f(g){g.value instanceof Le?Promise.resolve(g.value.v).then(m,p):h(o[0][2],g)}function m(g){u("next",g)}function p(g){u("throw",g)}function h(g,y){g(y),o.shift(),o.length&&u(o[0][0],o[0][1])}}function ys(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],s;return e?e.call(t):(t=typeof Fa=="function"?Fa(t):t[Symbol.iterator](),s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s);function r(o){s[o]=t[o]&&function(i){return new Promise(function(d,u){i=t[o](i),a(d,u,i.done,i.value)})}}function a(o,i,d,u){Promise.resolve(u).then(function(f){o({value:f,done:d})},i)}}function Pu(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;const s=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return s===void 0?!1:ai(s)}function ai(t){if(t.parts===void 0||t.parts.length===0)return!1;for(const e of t.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function ju(t){if(t.length!==0){for(const e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function La(t){if(t===void 0||t.length===0)return[];const e=[],s=t.length;let r=0;for(;r<s;)if(t[r].role==="user")e.push(t[r]),r++;else{const a=[];let o=!0;for(;r<s&&t[r].role==="model";)a.push(t[r]),o&&!ai(t[r])&&(o=!1),r++;o?e.push(...a):e.pop()}return e}class Mu{constructor(e,s){this.modelsModule=e,this.apiClient=s}create(e){return new Du(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}let Du=class{constructor(e,s,r,a={},o=[]){this.apiClient=e,this.modelsModule=s,this.model=r,this.config=a,this.history=o,this.sendPromise=Promise.resolve(),ju(o)}async sendMessage(e){var s;await this.sendPromise;const r=Ke(e.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(s=e.config)!==null&&s!==void 0?s:this.config});return this.sendPromise=(async()=>{var o,i,d;const u=await a,f=(i=(o=u.candidates)===null||o===void 0?void 0:o[0])===null||i===void 0?void 0:i.content,m=u.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];m!=null&&(h=(d=m.slice(p))!==null&&d!==void 0?d:[]);const g=f?[f]:[];this.recordHistory(r,g,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),a}async sendMessageStream(e){var s;await this.sendPromise;const r=Ke(e.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(s=e.config)!==null&&s!==void 0?s:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const o=await a;return this.processStreamResponse(o,r)}getHistory(e=!1){const s=e?La(this.history):this.history;return structuredClone(s)}processStreamResponse(e,s){var r,a;return ns(this,arguments,function*(){var i,d,u,f;const m=[];try{for(var p=!0,h=ys(e),g;g=yield Le(h.next()),i=g.done,!i;p=!0){f=g.value,p=!1;const y=f;if(Pu(y)){const b=(a=(r=y.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content;b!==void 0&&m.push(b)}yield yield Le(y)}}catch(y){d={error:y}}finally{try{!p&&!i&&(u=h.return)&&(yield Le(u.call(h)))}finally{if(d)throw d.error}}this.recordHistory(s,m)})}recordHistory(e,s,r){let a=[];s.length>0&&s.every(o=>o.role!==void 0)?a=s:a.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...La(r)):this.history.push(e),this.history.push(...a)}};class an extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,an.prototype)}}function Fu(t){const e={},s=l(t,["file"]);return s!=null&&c(e,["file"],s),e}function Lu(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function Uu(t){const e={},s=l(t,["name"]);return s!=null&&c(e,["_url","file"],Zo(s)),e}function zu(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function qu(t){const e={},s=l(t,["name"]);return s!=null&&c(e,["_url","file"],Zo(s)),e}function Gu(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);return e!==void 0&&a!=null&&c(e,["_query","pageToken"],a),s}function Bu(t){const e={},s=l(t,["config"]);return s!=null&&Gu(s,e),e}function Ou(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["files"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["files"],o)}return e}let Vu=class extends kt{constructor(e){super(),this.apiClient=e,this.list=async(s={})=>new $t(Nt.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(s),s)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(s=>s)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Bu(e);return o=ge("files",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>{const f=Ou(u),m=new Wd;return Object.assign(m,f),m})}}async createInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Fu(e);return o=ge("upload/v1beta/files",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=Lu(u),m=new Kd;return Object.assign(m,f),m})}}async get(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=qu(e);return o=ge("files/{file}",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>u)}}async delete(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Uu(e);return o=ge("files/{file}",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>{const f=zu(u),m=new Yd;return Object.assign(m,f),m})}}};function Os(t){const e={},s=l(t,["data"]);if(s!=null&&c(e,["data"],s),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function $u(t){const e={},s=l(t,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>lf(o))),c(e,["parts"],a)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function Hu(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=l(t,["fileUri"]);s!=null&&c(e,["fileUri"],s);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Ju(t){const e={},s=l(t,["id"]);s!=null&&c(e,["id"],s);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const a=l(t,["name"]);if(a!=null&&c(e,["name"],a),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Wu(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=l(t,["description"]);s!=null&&c(e,["description"],s);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const a=l(t,["parameters"]);a!=null&&c(e,["parameters"],a);const o=l(t,["parametersJsonSchema"]);o!=null&&c(e,["parametersJsonSchema"],o);const i=l(t,["response"]);i!=null&&c(e,["response"],i);const d=l(t,["responseJsonSchema"]);return d!=null&&c(e,["responseJsonSchema"],d),e}function Ku(t){const e={},s=l(t,["modelSelectionConfig"]);s!=null&&c(e,["modelConfig"],s);const r=l(t,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);const a=l(t,["audioTimestamp"]);a!=null&&c(e,["audioTimestamp"],a);const o=l(t,["candidateCount"]);o!=null&&c(e,["candidateCount"],o);const i=l(t,["enableAffectiveDialog"]);i!=null&&c(e,["enableAffectiveDialog"],i);const d=l(t,["frequencyPenalty"]);d!=null&&c(e,["frequencyPenalty"],d);const u=l(t,["logprobs"]);u!=null&&c(e,["logprobs"],u);const f=l(t,["maxOutputTokens"]);f!=null&&c(e,["maxOutputTokens"],f);const m=l(t,["mediaResolution"]);m!=null&&c(e,["mediaResolution"],m);const p=l(t,["presencePenalty"]);p!=null&&c(e,["presencePenalty"],p);const h=l(t,["responseLogprobs"]);h!=null&&c(e,["responseLogprobs"],h);const g=l(t,["responseMimeType"]);g!=null&&c(e,["responseMimeType"],g);const y=l(t,["responseModalities"]);y!=null&&c(e,["responseModalities"],y);const b=l(t,["responseSchema"]);b!=null&&c(e,["responseSchema"],b);const w=l(t,["routingConfig"]);w!=null&&c(e,["routingConfig"],w);const N=l(t,["seed"]);N!=null&&c(e,["seed"],N);const v=l(t,["speechConfig"]);v!=null&&c(e,["speechConfig"],oi(v));const k=l(t,["stopSequences"]);k!=null&&c(e,["stopSequences"],k);const A=l(t,["temperature"]);A!=null&&c(e,["temperature"],A);const C=l(t,["thinkingConfig"]);C!=null&&c(e,["thinkingConfig"],C);const P=l(t,["topK"]);P!=null&&c(e,["topK"],P);const D=l(t,["topP"]);if(D!=null&&c(e,["topP"],D),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Yu(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=l(t,["enableWidget"]);return s!=null&&c(e,["enableWidget"],s),e}function Xu(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=l(t,["timeRangeFilter"]);return s!=null&&c(e,["timeRangeFilter"],s),e}function Zu(t,e){const s={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);const a=l(t,["responseModalities"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","responseModalities"],a);const o=l(t,["temperature"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","temperature"],o);const i=l(t,["topP"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","topP"],i);const d=l(t,["topK"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","topK"],d);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","maxOutputTokens"],u);const f=l(t,["mediaResolution"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","mediaResolution"],f);const m=l(t,["seed"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","seed"],m);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&c(e,["setup","generationConfig","speechConfig"],ir(p));const h=l(t,["thinkingConfig"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","thinkingConfig"],h);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],g);const y=l(t,["systemInstruction"]);e!==void 0&&y!=null&&c(e,["setup","systemInstruction"],$u(Ke(y)));const b=l(t,["tools"]);if(e!==void 0&&b!=null){let P=ds(b);Array.isArray(P)&&(P=P.map(D=>cf(ls(D)))),c(e,["setup","tools"],P)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&c(e,["setup","sessionResumption"],df(w));const N=l(t,["inputAudioTranscription"]);e!==void 0&&N!=null&&c(e,["setup","inputAudioTranscription"],N);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&c(e,["setup","outputAudioTranscription"],v);const k=l(t,["realtimeInputConfig"]);e!==void 0&&k!=null&&c(e,["setup","realtimeInputConfig"],k);const A=l(t,["contextWindowCompression"]);e!==void 0&&A!=null&&c(e,["setup","contextWindowCompression"],A);const C=l(t,["proactivity"]);return e!==void 0&&C!=null&&c(e,["setup","proactivity"],C),s}function Qu(t,e){const s={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],Ku(r));const a=l(t,["responseModalities"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","responseModalities"],a);const o=l(t,["temperature"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","temperature"],o);const i=l(t,["topP"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","topP"],i);const d=l(t,["topK"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","topK"],d);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","maxOutputTokens"],u);const f=l(t,["mediaResolution"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","mediaResolution"],f);const m=l(t,["seed"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","seed"],m);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&c(e,["setup","generationConfig","speechConfig"],oi(ir(p)));const h=l(t,["thinkingConfig"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","thinkingConfig"],h);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],g);const y=l(t,["systemInstruction"]);e!==void 0&&y!=null&&c(e,["setup","systemInstruction"],Ke(y));const b=l(t,["tools"]);if(e!==void 0&&b!=null){let P=ds(b);Array.isArray(P)&&(P=P.map(D=>uf(ls(D)))),c(e,["setup","tools"],P)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&c(e,["setup","sessionResumption"],w);const N=l(t,["inputAudioTranscription"]);e!==void 0&&N!=null&&c(e,["setup","inputAudioTranscription"],N);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&c(e,["setup","outputAudioTranscription"],v);const k=l(t,["realtimeInputConfig"]);e!==void 0&&k!=null&&c(e,["setup","realtimeInputConfig"],k);const A=l(t,["contextWindowCompression"]);e!==void 0&&A!=null&&c(e,["setup","contextWindowCompression"],A);const C=l(t,["proactivity"]);return e!==void 0&&C!=null&&c(e,["setup","proactivity"],C),s}function ef(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["setup","model"],Pe(t,r));const a=l(e,["config"]);return a!=null&&c(s,["config"],Zu(a,s)),s}function tf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["setup","model"],Pe(t,r));const a=l(e,["config"]);return a!=null&&c(s,["config"],Qu(a,s)),s}function sf(t){const e={},s=l(t,["musicGenerationConfig"]);return s!=null&&c(e,["musicGenerationConfig"],s),e}function nf(t){const e={},s=l(t,["weightedPrompts"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),c(e,["weightedPrompts"],r)}return e}function rf(t){const e={},s=l(t,["media"]);if(s!=null){let f=Jo(s);Array.isArray(f)&&(f=f.map(m=>Os(m))),c(e,["mediaChunks"],f)}const r=l(t,["audio"]);r!=null&&c(e,["audio"],Os(Ko(r)));const a=l(t,["audioStreamEnd"]);a!=null&&c(e,["audioStreamEnd"],a);const o=l(t,["video"]);o!=null&&c(e,["video"],Os(Wo(o)));const i=l(t,["text"]);i!=null&&c(e,["text"],i);const d=l(t,["activityStart"]);d!=null&&c(e,["activityStart"],d);const u=l(t,["activityEnd"]);return u!=null&&c(e,["activityEnd"],u),e}function af(t){const e={},s=l(t,["media"]);if(s!=null){let f=Jo(s);Array.isArray(f)&&(f=f.map(m=>m)),c(e,["mediaChunks"],f)}const r=l(t,["audio"]);r!=null&&c(e,["audio"],Ko(r));const a=l(t,["audioStreamEnd"]);a!=null&&c(e,["audioStreamEnd"],a);const o=l(t,["video"]);o!=null&&c(e,["video"],Wo(o));const i=l(t,["text"]);i!=null&&c(e,["text"],i);const d=l(t,["activityStart"]);d!=null&&c(e,["activityStart"],d);const u=l(t,["activityEnd"]);return u!=null&&c(e,["activityEnd"],u),e}function of(t){const e={},s=l(t,["setupComplete"]);s!=null&&c(e,["setupComplete"],s);const r=l(t,["serverContent"]);r!=null&&c(e,["serverContent"],r);const a=l(t,["toolCall"]);a!=null&&c(e,["toolCall"],a);const o=l(t,["toolCallCancellation"]);o!=null&&c(e,["toolCallCancellation"],o);const i=l(t,["usageMetadata"]);i!=null&&c(e,["usageMetadata"],ff(i));const d=l(t,["goAway"]);d!=null&&c(e,["goAway"],d);const u=l(t,["sessionResumptionUpdate"]);return u!=null&&c(e,["sessionResumptionUpdate"],u),e}function lf(t){const e={},s=l(t,["mediaResolution"]);s!=null&&c(e,["mediaResolution"],s);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const a=l(t,["executableCode"]);a!=null&&c(e,["executableCode"],a);const o=l(t,["fileData"]);o!=null&&c(e,["fileData"],Hu(o));const i=l(t,["functionCall"]);i!=null&&c(e,["functionCall"],Ju(i));const d=l(t,["functionResponse"]);d!=null&&c(e,["functionResponse"],d);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],Os(u));const f=l(t,["text"]);f!=null&&c(e,["text"],f);const m=l(t,["thought"]);m!=null&&c(e,["thought"],m);const p=l(t,["thoughtSignature"]);p!=null&&c(e,["thoughtSignature"],p);const h=l(t,["videoMetadata"]);return h!=null&&c(e,["videoMetadata"],h),e}function df(t){const e={},s=l(t,["handle"]);if(s!=null&&c(e,["handle"],s),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function oi(t){const e={},s=l(t,["languageCode"]);s!=null&&c(e,["languageCode"],s);const r=l(t,["voiceConfig"]);if(r!=null&&c(e,["voiceConfig"],r),l(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function cf(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>p)),c(e,["functionDeclarations"],m)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const a=l(t,["computerUse"]);a!=null&&c(e,["computerUse"],a);const o=l(t,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);const i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=l(t,["googleMaps"]);d!=null&&c(e,["googleMaps"],Yu(d));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],Xu(u));const f=l(t,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function uf(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(h=>Wu(h))),c(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&c(e,["retrieval"],r);const a=l(t,["googleSearchRetrieval"]);a!=null&&c(e,["googleSearchRetrieval"],a);const o=l(t,["computerUse"]);if(o!=null&&c(e,["computerUse"],o),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=l(t,["codeExecution"]);i!=null&&c(e,["codeExecution"],i);const d=l(t,["enterpriseWebSearch"]);d!=null&&c(e,["enterpriseWebSearch"],d);const u=l(t,["googleMaps"]);u!=null&&c(e,["googleMaps"],u);const f=l(t,["googleSearch"]);f!=null&&c(e,["googleSearch"],f);const m=l(t,["urlContext"]);return m!=null&&c(e,["urlContext"],m),e}function ff(t){const e={},s=l(t,["promptTokenCount"]);s!=null&&c(e,["promptTokenCount"],s);const r=l(t,["cachedContentTokenCount"]);r!=null&&c(e,["cachedContentTokenCount"],r);const a=l(t,["candidatesTokenCount"]);a!=null&&c(e,["responseTokenCount"],a);const o=l(t,["toolUsePromptTokenCount"]);o!=null&&c(e,["toolUsePromptTokenCount"],o);const i=l(t,["thoughtsTokenCount"]);i!=null&&c(e,["thoughtsTokenCount"],i);const d=l(t,["totalTokenCount"]);d!=null&&c(e,["totalTokenCount"],d);const u=l(t,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(y=>y)),c(e,["promptTokensDetails"],g)}const f=l(t,["cacheTokensDetails"]);if(f!=null){let g=f;Array.isArray(g)&&(g=g.map(y=>y)),c(e,["cacheTokensDetails"],g)}const m=l(t,["candidatesTokensDetails"]);if(m!=null){let g=m;Array.isArray(g)&&(g=g.map(y=>y)),c(e,["responseTokensDetails"],g)}const p=l(t,["toolUsePromptTokensDetails"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(y=>y)),c(e,["toolUsePromptTokensDetails"],g)}const h=l(t,["trafficType"]);return h!=null&&c(e,["trafficType"],h),e}function mf(t){const e={},s=l(t,["data"]);if(s!=null&&c(e,["data"],s),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function hf(t){const e={},s=l(t,["content"]);s!=null&&c(e,["content"],s);const r=l(t,["citationMetadata"]);r!=null&&c(e,["citationMetadata"],pf(r));const a=l(t,["tokenCount"]);a!=null&&c(e,["tokenCount"],a);const o=l(t,["finishReason"]);o!=null&&c(e,["finishReason"],o);const i=l(t,["avgLogprobs"]);i!=null&&c(e,["avgLogprobs"],i);const d=l(t,["groundingMetadata"]);d!=null&&c(e,["groundingMetadata"],d);const u=l(t,["index"]);u!=null&&c(e,["index"],u);const f=l(t,["logprobsResult"]);f!=null&&c(e,["logprobsResult"],f);const m=l(t,["safetyRatings"]);if(m!=null){let h=m;Array.isArray(h)&&(h=h.map(g=>g)),c(e,["safetyRatings"],h)}const p=l(t,["urlContextMetadata"]);return p!=null&&c(e,["urlContextMetadata"],p),e}function pf(t){const e={},s=l(t,["citationSources"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>a)),c(e,["citations"],r)}return e}function gf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let o=lt(a);Array.isArray(o)&&(o=o.map(i=>i)),c(s,["contents"],o)}return s}function xf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["tokensInfo"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),c(e,["tokensInfo"],a)}return e}function bf(t){const e={},s=l(t,["values"]);s!=null&&c(e,["values"],s);const r=l(t,["statistics"]);return r!=null&&c(e,["statistics"],yf(r)),e}function yf(t){const e={},s=l(t,["truncated"]);s!=null&&c(e,["truncated"],s);const r=l(t,["token_count"]);return r!=null&&c(e,["tokenCount"],r),e}function on(t){const e={},s=l(t,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>Tm(o))),c(e,["parts"],a)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function vf(t){const e={},s=l(t,["controlType"]);s!=null&&c(e,["controlType"],s);const r=l(t,["enableControlImageComputation"]);return r!=null&&c(e,["computeControl"],r),e}function wf(t){const e={};if(l(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(l(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(l(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function _f(t,e){const s={},r=l(t,["systemInstruction"]);e!==void 0&&r!=null&&c(e,["systemInstruction"],Ke(r));const a=l(t,["tools"]);if(e!==void 0&&a!=null){let i=a;Array.isArray(i)&&(i=i.map(d=>ui(d))),c(e,["tools"],i)}const o=l(t,["generationConfig"]);return e!==void 0&&o!=null&&c(e,["generationConfig"],mm(o)),s}function Nf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let i=lt(a);Array.isArray(i)&&(i=i.map(d=>on(d))),c(s,["contents"],i)}const o=l(e,["config"]);return o!=null&&wf(o),s}function kf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let i=lt(a);Array.isArray(i)&&(i=i.map(d=>d)),c(s,["contents"],i)}const o=l(e,["config"]);return o!=null&&_f(o,s),s}function Sf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["totalTokens"]);r!=null&&c(e,["totalTokens"],r);const a=l(t,["cachedContentTokenCount"]);return a!=null&&c(e,["cachedContentTokenCount"],a),e}function Cf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["totalTokens"]);return r!=null&&c(e,["totalTokens"],r),e}function Ef(t,e){const s={},r=l(e,["model"]);return r!=null&&c(s,["_url","name"],Pe(t,r)),s}function Tf(t,e){const s={},r=l(e,["model"]);return r!=null&&c(s,["_url","name"],Pe(t,r)),s}function Af(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function If(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function Rf(t,e){const s={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);const a=l(t,["negativePrompt"]);e!==void 0&&a!=null&&c(e,["parameters","negativePrompt"],a);const o=l(t,["numberOfImages"]);e!==void 0&&o!=null&&c(e,["parameters","sampleCount"],o);const i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&c(e,["parameters","aspectRatio"],i);const d=l(t,["guidanceScale"]);e!==void 0&&d!=null&&c(e,["parameters","guidanceScale"],d);const u=l(t,["seed"]);e!==void 0&&u!=null&&c(e,["parameters","seed"],u);const f=l(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&c(e,["parameters","safetySetting"],f);const m=l(t,["personGeneration"]);e!==void 0&&m!=null&&c(e,["parameters","personGeneration"],m);const p=l(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&c(e,["parameters","includeSafetyAttributes"],p);const h=l(t,["includeRaiReason"]);e!==void 0&&h!=null&&c(e,["parameters","includeRaiReason"],h);const g=l(t,["language"]);e!==void 0&&g!=null&&c(e,["parameters","language"],g);const y=l(t,["outputMimeType"]);e!==void 0&&y!=null&&c(e,["parameters","outputOptions","mimeType"],y);const b=l(t,["outputCompressionQuality"]);e!==void 0&&b!=null&&c(e,["parameters","outputOptions","compressionQuality"],b);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&c(e,["parameters","addWatermark"],w);const N=l(t,["labels"]);e!==void 0&&N!=null&&c(e,["labels"],N);const v=l(t,["editMode"]);e!==void 0&&v!=null&&c(e,["parameters","editMode"],v);const k=l(t,["baseSteps"]);return e!==void 0&&k!=null&&c(e,["parameters","editConfig","baseSteps"],k),s}function Pf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["prompt"]);a!=null&&c(s,["instances[0]","prompt"],a);const o=l(e,["referenceImages"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(u=>Mm(u))),c(s,["instances[0]","referenceImages"],d)}const i=l(e,["config"]);return i!=null&&Rf(i,s),s}function jf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>ln(o))),c(e,["generatedImages"],a)}return e}function Mf(t,e){const s={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["requests[]","taskType"],r);const a=l(t,["title"]);e!==void 0&&a!=null&&c(e,["requests[]","title"],a);const o=l(t,["outputDimensionality"]);if(e!==void 0&&o!=null&&c(e,["requests[]","outputDimensionality"],o),l(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(l(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return s}function Df(t,e){const s={},r=l(t,["taskType"]);e!==void 0&&r!=null&&c(e,["instances[]","task_type"],r);const a=l(t,["title"]);e!==void 0&&a!=null&&c(e,["instances[]","title"],a);const o=l(t,["outputDimensionality"]);e!==void 0&&o!=null&&c(e,["parameters","outputDimensionality"],o);const i=l(t,["mimeType"]);e!==void 0&&i!=null&&c(e,["instances[]","mimeType"],i);const d=l(t,["autoTruncate"]);return e!==void 0&&d!=null&&c(e,["parameters","autoTruncate"],d),s}function Ff(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let d=rr(t,a);Array.isArray(d)&&(d=d.map(u=>u)),c(s,["requests[]","content"],d)}const o=l(e,["config"]);o!=null&&Mf(o,s);const i=l(e,["model"]);return i!==void 0&&c(s,["requests[]","model"],Pe(t,i)),s}function Lf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let i=rr(t,a);Array.isArray(i)&&(i=i.map(d=>d)),c(s,["instances[]","content"],i)}const o=l(e,["config"]);return o!=null&&Df(o,s),s}function Uf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["embeddings"],o)}const a=l(t,["metadata"]);return a!=null&&c(e,["metadata"],a),e}function zf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>bf(i))),c(e,["embeddings"],o)}const a=l(t,["metadata"]);return a!=null&&c(e,["metadata"],a),e}function qf(t){const e={},s=l(t,["endpoint"]);s!=null&&c(e,["name"],s);const r=l(t,["deployedModelId"]);return r!=null&&c(e,["deployedModelId"],r),e}function Gf(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=l(t,["fileUri"]);s!=null&&c(e,["fileUri"],s);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Bf(t){const e={},s=l(t,["id"]);s!=null&&c(e,["id"],s);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const a=l(t,["name"]);if(a!=null&&c(e,["name"],a),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Of(t){const e={},s=l(t,["mode"]);s!=null&&c(e,["mode"],s);const r=l(t,["allowedFunctionNames"]);if(r!=null&&c(e,["allowedFunctionNames"],r),l(t,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function Vf(t){const e={};if(l(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const s=l(t,["description"]);s!=null&&c(e,["description"],s);const r=l(t,["name"]);r!=null&&c(e,["name"],r);const a=l(t,["parameters"]);a!=null&&c(e,["parameters"],a);const o=l(t,["parametersJsonSchema"]);o!=null&&c(e,["parametersJsonSchema"],o);const i=l(t,["response"]);i!=null&&c(e,["response"],i);const d=l(t,["responseJsonSchema"]);return d!=null&&c(e,["responseJsonSchema"],d),e}function $f(t,e,s){const r={},a=l(e,["systemInstruction"]);s!==void 0&&a!=null&&c(s,["systemInstruction"],on(Ke(a)));const o=l(e,["temperature"]);o!=null&&c(r,["temperature"],o);const i=l(e,["topP"]);i!=null&&c(r,["topP"],i);const d=l(e,["topK"]);d!=null&&c(r,["topK"],d);const u=l(e,["candidateCount"]);u!=null&&c(r,["candidateCount"],u);const f=l(e,["maxOutputTokens"]);f!=null&&c(r,["maxOutputTokens"],f);const m=l(e,["stopSequences"]);m!=null&&c(r,["stopSequences"],m);const p=l(e,["responseLogprobs"]);p!=null&&c(r,["responseLogprobs"],p);const h=l(e,["logprobs"]);h!=null&&c(r,["logprobs"],h);const g=l(e,["presencePenalty"]);g!=null&&c(r,["presencePenalty"],g);const y=l(e,["frequencyPenalty"]);y!=null&&c(r,["frequencyPenalty"],y);const b=l(e,["seed"]);b!=null&&c(r,["seed"],b);const w=l(e,["responseMimeType"]);w!=null&&c(r,["responseMimeType"],w);const N=l(e,["responseSchema"]);N!=null&&c(r,["responseSchema"],ar(N));const v=l(e,["responseJsonSchema"]);if(v!=null&&c(r,["responseJsonSchema"],v),l(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(l(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const k=l(e,["safetySettings"]);if(s!==void 0&&k!=null){let S=k;Array.isArray(S)&&(S=S.map(G=>Dm(G))),c(s,["safetySettings"],S)}const A=l(e,["tools"]);if(s!==void 0&&A!=null){let S=ds(A);Array.isArray(S)&&(S=S.map(G=>Bm(ls(G)))),c(s,["tools"],S)}const C=l(e,["toolConfig"]);if(s!==void 0&&C!=null&&c(s,["toolConfig"],Gm(C)),l(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=l(e,["cachedContent"]);s!==void 0&&P!=null&&c(s,["cachedContent"],St(t,P));const D=l(e,["responseModalities"]);D!=null&&c(r,["responseModalities"],D);const B=l(e,["mediaResolution"]);B!=null&&c(r,["mediaResolution"],B);const R=l(e,["speechConfig"]);if(R!=null&&c(r,["speechConfig"],or(R)),l(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const U=l(e,["thinkingConfig"]);U!=null&&c(r,["thinkingConfig"],U);const Q=l(e,["imageConfig"]);return Q!=null&&c(r,["imageConfig"],bm(Q)),r}function Hf(t,e,s){const r={},a=l(e,["systemInstruction"]);s!==void 0&&a!=null&&c(s,["systemInstruction"],Ke(a));const o=l(e,["temperature"]);o!=null&&c(r,["temperature"],o);const i=l(e,["topP"]);i!=null&&c(r,["topP"],i);const d=l(e,["topK"]);d!=null&&c(r,["topK"],d);const u=l(e,["candidateCount"]);u!=null&&c(r,["candidateCount"],u);const f=l(e,["maxOutputTokens"]);f!=null&&c(r,["maxOutputTokens"],f);const m=l(e,["stopSequences"]);m!=null&&c(r,["stopSequences"],m);const p=l(e,["responseLogprobs"]);p!=null&&c(r,["responseLogprobs"],p);const h=l(e,["logprobs"]);h!=null&&c(r,["logprobs"],h);const g=l(e,["presencePenalty"]);g!=null&&c(r,["presencePenalty"],g);const y=l(e,["frequencyPenalty"]);y!=null&&c(r,["frequencyPenalty"],y);const b=l(e,["seed"]);b!=null&&c(r,["seed"],b);const w=l(e,["responseMimeType"]);w!=null&&c(r,["responseMimeType"],w);const N=l(e,["responseSchema"]);N!=null&&c(r,["responseSchema"],ar(N));const v=l(e,["responseJsonSchema"]);v!=null&&c(r,["responseJsonSchema"],v);const k=l(e,["routingConfig"]);k!=null&&c(r,["routingConfig"],k);const A=l(e,["modelSelectionConfig"]);A!=null&&c(r,["modelConfig"],A);const C=l(e,["safetySettings"]);if(s!==void 0&&C!=null){let ae=C;Array.isArray(ae)&&(ae=ae.map(Y=>Y)),c(s,["safetySettings"],ae)}const P=l(e,["tools"]);if(s!==void 0&&P!=null){let ae=ds(P);Array.isArray(ae)&&(ae=ae.map(Y=>ui(ls(Y)))),c(s,["tools"],ae)}const D=l(e,["toolConfig"]);s!==void 0&&D!=null&&c(s,["toolConfig"],D);const B=l(e,["labels"]);s!==void 0&&B!=null&&c(s,["labels"],B);const R=l(e,["cachedContent"]);s!==void 0&&R!=null&&c(s,["cachedContent"],St(t,R));const U=l(e,["responseModalities"]);U!=null&&c(r,["responseModalities"],U);const Q=l(e,["mediaResolution"]);Q!=null&&c(r,["mediaResolution"],Q);const S=l(e,["speechConfig"]);S!=null&&c(r,["speechConfig"],ci(or(S)));const G=l(e,["audioTimestamp"]);G!=null&&c(r,["audioTimestamp"],G);const _=l(e,["thinkingConfig"]);_!=null&&c(r,["thinkingConfig"],_);const J=l(e,["imageConfig"]);return J!=null&&c(r,["imageConfig"],ym(J)),r}function Ua(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let i=lt(a);Array.isArray(i)&&(i=i.map(d=>on(d))),c(s,["contents"],i)}const o=l(e,["config"]);return o!=null&&c(s,["generationConfig"],$f(t,o,s)),s}function za(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["contents"]);if(a!=null){let i=lt(a);Array.isArray(i)&&(i=i.map(d=>d)),c(s,["contents"],i)}const o=l(e,["config"]);return o!=null&&c(s,["generationConfig"],Hf(t,o,s)),s}function qa(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>hf(f))),c(e,["candidates"],u)}const a=l(t,["modelVersion"]);a!=null&&c(e,["modelVersion"],a);const o=l(t,["promptFeedback"]);o!=null&&c(e,["promptFeedback"],o);const i=l(t,["responseId"]);i!=null&&c(e,["responseId"],i);const d=l(t,["usageMetadata"]);return d!=null&&c(e,["usageMetadata"],d),e}function Ga(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["candidates"]);if(r!=null){let f=r;Array.isArray(f)&&(f=f.map(m=>m)),c(e,["candidates"],f)}const a=l(t,["createTime"]);a!=null&&c(e,["createTime"],a);const o=l(t,["modelVersion"]);o!=null&&c(e,["modelVersion"],o);const i=l(t,["promptFeedback"]);i!=null&&c(e,["promptFeedback"],i);const d=l(t,["responseId"]);d!=null&&c(e,["responseId"],d);const u=l(t,["usageMetadata"]);return u!=null&&c(e,["usageMetadata"],u),e}function Jf(t,e){const s={};if(l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);const a=l(t,["aspectRatio"]);e!==void 0&&a!=null&&c(e,["parameters","aspectRatio"],a);const o=l(t,["guidanceScale"]);if(e!==void 0&&o!=null&&c(e,["parameters","guidanceScale"],o),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const i=l(t,["safetyFilterLevel"]);e!==void 0&&i!=null&&c(e,["parameters","safetySetting"],i);const d=l(t,["personGeneration"]);e!==void 0&&d!=null&&c(e,["parameters","personGeneration"],d);const u=l(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&c(e,["parameters","includeSafetyAttributes"],u);const f=l(t,["includeRaiReason"]);e!==void 0&&f!=null&&c(e,["parameters","includeRaiReason"],f);const m=l(t,["language"]);e!==void 0&&m!=null&&c(e,["parameters","language"],m);const p=l(t,["outputMimeType"]);e!==void 0&&p!=null&&c(e,["parameters","outputOptions","mimeType"],p);const h=l(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&c(e,["parameters","outputOptions","compressionQuality"],h),l(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const g=l(t,["imageSize"]);if(e!==void 0&&g!=null&&c(e,["parameters","sampleImageSize"],g),l(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return s}function Wf(t,e){const s={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);const a=l(t,["negativePrompt"]);e!==void 0&&a!=null&&c(e,["parameters","negativePrompt"],a);const o=l(t,["numberOfImages"]);e!==void 0&&o!=null&&c(e,["parameters","sampleCount"],o);const i=l(t,["aspectRatio"]);e!==void 0&&i!=null&&c(e,["parameters","aspectRatio"],i);const d=l(t,["guidanceScale"]);e!==void 0&&d!=null&&c(e,["parameters","guidanceScale"],d);const u=l(t,["seed"]);e!==void 0&&u!=null&&c(e,["parameters","seed"],u);const f=l(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&c(e,["parameters","safetySetting"],f);const m=l(t,["personGeneration"]);e!==void 0&&m!=null&&c(e,["parameters","personGeneration"],m);const p=l(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&c(e,["parameters","includeSafetyAttributes"],p);const h=l(t,["includeRaiReason"]);e!==void 0&&h!=null&&c(e,["parameters","includeRaiReason"],h);const g=l(t,["language"]);e!==void 0&&g!=null&&c(e,["parameters","language"],g);const y=l(t,["outputMimeType"]);e!==void 0&&y!=null&&c(e,["parameters","outputOptions","mimeType"],y);const b=l(t,["outputCompressionQuality"]);e!==void 0&&b!=null&&c(e,["parameters","outputOptions","compressionQuality"],b);const w=l(t,["addWatermark"]);e!==void 0&&w!=null&&c(e,["parameters","addWatermark"],w);const N=l(t,["labels"]);e!==void 0&&N!=null&&c(e,["labels"],N);const v=l(t,["imageSize"]);e!==void 0&&v!=null&&c(e,["parameters","sampleImageSize"],v);const k=l(t,["enhancePrompt"]);return e!==void 0&&k!=null&&c(e,["parameters","enhancePrompt"],k),s}function Kf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["prompt"]);a!=null&&c(s,["instances[0]","prompt"],a);const o=l(e,["config"]);return o!=null&&Jf(o,s),s}function Yf(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["prompt"]);a!=null&&c(s,["instances[0]","prompt"],a);const o=l(e,["config"]);return o!=null&&Wf(o,s),s}function Xf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>dm(i))),c(e,["generatedImages"],o)}const a=l(t,["positivePromptSafetyAttributes"]);return a!=null&&c(e,["positivePromptSafetyAttributes"],li(a)),e}function Zf(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>ln(i))),c(e,["generatedImages"],o)}const a=l(t,["positivePromptSafetyAttributes"]);return a!=null&&c(e,["positivePromptSafetyAttributes"],di(a)),e}function Qf(t,e){const s={},r=l(t,["numberOfVideos"]);if(e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r),l(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(l(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const a=l(t,["durationSeconds"]);if(e!==void 0&&a!=null&&c(e,["parameters","durationSeconds"],a),l(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=l(t,["aspectRatio"]);e!==void 0&&o!=null&&c(e,["parameters","aspectRatio"],o);const i=l(t,["resolution"]);e!==void 0&&i!=null&&c(e,["parameters","resolution"],i);const d=l(t,["personGeneration"]);if(e!==void 0&&d!=null&&c(e,["parameters","personGeneration"],d),l(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const u=l(t,["negativePrompt"]);e!==void 0&&u!=null&&c(e,["parameters","negativePrompt"],u);const f=l(t,["enhancePrompt"]);if(e!==void 0&&f!=null&&c(e,["parameters","enhancePrompt"],f),l(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const m=l(t,["lastFrame"]);e!==void 0&&m!=null&&c(e,["instances[0]","lastFrame"],dn(m));const p=l(t,["referenceImages"]);if(e!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(g=>th(g))),c(e,["instances[0]","referenceImages"],h)}if(l(t,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(l(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return s}function em(t,e){const s={},r=l(t,["numberOfVideos"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);const a=l(t,["outputGcsUri"]);e!==void 0&&a!=null&&c(e,["parameters","storageUri"],a);const o=l(t,["fps"]);e!==void 0&&o!=null&&c(e,["parameters","fps"],o);const i=l(t,["durationSeconds"]);e!==void 0&&i!=null&&c(e,["parameters","durationSeconds"],i);const d=l(t,["seed"]);e!==void 0&&d!=null&&c(e,["parameters","seed"],d);const u=l(t,["aspectRatio"]);e!==void 0&&u!=null&&c(e,["parameters","aspectRatio"],u);const f=l(t,["resolution"]);e!==void 0&&f!=null&&c(e,["parameters","resolution"],f);const m=l(t,["personGeneration"]);e!==void 0&&m!=null&&c(e,["parameters","personGeneration"],m);const p=l(t,["pubsubTopic"]);e!==void 0&&p!=null&&c(e,["parameters","pubsubTopic"],p);const h=l(t,["negativePrompt"]);e!==void 0&&h!=null&&c(e,["parameters","negativePrompt"],h);const g=l(t,["enhancePrompt"]);e!==void 0&&g!=null&&c(e,["parameters","enhancePrompt"],g);const y=l(t,["generateAudio"]);e!==void 0&&y!=null&&c(e,["parameters","generateAudio"],y);const b=l(t,["lastFrame"]);e!==void 0&&b!=null&&c(e,["instances[0]","lastFrame"],mt(b));const w=l(t,["referenceImages"]);if(e!==void 0&&w!=null){let k=w;Array.isArray(k)&&(k=k.map(A=>sh(A))),c(e,["instances[0]","referenceImages"],k)}const N=l(t,["mask"]);e!==void 0&&N!=null&&c(e,["instances[0]","mask"],eh(N));const v=l(t,["compressionQuality"]);return e!==void 0&&v!=null&&c(e,["parameters","compressionQuality"],v),s}function tm(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response","generateVideoResponse"]);return i!=null&&c(e,["response"],am(i)),e}function sm(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response"]);return i!=null&&c(e,["response"],om(i)),e}function nm(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["prompt"]);a!=null&&c(s,["instances[0]","prompt"],a);const o=l(e,["image"]);o!=null&&c(s,["instances[0]","image"],dn(o));const i=l(e,["video"]);i!=null&&c(s,["instances[0]","video"],fi(i));const d=l(e,["source"]);d!=null&&im(d,s);const u=l(e,["config"]);return u!=null&&Qf(u,s),s}function rm(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["prompt"]);a!=null&&c(s,["instances[0]","prompt"],a);const o=l(e,["image"]);o!=null&&c(s,["instances[0]","image"],mt(o));const i=l(e,["video"]);i!=null&&c(s,["instances[0]","video"],mi(i));const d=l(e,["source"]);d!=null&&lm(d,s);const u=l(e,["config"]);return u!=null&&em(u,s),s}function am(t){const e={},s=l(t,["generatedSamples"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(i=>um(i))),c(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const a=l(t,["raiMediaFilteredReasons"]);return a!=null&&c(e,["raiMediaFilteredReasons"],a),e}function om(t){const e={},s=l(t,["videos"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(i=>fm(i))),c(e,["generatedVideos"],o)}const r=l(t,["raiMediaFilteredCount"]);r!=null&&c(e,["raiMediaFilteredCount"],r);const a=l(t,["raiMediaFilteredReasons"]);return a!=null&&c(e,["raiMediaFilteredReasons"],a),e}function im(t,e){const s={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const a=l(t,["image"]);e!==void 0&&a!=null&&c(e,["instances[0]","image"],dn(a));const o=l(t,["video"]);return e!==void 0&&o!=null&&c(e,["instances[0]","video"],fi(o)),s}function lm(t,e){const s={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const a=l(t,["image"]);e!==void 0&&a!=null&&c(e,["instances[0]","image"],mt(a));const o=l(t,["video"]);return e!==void 0&&o!=null&&c(e,["instances[0]","video"],mi(o)),s}function dm(t){const e={},s=l(t,["_self"]);s!=null&&c(e,["image"],vm(s));const r=l(t,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);const a=l(t,["_self"]);return a!=null&&c(e,["safetyAttributes"],li(a)),e}function ln(t){const e={},s=l(t,["_self"]);s!=null&&c(e,["image"],ii(s));const r=l(t,["raiFilteredReason"]);r!=null&&c(e,["raiFilteredReason"],r);const a=l(t,["_self"]);a!=null&&c(e,["safetyAttributes"],di(a));const o=l(t,["prompt"]);return o!=null&&c(e,["enhancedPrompt"],o),e}function cm(t){const e={},s=l(t,["_self"]);s!=null&&c(e,["mask"],ii(s));const r=l(t,["labels"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),c(e,["labels"],a)}return e}function um(t){const e={},s=l(t,["video"]);return s!=null&&c(e,["video"],Zm(s)),e}function fm(t){const e={},s=l(t,["_self"]);return s!=null&&c(e,["video"],Qm(s)),e}function mm(t){const e={},s=l(t,["modelSelectionConfig"]);s!=null&&c(e,["modelConfig"],s);const r=l(t,["responseJsonSchema"]);r!=null&&c(e,["responseJsonSchema"],r);const a=l(t,["audioTimestamp"]);a!=null&&c(e,["audioTimestamp"],a);const o=l(t,["candidateCount"]);o!=null&&c(e,["candidateCount"],o);const i=l(t,["enableAffectiveDialog"]);i!=null&&c(e,["enableAffectiveDialog"],i);const d=l(t,["frequencyPenalty"]);d!=null&&c(e,["frequencyPenalty"],d);const u=l(t,["logprobs"]);u!=null&&c(e,["logprobs"],u);const f=l(t,["maxOutputTokens"]);f!=null&&c(e,["maxOutputTokens"],f);const m=l(t,["mediaResolution"]);m!=null&&c(e,["mediaResolution"],m);const p=l(t,["presencePenalty"]);p!=null&&c(e,["presencePenalty"],p);const h=l(t,["responseLogprobs"]);h!=null&&c(e,["responseLogprobs"],h);const g=l(t,["responseMimeType"]);g!=null&&c(e,["responseMimeType"],g);const y=l(t,["responseModalities"]);y!=null&&c(e,["responseModalities"],y);const b=l(t,["responseSchema"]);b!=null&&c(e,["responseSchema"],b);const w=l(t,["routingConfig"]);w!=null&&c(e,["routingConfig"],w);const N=l(t,["seed"]);N!=null&&c(e,["seed"],N);const v=l(t,["speechConfig"]);v!=null&&c(e,["speechConfig"],ci(v));const k=l(t,["stopSequences"]);k!=null&&c(e,["stopSequences"],k);const A=l(t,["temperature"]);A!=null&&c(e,["temperature"],A);const C=l(t,["thinkingConfig"]);C!=null&&c(e,["thinkingConfig"],C);const P=l(t,["topK"]);P!=null&&c(e,["topK"],P);const D=l(t,["topP"]);if(D!=null&&c(e,["topP"],D),l(t,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function hm(t,e){const s={},r=l(e,["model"]);return r!=null&&c(s,["_url","name"],Pe(t,r)),s}function pm(t,e){const s={},r=l(e,["model"]);return r!=null&&c(s,["_url","name"],Pe(t,r)),s}function gm(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=l(t,["enableWidget"]);return s!=null&&c(e,["enableWidget"],s),e}function xm(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=l(t,["timeRangeFilter"]);return s!=null&&c(e,["timeRangeFilter"],s),e}function bm(t){const e={},s=l(t,["aspectRatio"]);s!=null&&c(e,["aspectRatio"],s);const r=l(t,["imageSize"]);if(r!=null&&c(e,["imageSize"],r),l(t,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(l(t,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function ym(t){const e={},s=l(t,["aspectRatio"]);s!=null&&c(e,["aspectRatio"],s);const r=l(t,["imageSize"]);r!=null&&c(e,["imageSize"],r);const a=l(t,["outputMimeType"]);a!=null&&c(e,["imageOutputOptions","mimeType"],a);const o=l(t,["outputCompressionQuality"]);return o!=null&&c(e,["imageOutputOptions","compressionQuality"],o),e}function vm(t){const e={},s=l(t,["bytesBase64Encoded"]);s!=null&&c(e,["imageBytes"],Rt(s));const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function ii(t){const e={},s=l(t,["gcsUri"]);s!=null&&c(e,["gcsUri"],s);const r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["imageBytes"],Rt(r));const a=l(t,["mimeType"]);return a!=null&&c(e,["mimeType"],a),e}function dn(t){const e={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const s=l(t,["imageBytes"]);s!=null&&c(e,["bytesBase64Encoded"],Rt(s));const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function mt(t){const e={},s=l(t,["gcsUri"]);s!=null&&c(e,["gcsUri"],s);const r=l(t,["imageBytes"]);r!=null&&c(e,["bytesBase64Encoded"],Rt(r));const a=l(t,["mimeType"]);return a!=null&&c(e,["mimeType"],a),e}function wm(t,e,s){const r={},a=l(e,["pageSize"]);s!==void 0&&a!=null&&c(s,["_query","pageSize"],a);const o=l(e,["pageToken"]);s!==void 0&&o!=null&&c(s,["_query","pageToken"],o);const i=l(e,["filter"]);s!==void 0&&i!=null&&c(s,["_query","filter"],i);const d=l(e,["queryBase"]);return s!==void 0&&d!=null&&c(s,["_url","models_url"],Qo(t,d)),r}function _m(t,e,s){const r={},a=l(e,["pageSize"]);s!==void 0&&a!=null&&c(s,["_query","pageSize"],a);const o=l(e,["pageToken"]);s!==void 0&&o!=null&&c(s,["_query","pageToken"],o);const i=l(e,["filter"]);s!==void 0&&i!=null&&c(s,["_query","filter"],i);const d=l(e,["queryBase"]);return s!==void 0&&d!=null&&c(s,["_url","models_url"],Qo(t,d)),r}function Nm(t,e){const s={},r=l(e,["config"]);return r!=null&&wm(t,r,s),s}function km(t,e){const s={},r=l(e,["config"]);return r!=null&&_m(t,r,s),s}function Sm(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["_self"]);if(a!=null){let o=ei(a);Array.isArray(o)&&(o=o.map(i=>Un(i))),c(e,["models"],o)}return e}function Cm(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["_self"]);if(a!=null){let o=ei(a);Array.isArray(o)&&(o=o.map(i=>zn(i))),c(e,["models"],o)}return e}function Em(t){const e={},s=l(t,["maskMode"]);s!=null&&c(e,["maskMode"],s);const r=l(t,["segmentationClasses"]);r!=null&&c(e,["maskClasses"],r);const a=l(t,["maskDilation"]);return a!=null&&c(e,["dilation"],a),e}function Un(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);const a=l(t,["description"]);a!=null&&c(e,["description"],a);const o=l(t,["version"]);o!=null&&c(e,["version"],o);const i=l(t,["_self"]);i!=null&&c(e,["tunedModelInfo"],Om(i));const d=l(t,["inputTokenLimit"]);d!=null&&c(e,["inputTokenLimit"],d);const u=l(t,["outputTokenLimit"]);u!=null&&c(e,["outputTokenLimit"],u);const f=l(t,["supportedGenerationMethods"]);f!=null&&c(e,["supportedActions"],f);const m=l(t,["temperature"]);m!=null&&c(e,["temperature"],m);const p=l(t,["maxTemperature"]);p!=null&&c(e,["maxTemperature"],p);const h=l(t,["topP"]);h!=null&&c(e,["topP"],h);const g=l(t,["topK"]);g!=null&&c(e,["topK"],g);const y=l(t,["thinking"]);return y!=null&&c(e,["thinking"],y),e}function zn(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["displayName"]);r!=null&&c(e,["displayName"],r);const a=l(t,["description"]);a!=null&&c(e,["description"],a);const o=l(t,["versionId"]);o!=null&&c(e,["version"],o);const i=l(t,["deployedModels"]);if(i!=null){let p=i;Array.isArray(p)&&(p=p.map(h=>qf(h))),c(e,["endpoints"],p)}const d=l(t,["labels"]);d!=null&&c(e,["labels"],d);const u=l(t,["_self"]);u!=null&&c(e,["tunedModelInfo"],Vm(u));const f=l(t,["defaultCheckpointId"]);f!=null&&c(e,["defaultCheckpointId"],f);const m=l(t,["checkpoints"]);if(m!=null){let p=m;Array.isArray(p)&&(p=p.map(h=>h)),c(e,["checkpoints"],p)}return e}function Tm(t){const e={},s=l(t,["mediaResolution"]);s!=null&&c(e,["mediaResolution"],s);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const a=l(t,["executableCode"]);a!=null&&c(e,["executableCode"],a);const o=l(t,["fileData"]);o!=null&&c(e,["fileData"],Gf(o));const i=l(t,["functionCall"]);i!=null&&c(e,["functionCall"],Bf(i));const d=l(t,["functionResponse"]);d!=null&&c(e,["functionResponse"],d);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],mf(u));const f=l(t,["text"]);f!=null&&c(e,["text"],f);const m=l(t,["thought"]);m!=null&&c(e,["thought"],m);const p=l(t,["thoughtSignature"]);p!=null&&c(e,["thoughtSignature"],p);const h=l(t,["videoMetadata"]);return h!=null&&c(e,["videoMetadata"],h),e}function Am(t){const e={},s=l(t,["productImage"]);return s!=null&&c(e,["image"],mt(s)),e}function Im(t,e){const s={},r=l(t,["numberOfImages"]);e!==void 0&&r!=null&&c(e,["parameters","sampleCount"],r);const a=l(t,["baseSteps"]);e!==void 0&&a!=null&&c(e,["parameters","baseSteps"],a);const o=l(t,["outputGcsUri"]);e!==void 0&&o!=null&&c(e,["parameters","storageUri"],o);const i=l(t,["seed"]);e!==void 0&&i!=null&&c(e,["parameters","seed"],i);const d=l(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&c(e,["parameters","safetySetting"],d);const u=l(t,["personGeneration"]);e!==void 0&&u!=null&&c(e,["parameters","personGeneration"],u);const f=l(t,["addWatermark"]);e!==void 0&&f!=null&&c(e,["parameters","addWatermark"],f);const m=l(t,["outputMimeType"]);e!==void 0&&m!=null&&c(e,["parameters","outputOptions","mimeType"],m);const p=l(t,["outputCompressionQuality"]);e!==void 0&&p!=null&&c(e,["parameters","outputOptions","compressionQuality"],p);const h=l(t,["enhancePrompt"]);e!==void 0&&h!=null&&c(e,["parameters","enhancePrompt"],h);const g=l(t,["labels"]);return e!==void 0&&g!=null&&c(e,["labels"],g),s}function Rm(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["source"]);a!=null&&jm(a,s);const o=l(e,["config"]);return o!=null&&Im(o,s),s}function Pm(t){const e={},s=l(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>ln(a))),c(e,["generatedImages"],r)}return e}function jm(t,e){const s={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const a=l(t,["personImage"]);e!==void 0&&a!=null&&c(e,["instances[0]","personImage","image"],mt(a));const o=l(t,["productImages"]);if(e!==void 0&&o!=null){let i=o;Array.isArray(i)&&(i=i.map(d=>Am(d))),c(e,["instances[0]","productImages"],i)}return s}function Mm(t){const e={},s=l(t,["referenceImage"]);s!=null&&c(e,["referenceImage"],mt(s));const r=l(t,["referenceId"]);r!=null&&c(e,["referenceId"],r);const a=l(t,["referenceType"]);a!=null&&c(e,["referenceType"],a);const o=l(t,["maskImageConfig"]);o!=null&&c(e,["maskImageConfig"],Em(o));const i=l(t,["controlImageConfig"]);i!=null&&c(e,["controlImageConfig"],vf(i));const d=l(t,["styleImageConfig"]);d!=null&&c(e,["styleImageConfig"],d);const u=l(t,["subjectImageConfig"]);return u!=null&&c(e,["subjectImageConfig"],u),e}function li(t){const e={},s=l(t,["safetyAttributes","categories"]);s!=null&&c(e,["categories"],s);const r=l(t,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);const a=l(t,["contentType"]);return a!=null&&c(e,["contentType"],a),e}function di(t){const e={},s=l(t,["safetyAttributes","categories"]);s!=null&&c(e,["categories"],s);const r=l(t,["safetyAttributes","scores"]);r!=null&&c(e,["scores"],r);const a=l(t,["contentType"]);return a!=null&&c(e,["contentType"],a),e}function Dm(t){const e={},s=l(t,["category"]);if(s!=null&&c(e,["category"],s),l(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=l(t,["threshold"]);return r!=null&&c(e,["threshold"],r),e}function Fm(t){const e={},s=l(t,["image"]);return s!=null&&c(e,["image"],mt(s)),e}function Lm(t,e){const s={},r=l(t,["mode"]);e!==void 0&&r!=null&&c(e,["parameters","mode"],r);const a=l(t,["maxPredictions"]);e!==void 0&&a!=null&&c(e,["parameters","maxPredictions"],a);const o=l(t,["confidenceThreshold"]);e!==void 0&&o!=null&&c(e,["parameters","confidenceThreshold"],o);const i=l(t,["maskDilation"]);e!==void 0&&i!=null&&c(e,["parameters","maskDilation"],i);const d=l(t,["binaryColorThreshold"]);e!==void 0&&d!=null&&c(e,["parameters","binaryColorThreshold"],d);const u=l(t,["labels"]);return e!==void 0&&u!=null&&c(e,["labels"],u),s}function Um(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["source"]);a!=null&&qm(a,s);const o=l(e,["config"]);return o!=null&&Lm(o,s),s}function zm(t){const e={},s=l(t,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(a=>cm(a))),c(e,["generatedMasks"],r)}return e}function qm(t,e){const s={},r=l(t,["prompt"]);e!==void 0&&r!=null&&c(e,["instances[0]","prompt"],r);const a=l(t,["image"]);e!==void 0&&a!=null&&c(e,["instances[0]","image"],mt(a));const o=l(t,["scribbleImage"]);return e!==void 0&&o!=null&&c(e,["instances[0]","scribble"],Fm(o)),s}function ci(t){const e={},s=l(t,["languageCode"]);s!=null&&c(e,["languageCode"],s);const r=l(t,["voiceConfig"]);if(r!=null&&c(e,["voiceConfig"],r),l(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Gm(t){const e={},s=l(t,["functionCallingConfig"]);s!=null&&c(e,["functionCallingConfig"],Of(s));const r=l(t,["retrievalConfig"]);return r!=null&&c(e,["retrievalConfig"],r),e}function Bm(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>p)),c(e,["functionDeclarations"],m)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const a=l(t,["computerUse"]);a!=null&&c(e,["computerUse"],a);const o=l(t,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);const i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=l(t,["googleMaps"]);d!=null&&c(e,["googleMaps"],gm(d));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],xm(u));const f=l(t,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function ui(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(h=>Vf(h))),c(e,["functionDeclarations"],p)}const r=l(t,["retrieval"]);r!=null&&c(e,["retrieval"],r);const a=l(t,["googleSearchRetrieval"]);a!=null&&c(e,["googleSearchRetrieval"],a);const o=l(t,["computerUse"]);if(o!=null&&c(e,["computerUse"],o),l(t,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const i=l(t,["codeExecution"]);i!=null&&c(e,["codeExecution"],i);const d=l(t,["enterpriseWebSearch"]);d!=null&&c(e,["enterpriseWebSearch"],d);const u=l(t,["googleMaps"]);u!=null&&c(e,["googleMaps"],u);const f=l(t,["googleSearch"]);f!=null&&c(e,["googleSearch"],f);const m=l(t,["urlContext"]);return m!=null&&c(e,["urlContext"],m),e}function Om(t){const e={},s=l(t,["baseModel"]);s!=null&&c(e,["baseModel"],s);const r=l(t,["createTime"]);r!=null&&c(e,["createTime"],r);const a=l(t,["updateTime"]);return a!=null&&c(e,["updateTime"],a),e}function Vm(t){const e={},s=l(t,["labels","google-vertex-llm-tuning-base-model-id"]);s!=null&&c(e,["baseModel"],s);const r=l(t,["createTime"]);r!=null&&c(e,["createTime"],r);const a=l(t,["updateTime"]);return a!=null&&c(e,["updateTime"],a),e}function $m(t,e){const s={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);const a=l(t,["description"]);e!==void 0&&a!=null&&c(e,["description"],a);const o=l(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&c(e,["defaultCheckpointId"],o),s}function Hm(t,e){const s={},r=l(t,["displayName"]);e!==void 0&&r!=null&&c(e,["displayName"],r);const a=l(t,["description"]);e!==void 0&&a!=null&&c(e,["description"],a);const o=l(t,["defaultCheckpointId"]);return e!==void 0&&o!=null&&c(e,["defaultCheckpointId"],o),s}function Jm(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","name"],Pe(t,r));const a=l(e,["config"]);return a!=null&&$m(a,s),s}function Wm(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["config"]);return a!=null&&Hm(a,s),s}function Km(t,e){const s={},r=l(t,["outputGcsUri"]);e!==void 0&&r!=null&&c(e,["parameters","storageUri"],r);const a=l(t,["safetyFilterLevel"]);e!==void 0&&a!=null&&c(e,["parameters","safetySetting"],a);const o=l(t,["personGeneration"]);e!==void 0&&o!=null&&c(e,["parameters","personGeneration"],o);const i=l(t,["includeRaiReason"]);e!==void 0&&i!=null&&c(e,["parameters","includeRaiReason"],i);const d=l(t,["outputMimeType"]);e!==void 0&&d!=null&&c(e,["parameters","outputOptions","mimeType"],d);const u=l(t,["outputCompressionQuality"]);e!==void 0&&u!=null&&c(e,["parameters","outputOptions","compressionQuality"],u);const f=l(t,["enhanceInputImage"]);e!==void 0&&f!=null&&c(e,["parameters","upscaleConfig","enhanceInputImage"],f);const m=l(t,["imagePreservationFactor"]);e!==void 0&&m!=null&&c(e,["parameters","upscaleConfig","imagePreservationFactor"],m);const p=l(t,["labels"]);e!==void 0&&p!=null&&c(e,["labels"],p);const h=l(t,["numberOfImages"]);e!==void 0&&h!=null&&c(e,["parameters","sampleCount"],h);const g=l(t,["mode"]);return e!==void 0&&g!=null&&c(e,["parameters","mode"],g),s}function Ym(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["_url","model"],Pe(t,r));const a=l(e,["image"]);a!=null&&c(s,["instances[0]","image"],mt(a));const o=l(e,["upscaleFactor"]);o!=null&&c(s,["parameters","upscaleConfig","upscaleFactor"],o);const i=l(e,["config"]);return i!=null&&Km(i,s),s}function Xm(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>ln(o))),c(e,["generatedImages"],a)}return e}function Zm(t){const e={},s=l(t,["uri"]);s!=null&&c(e,["uri"],s);const r=l(t,["encodedVideo"]);r!=null&&c(e,["videoBytes"],Rt(r));const a=l(t,["encoding"]);return a!=null&&c(e,["mimeType"],a),e}function Qm(t){const e={},s=l(t,["gcsUri"]);s!=null&&c(e,["uri"],s);const r=l(t,["bytesBase64Encoded"]);r!=null&&c(e,["videoBytes"],Rt(r));const a=l(t,["mimeType"]);return a!=null&&c(e,["mimeType"],a),e}function eh(t){const e={},s=l(t,["image"]);s!=null&&c(e,["_self"],mt(s));const r=l(t,["maskMode"]);return r!=null&&c(e,["maskMode"],r),e}function th(t){const e={},s=l(t,["image"]);s!=null&&c(e,["image"],dn(s));const r=l(t,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function sh(t){const e={},s=l(t,["image"]);s!=null&&c(e,["image"],mt(s));const r=l(t,["referenceType"]);return r!=null&&c(e,["referenceType"],r),e}function fi(t){const e={},s=l(t,["uri"]);s!=null&&c(e,["uri"],s);const r=l(t,["videoBytes"]);r!=null&&c(e,["encodedVideo"],Rt(r));const a=l(t,["mimeType"]);return a!=null&&c(e,["encoding"],a),e}function mi(t){const e={},s=l(t,["uri"]);s!=null&&c(e,["gcsUri"],s);const r=l(t,["videoBytes"]);r!=null&&c(e,["bytesBase64Encoded"],Rt(r));const a=l(t,["mimeType"]);return a!=null&&c(e,["mimeType"],a),e}const nh="Content-Type",rh="X-Server-Timeout",ah="User-Agent",qn="x-goog-api-client",oh="1.30.0",ih=`google-genai-sdk/${oh}`,lh="v1beta1",dh="v1beta",Ba=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class ch{constructor(e){var s,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:lh,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:dh,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),s=new URL(e);return s.protocol=s.protocol=="http:"?"ws":"wss",s.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,s,r){const a=[this.getRequestUrlInternal(s)];return r&&a.push(this.getBaseResourcePath()),e!==""&&a.push(e),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let s=this.clientOptions.httpOptions;e.httpOptions&&(s=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,s,r);if(e.queryParams)for(const[i,d]of Object.entries(e.queryParams))a.searchParams.append(i,String(d));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,s,a.toString(),e.abortSignal),this.unaryApiCall(a,o,e.httpMethod)}patchHttpOptions(e,s){const r=JSON.parse(JSON.stringify(e));for(const[a,o]of Object.entries(s))typeof o=="object"?r[a]=Object.assign(Object.assign({},r[a]),o):o!==void 0&&(r[a]=o);return r}async requestStream(e){let s=this.clientOptions.httpOptions;e.httpOptions&&(s=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),a=this.constructUrl(e.path,s,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,s,a.toString(),e.abortSignal),this.streamApiCall(a,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,s,r,a){if(s&&s.timeout||a){const o=new AbortController,i=o.signal;if(s.timeout&&s?.timeout>0){const d=setTimeout(()=>o.abort(),s.timeout);d&&typeof d.unref=="function"&&d.unref()}a&&a.addEventListener("abort",()=>{o.abort()}),e.signal=i}return s&&s.extraBody!==null&&uh(e,s.extraBody),e.headers=await this.getHeadersInternal(s,r),e}async unaryApiCall(e,s,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},s),{method:r})).then(async a=>(await Oa(a),new Dn(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(e,s,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},s),{method:r})).then(async a=>(await Oa(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(e){var s;return ns(this,arguments,function*(){const a=(s=e?.body)===null||s===void 0?void 0:s.getReader(),o=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let i="";for(;;){const{done:d,value:u}=yield Le(a.read());if(d){if(i.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const f=o.decode(u,{stream:!0});try{const p=JSON.parse(f);if("error"in p){const h=JSON.parse(JSON.stringify(p.error)),g=h.status,y=h.code,b=`got status: ${g}. ${JSON.stringify(p)}`;if(y>=400&&y<600)throw new an({message:b,status:y})}}catch(p){if(p.name==="ApiError")throw p}i+=f;let m=i.match(Ba);for(;m;){const p=m[1];try{const h=new Response(p,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield Le(new Dn(h)),i=i.slice(m[0].length),m=i.match(Ba)}catch(h){throw new Error(`exception parsing stream chunk ${p}. ${h}`)}}}}finally{a.releaseLock()}})}async apiCall(e,s){return fetch(e,s).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},s=ih+" "+this.clientOptions.userAgentExtra;return e[ah]=s,e[qn]=s,e[nh]="application/json",e}async getHeadersInternal(e,s){const r=new Headers;if(e&&e.headers){for(const[a,o]of Object.entries(e.headers))r.append(a,o);e.timeout&&e.timeout>0&&r.append(rh,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(r,s),r}getFileName(e){var s;let r="";return typeof e=="string"&&(r=e.replace(/[/\\]+$/,""),r=(s=r.split(/[/\\]/).pop())!==null&&s!==void 0?s:""),r}async uploadFile(e,s){var r;const a={};s!=null&&(a.mimeType=s.mimeType,a.name=s.name,a.displayName=s.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const o=this.clientOptions.uploader,i=await o.stat(e);a.sizeBytes=String(i.size);const d=(r=s?.mimeType)!==null&&r!==void 0?r:i.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=d;const u={file:a},f=this.getFileName(e),m=ge("upload/v1beta/files",u._url),p=await this.fetchUploadUrl(m,a.sizeBytes,a.mimeType,f,u,s?.httpOptions);return o.upload(e,p,this)}async uploadFileToFileSearchStore(e,s,r){var a;const o=this.clientOptions.uploader,i=await o.stat(s),d=String(i.size),u=(a=r?.mimeType)!==null&&a!==void 0?a:i.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const f=`upload/v1beta/${e}:uploadToFileSearchStore`,m=this.getFileName(s),p={};r?.customMetadata&&(p.customMetadata=r.customMetadata),r?.chunkingConfig&&(p.chunkingConfig=r.chunkingConfig);const h=await this.fetchUploadUrl(f,d,u,m,p,r?.httpOptions);return o.uploadToFileSearchStore(s,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,s,r,a,o,i){var d;let u={};i?u=i:u={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s}`,"X-Goog-Upload-Header-Content-Type":`${r}`},a?{"X-Goog-Upload-File-Name":a}:{})};const f=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:u});if(!f||!f?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const m=(d=f?.headers)===null||d===void 0?void 0:d["x-goog-upload-url"];if(m===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return m}}async function Oa(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){const s=t.status;let r;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await t.json():r={error:{message:await t.text(),code:t.status,status:t.statusText}};const a=JSON.stringify(r);throw s>=400&&s<600?new an({message:a,status:s}):new Error(a)}}function uh(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let s={};if(typeof t.body=="string"&&t.body.length>0)try{const o=JSON.parse(t.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))s=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(o,i){const d=Object.assign({},o);for(const u in i)if(Object.prototype.hasOwnProperty.call(i,u)){const f=i[u],m=d[u];f&&typeof f=="object"&&!Array.isArray(f)&&m&&typeof m=="object"&&!Array.isArray(m)?d[u]=r(m,f):(m&&f&&typeof m!=typeof f&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof m}, New type: ${typeof f}. Overwriting.`),d[u]=f)}return d}const a=r(s,e);t.body=JSON.stringify(a)}const fh="mcp_used/unknown";let mh=!1;function hi(t){for(const e of t)if(hh(e)||typeof e=="object"&&"inputSchema"in e)return!0;return mh}function pi(t){var e;const s=(e=t[qn])!==null&&e!==void 0?e:"";t[qn]=(s+` ${fh}`).trimStart()}function hh(t){return t!==null&&typeof t=="object"&&t instanceof lr}function ph(t,e=100){return ns(this,arguments,function*(){let r,a=0;for(;a<e;){const o=yield Le(t.listTools({cursor:r}));for(const i of o.tools)yield yield Le(i),a++;if(!o.nextCursor)break;r=o.nextCursor}})}class lr{constructor(e=[],s){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=s}static create(e,s){return new lr(e,s)}async initialize(){var e,s,r,a;if(this.mcpTools.length>0)return;const o={},i=[];for(const m of this.mcpClients)try{for(var d=!0,u=(s=void 0,ys(ph(m))),f;f=await u.next(),e=f.done,!e;d=!0){a=f.value,d=!1;const p=a;i.push(p);const h=p.name;if(o[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);o[h]=m}}catch(p){s={error:p}}finally{try{!d&&!e&&(r=u.return)&&await r.call(u)}finally{if(s)throw s.error}}this.mcpTools=i,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),oc(this.mcpTools,this.config)}async callTool(e){await this.initialize();const s=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const a=this.functionNameToMcpClient[r.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const i=await a.callTool({name:r.name,arguments:r.args},void 0,o);s.push({functionResponse:{name:r.name,response:i.isError?{error:i}:i}})}return s}}async function gh(t,e,s){const r=new Zd;let a;s.data instanceof Blob?a=JSON.parse(await s.data.text()):a=JSON.parse(s.data),Object.assign(r,a),e(r)}class xh{constructor(e,s,r){this.apiClient=e,this.auth=s,this.webSocketFactory=r}async connect(e){var s,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const a=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),i=vh(this.apiClient.getDefaultHeaders()),d=this.apiClient.getApiKey(),u=`${a}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${d}`;let f=()=>{};const m=new Promise(k=>{f=k}),p=e.callbacks,h=function(){f({})},g=this.apiClient,y={onopen:h,onmessage:k=>{gh(g,p.onmessage,k)},onerror:(s=p?.onerror)!==null&&s!==void 0?s:function(k){},onclose:(r=p?.onclose)!==null&&r!==void 0?r:function(k){}},b=this.webSocketFactory.create(u,yh(i),y);b.connect(),await m;const v={setup:{model:Pe(this.apiClient,e.model)}};return b.send(JSON.stringify(v)),new bh(b,this.apiClient)}}class bh{constructor(e,s){this.conn=e,this.apiClient=s}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const s=nf(e);this.conn.send(JSON.stringify({clientContent:s}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const s=sf(e);this.conn.send(JSON.stringify(s))}sendPlaybackControl(e){const s={playbackControl:e};this.conn.send(JSON.stringify(s))}play(){this.sendPlaybackControl(Zt.PLAY)}pause(){this.sendPlaybackControl(Zt.PAUSE)}stop(){this.sendPlaybackControl(Zt.STOP)}resetContext(){this.sendPlaybackControl(Zt.RESET_CONTEXT)}close(){this.conn.close()}}function yh(t){const e={};return t.forEach((s,r)=>{e[r]=s}),e}function vh(t){const e=new Headers;for(const[s,r]of Object.entries(t))e.append(s,r);return e}const wh="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function _h(t,e,s){const r=new Xd;let a;s.data instanceof Blob?a=await s.data.text():s.data instanceof ArrayBuffer?a=new TextDecoder().decode(s.data):a=s.data;const o=JSON.parse(a);if(t.isVertexAI()){const i=of(o);Object.assign(r,i)}else Object.assign(r,o);e(r)}class Nh{constructor(e,s,r){this.apiClient=e,this.auth=s,this.webSocketFactory=r,this.music=new xh(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var s,r,a,o,i,d;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const u=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion();let m;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&hi(e.config.tools)&&pi(p);const h=Eh(p);if(this.apiClient.isVertexAI())m=`${u}/ws/google.cloud.aiplatform.${f}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,m);else{const R=this.apiClient.getApiKey();let U="BidiGenerateContent",Q="key";R?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),f!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),U="BidiGenerateContentConstrained",Q="access_token"),m=`${u}/ws/google.ai.generativelanguage.${f}.GenerativeService.${U}?${Q}=${R}`}let g=()=>{};const y=new Promise(R=>{g=R}),b=e.callbacks,w=function(){var R;(R=b?.onopen)===null||R===void 0||R.call(b),g({})},N=this.apiClient,v={onopen:w,onmessage:R=>{_h(N,b.onmessage,R)},onerror:(s=b?.onerror)!==null&&s!==void 0?s:function(R){},onclose:(r=b?.onclose)!==null&&r!==void 0?r:function(R){}},k=this.webSocketFactory.create(m,Ch(h),v);k.connect(),await y;let A=Pe(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&A.startsWith("publishers/")){const R=this.apiClient.getProject(),U=this.apiClient.getLocation();A=`projects/${R}/locations/${U}/`+A}let C={};this.apiClient.isVertexAI()&&((a=e.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Qs.AUDIO]}:e.config.responseModalities=[Qs.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const P=(d=(i=e.config)===null||i===void 0?void 0:i.tools)!==null&&d!==void 0?d:[],D=[];for(const R of P)if(this.isCallableTool(R)){const U=R;D.push(await U.tool())}else D.push(R);D.length>0&&(e.config.tools=D);const B={model:A,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?C=tf(this.apiClient,B):C=ef(this.apiClient,B),delete C.config,k.send(JSON.stringify(C)),new Sh(k,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const kh={turnComplete:!0};class Sh{constructor(e,s){this.conn=e,this.apiClient=s}tLiveClientContent(e,s){if(s.turns!==null&&s.turns!==void 0){let r=[];try{r=lt(s.turns),e.isVertexAI()||(r=r.map(a=>on(a)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof s.turns}'`)}return{clientContent:{turns:r,turnComplete:s.turnComplete}}}return{clientContent:{turnComplete:s.turnComplete}}}tLiveClienttToolResponse(e,s){let r=[];if(s.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(s.functionResponses)?r=s.functionResponses:r=[s.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(wh)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},kh),e);const s=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(s))}sendRealtimeInput(e){let s={};this.apiClient.isVertexAI()?s={realtimeInput:af(e)}:s={realtimeInput:rf(e)},this.conn.send(JSON.stringify(s))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const s=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(s))}close(){this.conn.close()}}function Ch(t){const e={};return t.forEach((s,r)=>{e[r]=s}),e}function Eh(t){const e=new Headers;for(const[s,r]of Object.entries(t))e.append(s,r);return e}const Va=10;function $a(t){var e,s,r;if(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let a=!1;for(const i of(s=t?.tools)!==null&&s!==void 0?s:[])if(rs(i)){a=!0;break}if(!a)return!0;const o=(r=t?.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function rs(t){return"callTool"in t&&typeof t.callTool=="function"}function Th(t){var e,s,r;return(r=(s=(e=t.config)===null||e===void 0?void 0:e.tools)===null||s===void 0?void 0:s.some(a=>rs(a)))!==null&&r!==void 0?r:!1}function Ha(t){var e;const s=[];return!((e=t?.config)===null||e===void 0)&&e.tools&&t.config.tools.forEach((r,a)=>{if(rs(r))return;const o=r;o.functionDeclarations&&o.functionDeclarations.length>0&&s.push(a)}),s}function Ja(t){var e;return!(!((e=t?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}let Ah=class extends kt{constructor(e){super(),this.apiClient=e,this.generateContent=async s=>{var r,a,o,i,d;const u=await this.processParamsMaybeAddMcpUsage(s);if(this.maybeMoveToResponseJsonSchem(s),!Th(s)||$a(s.config))return await this.generateContentInternal(u);const f=Ha(s);if(f.length>0){const b=f.map(w=>`tools[${w}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${b}.`)}let m,p;const h=lt(u.contents),g=(o=(a=(r=u.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||a===void 0?void 0:a.maximumRemoteCalls)!==null&&o!==void 0?o:Va;let y=0;for(;y<g&&(m=await this.generateContentInternal(u),!(!m.functionCalls||m.functionCalls.length===0));){const b=m.candidates[0].content,w=[];for(const N of(d=(i=s.config)===null||i===void 0?void 0:i.tools)!==null&&d!==void 0?d:[])if(rs(N)){const k=await N.callTool(m.functionCalls);w.push(...k)}y++,p={role:"user",parts:w},u.contents=lt(u.contents),u.contents.push(b),u.contents.push(p),Ja(u.config)&&(h.push(b),h.push(p))}return Ja(u.config)&&(m.automaticFunctionCallingHistory=h),m},this.generateContentStream=async s=>{var r,a,o,i,d;if(this.maybeMoveToResponseJsonSchem(s),$a(s.config)){const p=await this.processParamsMaybeAddMcpUsage(s);return await this.generateContentStreamInternal(p)}const u=Ha(s);if(u.length>0){const p=u.map(h=>`tools[${h}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const f=(o=(a=(r=s?.config)===null||r===void 0?void 0:r.toolConfig)===null||a===void 0?void 0:a.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,m=(d=(i=s?.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||d===void 0?void 0:d.disable;if(f&&!m)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(s)},this.generateImages=async s=>await this.generateImagesInternal(s).then(r=>{var a;let o;const i=[];if(r?.generatedImages)for(const u of r.generatedImages)u&&u?.safetyAttributes&&((a=u?.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?o=u?.safetyAttributes:i.push(u);let d;return o?d={generatedImages:i,positivePromptSafetyAttributes:o,sdkHttpResponse:r.sdkHttpResponse}:d={generatedImages:i,sdkHttpResponse:r.sdkHttpResponse},d}),this.list=async s=>{var r;const i={config:Object.assign(Object.assign({},{queryBase:!0}),s?.config)};if(this.apiClient.isVertexAI()&&!i.config.queryBase){if(!((r=i.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");i.config.filter="labels.tune-type:*"}return new $t(Nt.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(i),i)},this.editImage=async s=>{const r={model:s.model,prompt:s.prompt,referenceImages:[],config:s.config};return s.referenceImages&&s.referenceImages&&(r.referenceImages=s.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async s=>{let r={numberOfImages:1,mode:"upscale"};s.config&&(r=Object.assign(Object.assign({},r),s.config));const a={model:s.model,image:s.image,upscaleFactor:s.upscaleFactor,config:r};return await this.upscaleImageInternal(a)},this.generateVideos=async s=>{var r,a,o,i,d,u;if((s.prompt||s.image||s.video)&&s.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((r=s.video)===null||r===void 0)&&r.uri&&(!((a=s.video)===null||a===void 0)&&a.videoBytes)?s.video={uri:s.video.uri,mimeType:s.video.mimeType}:!((i=(o=s.source)===null||o===void 0?void 0:o.video)===null||i===void 0)&&i.uri&&(!((u=(d=s.source)===null||d===void 0?void 0:d.video)===null||u===void 0)&&u.videoBytes)&&(s.source.video={uri:s.source.video.uri,mimeType:s.source.video.mimeType})),await this.generateVideosInternal(s)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var s,r,a;const o=(s=e.config)===null||s===void 0?void 0:s.tools;if(!o)return e;const i=await Promise.all(o.map(async u=>rs(u)?await u.tool():u)),d={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:i})};if(d.config.tools=i,e.config&&e.config.tools&&hi(e.config.tools)){const u=(a=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&a!==void 0?a:{};let f=Object.assign({},u);Object.keys(f).length===0&&(f=this.apiClient.getDefaultHeaders()),pi(f),d.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:f})}return d}async initAfcToolsMap(e){var s,r,a;const o=new Map;for(const i of(r=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&r!==void 0?r:[])if(rs(i)){const d=i,u=await d.tool();for(const f of(a=u.functionDeclarations)!==null&&a!==void 0?a:[]){if(!f.name)throw new Error("Function declaration name is required.");if(o.has(f.name))throw new Error(`Duplicate tool declaration name: ${f.name}`);o.set(f.name,d)}}return o}async processAfcStream(e){var s,r,a;const o=(a=(r=(s=e.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&a!==void 0?a:Va;let i=!1,d=0;const u=await this.initAfcToolsMap(e);return(function(f,m,p){var h,g;return ns(this,arguments,function*(){for(var y,b,w,N;d<o;){i&&(d++,i=!1);const C=yield Le(f.processParamsMaybeAddMcpUsage(p)),P=yield Le(f.generateContentStreamInternal(C)),D=[],B=[];try{for(var v=!0,k=(b=void 0,ys(P)),A;A=yield Le(k.next()),y=A.done,!y;v=!0){N=A.value,v=!1;const R=N;if(yield yield Le(R),R.candidates&&(!((h=R.candidates[0])===null||h===void 0)&&h.content)){B.push(R.candidates[0].content);for(const U of(g=R.candidates[0].content.parts)!==null&&g!==void 0?g:[])if(d<o&&U.functionCall){if(!U.functionCall.name)throw new Error("Function call name was not returned by the model.");if(m.has(U.functionCall.name)){const Q=yield Le(m.get(U.functionCall.name).callTool([U.functionCall]));D.push(...Q)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${m.keys()}, mising tool: ${U.functionCall.name}`)}}}}catch(R){b={error:R}}finally{try{!v&&!y&&(w=k.return)&&(yield Le(w.call(k)))}finally{if(b)throw b.error}}if(D.length>0){i=!0;const R=new hs;R.candidates=[{content:{role:"user",parts:D}}],yield yield Le(R);const U=[];U.push(...B),U.push({role:"user",parts:D});const Q=lt(p.contents).concat(U);p.contents=Q}else break}})})(this,u,e)}async generateContentInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=za(this.apiClient,e);return d=ge("{model}:generateContent",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Ga(m),h=new hs;return Object.assign(h,p),h})}else{const f=Ua(this.apiClient,e);return d=ge("{model}:generateContent",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=qa(m),h=new hs;return Object.assign(h,p),h})}}async generateContentStreamInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=za(this.apiClient,e);return d=ge("{model}:streamGenerateContent?alt=sse",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.requestStream({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),i.then(function(p){return ns(this,arguments,function*(){var h,g,y,b;try{for(var w=!0,N=ys(p),v;v=yield Le(N.next()),h=v.done,!h;w=!0){b=v.value,w=!1;const k=b,A=Ga(yield Le(k.json()));A.sdkHttpResponse={headers:k.headers};const C=new hs;Object.assign(C,A),yield yield Le(C)}}catch(k){g={error:k}}finally{try{!w&&!h&&(y=N.return)&&(yield Le(y.call(N)))}finally{if(g)throw g.error}}})})}else{const f=Ua(this.apiClient,e);return d=ge("{model}:streamGenerateContent?alt=sse",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.requestStream({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),i.then(function(p){return ns(this,arguments,function*(){var h,g,y,b;try{for(var w=!0,N=ys(p),v;v=yield Le(N.next()),h=v.done,!h;w=!0){b=v.value,w=!1;const k=b,A=qa(yield Le(k.json()));A.sdkHttpResponse={headers:k.headers};const C=new hs;Object.assign(C,A),yield yield Le(C)}}catch(k){g={error:k}}finally{try{!w&&!h&&(y=N.return)&&(yield Le(y.call(N)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Lf(this.apiClient,e);return d=ge("{model}:predict",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=zf(m),h=new _a;return Object.assign(h,p),h})}else{const f=Ff(this.apiClient,e);return d=ge("{model}:batchEmbedContents",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Uf(m),h=new _a;return Object.assign(h,p),h})}}async generateImagesInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Yf(this.apiClient,e);return d=ge("{model}:predict",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Zf(m),h=new Na;return Object.assign(h,p),h})}else{const f=Kf(this.apiClient,e);return d=ge("{model}:predict",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Xf(m),h=new Na;return Object.assign(h,p),h})}}async editImageInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=Pf(this.apiClient,e);return o=ge("{model}:predict",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>{const f=jf(u),m=new qd;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=Ym(this.apiClient,e);return o=ge("{model}:predict",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>{const f=Xm(u),m=new Gd;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=Rm(this.apiClient,e);return o=ge("{model}:predict",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=Pm(u),m=new Bd;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=Um(this.apiClient,e);return o=ge("{model}:predict",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=zm(u),m=new Od;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=pm(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>zn(m))}else{const f=hm(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>Un(m))}}async listInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=km(this.apiClient,e);return d=ge("{models_url}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Cm(m),h=new ka;return Object.assign(h,p),h})}else{const f=Nm(this.apiClient,e);return d=ge("{models_url}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Sm(m),h=new ka;return Object.assign(h,p),h})}}async update(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Wm(this.apiClient,e);return d=ge("{model}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>zn(m))}else{const f=Jm(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"PATCH",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>Un(m))}}async delete(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Tf(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=If(m),h=new Sa;return Object.assign(h,p),h})}else{const f=Ef(this.apiClient,e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Af(m),h=new Sa;return Object.assign(h,p),h})}}async countTokens(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=kf(this.apiClient,e);return d=ge("{model}:countTokens",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Cf(m),h=new Ca;return Object.assign(h,p),h})}else{const f=Nf(this.apiClient,e);return d=ge("{model}:countTokens",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Sf(m),h=new Ca;return Object.assign(h,p),h})}}async computeTokens(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=gf(this.apiClient,e);return o=ge("{model}:computeTokens",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>{const f=xf(u),m=new Vd;return Object.assign(m,f),m})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=rm(this.apiClient,e);return d=ge("{model}:predictLongRunning",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i.then(m=>{const p=sm(m),h=new en;return Object.assign(h,p),h})}else{const f=nm(this.apiClient,e);return d=ge("{model}:predictLongRunning",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i.then(m=>{const p=tm(m),h=new en;return Object.assign(h,p),h})}}};class Ih extends kt{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const s=e.operation,r=e.config;if(s.name===void 0||s.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=s.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const i=await this.fetchPredictVideosOperationInternal({operationName:s.name,resourceName:a,config:{httpOptions:o}});return s._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:s.name,config:r});return s._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(e){const s=e.operation,r=e.config;if(s.name===void 0||s.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=s.name.split("/operations/")[0];let o;r&&"httpOptions"in r&&(o=r.httpOptions);const i=await this.fetchPredictVideosOperationInternal({operationName:s.name,resourceName:a,config:{httpOptions:o}});return s._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}else{const a=await this.getVideosOperationInternal({operationName:s.name,config:r});return s._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Md(e);return d=ge("{operationName}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json()),i}else{const f=jd(e);return d=ge("{operationName}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()),i}}async fetchPredictVideosOperationInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=Cd(e);return o=ge("{resourceName}:fetchPredictOperation",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a}else throw new Error("This method is only supported by the Vertex AI.")}}function Rh(t){const e={},s=l(t,["data"]);if(s!=null&&c(e,["data"],s),l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Ph(t){const e={},s=l(t,["parts"]);if(s!=null){let a=s;Array.isArray(a)&&(a=a.map(o=>Gh(o))),c(e,["parts"],a)}const r=l(t,["role"]);return r!=null&&c(e,["role"],r),e}function jh(t,e,s){const r={},a=l(e,["expireTime"]);s!==void 0&&a!=null&&c(s,["expireTime"],a);const o=l(e,["newSessionExpireTime"]);s!==void 0&&o!=null&&c(s,["newSessionExpireTime"],o);const i=l(e,["uses"]);s!==void 0&&i!=null&&c(s,["uses"],i);const d=l(e,["liveConnectConstraints"]);s!==void 0&&d!=null&&c(s,["bidiGenerateContentSetup"],qh(t,d));const u=l(e,["lockAdditionalFields"]);return s!==void 0&&u!=null&&c(s,["fieldMask"],u),r}function Mh(t,e){const s={},r=l(e,["config"]);return r!=null&&c(s,["config"],jh(t,r,s)),s}function Dh(t){const e={};if(l(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=l(t,["fileUri"]);s!=null&&c(e,["fileUri"],s);const r=l(t,["mimeType"]);return r!=null&&c(e,["mimeType"],r),e}function Fh(t){const e={},s=l(t,["id"]);s!=null&&c(e,["id"],s);const r=l(t,["args"]);r!=null&&c(e,["args"],r);const a=l(t,["name"]);if(a!=null&&c(e,["name"],a),l(t,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(l(t,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function Lh(t){const e={};if(l(t,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const s=l(t,["enableWidget"]);return s!=null&&c(e,["enableWidget"],s),e}function Uh(t){const e={};if(l(t,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(l(t,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const s=l(t,["timeRangeFilter"]);return s!=null&&c(e,["timeRangeFilter"],s),e}function zh(t,e){const s={},r=l(t,["generationConfig"]);e!==void 0&&r!=null&&c(e,["setup","generationConfig"],r);const a=l(t,["responseModalities"]);e!==void 0&&a!=null&&c(e,["setup","generationConfig","responseModalities"],a);const o=l(t,["temperature"]);e!==void 0&&o!=null&&c(e,["setup","generationConfig","temperature"],o);const i=l(t,["topP"]);e!==void 0&&i!=null&&c(e,["setup","generationConfig","topP"],i);const d=l(t,["topK"]);e!==void 0&&d!=null&&c(e,["setup","generationConfig","topK"],d);const u=l(t,["maxOutputTokens"]);e!==void 0&&u!=null&&c(e,["setup","generationConfig","maxOutputTokens"],u);const f=l(t,["mediaResolution"]);e!==void 0&&f!=null&&c(e,["setup","generationConfig","mediaResolution"],f);const m=l(t,["seed"]);e!==void 0&&m!=null&&c(e,["setup","generationConfig","seed"],m);const p=l(t,["speechConfig"]);e!==void 0&&p!=null&&c(e,["setup","generationConfig","speechConfig"],ir(p));const h=l(t,["thinkingConfig"]);e!==void 0&&h!=null&&c(e,["setup","generationConfig","thinkingConfig"],h);const g=l(t,["enableAffectiveDialog"]);e!==void 0&&g!=null&&c(e,["setup","generationConfig","enableAffectiveDialog"],g);const y=l(t,["systemInstruction"]);e!==void 0&&y!=null&&c(e,["setup","systemInstruction"],Ph(Ke(y)));const b=l(t,["tools"]);if(e!==void 0&&b!=null){let P=ds(b);Array.isArray(P)&&(P=P.map(D=>Oh(ls(D)))),c(e,["setup","tools"],P)}const w=l(t,["sessionResumption"]);e!==void 0&&w!=null&&c(e,["setup","sessionResumption"],Bh(w));const N=l(t,["inputAudioTranscription"]);e!==void 0&&N!=null&&c(e,["setup","inputAudioTranscription"],N);const v=l(t,["outputAudioTranscription"]);e!==void 0&&v!=null&&c(e,["setup","outputAudioTranscription"],v);const k=l(t,["realtimeInputConfig"]);e!==void 0&&k!=null&&c(e,["setup","realtimeInputConfig"],k);const A=l(t,["contextWindowCompression"]);e!==void 0&&A!=null&&c(e,["setup","contextWindowCompression"],A);const C=l(t,["proactivity"]);return e!==void 0&&C!=null&&c(e,["setup","proactivity"],C),s}function qh(t,e){const s={},r=l(e,["model"]);r!=null&&c(s,["setup","model"],Pe(t,r));const a=l(e,["config"]);return a!=null&&c(s,["config"],zh(a,s)),s}function Gh(t){const e={},s=l(t,["mediaResolution"]);s!=null&&c(e,["mediaResolution"],s);const r=l(t,["codeExecutionResult"]);r!=null&&c(e,["codeExecutionResult"],r);const a=l(t,["executableCode"]);a!=null&&c(e,["executableCode"],a);const o=l(t,["fileData"]);o!=null&&c(e,["fileData"],Dh(o));const i=l(t,["functionCall"]);i!=null&&c(e,["functionCall"],Fh(i));const d=l(t,["functionResponse"]);d!=null&&c(e,["functionResponse"],d);const u=l(t,["inlineData"]);u!=null&&c(e,["inlineData"],Rh(u));const f=l(t,["text"]);f!=null&&c(e,["text"],f);const m=l(t,["thought"]);m!=null&&c(e,["thought"],m);const p=l(t,["thoughtSignature"]);p!=null&&c(e,["thoughtSignature"],p);const h=l(t,["videoMetadata"]);return h!=null&&c(e,["videoMetadata"],h),e}function Bh(t){const e={},s=l(t,["handle"]);if(s!=null&&c(e,["handle"],s),l(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Oh(t){const e={},s=l(t,["functionDeclarations"]);if(s!=null){let m=s;Array.isArray(m)&&(m=m.map(p=>p)),c(e,["functionDeclarations"],m)}if(l(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=l(t,["googleSearchRetrieval"]);r!=null&&c(e,["googleSearchRetrieval"],r);const a=l(t,["computerUse"]);a!=null&&c(e,["computerUse"],a);const o=l(t,["fileSearch"]);o!=null&&c(e,["fileSearch"],o);const i=l(t,["codeExecution"]);if(i!=null&&c(e,["codeExecution"],i),l(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const d=l(t,["googleMaps"]);d!=null&&c(e,["googleMaps"],Lh(d));const u=l(t,["googleSearch"]);u!=null&&c(e,["googleSearch"],Uh(u));const f=l(t,["urlContext"]);return f!=null&&c(e,["urlContext"],f),e}function Vh(t){const e=[];for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const r=t[s];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const a=Object.keys(r).map(o=>`${s}.${o}`);e.push(...a)}else e.push(s)}return e.join(",")}function $h(t,e){let s=null;const r=t.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const o=r.setup;typeof o=="object"&&o!==null?(t.bidiGenerateContentSetup=o,s=o):delete t.bidiGenerateContentSetup}else r!==void 0&&delete t.bidiGenerateContentSetup;const a=t.fieldMask;if(s){const o=Vh(s);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)o?t.fieldMask=o:delete t.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&a!==null&&Array.isArray(a)&&a.length>0){const i=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let d=[];a.length>0&&(d=a.map(f=>i.includes(f)?`generationConfig.${f}`:f));const u=[];o&&u.push(o),d.length>0&&u.push(...d),u.length>0?t.fieldMask=u.join(","):delete t.fieldMask}else delete t.fieldMask}else a!==null&&Array.isArray(a)&&a.length>0?t.fieldMask=a.join(","):delete t.fieldMask;return t}class Hh extends kt{constructor(e){super(),this.apiClient=e}async create(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const d=Mh(this.apiClient,e);o=ge("auth_tokens",d._url),i=d._query,delete d.config,delete d._url,delete d._query;const u=$h(d,e.config);return a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),a.then(f=>f)}}}function Jh(t,e){const s={},r=l(t,["displayName"]);return e!==void 0&&r!=null&&c(e,["displayName"],r),s}function Wh(t){const e={},s=l(t,["config"]);return s!=null&&Jh(s,e),e}function Kh(t,e){const s={},r=l(t,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),s}function Yh(t){const e={},s=l(t,["name"]);s!=null&&c(e,["_url","name"],s);const r=l(t,["config"]);return r!=null&&Kh(r,e),e}function Xh(t){const e={},s=l(t,["name"]);return s!=null&&c(e,["_url","name"],s),e}function Zh(t,e){const s={},r=l(t,["customMetadata"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["customMetadata"],o)}const a=l(t,["chunkingConfig"]);return e!==void 0&&a!=null&&c(e,["chunkingConfig"],a),s}function Qh(t){const e={},s=l(t,["name"]);s!=null&&c(e,["name"],s);const r=l(t,["metadata"]);r!=null&&c(e,["metadata"],r);const a=l(t,["done"]);a!=null&&c(e,["done"],a);const o=l(t,["error"]);o!=null&&c(e,["error"],o);const i=l(t,["response"]);return i!=null&&c(e,["response"],tp(i)),e}function ep(t){const e={},s=l(t,["fileSearchStoreName"]);s!=null&&c(e,["_url","file_search_store_name"],s);const r=l(t,["fileName"]);r!=null&&c(e,["fileName"],r);const a=l(t,["config"]);return a!=null&&Zh(a,e),e}function tp(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["parent"]);r!=null&&c(e,["parent"],r);const a=l(t,["documentName"]);return a!=null&&c(e,["documentName"],a),e}function sp(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);return e!==void 0&&a!=null&&c(e,["_query","pageToken"],a),s}function np(t){const e={},s=l(t,["config"]);return s!=null&&sp(s,e),e}function rp(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["fileSearchStores"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["fileSearchStores"],o)}return e}function ap(t,e){const s={},r=l(t,["mimeType"]);e!==void 0&&r!=null&&c(e,["mimeType"],r);const a=l(t,["displayName"]);e!==void 0&&a!=null&&c(e,["displayName"],a);const o=l(t,["customMetadata"]);if(e!==void 0&&o!=null){let d=o;Array.isArray(d)&&(d=d.map(u=>u)),c(e,["customMetadata"],d)}const i=l(t,["chunkingConfig"]);return e!==void 0&&i!=null&&c(e,["chunkingConfig"],i),s}function op(t){const e={},s=l(t,["fileSearchStoreName"]);s!=null&&c(e,["_url","file_search_store_name"],s);const r=l(t,["config"]);return r!=null&&ap(r,e),e}function ip(t){const e={},s=l(t,["sdkHttpResponse"]);return s!=null&&c(e,["sdkHttpResponse"],s),e}function lp(t,e){const s={},r=l(t,["force"]);return e!==void 0&&r!=null&&c(e,["_query","force"],r),s}function dp(t){const e={},s=l(t,["name"]);s!=null&&c(e,["_url","name"],s);const r=l(t,["config"]);return r!=null&&lp(r,e),e}function cp(t){const e={},s=l(t,["name"]);return s!=null&&c(e,["_url","name"],s),e}function up(t,e){const s={},r=l(t,["pageSize"]);e!==void 0&&r!=null&&c(e,["_query","pageSize"],r);const a=l(t,["pageToken"]);return e!==void 0&&a!=null&&c(e,["_query","pageToken"],a),s}function fp(t){const e={},s=l(t,["parent"]);s!=null&&c(e,["_url","parent"],s);const r=l(t,["config"]);return r!=null&&up(r,e),e}function mp(t){const e={},s=l(t,["sdkHttpResponse"]);s!=null&&c(e,["sdkHttpResponse"],s);const r=l(t,["nextPageToken"]);r!=null&&c(e,["nextPageToken"],r);const a=l(t,["documents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(i=>i)),c(e,["documents"],o)}return e}class hp extends kt{constructor(e){super(),this.apiClient=e,this.list=async s=>new $t(Nt.PAGED_ITEM_DOCUMENTS,r=>this.listInternal({parent:s.parent,config:r.config}),await this.listInternal(s),s)}async get(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=cp(e);return o=ge("{name}",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>u)}}async delete(e){var s,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const i=dp(e);a=ge("{name}",i._url),o=i._query,delete i._url,delete i._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=fp(e);return o=ge("{parent}/documents",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=mp(u),m=new $d;return Object.assign(m,f),m})}}}class pp extends kt{constructor(e,s=new hp(e)){super(),this.apiClient=e,this.documents=s,this.list=async(r={})=>new $t(Nt.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(r),r)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Wh(e);return o=ge("fileSearchStores",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>u)}}async get(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Xh(e);return o=ge("{name}",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>u)}}async delete(e){var s,r;let a="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const i=Yh(e);a=ge("{name}",i._url),o=i._query,delete i._url,delete i._query,await this.apiClient.request({path:a,queryParams:o,body:JSON.stringify(i),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=np(e);return o=ge("fileSearchStores",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=rp(u),m=new Hd;return Object.assign(m,f),m})}}async uploadToFileSearchStoreInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=op(e);return o=ge("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=ip(u),m=new Jd;return Object.assign(m,f),m})}}async importFile(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=ep(e);return o=ge("{file_search_store_name}:importFile",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),a.then(u=>{const f=Qh(u),m=new sr;return Object.assign(m,f),m})}}}function gp(t,e){const s={},r=l(t,["name"]);return r!=null&&c(s,["_url","name"],r),s}function xp(t,e){const s={},r=l(t,["name"]);return r!=null&&c(s,["_url","name"],r),s}function bp(t,e,s){const r={};if(l(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=l(t,["tunedModelDisplayName"]);if(e!==void 0&&a!=null&&c(e,["displayName"],a),l(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=l(t,["epochCount"]);e!==void 0&&o!=null&&c(e,["tuningTask","hyperparameters","epochCount"],o);const i=l(t,["learningRateMultiplier"]);if(i!=null&&c(r,["tuningTask","hyperparameters","learningRateMultiplier"],i),l(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(l(t,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(l(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=l(t,["batchSize"]);e!==void 0&&d!=null&&c(e,["tuningTask","hyperparameters","batchSize"],d);const u=l(t,["learningRate"]);if(e!==void 0&&u!=null&&c(e,["tuningTask","hyperparameters","learningRate"],u),l(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(l(t,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return r}function yp(t,e,s){const r={};let a=l(s,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec"],Wa(g))}else if(a==="PREFERENCE_TUNING"){const g=l(t,["validationDataset"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec"],Wa(g))}const o=l(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&c(e,["tunedModelDisplayName"],o);const i=l(t,["description"]);e!==void 0&&i!=null&&c(e,["description"],i);let d=l(s,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","hyperParameters","epochCount"],g)}else if(d==="PREFERENCE_TUNING"){const g=l(t,["epochCount"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],g)}let u=l(s,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],g)}else if(u==="PREFERENCE_TUNING"){const g=l(t,["learningRateMultiplier"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],g)}let f=l(s,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","exportLastCheckpointOnly"],g)}else if(f==="PREFERENCE_TUNING"){const g=l(t,["exportLastCheckpointOnly"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],g)}let m=l(s,["config","method"]);if(m===void 0&&(m="SUPERVISED_FINE_TUNING"),m==="SUPERVISED_FINE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&c(e,["supervisedTuningSpec","hyperParameters","adapterSize"],g)}else if(m==="PREFERENCE_TUNING"){const g=l(t,["adapterSize"]);e!==void 0&&g!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],g)}if(l(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(l(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=l(t,["labels"]);e!==void 0&&p!=null&&c(e,["labels"],p);const h=l(t,["beta"]);return e!==void 0&&h!=null&&c(e,["preferenceOptimizationSpec","hyperParameters","beta"],h),r}function vp(t,e){const s={},r=l(t,["baseModel"]);r!=null&&c(s,["baseModel"],r);const a=l(t,["preTunedModel"]);a!=null&&c(s,["preTunedModel"],a);const o=l(t,["trainingDataset"]);o!=null&&Rp(o);const i=l(t,["config"]);return i!=null&&bp(i,s),s}function wp(t,e){const s={},r=l(t,["baseModel"]);r!=null&&c(s,["baseModel"],r);const a=l(t,["preTunedModel"]);a!=null&&c(s,["preTunedModel"],a);const o=l(t,["trainingDataset"]);o!=null&&Pp(o,s,e);const i=l(t,["config"]);return i!=null&&yp(i,s,e),s}function _p(t,e){const s={},r=l(t,["name"]);return r!=null&&c(s,["_url","name"],r),s}function Np(t,e){const s={},r=l(t,["name"]);return r!=null&&c(s,["_url","name"],r),s}function kp(t,e,s){const r={},a=l(t,["pageSize"]);e!==void 0&&a!=null&&c(e,["_query","pageSize"],a);const o=l(t,["pageToken"]);e!==void 0&&o!=null&&c(e,["_query","pageToken"],o);const i=l(t,["filter"]);return e!==void 0&&i!=null&&c(e,["_query","filter"],i),r}function Sp(t,e,s){const r={},a=l(t,["pageSize"]);e!==void 0&&a!=null&&c(e,["_query","pageSize"],a);const o=l(t,["pageToken"]);e!==void 0&&o!=null&&c(e,["_query","pageToken"],o);const i=l(t,["filter"]);return e!==void 0&&i!=null&&c(e,["_query","filter"],i),r}function Cp(t,e){const s={},r=l(t,["config"]);return r!=null&&kp(r,s),s}function Ep(t,e){const s={},r=l(t,["config"]);return r!=null&&Sp(r,s),s}function Tp(t,e){const s={},r=l(t,["sdkHttpResponse"]);r!=null&&c(s,["sdkHttpResponse"],r);const a=l(t,["nextPageToken"]);a!=null&&c(s,["nextPageToken"],a);const o=l(t,["tunedModels"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(d=>gi(d))),c(s,["tuningJobs"],i)}return s}function Ap(t,e){const s={},r=l(t,["sdkHttpResponse"]);r!=null&&c(s,["sdkHttpResponse"],r);const a=l(t,["nextPageToken"]);a!=null&&c(s,["nextPageToken"],a);const o=l(t,["tuningJobs"]);if(o!=null){let i=o;Array.isArray(i)&&(i=i.map(d=>Gn(d))),c(s,["tuningJobs"],i)}return s}function Ip(t,e){const s={},r=l(t,["name"]);r!=null&&c(s,["model"],r);const a=l(t,["name"]);return a!=null&&c(s,["endpoint"],a),s}function Rp(t,e){const s={};if(l(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(l(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const r=l(t,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>o)),c(s,["examples","examples"],a)}return s}function Pp(t,e,s){const r={};let a=l(s,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const i=l(t,["gcsUri"]);e!==void 0&&i!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],i)}else if(a==="PREFERENCE_TUNING"){const i=l(t,["gcsUri"]);e!==void 0&&i!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],i)}let o=l(s,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const i=l(t,["vertexDatasetResource"]);e!==void 0&&i!=null&&c(e,["supervisedTuningSpec","trainingDatasetUri"],i)}else if(o==="PREFERENCE_TUNING"){const i=l(t,["vertexDatasetResource"]);e!==void 0&&i!=null&&c(e,["preferenceOptimizationSpec","trainingDatasetUri"],i)}if(l(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function gi(t,e){const s={},r=l(t,["sdkHttpResponse"]);r!=null&&c(s,["sdkHttpResponse"],r);const a=l(t,["name"]);a!=null&&c(s,["name"],a);const o=l(t,["state"]);o!=null&&c(s,["state"],Xo(o));const i=l(t,["createTime"]);i!=null&&c(s,["createTime"],i);const d=l(t,["tuningTask","startTime"]);d!=null&&c(s,["startTime"],d);const u=l(t,["tuningTask","completeTime"]);u!=null&&c(s,["endTime"],u);const f=l(t,["updateTime"]);f!=null&&c(s,["updateTime"],f);const m=l(t,["description"]);m!=null&&c(s,["description"],m);const p=l(t,["baseModel"]);p!=null&&c(s,["baseModel"],p);const h=l(t,["_self"]);return h!=null&&c(s,["tunedModel"],Ip(h)),s}function Gn(t,e){const s={},r=l(t,["sdkHttpResponse"]);r!=null&&c(s,["sdkHttpResponse"],r);const a=l(t,["name"]);a!=null&&c(s,["name"],a);const o=l(t,["state"]);o!=null&&c(s,["state"],Xo(o));const i=l(t,["createTime"]);i!=null&&c(s,["createTime"],i);const d=l(t,["startTime"]);d!=null&&c(s,["startTime"],d);const u=l(t,["endTime"]);u!=null&&c(s,["endTime"],u);const f=l(t,["updateTime"]);f!=null&&c(s,["updateTime"],f);const m=l(t,["error"]);m!=null&&c(s,["error"],m);const p=l(t,["description"]);p!=null&&c(s,["description"],p);const h=l(t,["baseModel"]);h!=null&&c(s,["baseModel"],h);const g=l(t,["tunedModel"]);g!=null&&c(s,["tunedModel"],g);const y=l(t,["preTunedModel"]);y!=null&&c(s,["preTunedModel"],y);const b=l(t,["supervisedTuningSpec"]);b!=null&&c(s,["supervisedTuningSpec"],b);const w=l(t,["preferenceOptimizationSpec"]);w!=null&&c(s,["preferenceOptimizationSpec"],w);const N=l(t,["tuningDataStats"]);N!=null&&c(s,["tuningDataStats"],N);const v=l(t,["encryptionSpec"]);v!=null&&c(s,["encryptionSpec"],v);const k=l(t,["partnerModelTuningSpec"]);k!=null&&c(s,["partnerModelTuningSpec"],k);const A=l(t,["customBaseModel"]);A!=null&&c(s,["customBaseModel"],A);const C=l(t,["experiment"]);C!=null&&c(s,["experiment"],C);const P=l(t,["labels"]);P!=null&&c(s,["labels"],P);const D=l(t,["outputUri"]);D!=null&&c(s,["outputUri"],D);const B=l(t,["pipelineJob"]);B!=null&&c(s,["pipelineJob"],B);const R=l(t,["serviceAccount"]);R!=null&&c(s,["serviceAccount"],R);const U=l(t,["tunedModelDisplayName"]);U!=null&&c(s,["tunedModelDisplayName"],U);const Q=l(t,["veoTuningSpec"]);return Q!=null&&c(s,["veoTuningSpec"],Q),s}function jp(t,e){const s={},r=l(t,["sdkHttpResponse"]);r!=null&&c(s,["sdkHttpResponse"],r);const a=l(t,["name"]);a!=null&&c(s,["name"],a);const o=l(t,["metadata"]);o!=null&&c(s,["metadata"],o);const i=l(t,["done"]);i!=null&&c(s,["done"],i);const d=l(t,["error"]);return d!=null&&c(s,["error"],d),s}function Wa(t,e){const s={},r=l(t,["gcsUri"]);r!=null&&c(s,["validationDatasetUri"],r);const a=l(t,["vertexDatasetResource"]);return a!=null&&c(s,["validationDatasetUri"],a),s}class Mp extends kt{constructor(e){super(),this.apiClient=e,this.get=async s=>await this.getInternal(s),this.list=async(s={})=>new $t(Nt.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(s),s),this.tune=async s=>{var r;if(this.apiClient.isVertexAI())if(s.baseModel.startsWith("projects/")){const a={tunedModelName:s.baseModel};!((r=s.config)===null||r===void 0)&&r.preTunedModelCheckpointId&&(a.checkpointId=s.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},s),{preTunedModel:a});return o.baseModel=void 0,await this.tuneInternal(o)}else{const a=Object.assign({},s);return await this.tuneInternal(a)}else{const a=Object.assign({},s),o=await this.tuneMldevInternal(a);let i="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?i=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(i=o.name.split("/operations/")[0]),{name:i,state:Mn.JOB_STATE_QUEUED}}}}async getInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Np(e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>Gn(m))}else{const f=_p(e);return d=ge("{name}",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>gi(m))}}async listInternal(e){var s,r,a,o;let i,d="",u={};if(this.apiClient.isVertexAI()){const f=Ep(e);return d=ge("tuningJobs",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Ap(m),h=new Ea;return Object.assign(h,p),h})}else{const f=Cp(e);return d=ge("tunedModels",f._url),u=f._query,delete f._url,delete f._query,i=this.apiClient.request({path:d,queryParams:u,body:JSON.stringify(f),httpMethod:"GET",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:m.headers},h})),i.then(m=>{const p=Tp(m),h=new Ea;return Object.assign(h,p),h})}}async cancel(e){var s,r,a,o;let i="",d={};if(this.apiClient.isVertexAI()){const u=xp(e);i=ge("{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}else{const u=gp(e);i=ge("{name}:cancel",u._url),d=u._query,delete u._url,delete u._query,await this.apiClient.request({path:i,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=e.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async tuneInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI()){const d=wp(e,e);return o=ge("tuningJobs",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>Gn(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var s,r;let a,o="",i={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=vp(e);return o=ge("tunedModels",d._url),i=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:o,queryParams:i,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),a.then(u=>jp(u))}}}class Dp{async download(e,s){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Fp=1024*1024*8,Lp=3,Up=1e3,zp=2,sn="x-goog-upload-status";async function qp(t,e,s){var r;const a=await xi(t,e,s),o=await a?.json();if(((r=a?.headers)===null||r===void 0?void 0:r[sn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function Gp(t,e,s){var r;const a=await xi(t,e,s),o=await a?.json();if(((r=a?.headers)===null||r===void 0?void 0:r[sn])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const i=$o(o),d=new nr;return Object.assign(d,i),d}async function xi(t,e,s){var r,a;let o=0,i=0,d=new Dn(new Response),u="upload";for(o=t.size;i<o;){const f=Math.min(Fp,o-i),m=t.slice(i,i+f);i+f>=o&&(u+=", finalize");let p=0,h=Up;for(;p<Lp&&(d=await s.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(i),"Content-Length":String(f)}}}),!(!((r=d?.headers)===null||r===void 0)&&r[sn]));)p++,await Op(h),h=h*zp;if(i+=f,((a=d?.headers)===null||a===void 0?void 0:a[sn])!=="active")break;if(o<=i)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return d}async function Bp(t){return{size:t.size,type:t.type}}function Op(t){return new Promise(e=>setTimeout(e,t))}class Vp{async upload(e,s,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await qp(e,s,r)}async uploadToFileSearchStore(e,s,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Gp(e,s,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Bp(e)}}class $p{create(e,s,r){return new Hp(e,s,r)}}class Hp{constructor(e,s,r){this.url=e,this.headers=s,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}const Ka="x-goog-api-key";class Jp{constructor(e){this.apiKey=e}async addAuthHeaders(e,s){if(e.get(Ka)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Ka,this.apiKey)}}}const Wp="gl-node/";class Kp{constructor(e){var s;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(s=e.vertexai)!==null&&s!==void 0?s:!1,this.apiKey=e.apiKey;const r=kd(e.httpOptions,e.vertexai,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const a=new Jp(this.apiKey);this.apiClient=new ch({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Wp+"web",uploader:new Vp,downloader:new Dp}),this.models=new Ah(this.apiClient),this.live=new Nh(this.apiClient,a,new $p),this.batches=new Qc(this.apiClient),this.chats=new Mu(this.models,this.apiClient),this.caches=new Ru(this.apiClient),this.files=new Vu(this.apiClient),this.operations=new Ih(this.apiClient),this.authTokens=new Hh(this.apiClient),this.tunings=new Mp(this.apiClient),this.fileSearchStores=new pp(this.apiClient)}}const Se="/api";async function Ce(t){if(!t.ok)try{const e=await t.json();throw new Error(e.error||e.message||`Request failed: ${t.status}`)}catch{throw new Error(`Request failed: ${t.status} ${t.statusText}`)}return t.json()}const Vs={login:async(t,e)=>{const s=await fetch(`${Se}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:e})});return Ce(s)},register:async t=>{const e=await fetch(`${Se}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},logout:async()=>{const t=await fetch(`${Se}/auth/logout`,{method:"POST",credentials:"include"});return Ce(t)},me:async()=>{const t=await fetch(`${Se}/auth/me`,{credentials:"include"});return Ce(t)},recoverPassword:async(t,e,s)=>{const r=await fetch(`${Se}/auth/recover-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,securityAnswer:e,newPassword:s})});return Ce(r)}},gs={getAll:async()=>{const t=await fetch(`${Se}/transactions`,{credentials:"include"});return Ce(t)},create:async t=>{const e=await fetch(`${Se}/transactions`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},update:async(t,e)=>{const s=await fetch(`${Se}/transactions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return Ce(s)},delete:async t=>{const e=await fetch(`${Se}/transactions/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)}},Ya={analyze:async(t=!0)=>{let e=`${Se}/ai-planning/analyze`;if(t){const r=Date.now();e+=`?refresh=true&t=${r}`}const s=await fetch(e,{credentials:"include",cache:"no-cache"});return Ce(s)}},Qt={getLimits:async()=>{const t=await fetch(`${Se}/budget/limits`,{credentials:"include"});return Ce(t)},saveBudget:async t=>{const e=await fetch(`${Se}/budget/limits`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},setLimit:async(t,e)=>{const s=await fetch(`${Se}/budget/limits`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({category:t,limit:e})});return Ce(s)},deleteLimit:async t=>{const e=await fetch(`${Se}/budget/limits/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)},getHistory:async()=>{const t=await fetch(`${Se}/budget/history`,{credentials:"include"});return Ce(t)},saveHistory:async()=>{const t=await fetch(`${Se}/budget/history/save`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({})});return Ce(t)},getSummary:async()=>{const t=await fetch(`${Se}/budget/summary`,{credentials:"include"});return Ce(t)}},es={getAll:async()=>{const t=await fetch(`${Se}/goals`,{credentials:"include"});return Ce(t)},create:async t=>{const e=await fetch(`${Se}/goals`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},contribute:async(t,e,s)=>{const r=await fetch(`${Se}/goals/${t}/contribute`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({amount:e,note:s})});return Ce(r)},update:async(t,e)=>{const s=await fetch(`${Se}/goals/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return Ce(s)},delete:async t=>{const e=await fetch(`${Se}/goals/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)}},$s={getAll:async()=>{const t=await fetch(`${Se}/users`,{credentials:"include"});return Ce(t)},create:async t=>{const e=await fetch(`${Se}/users`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},update:async(t,e)=>{const s=await fetch(`${Se}/users/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return Ce(s)},delete:async t=>{const e=await fetch(`${Se}/users/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)}},Lt={getTasks:async()=>{const t=await fetch(`${Se}/family/tasks`,{credentials:"include"});return Ce(t)},createTask:async t=>{const e=await fetch(`${Se}/family/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},updateTask:async(t,e)=>{const s=await fetch(`${Se}/family/tasks/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});return Ce(s)},deleteTask:async t=>{const e=await fetch(`${Se}/family/tasks/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)},getEvents:async()=>{const t=await fetch(`${Se}/family/events`,{credentials:"include"});return Ce(t)},createEvent:async t=>{const e=await fetch(`${Se}/family/events`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});return Ce(e)},deleteEvent:async t=>{const e=await fetch(`${Se}/family/events/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)}},bt={getSetting:async t=>{const e=await fetch(`${Se}/settings/${t}`,{credentials:"include"});return Ce(e)},setSetting:async(t,e)=>{const s=await fetch(`${Se}/settings`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({key:t,value:e})});return Ce(s)},getApiConfig:async t=>{const e=await fetch(`${Se}/settings/api-config/${t}`,{credentials:"include"});return Ce(e)},saveApiConfig:async(t,e,s)=>{const r=await fetch(`${Se}/settings/api-configs`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({provider:t,apiKey:e,model:s})});return Ce(r)},deleteApiConfig:async t=>{const e=await fetch(`${Se}/settings/api-config/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)}},Xa={getAll:async()=>{const t=await fetch(`${Se}/families`,{credentials:"include"});return Ce(t)},delete:async t=>{const e=await fetch(`${Se}/families/${t}`,{method:"DELETE",credentials:"include"});return Ce(e)}};let xs=null;const bi=async()=>{if(xs)return xs;try{const t=await bt.getApiConfig("google_gemini");if(t?.apiKey)return xs=t.apiKey,xs}catch{}return""},ht=async()=>{const t=await bi();return t?new Kp({apiKey:t}):null},Yp=async t=>{try{await bt.saveApiConfig("google_gemini",t),xs=t}catch(e){throw console.error("Erro ao salvar chave Gemini:",e),e}},Xp=async()=>!!await bi(),Zp=async(t,e=[])=>{const s=e.find(a=>a.description.toLowerCase().trim()===t.toLowerCase().trim());if(s)return s.category;const r=await ht();if(!r)return"Geral";try{const a="gemini-2.5-flash",o=`
      VocÃª Ã© um assistente financeiro. Categorize a seguinte transaÃ§Ã£o financeira em uma Ãºnica palavra ou frase curta em PortuguÃªs (Ex: AlimentaÃ§Ã£o, Transporte, Moradia, Lazer, SaÃºde, EducaÃ§Ã£o, SalÃ¡rio, Outros).
      
      DescriÃ§Ã£o da transaÃ§Ã£o: "${t}"
      
      Responda apenas com a categoria.
    `,i=await r.models.generateContent({model:a,contents:o});return i.text?i.text.trim():"Geral"}catch(a){return console.error("Erro ao categorizar transaÃ§Ã£o com Gemini:",a),"Geral"}},Qp=async(t,e,s="pt")=>{const r=await ht();if(!r)return"Configure sua chave de API do Gemini em ConfiguraÃ§Ãµes > IntegraÃ§Ãµes para receber conselhos personalizados.";const a={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"};try{const i=`
      Analise brevemente este resumo financeiro familiar e dÃª uma dica curta (mÃ¡ximo 2 frases) de como melhorar a saÃºde financeira.
      Dados: ${JSON.stringify({totalTransacoes:t.length,metas:e.map(u=>({nome:u.name,progresso:(u.currentAmount/u.targetAmount).toFixed(2)}))})}
      
      IMPORTANTE: Responda APENAS em ${a[s]||"Portuguese"}.
    `,d=await r.models.generateContent({model:"gemini-2.5-flash",contents:i});return d.text?d.text.trim():"Mantenha o foco!"}catch{return"Mantenha o foco em suas metas de economia!"}},e0=async t=>{const e=await ht();if(!e)throw new Error("API Key nÃ£o configurada. PeÃ§a ao Super Admin para configurar em ConfiguraÃ§Ãµes > IntegraÃ§Ãµes.");try{const s=`
      Analise o texto completo extraÃ­do de um documento bancÃ¡rio (PDF).
      Extraia e retorne APENAS um JSON vÃ¡lido com os campos:
      - loanAmount: O valor do "Capital em DÃ­vida" inicial ou "Montante do EmprÃ©stimo". (NÃºmero).
      - interestRateAnnual: A taxa de juros anual (%) usada para calcular as prestaÃ§Ãµes. (NÃºmero).
      - termMonths: O nÃºmero total de prestaÃ§Ãµes. (NÃºmero).
      - system: 'PRICE' ou 'SAC'. Se a prestaÃ§Ã£o for constante, Ã© PRICE. Se a amortizaÃ§Ã£o for constante, Ã© SAC.

      Texto do Documento:
      "${t}"
    `,r=await e.models.generateContent({model:"gemini-2.5-flash",contents:s});let a=r.text?r.text.trim():"{}";return a.startsWith("```json")&&(a=a.replace(/```json\n?/,"").replace(/```$/,"")),JSON.parse(a)}catch(s){throw console.error("Erro ao analisar documento:",s),new Error("NÃ£o foi possÃ­vel analisar o documento. Verifique o formato do PDF.")}},t0=async(t,e="pt")=>{const s=await ht();if(!s)return{summary:"Configure a API do Gemini para anÃ¡lise de comportamento.",patterns:[],recommendations:[]};const r={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"};try{const a=JSON.stringify(t.slice(0,20)),o=`
      Analise o comportamento financeiro baseado nas transaÃ§Ãµes. Retorne um JSON com:
      - summary: Resumo breve (1 frase) do comportamento
      - persona: Um nome descritivo para o perfil de gastos (ex: "Economizador Cauteloso")
      - patternDescription: DescriÃ§Ã£o de um padrÃ£o principal observado
      - tip: Uma dica para melhorar os gastos
      - nextMonthProjection: ProjeÃ§Ã£o de despesa para o prÃ³ximo mÃªs (nÃºmero)
      
      IMPORTANTE: Responda APENAS em ${r[e]||"Portuguese"}, incluindo todas as strings.
      TransaÃ§Ãµes: ${a}
    `,i=await s.models.generateContent({model:"gemini-2.5-flash",contents:o});let d=i.text?i.text.trim():"{}";return d.includes("```")&&(d=d.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim()),JSON.parse(d)}catch{return{summary:"Comece adicionando mais transaÃ§Ãµes.",patterns:[],recommendations:[],persona:"Novo UsuÃ¡rio",patternDescription:"Insuficientes dados",tip:"Adicione mais transaÃ§Ãµes para anÃ¡lise",nextMonthProjection:0}}},s0=async t=>{const e=await ht();if(!e)return{description:t,category:"Geral"};try{const s=`
      Extraia os dados de uma transaÃ§Ã£o financeira do seguinte texto em PortuguÃªs. Retorne APENAS um JSON vÃ¡lido com:
      - description: DescriÃ§Ã£o breve
      - amount: Valor numÃ©rico
      - type: "INCOME" ou "EXPENSE"
      - category: Categoria (uma palavra)
      - date: Data em formato YYYY-MM-DD (hoje se nÃ£o mencionada)
      
      Texto: "${t}"
    `,r=await e.models.generateContent({model:"gemini-2.5-flash",contents:s});let a=r.text?r.text.trim():"{}";return a.startsWith("```json")&&(a=a.replace(/```json\n?/,"").replace(/```$/,"")),a.startsWith("```")&&(a=a.slice(3),a=a.slice(0,a.lastIndexOf("```"))),JSON.parse(a)}catch{return{description:t,category:"Geral"}}},n0=async t=>{const e=await ht();if(!e)return{description:"Ãudio nÃ£o processado",category:"Geral"};try{const r=await e.models.generateContent({model:"gemini-2.5-flash",contents:[{text:`
      Transcreva e extraia dados de uma transaÃ§Ã£o financeira do seguinte Ã¡udio. Retorne APENAS um JSON com:
      - description: DescriÃ§Ã£o
      - amount: Valor
      - type: "INCOME" ou "EXPENSE"
      - category: Categoria
      - date: YYYY-MM-DD
    `},{inlineData:{mimeType:"audio/webm",data:t}}]});let a=r.text?r.text.trim():"{}";return a.includes("```")&&(a=a.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim()),JSON.parse(a)}catch{return{description:"Ãudio nÃ£o processado",category:"Geral"}}},r0=async t=>{const e=await ht();if(!e)return[];try{const s=t.reduce((i,d)=>(d.type==="EXPENSE"&&(i[d.category]=(i[d.category]||0)+d.amount),i),{}),r=`
      Baseado nestes gastos por categoria: ${JSON.stringify(s)}
      Sugira 3 limites de orÃ§amento mensais recomendados.
      Responda com array JSON: [{ category: string, suggestedLimit: number }]
    `,a=await e.models.generateContent({model:"gemini-2.5-flash",contents:r});let o=a.text?a.text.trim():"[]";return o.startsWith("```json")&&(o=o.replace(/```json\n?/,"").replace(/```$/,"")),JSON.parse(o)}catch{return[]}},a0=async t=>{const e=await ht();if(!e)throw new Error("API nÃ£o configurada");try{const r=(await e.models.generateContent({model:"gemini-2.5-flash",contents:t,generationConfig:{temperature:.7}})).text||"Sem resposta.",a=20;return(async function*(){for(let o=0;o<r.length;o+=a)yield r.substring(o,o+a),await new Promise(i=>setTimeout(i,50))})()}catch{throw new Error("Erro ao processar mensagem com streaming.")}},o0=async t=>{const e=await ht();if(!e)return{description:"Recibo nÃ£o processado",category:"Geral"};try{const r=await e.models.generateContent({model:"gemini-2.5-flash",contents:[{text:`
      Analise esta foto de recibo/fatura. Extraia os dados de transaÃ§Ã£o financeira. Retorne APENAS um JSON vÃ¡lido com:
      - description: DescriÃ§Ã£o do estabelecimento/item principal
      - amount: Valor total pago (nÃºmero)
      - type: "EXPENSE"
      - category: Categoria (uma palavra em PortuguÃªs)
      - date: Data em formato YYYY-MM-DD (se visÃ­vel, caso contrÃ¡rio hoje)
      
      Se nÃ£o conseguir extrair algum campo, use um valor padrÃ£o razoÃ¡vel.
    `},{inlineData:{mimeType:"image/jpeg",data:t.startsWith("data:")?t.split(",")[1]:t}}]});let a=r.text?r.text.trim():"{}";return a.includes("```")&&(a=a.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim()),JSON.parse(a)}catch(s){return console.error("Erro ao processar recibo:",s),{description:"Recibo nÃ£o processado",category:"Geral"}}},i0=async(t,e="pt")=>{const s=await ht();if(!s)return{wasteIndicators:[],totalWaste:0,suggestions:[]};const r={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"};try{const a=t.reduce((u,f)=>(f.type==="EXPENSE"&&(u[f.category]=(u[f.category]||0)+f.amount),u),{}),o=`
      Analise estes gastos e identifique potenciais desperdÃ­cios:
      ${JSON.stringify(a)}
      
      Retorne um JSON com:
      - wasteIndicators: Array de 3-5 sinais de possÃ­vel desperdÃ­cio (ex: "Gastos elevados em cafÃ©")
      - totalWaste: Valor estimado em desperdÃ­cio (nÃºmero)
      - suggestions: Array de 3 sugestÃµes para reduzir gastos
      
      IMPORTANTE: Responda APENAS em ${r[e]||"Portuguese"}, incluindo todas as strings.
    `,i=await s.models.generateContent({model:"gemini-2.5-flash",contents:o});let d=i.text?i.text.trim():"{}";return d.includes("```")&&(d=d.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim()),JSON.parse(d)}catch{return{wasteIndicators:[],totalWaste:0,suggestions:[]}}},l0=async(t,e=3,s="pt")=>{const r=await ht();if(!r)return{predictions:[],confidence:0,notes:"API nÃ£o configurada"};const a={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"};try{const o=t.filter(f=>f.type==="EXPENSE").slice(0,12).reduce((f,m)=>{const p=new Date(m.date).toISOString().split("T")[0].substring(0,7);return f[p]=(f[p]||0)+m.amount,f},{}),i=`
      Analise o histÃ³rico de gastos mensais e faÃ§a previsÃµes para os prÃ³ximos ${e} meses:
      HistÃ³rico: ${JSON.stringify(o)}
      
      Retorne um JSON com:
      - predictions: Array com previsÃµes de despesa para cada mÃªs (ex: [{ month: "2025-12", predictedExpense: 500 }])
      - confidence: NÃ­vel de confianÃ§a da previsÃ£o (0-100)
      - notes: ObservaÃ§Ãµes sobre a previsÃ£o (ex: "TendÃªncia crescente detectada", "PadrÃ£o sazonal")
      
      IMPORTANTE: Responda APENAS em ${a[s]||"Portuguese"}, incluindo todas as strings.
    `,d=await r.models.generateContent({model:"gemini-2.5-flash",contents:i});let u=d.text?d.text.trim():"{}";return u.includes("```")&&(u=u.replace(/```json\s*/g,"").replace(/```\s*/g,"").trim()),JSON.parse(u)}catch{return{predictions:[],confidence:0,notes:"Erro ao processar previsÃ£o"}}},Ns={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"},Pt=()=>window.puter,d0=()=>localStorage.getItem("ai_provider")==="puter",c0=async t=>{const e=Pt();if(typeof e>"u")return console.warn("Puter.js not loaded"),"Geral";try{const s=`
      VocÃª Ã© um assistente financeiro. Categorize a seguinte transaÃ§Ã£o financeira em uma Ãºnica palavra ou frase curta em PortuguÃªs (Ex: AlimentaÃ§Ã£o, Transporte, Moradia, Lazer, SaÃºde, EducaÃ§Ã£o, SalÃ¡rio, Outros).
      
      DescriÃ§Ã£o da transaÃ§Ã£o: "${t}"
      
      Responda apenas com a categoria.
    `;return(await e.ai.chat(s,{model:"gpt-4.1-nano"}))?.trim()||"Geral"}catch(s){return console.error("Error categorizing with Puter:",s),"Geral"}},u0=async(t,e,s="pt")=>{const r=Pt();if(typeof r>"u")return"Configure Puter em ConfiguraÃ§Ãµes > IntegraÃ§Ãµes para receber conselhos personalizados.";try{const o=`
      Analise brevemente este resumo financeiro familiar e dÃª uma dica curta (mÃ¡ximo 2 frases) de como melhorar a saÃºde financeira.
      Dados: ${JSON.stringify({totalTransacoes:t.length,metas:e.map(d=>({nome:d.name,progresso:(d.currentAmount/d.targetAmount).toFixed(2)}))})}
      
      IMPORTANTE: Responda APENAS em ${Ns[s]||"Portuguese"}.
    `;return(await r.ai.chat(o,{model:"gpt-4.1-nano"}))?.trim()||"Mantenha o foco!"}catch(a){return console.error("Error getting financial advice from Puter:",a),"Mantenha o foco em suas metas de economia!"}},f0=async(t,e="pt")=>{const s=Pt();if(typeof s>"u")return{persona:"UsuÃ¡rio",patternDescription:"",tip:"",nextMonthProjection:0};try{const r=JSON.stringify(t.slice(0,10)),a=`
      Analise o comportamento de gastos deste usuÃ¡rio e retorne APENAS um JSON vÃ¡lido com:
      - persona (tipo de gastador em ${Ns[e]||"Portuguese"})
      - patternDescription (descriÃ§Ã£o do padrÃ£o)
      - tip (dica de melhoria)
      - nextMonthProjection (projeÃ§Ã£o de gastos para prÃ³ximo mÃªs em nÃºmero)
      
      TransaÃ§Ãµes: ${r}
      IMPORTANTE: Responda APENAS em ${Ns[e]||"Portuguese"}.
    `;let i=(await s.ai.chat(a,{model:"gpt-4.1-nano"}))?.trim()||"{}";return i.startsWith("```json")&&(i=i.replace(/```json\n?/,"").replace(/```$/,"")),i.startsWith("```")&&(i=i.slice(3).slice(0,i.lastIndexOf("```"))),JSON.parse(i)}catch(r){return console.error("Error analyzing user behavior with Puter:",r),{persona:"UsuÃ¡rio",patternDescription:"",tip:"",nextMonthProjection:0}}},m0=async t=>{const e=Pt();if(typeof e>"u")return{description:t,category:"Geral"};try{const s=`
      Extraia os dados de uma transaÃ§Ã£o financeira do seguinte texto em PortuguÃªs. Retorne APENAS um JSON vÃ¡lido com:
      - description: DescriÃ§Ã£o breve
      - amount: Valor numÃ©rico
      - type: "INCOME" ou "EXPENSE"
      - category: Categoria (uma palavra)
      - date: Data em formato YYYY-MM-DD (hoje se nÃ£o mencionada)
      
      Texto: "${t}"
    `;let a=(await e.ai.chat(s,{model:"gpt-4.1-nano"}))?.trim()||"{}";return a.startsWith("```json")&&(a=a.replace(/```json\n?/,"").replace(/```$/,"")),a.startsWith("```")&&(a=a.slice(3).slice(0,a.lastIndexOf("```"))),JSON.parse(a)}catch(s){return console.error("Error parsing transaction with Puter:",s),{description:t,category:"Geral"}}},h0=async t=>(console.warn("Puter does not support audio transcription. Please use Gemini provider for audio features."),{description:"",category:"Geral",error:"Puter nÃ£o suporta processamento de Ã¡udio. Use Gemini para esta funcionalidade."}),p0=async t=>{const e=Pt();return(async function*(){if(typeof e>"u"){yield"Puter.js nÃ£o foi carregado.";return}try{const s=await e.ai.chat(t,{model:"gpt-4.1-nano",stream:!0});for await(const r of s)yield r}catch(s){console.error("Error streaming response from Puter:",s);try{yield(await e.ai.chat(t,{model:"gpt-4.1-nano"}))?.trim()||"Erro ao processar sua mensagem."}catch{yield"Erro ao processar sua mensagem."}}})()},g0=async t=>{const e=Pt();if(typeof e>"u")return{description:"Recibo",category:"Geral"};try{const s=`
      Analise este recibo/nota fiscal e extraia dados da transaÃ§Ã£o.
      Retorne APENAS um JSON vÃ¡lido com: description, amount, category, date
      
      Imagem URL: ${t}
    `;let a=(await e.ai.chat(s,{model:"gpt-4.1-nano",image:t}))?.trim()||"{}";return a.startsWith("```json")&&(a=a.replace(/```json\n?/,"").replace(/```$/,"")),a.startsWith("```")&&(a=a.slice(3).slice(0,a.lastIndexOf("```"))),JSON.parse(a)}catch(s){return console.error("Error parsing receipt with Puter:",s),{description:"Recibo",category:"Geral"}}},x0=async(t,e="pt")=>{const s=Pt();if(typeof s>"u")return{wasteIndicators:[],totalWaste:0,suggestions:[]};try{const r=`
      Analise estes gastos e identifique possÃ­veis desperdÃ­cios.
      Retorne APENAS um JSON vÃ¡lido com: wasteIndicators (array), totalWaste (nÃºmero), suggestions (array)
      
      TransaÃ§Ãµes: ${JSON.stringify(t.slice(0,15))}
      IMPORTANTE: Responda APENAS em ${Ns[e]||"Portuguese"}.
    `;let o=(await s.ai.chat(r,{model:"gpt-4.1-nano"}))?.trim()||'{"wasteIndicators":[],"totalWaste":0,"suggestions":[]}';return o.startsWith("```json")&&(o=o.replace(/```json\n?/,"").replace(/```$/,"")),o.startsWith("```")&&(o=o.slice(3).slice(0,o.lastIndexOf("```"))),JSON.parse(o)}catch(r){return console.error("Error analyzing waste with Puter:",r),{wasteIndicators:[],totalWaste:0,suggestions:[]}}},b0=async(t,e=3,s="pt")=>{const r=Pt();if(typeof r>"u")return{predictions:[],confidence:0,notes:""};try{const a=`
      Com base no histÃ³rico de transaÃ§Ãµes, preveja os gastos dos prÃ³ximos ${e} meses.
      Retorne APENAS um JSON vÃ¡lido com: predictions (array com mÃªs e valor), confidence (0-1), notes (string)
      
      TransaÃ§Ãµes: ${JSON.stringify(t.slice(0,20))}
      IMPORTANTE: Responda APENAS em ${Ns[s]||"Portuguese"}.
    `;let i=(await r.ai.chat(a,{model:"gpt-4.1-nano"}))?.trim()||'{"predictions":[],"confidence":0,"notes":""}';return i.startsWith("```json")&&(i=i.replace(/```json\n?/,"").replace(/```$/,"")),i.startsWith("```")&&(i=i.slice(3).slice(0,i.lastIndexOf("```"))),JSON.parse(i)}catch(a){return console.error("Error predicting expenses with Puter:",a),{predictions:[],confidence:0,notes:""}}},ks={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"},yi=async()=>{try{return await bt.getApiConfig("openrouter")}catch(t){return console.error("Error getting OpenRouter config:",t),null}},Ht=async(t,e="openai/gpt-3.5-turbo")=>{const s=await yi();if(!s?.apiKey)throw new Error("OpenRouter API key not configured");try{const r=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s.apiKey}`,"HTTP-Referer":window.location.href,"X-Title":"Gestor Financeiro","Content-Type":"application/json"},body:JSON.stringify({model:e||"openai/gpt-3.5-turbo",messages:[{role:"user",content:t}],temperature:.7,max_tokens:2e3})});if(!r.ok)throw new Error(`OpenRouter API error: ${r.statusText}`);return(await r.json()).choices?.[0]?.message?.content||""}catch(r){throw console.error("Error calling OpenRouter:",r),r}},y0=async t=>{try{const e=`
      VocÃª Ã© um assistente financeiro. Categorize a seguinte transaÃ§Ã£o financeira em uma Ãºnica palavra ou frase curta em PortuguÃªs (Ex: AlimentaÃ§Ã£o, Transporte, Moradia, Lazer, SaÃºde, EducaÃ§Ã£o, SalÃ¡rio, Outros).
      
      DescriÃ§Ã£o da transaÃ§Ã£o: "${t}"
      
      Responda apenas com a categoria.
    `;return(await Ht(e,"openai/gpt-3.5-turbo"))?.trim()||"Geral"}catch(e){return console.error("Error categorizing with OpenRouter:",e),"Geral"}},v0=async(t,e,s="pt")=>{try{const a=`
      Analise brevemente este resumo financeiro familiar e dÃª uma dica curta (mÃ¡ximo 2 frases) de como melhorar a saÃºde financeira.
      Dados: ${JSON.stringify({totalTransacoes:t.length,metas:e.map(i=>({nome:i.name,progresso:(i.currentAmount/i.targetAmount).toFixed(2)}))})}
      
      IMPORTANTE: Responda APENAS em ${ks[s]||"Portuguese"}.
    `;return(await Ht(a))?.trim()||"Mantenha o foco!"}catch(r){return console.error("Error getting financial advice from OpenRouter:",r),"Mantenha o foco em suas metas de economia!"}},w0=async(t,e="pt")=>{try{const s=JSON.stringify(t.slice(0,10)),r=`
      Analise o comportamento de gastos deste usuÃ¡rio e retorne APENAS um JSON vÃ¡lido com:
      - persona (tipo de gastador em ${ks[e]||"Portuguese"})
      - patternDescription (descriÃ§Ã£o do padrÃ£o)
      - tip (dica de melhoria)
      - nextMonthProjection (projeÃ§Ã£o de gastos para prÃ³ximo mÃªs em nÃºmero)
      
      TransaÃ§Ãµes: ${s}
      IMPORTANTE: Responda APENAS em ${ks[e]||"Portuguese"}.
    `;let o=(await Ht(r))?.trim()||"{}";return o.startsWith("```json")&&(o=o.replace(/```json\n?/,"").replace(/```$/,"")),o.startsWith("```")&&(o=o.slice(3).slice(0,o.lastIndexOf("```"))),JSON.parse(o)}catch(s){return console.error("Error analyzing user behavior with OpenRouter:",s),{persona:"UsuÃ¡rio",patternDescription:"",tip:"",nextMonthProjection:0}}},_0=async t=>{try{const e=`
      Extraia os dados de uma transaÃ§Ã£o financeira do seguinte texto em PortuguÃªs. Retorne APENAS um JSON vÃ¡lido com:
      - description: DescriÃ§Ã£o breve
      - amount: Valor numÃ©rico
      - type: "INCOME" ou "EXPENSE"
      - category: Categoria (uma palavra)
      - date: Data em formato YYYY-MM-DD (hoje se nÃ£o mencionada)
      
      Texto: "${t}"
    `;let r=(await Ht(e))?.trim()||"{}";return r.startsWith("```json")&&(r=r.replace(/```json\n?/,"").replace(/```$/,"")),r.startsWith("```")&&(r=r.slice(3).slice(0,r.lastIndexOf("```"))),JSON.parse(r)}catch(e){return console.error("Error parsing transaction with OpenRouter:",e),{description:t,category:"Geral"}}},N0=async t=>{try{return console.warn("OpenRouter does not support audio transcription"),{description:"",category:"Geral"}}catch(e){return console.error("Error parsing audio with OpenRouter:",e),{description:"",category:"Geral"}}},k0=async t=>{const e=await yi();if(!e?.apiKey)throw new Error("OpenRouter API key not configured");return(async function*(){try{const s=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${e.apiKey}`,"HTTP-Referer":window.location.href,"X-Title":"Gestor Financeiro","Content-Type":"application/json"},body:JSON.stringify({model:"openai/gpt-3.5-turbo",messages:[{role:"user",content:t}],temperature:.7,max_tokens:2e3,stream:!0})});if(!s.body)throw new Error("No response body");const r=s.body.getReader(),a=new TextDecoder;for(;;){const{done:o,value:i}=await r.read();if(o)break;const u=a.decode(i).split(`
`);for(const f of u)if(f.startsWith("data: ")){const m=f.slice(6);if(m==="[DONE]")continue;try{const h=JSON.parse(m).choices?.[0]?.delta?.content||"";h&&(yield h)}catch{}}}}catch(s){console.error("Error streaming response from OpenRouter:",s),yield"Erro ao processar sua mensagem."}})()},S0=async t=>{try{const e=`
      Analise este recibo/nota fiscal e extraia dados da transaÃ§Ã£o.
      Retorne APENAS um JSON vÃ¡lido com: description, amount, category, date
      
      Imagem URL: ${t}
    `;let r=(await Ht(e))?.trim()||"{}";return r.startsWith("```json")&&(r=r.replace(/```json\n?/,"").replace(/```$/,"")),r.startsWith("```")&&(r=r.slice(3).slice(0,r.lastIndexOf("```"))),JSON.parse(r)}catch(e){return console.error("Error parsing receipt with OpenRouter:",e),{description:"Recibo",category:"Geral"}}},C0=async(t,e="pt")=>{try{const s=`
      Analise estes gastos e identifique possÃ­veis desperdÃ­cios.
      Retorne APENAS um JSON vÃ¡lido com: wasteIndicators (array), totalWaste (nÃºmero), suggestions (array)
      
      TransaÃ§Ãµes: ${JSON.stringify(t.slice(0,15))}
      IMPORTANTE: Responda APENAS em ${ks[e]||"Portuguese"}.
    `;let a=(await Ht(s))?.trim()||'{"wasteIndicators":[],"totalWaste":0,"suggestions":[]}';return a.startsWith("```json")&&(a=a.replace(/```json\n?/,"").replace(/```$/,"")),a.startsWith("```")&&(a=a.slice(3).slice(0,a.lastIndexOf("```"))),JSON.parse(a)}catch(s){return console.error("Error analyzing waste with OpenRouter:",s),{wasteIndicators:[],totalWaste:0,suggestions:[]}}},E0=async(t,e=3,s="pt")=>{try{const r=`
      Com base no histÃ³rico de transaÃ§Ãµes, preveja os gastos dos prÃ³ximos ${e} meses.
      Retorne APENAS um JSON vÃ¡lido com: predictions (array com mÃªs e valor), confidence (0-1), notes (string)
      
      TransaÃ§Ãµes: ${JSON.stringify(t.slice(0,20))}
      IMPORTANTE: Responda APENAS em ${ks[s]||"Portuguese"}.
    `;let o=(await Ht(r))?.trim()||'{"predictions":[],"confidence":0,"notes":""}';return o.startsWith("```json")&&(o=o.replace(/```json\n?/,"").replace(/```$/,"")),o.startsWith("```")&&(o=o.slice(3).slice(0,o.lastIndexOf("```"))),JSON.parse(o)}catch(r){return console.error("Error predicting expenses with OpenRouter:",r),{predictions:[],confidence:0,notes:""}}},Xt="0.37.0";let Za=!1,vs,vi,wi,Bn,_i,Ni,ki,Si,Ci;function T0(t,e={auto:!1}){if(Za)throw new Error(`you must \`import 'groq-sdk/shims/${t.kind}'\` before importing anything else from groq-sdk`);if(vs)throw new Error(`can't \`import 'groq-sdk/shims/${t.kind}'\` after \`import 'groq-sdk/shims/${vs}'\``);Za=e.auto,vs=t.kind,vi=t.fetch,wi=t.FormData,Bn=t.File,_i=t.ReadableStream,Ni=t.getMultipartRequestOptions,ki=t.getDefaultAgent,Si=t.fileFromPath,Ci=t.isFsReadStream}class A0{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function I0({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n";let s,r,a,o;try{s=fetch,r=Request,a=Response,o=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:s,Request:r,Response:a,Headers:o,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,d)=>({...d,body:new A0(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:i=>!1}}const Ei=()=>{vs||T0(I0(),{auto:!0})};Ei();class ft extends Error{}class Ye extends ft{constructor(e,s,r,a){super(`${Ye.makeMessage(e,s,r)}`),this.status=e,this.headers=a,this.error=s}static makeMessage(e,s,r){const a=s?.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,s,r,a){if(!e||!a)return new cn({message:r,cause:$n(s)});const o=s;return e===400?new Ai(e,o,r,a):e===401?new Ii(e,o,r,a):e===403?new Ri(e,o,r,a):e===404?new Pi(e,o,r,a):e===409?new ji(e,o,r,a):e===422?new Mi(e,o,r,a):e===429?new Di(e,o,r,a):e>=500?new Fi(e,o,r,a):new Ye(e,o,r,a)}}class On extends Ye{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class cn extends Ye{constructor({message:e,cause:s}){super(void 0,void 0,e||"Connection error.",void 0),s&&(this.cause=s)}}class Ti extends cn{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ai extends Ye{}class Ii extends Ye{}class Ri extends Ye{}class Pi extends Ye{}class ji extends Ye{}class Mi extends Ye{}class Di extends Ye{}class Fi extends Ye{}class ts{constructor(e,s){this.iterator=e,this.controller=s}static fromSSEResponse(e,s){let r=!1;const a=new R0;async function*o(){if(!e.body)throw s.abort(),new ft("Attempted to iterate over a response with no body");const d=new Ot,u=Qa(e.body);for await(const f of u)for(const m of d.decode(f)){const p=a.decode(m);p&&(yield p)}for(const f of d.flush()){const m=a.decode(f);m&&(yield m)}}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let d=!1;try{for await(const u of o())if(!d){if(u.data.startsWith("[DONE]")){d=!0;continue}if(u.event===null||u.event==="error"){let f;try{f=JSON.parse(u.data)}catch(m){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),m}if(f&&f.error)throw new Ye(f.error.status_code,f.error,f.error.message,void 0);yield f}}d=!0}catch(u){if(u instanceof Error&&u.name==="AbortError")return;throw u}finally{d||s.abort()}}return new ts(i,s)}static fromReadableStream(e,s){let r=!1;async function*a(){const i=new Ot,d=Qa(e);for await(const u of d)for(const f of i.decode(u))yield f;for(const u of i.flush())yield u}async function*o(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const d of a())i||d&&(yield JSON.parse(d));i=!0}catch(d){if(d instanceof Error&&d.name==="AbortError")return;throw d}finally{i||s.abort()}}return new ts(o,s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],s=[],r=this.iterator(),a=o=>({next:()=>{if(o.length===0){const i=r.next();e.push(i),s.push(i)}return o.shift()}});return[new ts(()=>a(e),this.controller),new ts(()=>a(s),this.controller)]}toReadableStream(){const e=this;let s;const r=new TextEncoder;return new _i({async start(){s=e[Symbol.asyncIterator]()},async pull(a){try{const{value:o,done:i}=await s.next();if(i)return a.close();const d=r.encode(JSON.stringify(o)+`
`);a.enqueue(d)}catch(o){a.error(o)}},async cancel(){await s.return?.()}})}}class R0{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[s,r,a]=P0(e,":");return a.startsWith(" ")&&(a=a.substring(1)),s==="event"?this.event=a:s==="data"&&this.data.push(a),null}}class Ot{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let s=this.decodeText(e);if(this.trailingCR&&(s="\r"+s,this.trailingCR=!1),s.endsWith("\r")&&(this.trailingCR=!0,s=s.slice(0,-1)),!s)return[];const r=Ot.NEWLINE_CHARS.has(s[s.length-1]||"");let a=s.split(Ot.NEWLINE_REGEXP);return a.length===1&&!r?(this.buffer.push(a[0]),[]):(this.buffer.length>0&&(a=[this.buffer.join("")+a[0],...a.slice(1)],this.buffer=[]),r||(this.buffer=[a.pop()||""]),a)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ft(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ft(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ft("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Ot.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","Â…","\u2028","\u2029"]);Ot.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function P0(t,e){const s=t.indexOf(e);return s!==-1?[t.substring(0,s),e,t.substring(s+e.length)]:[t,"",""]}function Qa(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const s=await e.read();return s?.done&&e.releaseLock(),s}catch(s){throw e.releaseLock(),s}},async return(){const s=e.cancel();return e.releaseLock(),await s,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Li=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Ui=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&un(t),un=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",j0=t=>Ui(t)||Li(t)||Ci(t);async function zi(t,e,s){if(t=await t,Ui(t))return t;if(Li(t)){const a=await t.blob();e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=un(a)?[await a.arrayBuffer()]:[a];return new Bn(o,e,s)}const r=await M0(t);if(e||(e=F0(t)??"unknown_file"),!s?.type){const a=r[0]?.type;typeof a=="string"&&(s={...s,type:a})}return new Bn(r,e,s)}async function M0(t){let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(un(t))e.push(await t.arrayBuffer());else if(L0(t))for await(const s of t)e.push(s);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${t?.constructor?.name}; props: ${D0(t)}`);return e}function D0(t){return`[${Object.getOwnPropertyNames(t).map(s=>`"${s}"`).join(", ")}]`}function F0(t){return kn(t.name)||kn(t.filename)||kn(t.path)?.split(/[\\/]/).pop()}const kn=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},L0=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",eo=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",dr=async t=>{const e=await U0(t.body);return Ni(e,t)},U0=async t=>{const e=new wi;return await Promise.all(Object.entries(t||{}).map(([s,r])=>Vn(e,s,r))),e},Vn=async(t,e,s)=>{if(s!==void 0){if(s==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")t.append(e,String(s));else if(j0(s)){const r=await zi(s);t.append(e,r)}else if(Array.isArray(s))await Promise.all(s.map(r=>Vn(t,e+"[]",r)));else if(typeof s=="object")await Promise.all(Object.entries(s).map(([r,a])=>Vn(t,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}};var qi={},z0=function(t,e,s,r,a){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,s),s},q0=function(t,e,s,r){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)},Hs;Ei();async function Gi(t){const{response:e}=t;if(t.options.stream)return as("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):ts.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){const i=await e.json();return as("response",e.status,e.url,e.headers,i),i}const o=await e.text();return as("response",e.status,e.url,e.headers,o),o}class fn extends Promise{constructor(e,s=Gi){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=s}_thenUnwrap(e){return new fn(this.responsePromise,async s=>e(await this.parseResponse(s),s))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:s}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,s){return this.parse().then(e,s)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class G0{constructor({baseURL:e,baseURLOverridden:s,maxRetries:r=2,timeout:a=6e4,httpAgent:o,fetch:i}){Hs.set(this,void 0),this.baseURL=e,z0(this,Hs,s),this.maxRetries=Sn("maxRetries",r),this.timeout=Sn("timeout",a),this.httpAgent=o,this.fetch=i??vi}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json",...["head","get"].includes(e.method)?{}:{"Content-Type":"application/json"},"User-Agent":this.getUserAgent(),...H0(),...this.authHeaders(e)}}validateHeaders(e,s){}defaultIdempotencyKey(){return`stainless-node-retry-${Q0()}`}get(e,s){return this.methodRequest("get",e,s)}post(e,s){return this.methodRequest("post",e,s)}patch(e,s){return this.methodRequest("patch",e,s)}put(e,s){return this.methodRequest("put",e,s)}delete(e,s){return this.methodRequest("delete",e,s)}methodRequest(e,s,r){return this.request(Promise.resolve(r).then(async a=>{const o=a&&un(a?.body)?new DataView(await a.body.arrayBuffer()):a?.body instanceof DataView?a.body:a?.body instanceof ArrayBuffer?new DataView(a.body):a&&ArrayBuffer.isView(a?.body)?new DataView(a.body.buffer):a?.body;return{method:e,path:s,...a,body:o}}))}getAPIList(e,s,r){return this.requestAPIList(s,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}async buildRequest(e,{retryCount:s=0}={}){const r={...e},{method:a,path:o,query:i,defaultBaseURL:d,headers:u={}}=r,f=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:eo(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,m=this.calculateContentLength(f),p=this.buildURL(o,i,d);"timeout"in r&&Sn("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const h=r.httpAgent??this.httpAgent??ki(p),g=r.timeout+1e3;typeof h?.options?.timeout=="number"&&g>(h.options.timeout??0)&&(h.options.timeout=g),this.idempotencyHeader&&a!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),u[this.idempotencyHeader]=e.idempotencyKey);const y=this.buildHeaders({options:r,headers:u,contentLength:m,retryCount:s});return{req:{method:a,...f&&{body:f},headers:y,...h&&{agent:h},signal:r.signal??null},url:p,timeout:r.timeout}}buildHeaders({options:e,headers:s,contentLength:r,retryCount:a}){const o={};r&&(o["content-length"]=r);const i=this.defaultHeaders(e);return ao(o,i),ao(o,s),eo(e.body)&&vs!=="node"&&delete o["content-type"],Ms(i,"x-stainless-retry-count")===void 0&&Ms(s,"x-stainless-retry-count")===void 0&&(o["x-stainless-retry-count"]=String(a)),Ms(i,"x-stainless-timeout")===void 0&&Ms(s,"x-stainless-timeout")===void 0&&e.timeout&&(o["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(o,s),o}async prepareOptions(e){}async prepareRequest(e,{url:s,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(s=>[...s])):{...e}:{}}makeStatusError(e,s,r,a){return Ye.generate(e,s,r,a)}request(e,s=null){return new fn(this.makeRequest(e,s))}async makeRequest(e,s){const r=await e,a=r.maxRetries??this.maxRetries;s==null&&(s=a),await this.prepareOptions(r);const{req:o,url:i,timeout:d}=await this.buildRequest(r,{retryCount:a-s});if(await this.prepareRequest(o,{url:i,options:r}),as("request",i,r,o.headers),r.signal?.aborted)throw new On;const u=new AbortController,f=await this.fetchWithTimeout(i,o,d,u).catch($n);if(f instanceof Error){if(r.signal?.aborted)throw new On;if(s)return this.retryRequest(r,s);throw f.name==="AbortError"?new Ti:new cn({cause:f})}const m=O0(f.headers);if(!f.ok){if(s&&this.shouldRetry(f)){const w=`retrying, ${s} attempts remaining`;return as(`response (error; ${w})`,f.status,i,m),this.retryRequest(r,s,m)}const p=await f.text().catch(w=>$n(w).message),h=J0(p),g=h?void 0:p;throw as(`response (error; ${s?"(error; no more retries left)":"(error; not retryable)"})`,f.status,i,m,g),this.makeStatusError(f.status,h,g,m)}return{response:f,options:r,controller:u}}requestAPIList(e,s){const r=this.makeRequest(s,null);return new B0(this,r,e)}buildURL(e,s,r){const a=!q0(this,Hs)&&r||this.baseURL,o=K0(e)?new URL(e):new URL(a+(a.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return X0(i)||(s={...i,...s}),typeof s=="object"&&s&&!Array.isArray(s)&&(o.search=this.stringifyQuery(s)),o.toString()}stringifyQuery(e){return Object.entries(e).filter(([s,r])=>typeof r<"u").map(([s,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(s)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(s)}=`;throw new ft(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,s,r,a){const{signal:o,...i}=s||{};o&&o.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),r),u={signal:a.signal,...i};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(d)})}shouldRetry(e){const s=e.headers.get("x-should-retry");return s==="true"?!0:s==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,s,r){let a;const o=r?.["retry-after-ms"];if(o){const d=parseFloat(o);Number.isNaN(d)||(a=d)}const i=r?.["retry-after"];if(i&&!a){const d=parseFloat(i);Number.isNaN(d)?a=Date.parse(i)-Date.now():a=d*1e3}if(!(a&&0<=a&&a<60*1e3)){const d=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(s,d)}return await Y0(a),this.makeRequest(e,s-1)}calculateDefaultRetryTimeoutMillis(e,s){const o=s-e,i=Math.min(.5*Math.pow(2,o),8),d=1-Math.random()*.25;return i*d*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Xt}`}}Hs=new WeakMap;class B0 extends fn{constructor(e,s,r){super(s,async a=>new r(e,a.response,await Gi(a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const s of e)yield s}}const O0=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,s){const r=s.toString();return e[r.toLowerCase()]||e[r]}}),V0=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":so(Deno.build.os),"X-Stainless-Arch":to(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":so(process.platform),"X-Stainless-Arch":to(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=$0();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $0(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:s}of t){const r=s.exec(navigator.userAgent);if(r){const a=r[1]||0,o=r[2]||0,i=r[3]||0;return{browser:e,version:`${a}.${o}.${i}`}}}return null}const to=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",so=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let no;const H0=()=>no??(no=V0()),J0=t=>{try{return JSON.parse(t)}catch{return}},W0=/^[a-z][a-z0-9+.-]*:/i,K0=t=>W0.test(t),Y0=t=>new Promise(e=>setTimeout(e,t)),Sn=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ft(`${t} must be an integer`);if(e<0)throw new ft(`${t} must be a positive integer`);return e},$n=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null)try{return new Error(JSON.stringify(t))}catch{}return new Error(t)},ro=t=>{if(typeof process<"u")return qi?.[t]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(t)?.trim()};function X0(t){if(!t)return!0;for(const e in t)return!1;return!0}function Z0(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ao(t,e){for(const s in e){if(!Z0(e,s))continue;const r=s.toLowerCase();if(!r)continue;const a=e[s];a===null?delete t[r]:a!==void 0&&(t[r]=a)}}function as(t,...e){typeof process<"u"&&qi?.DEBUG==="true"&&console.log(`Groq:DEBUG:${t}`,...e)}const Q0=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),eg=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",tg=t=>typeof t?.get=="function",Ms=(t,e)=>{const s=e.toLowerCase();if(tg(t)){const r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(a,o,i)=>o+i.toUpperCase());for(const a of[e,s,e.toUpperCase(),r]){const o=t.get(a);if(o)return o}}for(const[r,a]of Object.entries(t))if(r.toLowerCase()===s)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};class pt{constructor(e){this._client=e}}class Bi extends pt{create(e,s){return this._client.post("/openai/v1/audio/speech",{body:e,...s,headers:{Accept:"audio/wav",...s?.headers},__binaryResponse:!0})}}class Oi extends pt{create(e,s){return this._client.post("/openai/v1/audio/transcriptions",dr({body:e,...s}))}}class Vi extends pt{create(e,s){return this._client.post("/openai/v1/audio/translations",dr({body:e,...s}))}}class Es extends pt{constructor(){super(...arguments),this.speech=new Bi(this._client),this.transcriptions=new Oi(this._client),this.translations=new Vi(this._client)}}Es.Speech=Bi;Es.Transcriptions=Oi;Es.Translations=Vi;class $i extends pt{create(e,s){return this._client.post("/openai/v1/batches",{body:e,...s})}retrieve(e,s){return this._client.get(`/openai/v1/batches/${e}`,s)}list(e){return this._client.get("/openai/v1/batches",e)}cancel(e,s){return this._client.post(`/openai/v1/batches/${e}/cancel`,s)}}let Hi=class extends pt{create(e,s){return this._client.post("/openai/v1/chat/completions",{body:e,...s,stream:e.stream??!1})}};class cr extends pt{constructor(){super(...arguments),this.completions=new Hi(this._client)}}cr.Completions=Hi;class Ji extends pt{}class Wi extends pt{create(e,s){return this._client.post("/openai/v1/embeddings",{body:e,...s})}}class Ki extends pt{create(e,s){return this._client.post("/openai/v1/files",dr({body:e,...s}))}list(e){return this._client.get("/openai/v1/files",e)}delete(e,s){return this._client.delete(`/openai/v1/files/${e}`,s)}content(e,s){return this._client.get(`/openai/v1/files/${e}/content`,{...s,headers:{Accept:"application/octet-stream",...s?.headers},__binaryResponse:!0})}info(e,s){return this._client.get(`/openai/v1/files/${e}`,s)}}class Yi extends pt{retrieve(e,s){return this._client.get(`/openai/v1/models/${e}`,s)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,s){return this._client.delete(`/openai/v1/models/${e}`,s)}}var Xi,Zi;class De extends G0{constructor({baseURL:e=ro("GROQ_BASE_URL"),apiKey:s=ro("GROQ_API_KEY"),...r}={}){if(s===void 0)throw new ft("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");const a={apiKey:s,...r,baseURL:e||"https://api.groq.com"};if(!a.dangerouslyAllowBrowser&&eg())throw new ft(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Groq({ apiKey, dangerouslyAllowBrowser: true })`);super({baseURL:a.baseURL,baseURLOverridden:e?e!=="https://api.groq.com":!1,timeout:a.timeout??6e4,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),Xi.add(this),this.completions=new Ji(this),this.chat=new cr(this),this.embeddings=new Wi(this),this.audio=new Es(this),this.models=new Yi(this),this.batches=new $i(this),this.files=new Ki(this),this._options=a,this.apiKey=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}Zi=De,Xi=new WeakSet;De.Groq=Zi;De.DEFAULT_TIMEOUT=6e4;De.GroqError=ft;De.APIError=Ye;De.APIConnectionError=cn;De.APIConnectionTimeoutError=Ti;De.APIUserAbortError=On;De.NotFoundError=Pi;De.ConflictError=ji;De.RateLimitError=Di;De.BadRequestError=Ai;De.AuthenticationError=Ii;De.InternalServerError=Fi;De.PermissionDeniedError=Ri;De.UnprocessableEntityError=Mi;De.toFile=zi;De.fileFromPath=Si;De.Completions=Ji;De.Chat=cr;De.Embeddings=Wi;De.Audio=Es;De.Models=Yi;De.Batches=$i;De.Files=Ki;let Ds=null;const mn={pt:"Portuguese",en:"English",es:"Spanish",um:"Umbundu",ln:"Lingala"},sg=async()=>{if(Ds)return Ds;try{const t=await bt.getApiConfig("groq");if(t?.apiKey)return Ds=t.apiKey,Ds}catch(t){console.warn("Error getting Groq API key:",t)}return""},Jt=async()=>{const t=await sg();return t?new De({apiKey:t,dangerouslyAllowBrowser:!0}):null},ng=async t=>{const e=await Jt();if(!e)return"Geral";try{return(await e.chat.completions.create({messages:[{role:"user",content:`VocÃª Ã© um assistente financeiro. Categorize a seguinte transaÃ§Ã£o financeira em uma Ãºnica palavra ou frase curta em PortuguÃªs (Ex: AlimentaÃ§Ã£o, Transporte, Moradia, Lazer, SaÃºde, EducaÃ§Ã£o, SalÃ¡rio, Outros).
          
DescriÃ§Ã£o da transaÃ§Ã£o: "${t}"

Responda apenas com a categoria.`}],model:"llama-3.3-70b-versatile",max_completion_tokens:50,temperature:.3})).choices[0]?.message?.content?.trim()||"Geral"}catch(s){return console.error("Error categorizing with Groq:",s),"Geral"}},rg=async(t,e,s="pt")=>{const r=await Jt();if(!r)return"Configure Groq em ConfiguraÃ§Ãµes > IntegraÃ§Ãµes para receber conselhos personalizados.";try{const a=JSON.stringify({totalTransacoes:t.length,metas:e.map(i=>({nome:i.name,progresso:(i.currentAmount/i.targetAmount).toFixed(2)}))});return(await r.chat.completions.create({messages:[{role:"user",content:`Analise brevemente este resumo financeiro familiar e dÃª uma dica curta (mÃ¡ximo 2 frases) de como melhorar a saÃºde financeira.
Dados: ${a}

IMPORTANTE: Responda APENAS em ${mn[s]||"Portuguese"}.`}],model:"llama-3.3-70b-versatile",max_completion_tokens:150,temperature:.7})).choices[0]?.message?.content?.trim()||"Mantenha o foco!"}catch(a){return console.error("Error getting financial advice from Groq:",a),"Mantenha o foco em suas metas de economia!"}},ag=async(t,e="pt")=>{const s=await Jt();if(!s)return{persona:"UsuÃ¡rio",patternDescription:"",tip:"",nextMonthProjection:0};try{const r=JSON.stringify(t.slice(0,10));let o=(await s.chat.completions.create({messages:[{role:"user",content:`Analise o perfil de gastos do usuÃ¡rio baseado neste histÃ³rico de transaÃ§Ãµes e retorne um JSON com:
{ "persona": "tipo de gasto", "patternDescription": "descriÃ§Ã£o", "tip": "conselho", "nextMonthProjection": nÃºmero }

TransaÃ§Ãµes: ${r}

Responda APENAS em ${mn[e]||"Portuguese"} e retorne APENAS JSON vÃ¡lido.`}],model:"llama-3.3-70b-versatile",max_completion_tokens:300,temperature:.5})).choices[0]?.message?.content?.trim()||"{}";return o.startsWith("```json")&&(o=o.replace(/```json\n?/,"").replace(/```$/,"")),o.startsWith("```")&&(o=o.slice(3).slice(0,o.lastIndexOf("```"))),JSON.parse(o)}catch(r){return console.error("Error analyzing user behavior with Groq:",r),{persona:"UsuÃ¡rio",patternDescription:"",tip:"",nextMonthProjection:0}}},og=async t=>{const e=await Jt();if(!e)return{description:t,category:"Geral"};try{let r=(await e.chat.completions.create({messages:[{role:"user",content:`Extraia dados de uma transaÃ§Ã£o financeira do seguinte texto. Retorne APENAS um JSON com:
{ "description": "descriÃ§Ã£o", "amount": nÃºmero, "type": "RECEITA" ou "DESPESA", "category": "Categoria", "date": "YYYY-MM-DD" }

Texto: "${t}"`}],model:"llama-3.3-70b-versatile",max_completion_tokens:200,temperature:.3})).choices[0]?.message?.content?.trim()||"{}";return r.startsWith("```json")&&(r=r.replace(/```json\n?/,"").replace(/```$/,"")),r.startsWith("```")&&(r=r.slice(3).slice(0,r.lastIndexOf("```"))),JSON.parse(r)}catch(s){return console.error("Error parsing transaction with Groq:",s),{description:t,category:"Geral"}}},ig=async t=>(console.warn("Groq does not support audio transcription. Please use Gemini provider for audio features."),{description:"",category:"Geral",error:"Groq nÃ£o suporta processamento de Ã¡udio. Use Gemini para esta funcionalidade."}),lg=async(t,e)=>{const s=await Jt();if(!s){e("Configure Groq em ConfiguraÃ§Ãµes para usar o assistente.");return}try{const r=await s.chat.completions.create({messages:[{role:"user",content:t}],model:"llama-3.3-70b-versatile",max_completion_tokens:1e3,temperature:.7,stream:!0});for await(const a of r)a.choices[0]?.delta?.content&&e(a.choices[0].delta.content)}catch(r){console.error("Error getting streaming response from Groq:",r),e("Erro ao processar a solicitaÃ§Ã£o.")}},dg=async t=>(console.warn("Groq does not support image/receipt processing. Please use Gemini provider for receipts."),{description:"",category:"Geral",error:"Groq nÃ£o suporta processamento de imagens. Use Gemini para esta funcionalidade."}),cg=async(t,e="pt")=>{const s=await Jt();if(!s)return"Configure Groq em ConfiguraÃ§Ãµes para anÃ¡lise de desperdÃ­cios.";try{return(await s.chat.completions.create({messages:[{role:"user",content:`Analise o histÃ³rico de transaÃ§Ãµes e identifique desperdÃ­cios ou gastos duplicados. 
ForneÃ§a recomendaÃ§Ãµes para economizar em ${mn[e]||"Portuguese"}.

TransaÃ§Ãµes: ${JSON.stringify(t.slice(0,20))}`}],model:"llama-3.3-70b-versatile",max_completion_tokens:400,temperature:.6})).choices[0]?.message?.content?.trim()||"Nenhuma anÃ¡lise disponÃ­vel"}catch(r){return console.error("Error analyzing waste with Groq:",r),"Erro na anÃ¡lise de desperdÃ­cios."}},ug=async(t,e="pt")=>{const s=await Jt();if(!s)return"Configure Groq em ConfiguraÃ§Ãµes para previsÃµes.";try{return(await s.chat.completions.create({messages:[{role:"user",content:`Com base no histÃ³rico de transaÃ§Ãµes, preveja os gastos do prÃ³ximo mÃªs. 
Responda em ${mn[e]||"Portuguese"} com categorias e valores aproximados.

TransaÃ§Ãµes: ${JSON.stringify(t.slice(0,20))}`}],model:"llama-3.3-70b-versatile",max_completion_tokens:400,temperature:.6})).choices[0]?.message?.content?.trim()||"Sem previsÃ£o disponÃ­vel"}catch(r){return console.error("Error predicting expenses with Groq:",r),"Erro na previsÃ£o de despesas."}};let Fs=null;const Ct=async()=>{if(Fs)return Fs;try{const t=await fetch("/api/settings/default-ai-provider",{credentials:"include"});if(t.ok)return Fs=(await t.json()).provider||"google_gemini",Fs}catch(t){console.error("Error getting default provider:",t)}return"google_gemini"},fg=async(t,e=[])=>{const s=await Ct();return s==="puter"?c0(t):s==="openrouter"?y0(t):s==="groq"?ng(t):Zp(t,e)},mg=async(t,e,s="pt")=>{const r=await Ct();return r==="puter"?u0(t,e,s):r==="openrouter"?v0(t,e,s):r==="groq"?rg(t,e,s):Qp(t,e,s)},hg=async(t,e="pt")=>{const s=await Ct();return s==="puter"?f0(t,e):s==="openrouter"?w0(t,e):s==="groq"?ag(t,e):t0(t,e)},pg=async t=>{const e=await Ct();return e==="puter"?m0(t):e==="openrouter"?_0(t):e==="groq"?og(t):s0(t)},gg=async t=>{const e=await Ct();return e==="puter"?h0():e==="openrouter"?N0():e==="groq"?ig():n0(t)},xg=async t=>{const e=await Ct();return e==="puter"?p0(t):e==="openrouter"?k0(t):e==="groq"?lg(t):a0(t)},bg=async t=>{const e=await Ct();return e==="puter"?g0(t):e==="openrouter"?S0(t):e==="groq"?dg():o0(t)},yg=async(t,e="pt")=>{const s=await Ct();return s==="puter"?x0(t,e):s==="openrouter"?C0(t,e):s==="groq"?cg(t,e):i0(t,e)},vg=async(t,e=3,s="pt")=>{const r=await Ct();return r==="puter"?b0(t,e,s):r==="openrouter"?E0(t,e,s):r==="groq"?ug(t,s):l0(t,e,s)},oo=(t,e,s,r)=>{const a=new Bo,o=new Date;a.setFontSize(20),a.text("AnÃ¡lise Financeira AvanÃ§ada",20,20),a.setFontSize(10),a.setTextColor(100),a.text(`Data: ${o.toLocaleDateString("pt-BR")}`,20,30),a.text(`UsuÃ¡rio: ${r.name}`,20,37);let i=50;if(t&&(a.setFontSize(14),a.setTextColor(220,38,38),a.text("ðŸš¨ AnÃ¡lise de DesperdÃ­cio",20,i),i+=10,a.setFontSize(10),a.setTextColor(0),a.text("Sinais de DesperdÃ­cio:",20,i),i+=6,t.wasteIndicators?.slice(0,5).forEach(u=>{a.setTextColor(100),a.text(`â€¢ ${u}`,25,i),i+=5}),i+=3,a.setTextColor(220,38,38),a.setFontSize(11),a.text(`Estimativa Total de DesperdÃ­cio: ${s(t.totalWaste||0)}`,20,i),i+=10,a.setFontSize(10),a.setTextColor(0),a.text("SugestÃµes de ReduÃ§Ã£o:",20,i),i+=6,t.suggestions?.slice(0,3).forEach(u=>{a.setTextColor(100),a.text(`â€¢ ${u}`,25,i),i+=5}),i+=5),e&&e.predictions?.length>0){a.setFontSize(14),a.setTextColor(16,185,129),a.text("ðŸ“Š PrevisÃµes Financeiras",20,i),i+=10,a.setFontSize(10),a.setTextColor(0);const u=e.predictions.slice(0,3).map(f=>[f.month,s(f.predictedExpense||0)]);Oo(a,{head:[["MÃªs","PrevisÃ£o de Despesa"]],body:u,startY:i,theme:"grid",headStyles:{fillColor:[16,185,129]}}),i=a.lastAutoTable.finalY+10,a.setTextColor(100),a.setFontSize(9),a.text(`NÃ­vel de ConfianÃ§a: ${e.confidence||0}%`,20,i),i+=5,a.text(`Notas: ${e.notes}`,20,i)}const d=`Analise_${o.toISOString().slice(0,10)}.pdf`;a.save(d)},hn=({text:t,className:e=""})=>n.jsxs("div",{className:`group relative inline-block ml-2 align-middle z-10 ${e}`,children:[n.jsx(Fl,{size:16,className:"text-slate-400 hover:text-primary-500 cursor-help transition-colors"}),n.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-3 bg-slate-900 text-white text-xs rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none text-center leading-relaxed border border-slate-700",children:[t,n.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900"})]})]}),io={async getPreferences(){return(await fetch("/api/notifications/preferences")).json()},async updatePreferences(t){return(await fetch("/api/notifications/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}},Cn={async subscribe(t){return(await fetch("/api/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:t})})).json()},async unsubscribe(t){return(await fetch("/api/push/unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:t})})).json()},async getStatus(){return(await fetch("/api/push/status")).json()},async requestPermission(){if(!("Notification"in window))throw new Error("NotificaÃ§Ãµes nÃ£o suportadas");return Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1},async registerServiceWorker(){if(!("serviceWorker"in navigator))throw new Error("Service Workers nÃ£o suportados");try{const t=await navigator.serviceWorker.register("/service-worker.js");return console.log("Service Worker registado:",t),t}catch(t){throw console.error("Erro ao registar Service Worker:",t),t}},async subscribeToPush(){try{const t=await this.registerServiceWorker();if(!await this.requestPermission())throw new Error("PermissÃ£o de notificaÃ§Ãµes negada");const s=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:void 0});return await this.subscribe(s),s}catch(t){throw console.error("Erro ao subscribir push:",t),t}},async unsubscribeFromPush(){try{const e=await(await navigator.serviceWorker.ready).pushManager.getSubscription();return e&&(await this.unsubscribe(e),await e.unsubscribe()),!0}catch(t){throw console.error("Erro ao unsubscriber push:",t),t}}},wg=()=>{const[t,e]=T.useState(!1),[s,r]=T.useState(!1),[a,o]=T.useState(null);T.useEffect(()=>{i()},[]);const i=async()=>{try{const u=await Cn.getStatus();e(u.isSubscribed)}catch(u){console.error("Erro ao verificar status:",u)}},d=async()=>{r(!0),o(null);try{t?await Cn.unsubscribeFromPush():await Cn.subscribeToPush(),e(!t)}catch(u){o(u.message||"Erro ao atualizar notificaÃ§Ãµes push"),console.error("Erro:",u)}finally{r(!1)}};return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("button",{onClick:d,disabled:s,className:`w-full p-3 rounded-xl font-bold transition flex items-center justify-center gap-2 ${t?"bg-emerald-600 text-white hover:bg-emerald-700":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:[s?n.jsx(ze,{size:18,className:"animate-spin"}):n.jsx(It,{size:18}),s?"Processando...":t?"ðŸ”” NotificaÃ§Ãµes Ativas":"ðŸ”• Ativar NotificaÃ§Ãµes Push"]}),a&&n.jsx("div",{className:"p-3 bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 rounded-lg",children:n.jsxs("p",{className:"text-sm text-rose-700 dark:text-rose-400",children:["âš ï¸ ",a]})}),t&&n.jsx("div",{className:"p-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg",children:n.jsx("p",{className:"text-xs text-emerald-700 dark:text-emerald-400",children:"âœ“ NotificaÃ§Ãµes push ativadas. ReceberÃ¡ alertas em tempo real."})})]})},_g=()=>{const{t}=He(),[e,s]=T.useState(null),[r,a]=T.useState(!1),[o,i]=T.useState(null);T.useEffect(()=>{d()},[]);const d=async()=>{try{const m=await(await fetch("/api/email/config")).json();s(m)}catch(f){console.error("Erro ao carregar config:",f)}},u=async()=>{a(!0),i(null);try{const f=await fetch("/api/email/test",{method:"POST"}),m=await f.json();f.ok?i({type:"success",text:t("email_notifications.test_sent_success")}):i({type:"error",text:m.error||t("email_notifications.send_error")})}catch(f){i({type:"error",text:f.message||t("email_notifications.send_error")})}finally{a(!1)}};return e?n.jsxs("div",{className:"space-y-3",children:[!e.hasEmail&&n.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg flex items-start gap-2",children:[n.jsx(os,{size:18,className:"text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),n.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:t("email_notifications.email_not_configured")})]}),e.hasEmail&&n.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:n.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-400",children:[t("email_notifications.registered_email")," ",n.jsx("strong",{children:e.email})]})}),n.jsxs("button",{onClick:u,disabled:r,className:"w-full p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 font-bold transition flex items-center justify-center gap-2",children:[r?n.jsx(ze,{size:18,className:"animate-spin"}):n.jsx(Io,{size:18}),t(r?"email_notifications.sending":"email_notifications.send_test_email")]}),o&&n.jsx("div",{className:`p-3 rounded-lg text-xs font-bold ${o.type==="success"?"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 text-emerald-700 dark:text-emerald-400":"bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 text-rose-700 dark:text-rose-400"}`,children:o.text}),n.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-900/50 rounded-lg",children:n.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:t("email_notifications.how_to_use")})})]}):n.jsx("div",{className:"text-center py-4",children:t("email_notifications.loading")})},Ng=()=>{const[t,e]=T.useState(""),[s,r]=T.useState(""),[a,o]=T.useState(!1),[i,d]=T.useState(null);T.useEffect(()=>{u()},[]);const u=async()=>{try{const m=await fetch("/api/settings/notification-config");if(m.ok){const p=await m.json();e(p.sendgridKeyExists?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":""),r(p.sendgridFromEmail||"")}}catch(m){console.error("Error loading config:",m)}},f=async()=>{try{(await fetch("/api/settings/notification-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sendgridKey:t!=="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"?t:void 0,sendgridEmail:s})})).ok?(o(!0),d({type:"success",text:"âœ“ ConfiguraÃ§Ã£o salva com sucesso!"}),setTimeout(()=>o(!1),3e3)):d({type:"error",text:"Erro ao salvar configuraÃ§Ã£o"})}catch(m){d({type:"error",text:m.message})}};return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg flex items-start gap-2",children:[n.jsx(os,{size:18,className:"text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),n.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:[n.jsx("strong",{children:"SendGrid (Opcional):"})," Configure suas credenciais para ativar envio de emails real. Sem isso, emails serÃ£o apenas registados em logs."]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:"SendGrid API Key"}),n.jsx("input",{type:"password",value:t,onChange:m=>e(m.target.value),placeholder:"SG.xxxxxxxxxxxx...",className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Obtenha em: https://app.sendgrid.com/settings/api_keys"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:"Email de Origem"}),n.jsx("input",{type:"email",value:s,onChange:m=>r(m.target.value),placeholder:"noreply@sua-empresa.com",className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Email que aparecerÃ¡ como remetente"})]}),n.jsxs("button",{onClick:f,className:"w-full p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold transition flex items-center justify-center gap-2",children:[n.jsx(ut,{size:18}),"Salvar Credenciais"]}),i&&n.jsxs("div",{className:`p-3 rounded-lg text-xs font-bold flex items-center gap-2 ${i.type==="success"?"bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 text-emerald-700 dark:text-emerald-400":"bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 text-rose-700 dark:text-rose-400"}`,children:[i.type==="success"&&n.jsx(Et,{size:16}),i.text]})]})},Qi=({isSuperAdmin:t,onClose:e})=>{const[s,r]=T.useState({budget_alerts:1,subscription_alerts:1,financial_tips:1,goal_progress:1,email_notifications:1,push_notifications:1}),[a,o]=T.useState(!0),[i,d]=T.useState(!1);T.useEffect(()=>{u()},[]);const u=async()=>{try{const h=await io.getPreferences();r({budget_alerts:h.budget_alerts||1,subscription_alerts:h.subscription_alerts||1,financial_tips:h.financial_tips||1,goal_progress:h.goal_progress||1,email_notifications:h.email_notifications||1,push_notifications:h.push_notifications||1})}catch(h){console.error("Error loading notification preferences:",h)}finally{o(!1)}},f=async()=>{try{await io.updatePreferences(s),d(!0),setTimeout(()=>d(!1),3e3)}catch(h){console.error("Error saving preferences:",h)}},m=({label:h,fieldName:g})=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:h}),n.jsx("input",{type:"checkbox",checked:s[g]===1,onChange:y=>r({...s,[g]:y.target.checked?1:0}),className:"w-5 h-5 rounded border-slate-300 text-primary-600"})]}),{t:p}=He?.()||{t:h=>h};return a?n.jsxs("div",{className:"text-center py-8",children:[p("common.loading"),"..."]}):n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 p-6 space-y-6",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(It,{size:24,className:"text-primary-600"}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:p(t?"settings.global_notifications":"settings.my_notifications")})]}),t&&n.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg flex items-start gap-2",children:[n.jsx(os,{size:18,className:"text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),n.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:p("settings.global_applies_all")})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:p("settings.alerts")}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(m,{label:p("settings.budget_alerts"),fieldName:"budget_alerts"}),n.jsx(m,{label:p("settings.subscription_alerts"),fieldName:"subscription_alerts"}),n.jsx(m,{label:p("settings.financial_tips"),fieldName:"financial_tips"}),n.jsx(m,{label:p("settings.goal_progress"),fieldName:"goal_progress"})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:p("settings.delivery_preferences")}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(m,{label:p("settings.email_notifications"),fieldName:"email_notifications"}),n.jsx(m,{label:p("settings.push_notifications"),fieldName:"push_notifications"})]})]}),t&&n.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-6",children:[n.jsxs("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase flex items-center gap-2",children:[n.jsx(qs,{size:16}),p("settings.credentials_config")]}),n.jsx(Ng,{})]}),!t&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:["ðŸ”” ",p("settings.enable_push")]}),n.jsx(wg,{})]}),n.jsxs("div",{children:[n.jsxs("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:["ðŸ“§ ",p("settings.configure_email")]}),n.jsx(_g,{})]})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:f,className:"flex-1 flex items-center justify-center gap-2 p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold transition",children:[n.jsx(ut,{size:18}),p("common.save")]}),e&&n.jsx("button",{onClick:e,className:"flex-1 p-3 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-xl hover:bg-slate-200 font-bold transition",children:p("common.close")})]}),i&&n.jsxs("p",{className:"text-sm text-emerald-600 dark:text-emerald-400 mt-3 text-center font-bold",children:["âœ“ ",p("common.saved_success")]})]})},Ls=["#8b5cf6","#10b981","#f59e0b","#ef4444","#ec4899","#6366f1","#06b6d4","#84cc16"],kg=({transactions:t,savingsGoals:e,budgets:s=[],currencyFormatter:r,currentInflation:a=0,currentUser:o})=>{const{t:i,language:d}=He(),[u,f]=T.useState(i("dashboard.analyzing")),[m,p]=T.useState("month"),[h,g]=T.useState(!0),[y,b]=T.useState(null),[w,N]=T.useState(!1),[v,k]=T.useState(!1),[A,C]=T.useState(null),[P,D]=T.useState(!1),[B,R]=T.useState(null),[U,Q]=T.useState(!1),S=({active:j,payload:M,label:ie})=>j&&M&&M.length?n.jsxs("div",{className:"bg-white/90 dark:bg-slate-900/90 backdrop-blur-md p-4 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 min-w-[200px] animate-scale-in",children:[n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 border-b border-slate-100 dark:border-slate-700 pb-2",children:ie}),n.jsx("div",{className:"space-y-3",children:M.map($=>n.jsxs("div",{className:"flex items-center justify-between group",children:[n.jsxs("div",{className:"flex items-center gap-2.5",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full ring-2 ring-white dark:ring-slate-800 shadow-sm",style:{backgroundColor:$.stroke}}),n.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:$.name})]}),n.jsx("span",{className:`text-sm font-extrabold tabular-nums ${$.name==="Receitas"?"text-emerald-600 dark:text-emerald-400":"text-rose-600 dark:text-rose-400"}`,children:r($.value)})]},$.name))})]}):null,G=({active:j,payload:M})=>{if(j&&M&&M.length){const ie=M[0],$=H.reduce((ue,Z)=>ue+Z.value,0),F=$>0?(ie.value/$*100).toFixed(1):0;return n.jsxs("div",{className:"bg-white/90 dark:bg-slate-900/90 backdrop-blur-md p-4 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 animate-scale-in",children:[n.jsxs("div",{className:"flex items-center gap-2.5 mb-2",children:[n.jsx("div",{className:"w-3 h-3 rounded-full ring-2 ring-white dark:ring-slate-800 shadow-sm",style:{backgroundColor:ie.payload.fill}}),n.jsx("span",{className:"text-sm font-bold text-slate-700 dark:text-white",children:ie.name})]}),n.jsxs("div",{className:"flex items-baseline gap-2",children:[n.jsx("span",{className:"text-lg font-extrabold text-slate-800 dark:text-slate-200 tracking-tight",children:r(ie.value)}),n.jsxs("span",{className:"text-xs font-bold px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-500",children:[F,"%"]})]})]})}return null};T.useEffect(()=>{mg(t,e,d).then(f)},[t,e,d]);const _=async()=>{N(!0);try{const j=await hg(t,d);b(j)}catch{alert(i("dashboard.error_analyzing_behavior"))}finally{N(!1)}},J=T.useMemo(()=>{const j=new Date;return t.filter(ie=>{const $=new Date(ie.date);switch(m){case"7days":const F=new Date;return F.setDate(j.getDate()-7),$>=F;case"month":return $.getMonth()===j.getMonth()&&$.getFullYear()===j.getFullYear();case"year":return $.getFullYear()===j.getFullYear();case"all":default:return!0}})},[t,m]),ae=T.useMemo(()=>{const j=J.filter($=>{const F=String($.type).toUpperCase();return F==="INCOME"||F==="RECEITA"}).reduce(($,F)=>$+F.amount,0),M=J.filter($=>{const F=String($.type).toUpperCase();return F==="EXPENSE"||F==="DESPESA"}).reduce(($,F)=>$+F.amount,0),ie=e.reduce(($,F)=>$+F.currentAmount,0);return{totalIncome:j,totalExpense:M,balance:j-M,totalSavings:ie}},[J,e]),Y=T.useMemo(()=>{const j=t.filter(ye=>{const be=String(ye.type).toUpperCase();return be==="INCOME"||be==="RECEITA"}).reduce((ye,be)=>ye+be.amount,0),M=t.filter(ye=>{const be=String(ye.type).toUpperCase();return be==="EXPENSE"||be==="DESPESA"}).reduce((ye,be)=>ye+be.amount,0),ie=e.reduce((ye,be)=>ye+be.currentAmount,0);if(j===0)return 0;const $=ie/j*100,F=Math.min(100,$/20*100)*.4,ue=M/j*100,Z=ue>90?0:Math.min(100,(1-(ue-50)/50)*100)*.3,X=e.filter(ye=>ye.currentAmount>0).length,me=e.length>0?X/e.length*100*.3:0;return Math.min(100,Math.round(F+(Z>0?Z:0)+me))},[t,e]),te=T.useMemo(()=>{const j=new Map;return J.forEach(M=>{const ie=new Date(M.date);let $="";m==="year"||m==="all"?$=ie.toLocaleDateString("pt-BR",{month:"short",year:"numeric"}):$=ie.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),j.has($)||j.set($,{income:0,expense:0,date:ie});const F=j.get($),ue=String(M.type).toUpperCase();ue==="INCOME"||ue==="RECEITA"?F.income+=M.amount:F.expense+=M.amount}),Array.from(j.entries()).sort((M,ie)=>M[1].date.getTime()-ie[1].date.getTime()).map(([M,ie])=>({name:M,Receitas:ie.income,Despesas:ie.expense}))},[J,m]),H=T.useMemo(()=>{const j=J.filter(ie=>{const $=String(ie.type).toUpperCase();return $==="EXPENSE"||$==="DESPESA"}),M=new Map;return j.forEach(ie=>{M.set(ie.category,(M.get(ie.category)||0)+ie.amount)}),Array.from(M.entries()).sort((ie,$)=>$[1]-ie[1]).map(([ie,$])=>({name:ie,value:$}))},[J]),ce=()=>{switch(m){case"7days":return i("dashboard.last7days");case"month":return i("dashboard.thisMonth");case"year":return i("dashboard.thisYear");case"all":return i("dashboard.allTime")}};return n.jsxs("div",{className:"space-y-6 md:space-y-8 animate-fade-in w-full max-w-full overflow-x-hidden",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("h3",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-slate-800 dark:text-white tracking-tight truncate",children:i("dashboard.overview")}),n.jsx("p",{className:"text-xs sm:text-sm text-slate-500 line-clamp-1",children:i("dashboard.financial_health")})]}),n.jsxs("div",{className:"flex items-center gap-1 md:gap-2 w-full sm:w-auto",children:[n.jsx("button",{onClick:()=>k(!v),className:"p-2 md:p-2.5 bg-white dark:bg-slate-800 rounded-lg md:rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition text-slate-600 dark:text-slate-300",title:i("dashboard.notification_preferences"),children:n.jsx(It,{size:18,className:"md:w-5 md:h-5"})}),n.jsxs("div",{className:"flex items-center bg-white dark:bg-slate-800 rounded-lg md:rounded-2xl p-1 md:p-1.5 shadow-sm border border-slate-200 dark:border-slate-700 flex-1 sm:flex-none hover:border-primary-400 transition-colors",children:[n.jsx(Cs,{size:14,className:"md:w-4 md:h-4 text-primary-500 ml-1 md:ml-2 mr-1 md:mr-2 shrink-0"}),n.jsxs("select",{value:m,onChange:j=>p(j.target.value),className:"bg-transparent border-none text-xs md:text-sm font-bold text-slate-700 dark:text-slate-200 focus:ring-0 cursor-pointer outline-none py-1 w-full",children:[n.jsx("option",{value:"7days",children:i("dashboard.last_7_days")}),n.jsx("option",{value:"month",children:i("dashboard.this_month")}),n.jsx("option",{value:"year",children:i("dashboard.this_year")}),n.jsx("option",{value:"all",children:i("dashboard.all_time")})]})]})]})]}),v&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 animate-slide-in-left",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("h3",{className:"text-xs sm:text-sm md:text-base lg:text-lg font-bold text-slate-800 dark:text-white flex items-center gap-1 md:gap-2 truncate",children:[n.jsx(It,{size:18,className:"md:w-5 md:h-5 text-primary-600 flex-shrink-0"}),n.jsx("span",{className:"truncate",children:i("dashboard.myNotifications")})]}),n.jsx("button",{onClick:()=>k(!1),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 p-1",children:n.jsx(at,{size:18,className:"md:w-5 md:h-5"})})]}),n.jsx(Qi,{onClose:()=>k(!1)})]}),n.jsxs("div",{className:"bg-gradient-to-r from-blue-900 to-indigo-900 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden min-w-0",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),n.jsxs("div",{className:"relative z-10",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start mb-4 gap-4",children:[n.jsxs("div",{className:"max-w-full min-w-0",children:[n.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-bold flex items-center gap-2 truncate",children:[n.jsx(Ll,{className:"text-cyan-400 shrink-0",size:18})," ",n.jsx("span",{className:"truncate",children:i("dashboard.behavioral_analysis")}),n.jsx(hn,{text:i("dashboard.hint_analyze_behavior"),className:"text-white ml-2 hidden sm:inline-block"})]}),n.jsx("p",{className:"text-blue-200 text-sm mt-1 truncate max-w-full",children:i("dashboard.discover_spending_profile")})]}),!y&&n.jsxs("button",{onClick:_,disabled:w,className:"px-4 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-md rounded-xl font-bold text-sm transition flex items-center whitespace-nowrap border border-white/10 active:scale-95",children:[w?n.jsx(st,{className:"animate-spin mr-2",size:16}):n.jsx(st,{className:"mr-2 text-yellow-300",size:16}),i(w?"dashboard.analyzing_dot":"dashboard.analyzeBehavior")]})]}),y&&n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 animate-scale-in bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/10",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-2 md:border-r border-white/10",children:[n.jsx("div",{className:"w-12 h-12 bg-cyan-500/20 rounded-full flex items-center justify-center mb-2 text-cyan-300",children:n.jsx(Qn,{size:24})}),n.jsx("p",{className:"text-xs uppercase font-bold text-cyan-300",children:i("dashboard.your_persona")}),n.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg font-bold break-words line-clamp-2",children:y.persona})]}),n.jsxs("div",{className:"flex flex-col justify-center md:border-r border-white/10 px-2 md:px-4 py-2 md:py-0 border-t border-b md:border-t-0 md:border-b-0 border-white/10 my-2 md:my-0",children:[n.jsxs("p",{className:"text-xs uppercase font-bold text-yellow-300 mb-1 flex items-center",children:[n.jsx(jo,{size:12,className:"mr-1"})," ",i("dashboard.detected_pattern")]}),n.jsxs("p",{className:"text-sm font-medium leading-relaxed break-words",children:['"',y.patternDescription,'"']}),n.jsxs("p",{className:"text-xs text-blue-200 mt-2 break-words",children:[i("dashboard.tip"),": ",y.tip]})]}),n.jsxs("div",{className:"flex flex-col justify-center items-center px-4",children:[n.jsx("p",{className:"text-xs uppercase font-bold text-emerald-300 mb-1 text-center",children:i("dashboard.next_month_projection")}),n.jsx("p",{className:"text-xs sm:text-sm md:text-base lg:text-lg font-bold tracking-tight break-words text-center min-w-0",children:r(y.nextMonthProjection)}),n.jsx("p",{className:"text-[10px] text-blue-200",children:i("dashboard.estimated_by_ai")})]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[n.jsxs("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6","data-tour":"dashboard-cards",children:[n.jsxs("div",{className:"bg-gradient-to-br from-indigo-600 to-violet-700 rounded-3xl p-6 text-white shadow-lg shadow-indigo-500/20 relative overflow-hidden min-w-0 transition-all duration-300 border border-indigo-400/30 hover:border-indigo-300/60 group",children:[n.jsx("div",{className:"absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-white opacity-10 rounded-full blur-2xl pointer-events-none"}),n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("div",{className:"p-3 bg-white/20 rounded-2xl backdrop-blur-sm group-hover:scale-110 transition-transform",children:n.jsx(Ro,{className:"text-white",size:24})}),n.jsx("span",{className:"text-xs font-medium bg-white/20 px-2 py-1 rounded-lg text-white",children:ce()})]}),n.jsx("p",{className:"text-indigo-100 text-sm font-medium mb-1",children:i("dashboard.balance_liquid")}),n.jsx("h3",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold tracking-tight break-words min-w-0",title:r(ae.balance),children:r(ae.balance)})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-soft border border-slate-100 dark:border-slate-700 relative group hover:border-emerald-200 dark:hover:border-emerald-800 transition-all duration-300 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("div",{className:"p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl text-emerald-600 dark:text-emerald-400 group-hover:scale-110 transition-transform",children:n.jsx(At,{size:24})}),n.jsx(Ul,{className:"text-emerald-500",size:20})]}),n.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm font-medium mb-1",children:i("dashboard.income")}),n.jsx("h3",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-slate-800 dark:text-white break-words min-w-0",title:r(ae.totalIncome),children:r(ae.totalIncome)})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-soft border border-slate-100 dark:border-slate-700 relative group hover:border-rose-200 dark:hover:border-rose-800 transition-all duration-300 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("div",{className:"p-3 bg-rose-50 dark:bg-rose-900/20 rounded-2xl text-rose-600 dark:text-rose-400 group-hover:scale-110 transition-transform",children:n.jsx(Ys,{size:24})}),n.jsx(zl,{className:"text-rose-500",size:20})]}),n.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm font-medium mb-1",children:i("dashboard.expenses")}),n.jsx("h3",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold text-slate-800 dark:text-white break-words min-w-0",title:r(ae.totalExpense),children:r(ae.totalExpense)})]})]}),n.jsxs("div",{className:`bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-soft border transition-all duration-300 flex flex-col items-center justify-center relative overflow-hidden h-[180px] md:h-[200px] group ${Y>70?"border-emerald-200 dark:border-emerald-900/30 hover:border-emerald-300":Y>40?"border-amber-200 dark:border-amber-900/30 hover:border-amber-300":"border-rose-200 dark:border-rose-900/30 hover:border-rose-300"}`,children:[n.jsx("div",{className:`absolute top-0 left-0 w-full h-1 bg-gradient-to-r transition-all duration-300 ${Y>70?"from-emerald-400 to-emerald-500":Y>40?"from-amber-400 to-amber-500":"from-rose-400 to-rose-500"}`}),n.jsxs("div",{className:"flex items-center justify-between w-full gap-4",children:[n.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[n.jsx("h3",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-2 flex items-center z-10 w-full justify-center text-center",children:"ðŸ’° Score"}),n.jsxs("div",{className:"animate-bounce-in",children:[n.jsx("span",{className:`text-base sm:text-lg md:text-2xl lg:text-3xl font-extrabold transition-colors duration-300 break-words min-w-0 ${Y>70?"text-emerald-500":Y>40?"text-amber-500":"text-rose-500"}`,children:Y}),n.jsx("span",{className:"text-[10px] text-slate-400 block font-bold",children:"/ 100"})]})]}),n.jsxs("div",{className:"flex-1 text-center z-10",children:[n.jsx("p",{className:`text-[10px] md:text-xs font-bold py-1.5 px-2 rounded-full bg-gradient-to-r transition-all duration-300 ${Y>70?"from-emerald-50 to-emerald-100 dark:from-emerald-900/30 dark:to-emerald-900/20 text-emerald-700 dark:text-emerald-300":Y>40?"from-amber-50 to-amber-100 dark:from-amber-900/30 dark:to-amber-900/20 text-amber-700 dark:text-amber-300":"from-rose-50 to-rose-100 dark:from-rose-900/30 dark:to-rose-900/20 text-rose-700 dark:text-rose-300"}`,children:Y>80?i("dashboard.score_excellent"):Y>50?i("dashboard.score_good"):i("dashboard.score_critical")}),n.jsxs("p",{className:"text-[9px] text-slate-400 mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[i("dashboard.savings_percentage"),n.jsx("br",{}),i("dashboard.expense_percentage"),n.jsx("br",{}),i("dashboard.goals_percentage")]})]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-gradient-to-r from-slate-900 to-slate-800 dark:from-indigo-900 dark:to-slate-900 rounded-3xl p-1 shadow-lg relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"}),n.jsxs("div",{className:"bg-white/5 backdrop-blur-sm p-4 md:p-6 rounded-[20px]",children:[n.jsxs("h3",{className:"font-bold text-lg mb-2 flex items-center text-white",children:[n.jsx(st,{className:"mr-2 text-yellow-300 animate-pulse shrink-0",size:20})," ",i("dashboard.intelligent_insight")]}),n.jsxs("p",{className:"text-slate-200 leading-relaxed font-light text-sm md:text-base break-words",children:['"',u,'"']})]})]}),n.jsxs("div",{className:"bg-gradient-to-r from-rose-900 to-red-800 dark:from-rose-900 dark:to-red-900 rounded-3xl p-1 shadow-lg relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-rose-500 via-red-500 to-orange-500"}),n.jsxs("div",{className:"bg-white/5 backdrop-blur-sm p-4 md:p-6 rounded-[20px]",children:[n.jsxs("h3",{className:"font-bold text-lg mb-3 flex items-center text-white justify-between",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(Ys,{className:"mr-2 text-rose-300 animate-pulse shrink-0",size:20})," ",i("dashboard.waste_analysis")]}),n.jsx("button",{onClick:async()=>{D(!0);const j=await yg(t,d);C(j),D(!1)},disabled:P,className:"text-xs bg-rose-600 hover:bg-rose-700 px-2 py-1 rounded disabled:opacity-50",children:i(P?"dashboard.analyzing_dot":"dashboard.analyzeWaste")})]}),A?n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsxs("p",{className:"text-rose-200 font-semibold",children:[i("dashboard.waste_indicators"),":"]}),n.jsx("ul",{className:"text-slate-300 text-xs space-y-1 list-disc list-inside",children:A.wasteIndicators?.slice(0,3).map((j,M)=>n.jsx("li",{children:j},M))}),n.jsxs("p",{className:"text-rose-300 font-bold pt-2",children:[i("dashboard.waste_estimate")," ",r(A.totalWaste||0)]}),n.jsx("button",{onClick:()=>oo(A,B,r,o),className:"mt-2 text-xs bg-rose-500/30 hover:bg-rose-500/50 px-2 py-1 rounded text-rose-200 font-bold",children:"ðŸ“¥ Exportar"})]}):n.jsx("p",{className:"text-slate-400 text-sm",children:i("dashboard.click_analyze")})]})]})]}),n.jsxs("div",{className:"bg-gradient-to-r from-emerald-900 to-teal-800 dark:from-emerald-900 dark:to-teal-900 rounded-3xl p-1 shadow-lg relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500"}),n.jsxs("div",{className:"bg-white/5 backdrop-blur-sm p-4 md:p-6 rounded-[20px]",children:[n.jsxs("h3",{className:"font-bold text-lg mb-3 flex items-center text-white justify-between",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(At,{className:"mr-2 text-emerald-300 animate-pulse shrink-0",size:20})," ",i("dashboard.financial_forecast")]}),n.jsx("button",{onClick:async()=>{Q(!0);const j=await vg(t,3,d);R(j),Q(!1)},disabled:U,className:"text-xs bg-emerald-600 hover:bg-emerald-700 px-2 py-1 rounded disabled:opacity-50",children:i(U?"dashboard.predicting":"dashboard.forecast")})]}),B?.predictions?.length>0?n.jsxs("div",{className:"space-y-2 text-sm",children:[n.jsx("div",{className:"grid grid-cols-3 gap-2",children:B.predictions.slice(0,3).map((j,M)=>n.jsxs("div",{className:"bg-white/10 p-2 rounded",children:[n.jsx("p",{className:"text-emerald-300 font-bold text-xs",children:j.month}),n.jsx("p",{className:"text-slate-200 font-semibold",children:r(j.predictedExpense||0)})]},M))}),n.jsxs("p",{className:"text-slate-300 text-xs pt-2",children:[i("dashboard.confidence_label")," ",n.jsxs("span",{className:"text-emerald-300 font-bold",children:[B.confidence||0,"%"]})," â€¢ ",B.notes]}),n.jsx("button",{onClick:()=>oo(A,B,r,o),className:"mt-2 text-xs bg-emerald-500/30 hover:bg-emerald-500/50 px-2 py-1 rounded text-emerald-200 font-bold",children:"ðŸ“¥ Exportar"})]}):n.jsx("p",{className:"text-slate-400 text-sm",children:i("dashboard.click_forecast")})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 p-6 md:p-8 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 min-h-[400px]",children:[n.jsxs("h3",{className:"text-lg font-bold mb-6 text-slate-800 dark:text-white flex items-center",children:[n.jsx("div",{className:"w-1.5 h-6 bg-emerald-500 rounded-full mr-3"}),i("dashboard.cash_flow")]}),n.jsx("div",{className:"h-64 md:h-80 w-full",children:n.jsx(wt,{width:"100%",height:"100%",children:n.jsxs(No,{data:te,margin:{top:10,right:10,left:0,bottom:0},children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:"colorIncome",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.4}),n.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:0})]}),n.jsxs("linearGradient",{id:"colorExpense",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.4}),n.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]})]}),n.jsx(zt,{strokeDasharray:"3 3",stroke:"#e2e8f0",opacity:.3,vertical:!1}),n.jsx(qt,{dataKey:"name",stroke:"#94a3b8",fontSize:11,tickLine:!1,axisLine:!1,dy:10,minTickGap:20}),n.jsx(Gt,{stroke:"#94a3b8",fontSize:11,tickLine:!1,axisLine:!1,tickFormatter:j=>`${j>=1e3?(j/1e3).toFixed(0)+"k":j}`}),n.jsx(_t,{content:n.jsx(S,{})}),n.jsx(ws,{type:"monotone",dataKey:"Receitas",stroke:"#10b981",strokeWidth:3,fillOpacity:1,fill:"url(#colorIncome)",activeDot:{r:6,strokeWidth:0,fill:"#10b981"}}),n.jsx(ws,{type:"monotone",dataKey:"Despesas",stroke:"#ef4444",strokeWidth:3,fillOpacity:1,fill:"url(#colorExpense)",activeDot:{r:6,strokeWidth:0,fill:"#ef4444"}})]})})})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 md:p-8 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 min-h-[400px]",children:[n.jsxs("h3",{className:"text-lg font-bold mb-6 text-slate-800 dark:text-white flex items-center",children:[n.jsx("div",{className:"w-1.5 h-6 bg-purple-500 rounded-full mr-3"}),i("dashboard.by_category")]}),H.length>0?n.jsxs("div",{className:"h-64 md:h-72 relative",children:[n.jsx(wt,{width:"100%",height:"100%",children:n.jsxs(ko,{children:[n.jsx(So,{data:H,cx:"50%",cy:"50%",innerRadius:60,outerRadius:85,cornerRadius:5,paddingAngle:3,dataKey:"value",stroke:"none",children:H.map((j,M)=>n.jsx(Co,{fill:Ls[M%Ls.length]},`cell-${M}`))}),n.jsx(_t,{content:n.jsx(G,{})})]})}),n.jsx("div",{className:"mt-4 flex flex-wrap justify-center gap-x-4 gap-y-2 max-h-[100px] overflow-y-auto scrollbar-thin",children:H.map((j,M)=>n.jsxs("div",{className:"flex items-center text-xs font-medium text-slate-500 dark:text-slate-400",children:[n.jsx("div",{className:"w-2.5 h-2.5 rounded-full mr-2 shrink-0",style:{backgroundColor:Ls[M%Ls.length]}}),n.jsx("span",{className:"truncate max-w-[120px]",title:j.name,children:j.name})]},M))})]}):n.jsxs("div",{className:"h-64 md:h-80 flex flex-col items-center justify-center text-slate-400",children:[n.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-700 rounded-full mb-3",children:n.jsx(rn,{size:32})}),n.jsx("p",{children:i("common.no_data_period")})]})]})]})]})};var Ts=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Sg={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},Cg=class{#e=Sg;#s=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},Hn=new Cg;function Eg(t){setTimeout(t,0)}var pn=typeof window>"u"||"Deno"in globalThis;function it(){}function Tg(t,e){return typeof t=="function"?t(e):t}function Ag(t){return typeof t=="number"&&t>=0&&t!==1/0}function Ig(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Jn(t,e){return typeof t=="function"?t(e):t}function Rg(t,e){return typeof t=="function"?t(e):t}function lo(t,e){const{type:s="all",exact:r,fetchStatus:a,predicate:o,queryKey:i,stale:d}=t;if(i){if(r){if(e.queryHash!==ur(i,e.options))return!1}else if(!Ss(e.queryKey,i))return!1}if(s!=="all"){const u=e.isActive();if(s==="active"&&!u||s==="inactive"&&u)return!1}return!(typeof d=="boolean"&&e.isStale()!==d||a&&a!==e.state.fetchStatus||o&&!o(e))}function co(t,e){const{exact:s,status:r,predicate:a,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(s){if(Vt(e.options.mutationKey)!==Vt(o))return!1}else if(!Ss(e.options.mutationKey,o))return!1}return!(r&&e.state.status!==r||a&&!a(e))}function ur(t,e){return(e?.queryKeyHashFn||Vt)(t)}function Vt(t){return JSON.stringify(t,(e,s)=>Wn(s)?Object.keys(s).sort().reduce((r,a)=>(r[a]=s[a],r),{}):s)}function Ss(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(s=>Ss(t[s],e[s])):!1}var Pg=Object.prototype.hasOwnProperty;function el(t,e){if(t===e)return t;const s=uo(t)&&uo(e);if(!s&&!(Wn(t)&&Wn(e)))return e;const a=(s?t:Object.keys(t)).length,o=s?e:Object.keys(e),i=o.length,d=s?new Array(i):{};let u=0;for(let f=0;f<i;f++){const m=s?f:o[f],p=t[m],h=e[m];if(p===h){d[m]=p,(s?f<a:Pg.call(t,m))&&u++;continue}if(p===null||h===null||typeof p!="object"||typeof h!="object"){d[m]=h;continue}const g=el(p,h);d[m]=g,g===p&&u++}return a===i&&u===a?t:d}function jg(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const s in t)if(t[s]!==e[s])return!1;return!0}function uo(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Wn(t){if(!fo(t))return!1;const e=t.constructor;if(e===void 0)return!0;const s=e.prototype;return!(!fo(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function fo(t){return Object.prototype.toString.call(t)==="[object Object]"}function Mg(t){return new Promise(e=>{Hn.setTimeout(e,t)})}function Dg(t,e,s){return typeof s.structuralSharing=="function"?s.structuralSharing(t,e):s.structuralSharing!==!1?el(t,e):e}function Fg(t,e,s=0){const r=[...t,e];return s&&r.length>s?r.slice(1):r}function Lg(t,e,s=0){const r=[e,...t];return s&&r.length>s?r.slice(0,-1):r}var fr=Symbol();function tl(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===fr?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function Ug(t,e){return typeof t=="function"?t(...e):!!t}var zg=class extends Ts{#e;#s;#t;constructor(){super(),this.#t=t=>{if(!pn&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#s||this.setEventListener(this.#t)}onUnsubscribe(){this.hasListeners()||(this.#s?.(),this.#s=void 0)}setEventListener(t){this.#t=t,this.#s?.(),this.#s=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},sl=new zg;function qg(){let t,e;const s=new Promise((a,o)=>{t=a,e=o});s.status="pending",s.catch(()=>{});function r(a){Object.assign(s,a),delete s.resolve,delete s.reject}return s.resolve=a=>{r({status:"fulfilled",value:a}),t(a)},s.reject=a=>{r({status:"rejected",reason:a}),e(a)},s}var Gg=Eg;function Bg(){let t=[],e=0,s=d=>{d()},r=d=>{d()},a=Gg;const o=d=>{e?t.push(d):a(()=>{s(d)})},i=()=>{const d=t;t=[],d.length&&a(()=>{r(()=>{d.forEach(u=>{s(u)})})})};return{batch:d=>{let u;e++;try{u=d()}finally{e--,e||i()}return u},batchCalls:d=>(...u)=>{o(()=>{d(...u)})},schedule:o,setNotifyFunction:d=>{s=d},setBatchNotifyFunction:d=>{r=d},setScheduler:d=>{a=d}}}var Je=Bg(),Og=class extends Ts{#e=!0;#s;#t;constructor(){super(),this.#t=t=>{if(!pn&&window.addEventListener){const e=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#s||this.setEventListener(this.#t)}onUnsubscribe(){this.hasListeners()||(this.#s?.(),this.#s=void 0)}setEventListener(t){this.#t=t,this.#s?.(),this.#s=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(s=>{s(t)}))}isOnline(){return this.#e}},nn=new Og;function Vg(t){return Math.min(1e3*2**t,3e4)}function nl(t){return(t??"online")==="online"?nn.isOnline():!0}var Kn=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function rl(t){let e=!1,s=0,r;const a=qg(),o=()=>a.status!=="pending",i=b=>{if(!o()){const w=new Kn(b);h(w),t.onCancel?.(w)}},d=()=>{e=!0},u=()=>{e=!1},f=()=>sl.isFocused()&&(t.networkMode==="always"||nn.isOnline())&&t.canRun(),m=()=>nl(t.networkMode)&&t.canRun(),p=b=>{o()||(r?.(),a.resolve(b))},h=b=>{o()||(r?.(),a.reject(b))},g=()=>new Promise(b=>{r=w=>{(o()||f())&&b(w)},t.onPause?.()}).then(()=>{r=void 0,o()||t.onContinue?.()}),y=()=>{if(o())return;let b;const w=s===0?t.initialPromise:void 0;try{b=w??t.fn()}catch(N){b=Promise.reject(N)}Promise.resolve(b).then(p).catch(N=>{if(o())return;const v=t.retry??(pn?0:3),k=t.retryDelay??Vg,A=typeof k=="function"?k(s,N):k,C=v===!0||typeof v=="number"&&s<v||typeof v=="function"&&v(s,N);if(e||!C){h(N);return}s++,t.onFail?.(s,N),Mg(A).then(()=>f()?void 0:g()).then(()=>{e?h(N):y()})})};return{promise:a,status:()=>a.status,cancel:i,continue:()=>(r?.(),a),cancelRetry:d,continueRetry:u,canStart:m,start:()=>(m()?y():g().then(y),a)}}var al=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Ag(this.gcTime)&&(this.#e=Hn.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(pn?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Hn.clearTimeout(this.#e),this.#e=void 0)}},$g=class extends al{#e;#s;#t;#r;#n;#o;#i;constructor(t){super(),this.#i=!1,this.#o=t.defaultOptions,this.setOptions(t.options),this.observers=[],this.#r=t.client,this.#t=this.#r.getQueryCache(),this.queryKey=t.queryKey,this.queryHash=t.queryHash,this.#e=ho(this.options),this.state=t.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(t){if(this.options={...this.#o,...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=ho(this.options);e.data!==void 0&&(this.setState(mo(e.data,e.dataUpdatedAt)),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#t.remove(this)}setData(t,e){const s=Dg(this.state.data,t,this.options);return this.#a({data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(t,e){this.#a({type:"setState",state:t,setStateOptions:e})}cancel(t){const e=this.#n?.promise;return this.#n?.cancel(t),e?e.then(it).catch(it):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(t=>Rg(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===fr||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Jn(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Ig(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(this.#n&&(this.#i?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#t.notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(t&&this.setOptions(t),!this.options.queryFn){const d=this.observers.find(u=>u.options.queryFn);d&&this.setOptions(d.options)}const s=new AbortController,r=d=>{Object.defineProperty(d,"signal",{enumerable:!0,get:()=>(this.#i=!0,s.signal)})},a=()=>{const d=tl(this.options,e),f=(()=>{const m={client:this.#r,queryKey:this.queryKey,meta:this.meta};return r(m),m})();return this.#i=!1,this.options.persister?this.options.persister(d,f,this):d(f)},i=(()=>{const d={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#r,state:this.state,fetchFn:a};return r(d),d})();this.options.behavior?.onFetch(i,this),this.#s=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==i.fetchOptions?.meta)&&this.#a({type:"fetch",meta:i.fetchOptions?.meta}),this.#n=rl({initialPromise:e?.initialPromise,fn:i.fetchFn,onCancel:d=>{d instanceof Kn&&d.revert&&this.setState({...this.#s,fetchStatus:"idle"}),s.abort()},onFail:(d,u)=>{this.#a({type:"failed",failureCount:d,error:u})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0});try{const d=await this.#n.start();if(d===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(d),this.#t.config.onSuccess?.(d,this),this.#t.config.onSettled?.(d,this.state.error,this),d}catch(d){if(d instanceof Kn){if(d.silent)return this.#n.promise;if(d.revert){if(this.state.data===void 0)throw d;return this.state.data}}throw this.#a({type:"error",error:d}),this.#t.config.onError?.(d,this),this.#t.config.onSettled?.(this.state.data,d,this),d}finally{this.scheduleGc()}}#a(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...Hg(s.data,this.options),fetchMeta:t.meta??null};case"success":const r={...s,...mo(t.data,t.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#s=t.manual?r:void 0,r;case"error":const a=t.error;return{...s,error:a,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),Je.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#t.notify({query:this,type:"updated",action:t})})}};function Hg(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:nl(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function mo(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function ho(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,s=e!==void 0,r=s?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:s?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}function po(t){return{onFetch:(e,s)=>{const r=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,o=e.state.data?.pages||[],i=e.state.data?.pageParams||[];let d={pages:[],pageParams:[]},u=0;const f=async()=>{let m=!1;const p=y=>{Object.defineProperty(y,"signal",{enumerable:!0,get:()=>(e.signal.aborted?m=!0:e.signal.addEventListener("abort",()=>{m=!0}),e.signal)})},h=tl(e.options,e.fetchOptions),g=async(y,b,w)=>{if(m)return Promise.reject();if(b==null&&y.pages.length)return Promise.resolve(y);const v=(()=>{const P={client:e.client,queryKey:e.queryKey,pageParam:b,direction:w?"backward":"forward",meta:e.options.meta};return p(P),P})(),k=await h(v),{maxPages:A}=e.options,C=w?Lg:Fg;return{pages:C(y.pages,k,A),pageParams:C(y.pageParams,b,A)}};if(a&&o.length){const y=a==="backward",b=y?Jg:go,w={pages:o,pageParams:i},N=b(r,w);d=await g(w,N,y)}else{const y=t??o.length;do{const b=u===0?i[0]??r.initialPageParam:go(r,d);if(u>0&&b==null)break;d=await g(d,b),u++}while(u<y)}return d};e.options.persister?e.fetchFn=()=>e.options.persister?.(f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s):e.fetchFn=f}}}function go(t,{pages:e,pageParams:s}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,s[r],s):void 0}function Jg(t,{pages:e,pageParams:s}){return e.length>0?t.getPreviousPageParam?.(e[0],e,s[0],s):void 0}var Wg=class extends al{#e;#s;#t;#r;constructor(t){super(),this.#e=t.client,this.mutationId=t.mutationId,this.#t=t.mutationCache,this.#s=[],this.state=t.state||ol(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#s.includes(t)||(this.#s.push(t),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#s=this.#s.filter(e=>e!==t),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#s.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(t){const e=()=>{this.#n({type:"continue"})},s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#r=rl({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(o,i)=>{this.#n({type:"failed",failureCount:o,error:i})},onPause:()=>{this.#n({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const r=this.state.status==="pending",a=!this.#r.canStart();try{if(r)e();else{this.#n({type:"pending",variables:t,isPaused:a}),await this.#t.config.onMutate?.(t,this,s);const i=await this.options.onMutate?.(t,s);i!==this.state.context&&this.#n({type:"pending",context:i,variables:t,isPaused:a})}const o=await this.#r.start();return await this.#t.config.onSuccess?.(o,t,this.state.context,this,s),await this.options.onSuccess?.(o,t,this.state.context,s),await this.#t.config.onSettled?.(o,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(o,null,t,this.state.context,s),this.#n({type:"success",data:o}),o}catch(o){try{throw await this.#t.config.onError?.(o,t,this.state.context,this,s),await this.options.onError?.(o,t,this.state.context,s),await this.#t.config.onSettled?.(void 0,o,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(void 0,o,t,this.state.context,s),o}finally{this.#n({type:"error",error:o})}}finally{this.#t.runNext(this)}}#n(t){const e=s=>{switch(t.type){case"failed":return{...s,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=e(this.state),Je.batch(()=>{this.#s.forEach(s=>{s.onMutationUpdate(t)}),this.#t.notify({mutation:this,type:"updated",action:t})})}};function ol(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Kg=class extends Ts{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#s=new Map,this.#t=0}#e;#s;#t;build(t,e,s){const r=new Wg({client:t,mutationCache:this,mutationId:++this.#t,options:t.defaultMutationOptions(e),state:s});return this.add(r),r}add(t){this.#e.add(t);const e=Us(t);if(typeof e=="string"){const s=this.#s.get(e);s?s.push(t):this.#s.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=Us(t);if(typeof e=="string"){const s=this.#s.get(e);if(s)if(s.length>1){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}else s[0]===t&&this.#s.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Us(t);if(typeof e=="string"){const r=this.#s.get(e)?.find(a=>a.state.status==="pending");return!r||r===t}else return!0}runNext(t){const e=Us(t);return typeof e=="string"?this.#s.get(e)?.find(r=>r!==t&&r.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){Je.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#s.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(s=>co(e,s))}findAll(t={}){return this.getAll().filter(e=>co(t,e))}notify(t){Je.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return Je.batch(()=>Promise.all(t.map(e=>e.continue().catch(it))))}};function Us(t){return t.options.scope?.id}var Yg=class extends Ts{#e;#s=void 0;#t;#r;constructor(e,s){super(),this.#e=e,this.setOptions(s),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const s=this.options;this.options=this.#e.defaultMutationOptions(e),jg(this.options,s)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&Vt(s.mutationKey)!==Vt(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#o(e)}getCurrentResult(){return this.#s}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#n(),this.#o()}mutate(e,s){return this.#r=s,this.#t?.removeObserver(this),this.#t=this.#e.getMutationCache().build(this.#e,this.options),this.#t.addObserver(this),this.#t.execute(e)}#n(){const e=this.#t?.state??ol();this.#s={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#o(e){Je.batch(()=>{if(this.#r&&this.hasListeners()){const s=this.#s.variables,r=this.#s.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#r.onSuccess?.(e.data,s,r,a),this.#r.onSettled?.(e.data,null,s,r,a)):e?.type==="error"&&(this.#r.onError?.(e.error,s,r,a),this.#r.onSettled?.(void 0,e.error,s,r,a))}this.listeners.forEach(s=>{s(this.#s)})})}},Xg=class extends Ts{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,s){const r=e.queryKey,a=e.queryHash??ur(r,e);let o=this.get(a);return o||(o=new $g({client:t,queryKey:r,queryHash:a,options:t.defaultQueryOptions(e),state:s,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Je.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(s=>lo(e,s))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(s=>lo(t,s)):e}notify(t){Je.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){Je.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Je.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Zg=class{#e;#s;#t;#r;#n;#o;#i;#a;constructor(t={}){this.#e=t.queryCache||new Xg,this.#s=t.mutationCache||new Kg,this.#t=t.defaultOptions||{},this.#r=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#i=sl.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=nn.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#i?.(),this.#i=void 0,this.#a?.(),this.#a=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#s.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),s=this.#e.build(this,e),r=s.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&s.isStaleByTime(Jn(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:s})=>{const r=s.data;return[e,r]})}setQueryData(t,e,s){const r=this.defaultQueryOptions({queryKey:t}),o=this.#e.get(r.queryHash)?.state.data,i=Tg(e,o);if(i!==void 0)return this.#e.build(this,r).setData(i,{...s,manual:!0})}setQueriesData(t,e,s){return Je.batch(()=>this.#e.findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,s)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;Je.batch(()=>{e.findAll(t).forEach(s=>{e.remove(s)})})}resetQueries(t,e){const s=this.#e;return Je.batch(()=>(s.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const s={revert:!0,...e},r=Je.batch(()=>this.#e.findAll(t).map(a=>a.cancel(s)));return Promise.all(r).then(it).catch(it)}invalidateQueries(t,e={}){return Je.batch(()=>(this.#e.findAll(t).forEach(s=>{s.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const s={...e,cancelRefetch:e.cancelRefetch??!0},r=Je.batch(()=>this.#e.findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let o=a.fetch(void 0,s);return s.throwOnError||(o=o.catch(it)),a.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(r).then(it)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const s=this.#e.build(this,e);return s.isStaleByTime(Jn(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(it).catch(it)}fetchInfiniteQuery(t){return t.behavior=po(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(it).catch(it)}ensureInfiniteQueryData(t){return t.behavior=po(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return nn.isOnline()?this.#s.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#s}getDefaultOptions(){return this.#t}setDefaultOptions(t){this.#t=t}setQueryDefaults(t,e){this.#r.set(Vt(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#r.values()],s={};return e.forEach(r=>{Ss(t,r.queryKey)&&Object.assign(s,r.defaultOptions)}),s}setMutationDefaults(t,e){this.#n.set(Vt(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#n.values()],s={};return e.forEach(r=>{Ss(t,r.mutationKey)&&Object.assign(s,r.defaultOptions)}),s}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#t.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=ur(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===fr&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#t.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#s.clear()}},il=T.createContext(void 0),As=t=>{const e=T.useContext(il);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},Qg=({client:t,children:e})=>(T.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),n.jsx(il.Provider,{value:t,children:e}));function gn(t,e){const s=As(),[r]=T.useState(()=>new Yg(s,t));T.useEffect(()=>{r.setOptions(t)},[r,t]);const a=T.useSyncExternalStore(T.useCallback(i=>r.subscribe(Je.batchCalls(i)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=T.useCallback((i,d)=>{r.mutate(i,d).catch(it)},[r]);if(a.error&&Ug(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}const ex=()=>{const t=As();return gn({mutationFn:e=>gs.delete(e),onSuccess:()=>{t.invalidateQueries({queryKey:["transactions"]}),t.invalidateQueries({queryKey:["budgets"]})}})},tx=()=>{const t=As();return gn({mutationFn:e=>$s.delete(e),onSuccess:()=>{t.invalidateQueries({queryKey:["users"]})}})},sx=()=>{const t=As();return gn({mutationFn:e=>es.delete(e),onSuccess:()=>{t.invalidateQueries({queryKey:["goals"]})}})},nx=()=>{const t=As();return gn({mutationFn:({id:e,amount:s,note:r})=>es.contribute(e,s,r),onSuccess:()=>{t.invalidateQueries({queryKey:["goals"]})}})},rx=20*1024*1024,ax=({transactions:t,addTransaction:e,updateTransaction:s,deleteTransaction:r,currentUserId:a,currencyFormatter:o,onExport:i,onRefresh:d})=>{const{t:u}=He(),{mutate:f}=ex(),[m,p]=T.useState("history"),[h,g]=T.useState(!1),[y,b]=T.useState(null),[w,N]=T.useState(""),[v,k]=T.useState(1),[A,C]=T.useState(10),[P,D]=T.useState(null),[B,R]=T.useState(""),[U,Q]=T.useState(!1),[S,G]=T.useState(!1),_=T.useRef(null),J=T.useRef([]),[ae,Y]=T.useState(!1),[te,H]=T.useState(null),[ce,j]=T.useState(null),M=T.useRef(null),ie=T.useRef(null),[$,F]=T.useState({description:"",amount:"",type:Ze.EXPENSE,category:"",date:new Date().toISOString().split("T")[0],attachments:[],isRecurring:!1,frequency:"monthly"}),[ue,Z]=T.useState(!1),[X,me]=T.useState(!1),[ye,be]=T.useState(!1),[Ae,fe]=T.useState(new Set),x=T.useRef(null),[K,W]=T.useState(!1),[I,E]=T.useState([]),[q,se]=T.useState([]),[re,O]=T.useState(null),[oe,he]=T.useState("date"),[de,xe]=T.useState("desc"),V=L=>{const ne=new Set(Ae);ne.has(L)?ne.delete(L):ne.add(L),fe(ne)},pe=()=>{Ae.size===Ue.length?fe(new Set):fe(new Set(Ue.map(L=>L.id)))},_e=async()=>{Ae.size!==0&&confirm(`${u("transactions.delete_confirm")} ${Ae.size} transaÃ§Ãµes?`)&&(Ae.forEach(L=>f(L)),fe(new Set))},Fe=L=>{oe===L?xe(de==="asc"?"desc":"asc"):(he(L),xe("asc"))},Ie="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white font-medium focus:ring-2 focus:ring-primary-500 outline-none transition-all",qe=async()=>{try{me(!0);const L=await fetch("/api/reports/template",{credentials:"include"});if(!L.ok)throw new Error("Erro ao baixar template");const ne=await L.blob(),ke=window.URL.createObjectURL(ne),we=document.createElement("a");we.href=ke,we.download="template_transacoes.xlsx",document.body.appendChild(we),we.click(),document.body.removeChild(we),window.URL.revokeObjectURL(ke)}catch(L){alert("Erro: "+L.message)}finally{me(!1)}},ve=async L=>{try{be(!0);const ne=new FileReader;ne.onload=async ke=>{const we=(ke.target?.result).split(",")[1],Me=await fetch("/api/reports/preview",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileData:we})}),tt=await Me.json();if(!Me.ok){alert("Erro ao processar: "+(tt.error||"Falha"));return}E(tt.transactions||[]),se(tt.errors||[]),O(we),W(!0)},ne.readAsDataURL(L)}catch(ne){alert("Erro: "+ne.message)}finally{be(!1)}},Oe=async()=>{if(re)try{const L=await fetch("/api/reports/import",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileData:re})}),ne=await L.json();if(!L.ok){alert("Erro: "+(ne.error||"Falha ao importar"));return}alert(`âœ“ Sucesso! ${ne.imported} transaÃ§Ãµes importadas.`),W(!1),E([]),se([]),O(null),x.current&&(x.current.value=""),d&&d()}catch(L){alert("Erro: "+L.message)}};T.useEffect(()=>()=>{et()},[]);const We=L=>{if(L.userId!==a){alert(u("transactions.cannot_edit_others"));return}b(L.id),F({description:L.description,amount:L.amount.toString(),type:L.type,category:L.category,date:L.date,attachments:L.attachments||[],isRecurring:L.isRecurring||!1,frequency:L.frequency||"monthly"}),g(!0)},Ge=()=>{b(null),F({description:"",amount:"",type:Ze.EXPENSE,category:"",date:new Date().toISOString().split("T")[0],attachments:[],isRecurring:!1,frequency:"monthly"}),g(!0)},Xe=async()=>{try{const L=await navigator.mediaDevices.getUserMedia({audio:!0}),ne=new MediaRecorder(L);_.current=ne,J.current=[],ne.ondataavailable=ke=>{ke.data.size>0&&J.current.push(ke.data)},ne.onstop=async()=>{const ke=new Blob(J.current,{type:"audio/webm"});await yt(ke),L.getTracks().forEach(we=>we.stop())},ne.start(),G(!0)}catch{alert(u("transactions.microphone_error"))}},gt=()=>{_.current&&S&&(_.current.stop(),G(!1))},yt=async L=>{Q(!0);try{const ne=new FileReader;ne.readAsDataURL(L),ne.onloadend=async()=>{const we=ne.result.split(",")[1];try{const Me=await gg(we);F(tt=>({...tt,description:Me.description||tt.description,amount:Me.amount?.toString()||tt.amount,type:Me.type||tt.type,category:Me.category||tt.category,date:Me.date||tt.date,isRecurring:Me.isRecurring||tt.isRecurring,frequency:Me.frequency||tt.frequency})),g(!0)}catch{alert(u("transactions.could_not_understand_audio"))}finally{Q(!1)}}}catch{Q(!1)}},jt=async L=>{if(L.preventDefault(),!!B.trim()){Q(!0);try{const ne=await pg(B);F(ke=>({...ke,description:ne.description||ke.description,amount:ne.amount?.toString()||ke.amount,type:ne.type||ke.type,category:ne.category||ke.category,date:ne.date||ke.date,isRecurring:ne.isRecurring||ke.isRecurring,frequency:ne.frequency||ke.frequency})),R(""),g(!0)}catch{alert(u("transactions.could_not_understand_text"))}finally{Q(!1)}}},xt=async L=>{const ne=L.target.value;if(F(ke=>({...ke,description:ne})),ne.length>3&&!y){Z(!0);try{await new Promise(we=>setTimeout(we,600));const ke=await fg(ne,t);F(we=>({...we,category:ke}))}finally{Z(!1)}}},dt=async()=>{j(null),Y(!0);try{const L=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});H(L),setTimeout(()=>{M.current&&(M.current.srcObject=L)},100)}catch(L){console.error(L),alert(u("transactions.camera_error")),Y(!1)}},et=()=>{te&&te.getTracks().forEach(L=>L.stop()),H(null),Y(!1),j(null)},Mt=()=>{if(M.current&&ie.current){const L=M.current,ne=ie.current;ne.width=L.videoWidth,ne.height=L.videoHeight;const ke=ne.getContext("2d");if(ke){ke.drawImage(L,0,0,ne.width,ne.height);const we=ne.toDataURL("image/jpeg",.8);j(we)}}},Dt=()=>{if(ce){const L={id:`${Date.now()}-cam`,name:`Foto_Recibo_${new Date().toLocaleTimeString().replace(/:/g,"-")}.jpg`,size:Math.round(ce.length*3/4),type:"image/jpeg",content:ce};F(ne=>({...ne,attachments:[...ne.attachments,L]})),et()}},us=async()=>{if(ce){Q(!0);try{const L=await bg(ce);F(ne=>({...ne,description:L.description||ne.description,amount:L.amount?.toString()||ne.amount,type:L.type||ne.type,category:L.category||ne.category,date:L.date||ne.date})),et(),g(!0)}catch{alert(u("transactions.could_not_process_receipt"))}finally{Q(!1)}}},Wt=L=>new Promise((ne,ke)=>{const we=new FileReader;we.readAsDataURL(L),we.onload=()=>ne(we.result),we.onerror=Me=>ke(Me)}),Ft=async L=>{if(L.target.files&&L.target.files.length>0){const ne=Array.from(L.target.files),ke=[];for(const we of ne){if(we.size>rx){alert(u("transactions.file_size_limit")+` ${we.name}.`);continue}try{const Me=await Wt(we);ke.push({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:we.name,size:we.size,type:we.type,content:Me})}catch(Me){console.error("Erro ao processar arquivo:",Me),alert(u("transactions.error_loading_file")+` ${we.name}`)}}F(we=>({...we,attachments:[...we.attachments,...ke]}))}},le=L=>{F(ne=>({...ne,attachments:ne.attachments.filter(ke=>ke.id!==L)}))},ee=L=>{if(L===0)return"0 B";const ne=1024,ke=["B","KB","MB","GB"],we=Math.floor(Math.log(L)/Math.log(ne));return parseFloat((L/Math.pow(ne,we)).toFixed(1))+" "+ke[we]},Ne=L=>{const ne=document.createElement("a");ne.href=L.content,ne.download=L.name,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne)},je=L=>{L.preventDefault();const ne={userId:a,description:$.description,amount:Number($.amount),type:$.type,category:$.category||u("transactions.general"),date:$.date,attachments:$.attachments,isRecurring:$.isRecurring,frequency:$.isRecurring?$.frequency:void 0};y&&s?s({...ne,id:y}):e(ne),g(!1),b(null),F({description:"",amount:"",type:Ze.EXPENSE,category:"",date:new Date().toISOString().split("T")[0],attachments:[],isRecurring:!1,frequency:"monthly"}),d&&d()},Ee=T.useMemo(()=>{let L=t.filter(ne=>(ne.description.toLowerCase().includes(w.toLowerCase())||ne.category.toLowerCase().includes(w.toLowerCase()))&&(m==="subscriptions"?ne.isRecurring:!ne.isRecurring));return L.sort((ne,ke)=>{let we,Me;return oe==="description"?(we=ne.description.toLowerCase(),Me=ke.description.toLowerCase()):oe==="category"?(we=ne.category.toLowerCase(),Me=ke.category.toLowerCase()):oe==="date"?(we=new Date(ne.date).getTime(),Me=new Date(ke.date).getTime()):oe==="amount"&&(we=ne.amount,Me=ke.amount),we<Me?de==="asc"?-1:1:we>Me?de==="asc"?1:-1:0}),L},[t,w,m,oe,de]);Xn.useEffect(()=>{k(1)},[w,m]);const Be=Math.ceil(Ee.length/A),Ue=T.useMemo(()=>{if(Ee.length===0)return[];const L=(v-1)*A;return Ee.slice(L,L+A)},[Ee,v,A]),fs=L=>{C(L),k(1)},Kt=t.filter(L=>L.isRecurring&&L.type===Ze.EXPENSE).reduce((L,ne)=>L+ne.amount,0);return n.jsxs("div",{className:"space-y-6 md:space-y-8 animate-fade-in w-full max-w-full overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 p-6 md:p-8 rounded-3xl shadow-lg shadow-indigo-500/20 text-white relative overflow-hidden","data-tour":"smart-input",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"}),n.jsxs("h3",{className:"flex items-center text-base md:text-lg font-bold mb-3 relative z-10 flex-wrap",children:[n.jsx(st,{className:"mr-2 text-yellow-300"})," ",u("transactions.smart_input")]}),n.jsxs("form",{onSubmit:jt,className:"relative flex flex-col sm:flex-row items-center gap-3 z-10",children:[n.jsxs("div",{className:"relative flex-1 w-full",children:[n.jsx("input",{type:"text",value:B,onChange:L=>R(L.target.value),placeholder:u("transactions.smart_input_example"),className:"w-full pl-5 pr-14 py-4 rounded-2xl bg-white/10 backdrop-blur-md border border-white/20 text-white placeholder-white/60 focus:ring-2 focus:ring-white/50 outline-none",disabled:U||S}),n.jsx("button",{type:"submit",disabled:U||S,className:"absolute right-2 top-2 bottom-2 bg-white text-indigo-600 px-4 rounded-xl font-bold hover:bg-indigo-50 transition flex items-center justify-center disabled:opacity-70 shadow-sm active:scale-95",children:U?n.jsx(ze,{className:"animate-spin",size:20}):n.jsx(Rs,{size:24})})]}),n.jsx("button",{type:"button",onClick:S?gt:Xe,disabled:U,className:`p-4 rounded-2xl font-bold transition flex items-center justify-center shadow-lg border border-white/20 w-full sm:w-auto active:scale-95
                ${S?"bg-rose-500 text-white animate-pulse shadow-rose-500/50":"bg-white/10 hover:bg-white/20 text-white"}
              `,title:u(S?"transactions.stop_recording":"transactions.start_recording"),children:S?n.jsx(Mo,{size:24,fill:"currentColor"}):n.jsx(ql,{size:24})})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-slate-800 dark:text-white",children:u("transactions.title")}),n.jsx("p",{className:"text-slate-500 text-sm hidden sm:block",children:u("transactions.subtitle")})]}),n.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1.5 rounded-xl border border-slate-200 dark:border-slate-700 w-fit","data-tour":"transactions-tabs",children:[n.jsx("button",{onClick:()=>p("history"),className:`px-4 py-2 text-sm font-bold rounded-lg transition-all ${m==="history"?"bg-white dark:bg-slate-600 shadow-sm text-primary-600 dark:text-white":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:u("common.history")}),n.jsxs("button",{onClick:()=>p("subscriptions"),className:`px-4 py-2 text-sm font-bold rounded-lg transition-all flex items-center justify-center ${m==="subscriptions"?"bg-white dark:bg-slate-600 shadow-sm text-primary-600 dark:text-white":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[n.jsx(_s,{size:14,className:"mr-2"})," ",u("transactions.subscriptions")]})]})]}),n.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 lg:items-center lg:justify-between",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-wrap",children:[n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs("button",{onClick:()=>i("PDF"),className:"flex items-center justify-center px-3 py-2 bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-300 rounded-lg hover:bg-rose-100 dark:hover:bg-rose-900/40 transition font-semibold text-xs sm:text-sm border border-rose-100 dark:border-rose-800 active:scale-95",title:"Exportar PDF",children:[n.jsx(Do,{size:16,className:"mr-1.5"})," PDF"]}),n.jsxs("button",{onClick:()=>i("CSV"),className:"flex items-center justify-center px-3 py-2 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-300 rounded-lg hover:bg-emerald-100 dark:hover:bg-emerald-900/40 transition font-semibold text-xs sm:text-sm border border-emerald-100 dark:border-emerald-800 active:scale-95",title:"Exportar Excel (CSV)",children:[n.jsx(Gl,{size:16,className:"mr-1.5"})," Excel"]}),n.jsxs("button",{onClick:qe,disabled:X,className:"flex items-center justify-center px-3 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/40 transition font-semibold text-xs sm:text-sm border border-blue-100 dark:border-blue-800 active:scale-95 disabled:opacity-50",title:"Baixar template Excel",children:[X?n.jsx(ze,{size:16,className:"mr-1.5 animate-spin"}):n.jsx(er,{size:16,className:"mr-1.5"}),"Template"]})]}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{ref:x,type:"file",accept:".xlsx,.xls",onChange:L=>L.target.files?.[0]&&ve(L.target.files[0]),className:"hidden"}),n.jsxs("button",{onClick:()=>x.current?.click(),disabled:ye,className:"flex items-center justify-center px-3 py-2 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-300 rounded-lg hover:bg-purple-100 dark:hover:bg-purple-900/40 transition font-semibold text-xs sm:text-sm border border-purple-100 dark:border-purple-800 active:scale-95 disabled:opacity-50",title:"Importar Excel",children:[ye?n.jsx(ze,{size:16,className:"mr-1.5 animate-spin"}):n.jsx(xr,{size:16,className:"mr-1.5"}),"Importar"]})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-wrap sm:flex-nowrap lg:justify-end",children:[n.jsxs("div",{className:"relative flex-1 sm:flex-none sm:w-48",children:[n.jsx(Fo,{className:"absolute left-3 top-2.5 text-slate-400",size:16}),n.jsx("input",{type:"text",placeholder:u("transactions.search_placeholder"),value:w,onChange:L=>N(L.target.value),className:"w-full pl-9 pr-3 py-2 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary-500 outline-none transition text-slate-800 dark:text-white text-sm"})]}),n.jsxs("button",{"data-tour":"btn-new-transaction",onClick:Ge,className:"flex items-center justify-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition shadow-lg shadow-primary-500/20 font-semibold text-sm whitespace-nowrap active:scale-95",children:[n.jsx(Bt,{size:18,className:"mr-1.5"}),u("transactions.new_transaction")]})]})]})]}),h&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:n.jsxs("form",{onSubmit:je,className:"bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-2xl border border-slate-100 dark:border-slate-700 animate-scale-in max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h3",{className:"text-base sm:text-lg md:text-xl font-bold text-slate-800 dark:text-white truncate",children:u(y?"transactions.edit_transaction":"transactions.new_transaction")}),n.jsx("button",{type:"button",onClick:()=>g(!1),className:"text-slate-400 hover:text-slate-600 active:scale-95 transition-transform",children:n.jsx(at,{size:24})})]}),n.jsxs("div",{className:"space-y-5",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsx("div",{onClick:()=>F({...$,type:Ze.EXPENSE}),className:`cursor-pointer p-4 rounded-2xl border-2 text-center transition-all active:scale-95 ${$.type===Ze.EXPENSE?"border-rose-500 bg-rose-50 dark:bg-rose-900/20 text-rose-600":"border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:border-slate-300"}`,children:n.jsx("p",{className:"font-bold",children:u("transactions.expense_type")})}),n.jsx("div",{onClick:()=>F({...$,type:Ze.INCOME}),className:`cursor-pointer p-4 rounded-2xl border-2 text-center transition-all active:scale-95 ${$.type===Ze.INCOME?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600":"border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 hover:border-slate-300"}`,children:n.jsx("p",{className:"font-bold",children:u("transactions.income_type")})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:u("transactions.amount_label")}),n.jsx("input",{type:"number",required:!0,value:$.amount,onChange:L=>F({...$,amount:L.target.value}),placeholder:"0.00",className:`${Ie} text-lg font-bold tabular-nums`}),$.amount&&n.jsx("p",{className:"text-right text-xs font-bold text-primary-600 dark:text-primary-400 mt-1",children:o(Number($.amount))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:u("transactions.description_label")}),n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"text",required:!0,value:$.description,onChange:xt,placeholder:"Ex: Uber...",className:Ie}),ue&&n.jsx("div",{className:"absolute right-3 top-3",children:n.jsx(ze,{className:"animate-spin text-primary-500",size:20})})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Categoria"}),n.jsx("input",{type:"text",value:$.category,onChange:L=>F({...$,category:L.target.value}),placeholder:u("transactions.general"),className:Ie})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Data"}),n.jsx("input",{type:"date",required:!0,value:$.date,onChange:L=>F({...$,date:L.target.value}),className:Ie})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Comprovativos e Recibos"}),n.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-xl p-4",children:[n.jsxs("div",{className:"mb-3 flex flex-col sm:flex-row gap-3",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("input",{type:"file",multiple:!0,id:"file-upload",className:"hidden",onChange:Ft,accept:"image/*,application/pdf"}),n.jsx("label",{htmlFor:"file-upload",className:"flex items-center justify-center w-full p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition group h-full min-h-[100px] active:scale-95",children:n.jsxs("div",{className:"text-center",children:[n.jsx(xr,{size:24,className:"mx-auto mb-2 text-slate-400 group-hover:text-primary-500"}),n.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"Carregar Arquivo"}),n.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"PDF/IMG (Max 20MB)"})]})})]}),n.jsxs("button",{type:"button",onClick:dt,className:"flex-1 p-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition group flex flex-col items-center justify-center min-h-[100px] active:scale-95",children:[n.jsx(Bl,{size:24,className:"mx-auto mb-2 text-slate-400 group-hover:text-primary-500"}),n.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"Usar CÃ¢mera"}),n.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Tirar foto do recibo"})]})]}),$.attachments.length>0&&n.jsx("div",{className:"space-y-2 max-h-[150px] overflow-y-auto pr-1",children:$.attachments.map(L=>n.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded-lg border border-slate-100 dark:border-slate-700 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx(yn,{size:16,className:"text-slate-400 shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-white truncate",title:L.name,children:L.name}),n.jsx("p",{className:"text-[10px] text-slate-400",children:ee(L.size)})]})]}),n.jsx("button",{type:"button",onClick:()=>le(L.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-lg transition active:scale-90",title:"Remover",children:n.jsx(at,{size:16})})]},L.id))})]})]}),n.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-slate-200 dark:border-slate-700",children:[n.jsx("div",{className:"flex items-center justify-between mb-2",children:n.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[n.jsx("input",{type:"checkbox",checked:$.isRecurring,onChange:L=>F({...$,isRecurring:L.target.checked}),className:"w-5 h-5 rounded border-slate-300 text-primary-600 focus:ring-primary-500"}),n.jsxs("span",{className:"text-sm font-bold text-slate-700 dark:text-white flex items-center",children:[n.jsx(_s,{size:14,className:"mr-1"})," ",u("transactions.recurring_label")]})]})}),$.isRecurring&&n.jsxs("div",{className:"animate-fade-in mt-3",children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1",children:u("transactions.frequency_label")}),n.jsxs("select",{value:$.frequency,onChange:L=>F({...$,frequency:L.target.value}),className:Ie,children:[n.jsx("option",{value:"weekly",children:u("transactions.freq_weekly")}),n.jsx("option",{value:"biweekly",children:u("transactions.freq_biweekly")}),n.jsx("option",{value:"monthly",children:u("transactions.freq_monthly")}),n.jsx("option",{value:"quarterly",children:u("transactions.freq_quarterly")}),n.jsx("option",{value:"semiannual",children:u("transactions.freq_semiannual")}),n.jsx("option",{value:"yearly",children:u("transactions.freq_yearly")})]})]})]})]}),n.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[n.jsx("button",{type:"button",onClick:()=>{g(!1),b(null)},className:"px-6 py-3 text-slate-600 dark:text-slate-300 font-bold hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition active:scale-95",children:u("common.cancel")}),n.jsx("button",{type:"submit",className:"px-6 py-3 bg-primary-600 text-white font-bold rounded-xl hover:bg-primary-700 shadow-lg shadow-primary-500/30 transition active:scale-95",children:u(y?"transactions.update_button":"common.save")})]})]})}),ae&&n.jsxs("div",{className:"fixed inset-0 z-[60] bg-black flex flex-col animate-fade-in",children:[n.jsxs("div",{className:"relative flex-1 bg-black flex items-center justify-center overflow-hidden",children:[n.jsx("video",{ref:M,autoPlay:!0,playsInline:!0,className:`w-full h-full object-cover ${ce?"hidden":"block"}`}),ce&&n.jsx("img",{src:ce,alt:"Captured",className:"w-full h-full object-contain"}),n.jsx("canvas",{ref:ie,className:"hidden"}),n.jsx("button",{onClick:et,className:"absolute top-4 right-4 text-white p-2 rounded-full bg-black/40 hover:bg-black/60 transition z-10 active:scale-95",children:n.jsx(at,{size:32})})]}),n.jsx("div",{className:"bg-black p-6 flex items-center justify-center gap-8 pb-10",children:ce?n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>j(null),className:"flex flex-col items-center text-white gap-1 active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center border border-slate-600",children:n.jsx(Ol,{size:24})}),n.jsx("span",{className:"text-xs",children:u("transactions.retry")})]}),n.jsxs("button",{onClick:Dt,className:"flex flex-col items-center text-white gap-1 active:scale-95 transition-transform",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-emerald-600 flex items-center justify-center shadow-lg shadow-emerald-600/30",children:n.jsx(Et,{size:32})}),n.jsx("span",{className:"text-xs font-bold",children:"Guardar"})]}),n.jsxs("button",{onClick:us,disabled:U,className:"flex flex-col items-center text-white gap-1 active:scale-95 transition-transform disabled:opacity-50",children:[n.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-600/30",children:U?n.jsx(ze,{size:32,className:"animate-spin"}):n.jsx(st,{size:32})}),n.jsx("span",{className:"text-xs font-bold",children:"OCR Recibo"})]})]}):n.jsx("button",{onClick:Mt,className:"w-20 h-20 rounded-full border-4 border-white flex items-center justify-center group active:scale-90 transition-transform",children:n.jsx("div",{className:"w-16 h-16 rounded-full bg-white group-active:scale-90 transition"})})})]}),m==="subscriptions"&&n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-3xl p-6 md:p-8 text-white shadow-xl shadow-indigo-500/20 relative overflow-hidden",children:n.jsxs("div",{className:"relative z-10 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-bold mb-1 opacity-90",children:u("transactions.monthly_recurring_cost")}),n.jsx("p",{className:"text-lg sm:text-2xl md:text-3xl font-extrabold tracking-tight break-words min-w-0",children:o(Kt)})]}),n.jsx("div",{className:"bg-white/20 p-4 rounded-2xl backdrop-blur-sm self-end sm:self-auto",children:n.jsx(Vl,{size:32})})]})}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Ue.map(L=>n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 flex flex-col justify-between group hover:-translate-y-1 transition duration-300 min-w-0",children:[n.jsxs("div",{className:"flex justify-between items-start mb-4",children:[n.jsx("div",{className:`p-3 rounded-2xl ${L.type==="RECEITA"?"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20":"bg-rose-50 text-rose-600 dark:bg-rose-900/20"}`,children:L.type==="RECEITA"?n.jsx(Rs,{size:24}):n.jsx($l,{size:24})}),n.jsx("span",{className:"px-3 py-1 bg-slate-100 dark:bg-slate-700 rounded-full text-xs font-bold text-slate-500 dark:text-slate-300 uppercase",children:L.frequency==="weekly"?u("transactions.freq_weekly"):L.frequency==="biweekly"?u("transactions.freq_biweekly"):L.frequency==="monthly"?u("transactions.freq_monthly"):L.frequency==="quarterly"?u("transactions.freq_quarterly"):L.frequency==="semiannual"?u("transactions.freq_semiannual"):u("transactions.freq_yearly")})]}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("h4",{className:"text-xs sm:text-sm md:text-base font-bold text-slate-800 dark:text-white mb-1 truncate line-clamp-2",children:L.description}),n.jsx("p",{className:"text-slate-400 text-xs sm:text-sm mb-4 font-medium truncate",children:L.category}),n.jsx("p",{className:`text-sm sm:text-lg md:text-xl font-bold break-words min-w-0 ${L.type==="RECEITA"?"text-emerald-600":"text-slate-700 dark:text-white"}`,children:o(L.amount)})]}),n.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-50 dark:border-slate-700 flex justify-end gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity",children:[n.jsx("button",{onClick:()=>We(L),className:"p-2 text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg active:scale-95 transition-transform",children:n.jsx(Gs,{size:18})}),n.jsx("button",{onClick:()=>f(L.id),className:"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-lg active:scale-95 transition-transform",children:n.jsx(Qe,{size:18})})]})]},L.id))})]}),m==="history"&&n.jsxs(n.Fragment,{children:[Ae.size>0&&n.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-2xl border border-blue-200 dark:border-blue-800 mb-6",children:[n.jsxs("span",{className:"text-sm font-bold text-blue-700 dark:text-blue-300",children:[Ae.size," selecionadas"]}),n.jsxs("button",{onClick:_e,className:"ml-auto flex items-center gap-2 px-4 py-2 bg-rose-500 text-white rounded-lg hover:bg-rose-600 font-bold text-sm active:scale-95",children:[n.jsx(Qe,{size:16})," Excluir"]})]}),n.jsx("div",{className:"hidden md:block bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 overflow-hidden",children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left border-collapse min-w-[600px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-900/30",children:[n.jsx("th",{className:"p-4 md:p-6",children:n.jsx("input",{type:"checkbox",checked:Ae.size===Ue.length&&Ue.length>0,onChange:pe,className:"w-4 h-4 cursor-pointer"})}),n.jsxs("th",{onClick:()=>Fe("description"),className:"p-4 md:p-6 text-xs font-bold text-slate-400 uppercase tracking-wider cursor-pointer hover:text-slate-600 dark:hover:text-slate-300 transition",children:[u("transactions.transaction_header")," ",oe==="description"&&n.jsx("span",{className:"text-xs",children:de==="asc"?"â†‘":"â†“"})]}),n.jsxs("th",{onClick:()=>Fe("category"),className:"p-4 md:p-6 text-xs font-bold text-slate-400 uppercase tracking-wider cursor-pointer hover:text-slate-600 dark:hover:text-slate-300 transition",children:[u("transactions.category_header")," ",oe==="category"&&n.jsx("span",{className:"text-xs",children:de==="asc"?"â†‘":"â†“"})]}),n.jsxs("th",{onClick:()=>Fe("date"),className:"p-4 md:p-6 text-xs font-bold text-slate-400 uppercase tracking-wider cursor-pointer hover:text-slate-600 dark:hover:text-slate-300 transition",children:[u("common.date")," ",oe==="date"&&n.jsx("span",{className:"text-xs",children:de==="asc"?"â†‘":"â†“"})]}),n.jsxs("th",{onClick:()=>Fe("amount"),className:"p-4 md:p-6 text-xs font-bold text-slate-400 uppercase tracking-wider text-right cursor-pointer hover:text-slate-600 dark:hover:text-slate-300 transition",children:[u("common.value")," ",oe==="amount"&&n.jsx("span",{className:"text-xs",children:de==="asc"?"â†‘":"â†“"})]}),n.jsx("th",{className:"p-4 md:p-6 text-xs font-bold text-slate-400 uppercase tracking-wider text-right",children:u("transactions.actions_header")})]})}),n.jsx("tbody",{className:"divide-y divide-slate-50 dark:divide-slate-700/50",children:Ue.map(L=>n.jsxs("tr",{className:`${Ae.has(L.id)?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-slate-50 dark:hover:bg-slate-700/30"} transition-colors group`,children:[n.jsx("td",{className:"p-4 md:p-6",children:n.jsx("input",{type:"checkbox",checked:Ae.has(L.id),onChange:()=>V(L.id),className:"w-4 h-4 cursor-pointer"})}),n.jsx("td",{className:"p-4 md:p-6",children:n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:`p-2.5 rounded-full mr-4 shrink-0 ${L.type===Ze.INCOME?"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30":"bg-rose-100 text-rose-600 dark:bg-rose-900/30"}`,children:L.type===Ze.INCOME?n.jsx(Rs,{size:20}):n.jsx(br,{size:20})}),n.jsxs("div",{className:"min-w-0",children:[n.jsx("p",{className:"font-bold text-slate-800 dark:text-white text-base truncate max-w-[120px] sm:max-w-xs",title:L.description,children:L.description}),n.jsx("div",{className:"flex flex-wrap gap-2 mt-0.5",children:L.attachments&&L.attachments.length>0?n.jsx("div",{className:"flex gap-1",children:L.attachments.slice(0,1).map(ne=>n.jsxs("button",{onClick:()=>Ne(ne),className:"flex items-center text-xs text-primary-500 hover:text-primary-600 font-medium bg-primary-50 dark:bg-primary-900/20 px-2 py-0.5 rounded-md transition active:scale-95",title:`${u("common.download")} ${ne.name}`,children:[n.jsx(yn,{size:10,className:"mr-1"})," ",L.attachments&&L.attachments.length>1?`${L.attachments.length} ${u("transactions.attachments")}`:u("common.attachment")]},ne.id))}):L.attachmentName?n.jsxs("span",{className:"flex items-center text-xs text-slate-400 font-medium",children:[n.jsx(Hl,{size:10,className:"mr-1"})," ",u("transactions.old_attachment")]}):null})]})]})}),n.jsx("td",{className:"p-4 md:p-6",children:n.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-600 whitespace-nowrap",children:L.category})}),n.jsx("td",{className:"p-4 md:p-6 text-sm text-slate-500 font-medium whitespace-nowrap",children:new Date(L.date).toLocaleDateString("pt-BR")}),n.jsxs("td",{className:`p-4 md:p-6 text-right font-bold text-base whitespace-nowrap tabular-nums ${L.type===Ze.INCOME?"text-emerald-600":"text-rose-500"}`,children:[L.type===Ze.INCOME?"+":"-"," ",o(L.amount)]}),n.jsx("td",{className:"p-4 md:p-6 text-right",children:n.jsx("div",{className:"flex justify-end gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition",children:L.userId===a&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:()=>We(L),className:"p-2 text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition active:scale-90",children:n.jsx(Gs,{size:16})}),n.jsx("button",{onClick:()=>{confirm(u("transactions.delete_confirm"))&&f(L.id)},className:"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-lg transition active:scale-90",children:n.jsx(Qe,{size:16})})]})})})]},L.id))})]})})}),n.jsx("div",{className:"md:hidden space-y-3",children:Ue.map(L=>n.jsxs("div",{onClick:()=>D(P===L.id?null:L.id),className:"bg-white dark:bg-slate-800 p-4 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 active:scale-[0.98] transition-transform cursor-pointer",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[n.jsx("div",{className:`p-2 rounded-full shrink-0 ${L.type==="RECEITA"?"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30":"bg-rose-100 text-rose-600 dark:bg-rose-900/30"}`,children:L.type==="RECEITA"?n.jsx(Rs,{size:18}):n.jsx(br,{size:18})}),n.jsx("span",{className:"font-bold text-slate-800 dark:text-white truncate text-sm",children:L.description})]}),n.jsxs("span",{className:`font-bold whitespace-nowrap text-sm ${L.type==="RECEITA"?"text-emerald-600":"text-rose-500"}`,children:[L.type==="RECEITA"?"+":"-"," ",o(L.amount)]})]}),P===L.id&&n.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-slate-700 animate-fade-in space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-400 uppercase font-bold mb-1",children:u("common.date")}),n.jsx("p",{className:"text-slate-700 dark:text-slate-200 font-medium",children:new Date(L.date).toLocaleDateString("pt-BR")})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-slate-400 uppercase font-bold mb-1",children:u("transactions.category_header")}),n.jsx("span",{className:"inline-block px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs font-bold",children:L.category})]})]}),L.attachments&&L.attachments.length>0&&n.jsx("div",{className:"flex flex-wrap gap-2",children:L.attachments.map(ne=>n.jsxs("button",{onClick:ke=>{ke.stopPropagation(),Ne(ne)},className:"flex items-center text-xs text-primary-500 hover:text-primary-600 font-medium bg-primary-50 dark:bg-primary-900/20 px-3 py-1.5 rounded-lg transition border border-primary-100 dark:border-primary-900",children:[n.jsx(yn,{size:12,className:"mr-1"})," ",ne.name]},ne.id))}),L.userId===a&&n.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-slate-50 dark:border-slate-700/50 mt-2",children:[n.jsxs("button",{onClick:ne=>{ne.stopPropagation(),We(L)},className:"px-3 py-1.5 bg-indigo-50 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400 rounded-lg text-xs font-bold flex items-center",children:[n.jsx(Gs,{size:12,className:"mr-1"})," Editar"]}),n.jsxs("button",{onClick:ne=>{ne.stopPropagation(),confirm("Excluir?")&&f(L.id)},className:"px-3 py-1.5 bg-rose-50 text-rose-600 dark:bg-rose-900/30 dark:text-rose-400 rounded-lg text-xs font-bold flex items-center",children:[n.jsx(Qe,{size:12,className:"mr-1"})," Excluir"]})]})]})]},L.id))}),Ee.length>A&&n.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-slate-700 flex flex-col sm:flex-row justify-between items-center gap-4 bg-slate-50 dark:bg-slate-900/30 mt-4 md:mt-0 rounded-b-3xl md:rounded-b-none rounded-t-3xl md:rounded-t-none",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("label",{className:"text-xs font-bold text-slate-600 dark:text-slate-400",children:"Itens/pÃ¡gina:"}),n.jsxs("select",{value:A,onChange:L=>fs(Number(L.target.value)),className:"px-3 py-1.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-bold text-slate-700 dark:text-white cursor-pointer hover:border-slate-300 dark:hover:border-slate-600 transition",children:[n.jsx("option",{value:10,children:"10"}),n.jsx("option",{value:20,children:"20"}),n.jsx("option",{value:50,children:"50"}),n.jsx("option",{value:100,children:"100"})]})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>k(L=>Math.max(1,L-1)),disabled:v===1,className:"p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-50 text-slate-600 dark:text-slate-300 transition active:scale-95",children:n.jsx(Lo,{size:20})}),n.jsxs("span",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 min-w-[100px] text-center",children:["PÃ¡gina ",v," de ",Be]}),n.jsx("button",{onClick:()=>k(L=>Math.min(Be,L+1)),disabled:Be===0||v===Be,className:"p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-50 text-slate-600 dark:text-slate-300 transition active:scale-95",children:n.jsx(Uo,{size:20})})]})]}),K&&n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:n.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-2xl max-w-2xl max-h-[80vh] overflow-y-auto w-full p-6 border border-slate-200 dark:border-slate-700",children:[n.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white mb-4",children:"TransaÃ§Ãµes para Importar"}),q.length>0&&n.jsxs("div",{className:"mb-4 p-3 bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 rounded-lg",children:[n.jsx("p",{className:"text-sm font-bold text-rose-700 dark:text-rose-300 mb-2",children:"âš ï¸ Erros:"}),q.slice(0,5).map((L,ne)=>n.jsx("p",{className:"text-xs text-rose-600 dark:text-rose-400",children:L},ne)),q.length>5&&n.jsxs("p",{className:"text-xs text-rose-600",children:["... +",q.length-5]})]}),n.jsxs("div",{className:"mb-4",children:[n.jsxs("p",{className:"text-sm font-semibold text-slate-600 dark:text-slate-400 mb-2",children:[I.length," transaÃ§Ã£o(Ãµes):"]}),n.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:I.map((L,ne)=>n.jsx("div",{className:`p-3 rounded-lg border ${L.type==="RECEITA"?"bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-800":"bg-rose-50 dark:bg-rose-900/10 border-rose-200 dark:border-rose-800"}`,children:n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-slate-800 dark:text-white",children:L.description}),n.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[L.category," â€¢ ",L.date]})]}),n.jsxs("p",{className:`text-sm font-bold ${L.type==="RECEITA"?"text-green-600":"text-rose-600"}`,children:[L.type==="RECEITA"?"+":"-"," ",L.amount]})]})},ne))})]}),n.jsxs("div",{className:"flex gap-3 justify-end",children:[n.jsx("button",{onClick:()=>W(!1),className:"px-4 py-2 rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-white font-bold hover:bg-slate-300",children:"Cancelar"}),n.jsx("button",{onClick:Oe,className:"px-4 py-2 rounded-lg bg-blue-500 text-white font-bold hover:bg-blue-600",children:"âœ“ Confirmar"})]})]})})]})]})},ox=({goals:t,addGoal:e,deleteGoal:s,addContribution:r,editContribution:a,deleteContribution:o,currencyFormatter:i,currentUser:d,onRefresh:u})=>{const{t:f}=He(),{mutate:m}=sx(),{mutate:p}=nx(),[h,g]=T.useState(!1),[y,b]=T.useState(null),[w,N]=T.useState(""),[v,k]=T.useState(""),[A,C]=T.useState("deposit"),[P,D]=T.useState(null),[B,R]=T.useState({amount:"",date:"",note:""}),[U,Q]=T.useState({name:"",targetAmount:"",deadline:"",color:"#8b5cf6",initialAmount:"",interestRate:""}),S=t.find(te=>te.id===y),G=te=>{te.preventDefault(),e({name:U.name,targetAmount:Number(U.targetAmount),currentAmount:Number(U.initialAmount)||0,deadline:U.deadline,color:U.color,interestRate:Number(U.interestRate)||0,history:[]}),g(!1),Q({name:"",targetAmount:"",deadline:"",color:"#8b5cf6",initialAmount:"",interestRate:""})},_=te=>{if(te.preventDefault(),y&&w){const H=Number(w);if(A==="withdraw"&&S&&H>S.currentAmount){alert(f("goals.insufficient_balance"));return}const ce=A==="withdraw"?-H:H;p({id:y,amount:ce,note:v||(A==="withdraw"?"Resgate":"DepÃ³sito")}),N(""),k(""),C("deposit")}},J=te=>{D(te),R({amount:Math.abs(te.amount).toString(),date:te.date,note:te.note||""})},ae=te=>{if(te.preventDefault(),!P||!y)return;const H=P.amount<0;let ce=Number(B.amount);H?ce=-Math.abs(ce):ce=Math.abs(ce),a(y,{...P,amount:ce,date:B.date,note:B.note}),D(null)},Y=T.useMemo(()=>{if(!S)return[];const te=[...S.history].sort((j,M)=>new Date(j.date).getTime()-new Date(M.date).getTime());let H=0;const ce=te.map(j=>(H+=j.amount,{date:new Date(j.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}),amount:H,deposit:j.amount>0?j.amount:null,withdrawal:j.amount<0?Math.abs(j.amount):null,note:j.note}));return ce.length===0?[{date:"InÃ­cio",amount:0,deposit:null,withdrawal:null,note:""}]:ce},[S]);if(S){const te=S.targetAmount>0?Math.min(100,S.currentAmount/S.targetAmount*100):0;return n.jsxs("div",{className:"space-y-8 animate-fade-in pb-10 w-full max-w-full overflow-hidden",children:[n.jsxs("button",{onClick:()=>b(null),className:"flex items-center text-slate-500 hover:text-primary-600 transition font-semibold bg-white dark:bg-slate-800 px-4 py-2 rounded-xl shadow-sm active:scale-95",children:[n.jsx(Tn,{size:20,className:"mr-2"}),f("common.back")]}),P&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4",children:n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-8 w-full max-w-md border border-slate-200 dark:border-slate-700 animate-scale-in",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:f("goals.edit_record")}),n.jsx("button",{onClick:()=>D(null),className:"active:scale-95 transition-transform",children:n.jsx(at,{size:24,className:"text-slate-400"})})]}),n.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("common.value")}),n.jsx("input",{type:"number",step:"0.01",required:!0,min:"0",value:B.amount,onChange:H=>R({...B,amount:H.target.value}),className:"w-full p-3 rounded-xl border bg-slate-50 text-slate-800 border-slate-200 dark:bg-slate-700 dark:border-slate-600 dark:text-white font-bold"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("common.date")}),n.jsx("input",{type:"date",required:!0,value:B.date,onChange:H=>R({...B,date:H.target.value}),className:"w-full p-3 rounded-xl border bg-slate-50 text-slate-800 border-slate-200 dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("common.note")}),n.jsx("input",{type:"text",value:B.note,onChange:H=>R({...B,note:H.target.value}),className:"w-full p-3 rounded-xl border bg-slate-50 text-slate-800 border-slate-200 dark:bg-slate-700 dark:border-slate-600 dark:text-white"})]}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:()=>D(null),className:"px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-xl active:scale-95 transition-transform",children:f("common.cancel")}),n.jsx("button",{type:"submit",className:"px-6 py-2 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold active:scale-95 transition-transform",children:f("common.save")})]})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[n.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl p-6 md:p-8 text-white shadow-2xl relative overflow-hidden",style:{background:`linear-gradient(135deg, ${S.color}, #1e293b)`},children:[n.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"}),n.jsxs("div",{className:"flex justify-between items-start mb-8 relative z-10",children:[n.jsx("div",{className:"p-3 bg-white/20 backdrop-blur-md rounded-2xl",children:n.jsx(An,{size:32})}),S.interestRate&&n.jsxs("span",{className:"bg-emerald-500/20 text-emerald-100 px-3 py-1 rounded-full text-sm font-medium border border-emerald-500/30 whitespace-nowrap",children:["+",S.interestRate,"% a.a."]})]}),n.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl lg:text-3xl font-bold mb-1 tracking-tight truncate line-clamp-2",children:S.name}),n.jsxs("p",{className:"text-white/70 mb-8 text-sm font-medium",children:[f("goals.target"),": ",new Date(S.deadline).toLocaleDateString("pt-BR")]}),n.jsx("div",{className:"mb-2 flex justify-between items-end",children:n.jsx("span",{className:"text-sm sm:text-base md:text-lg lg:text-2xl font-bold tracking-tight break-words min-w-0",children:i(S.currentAmount)})}),n.jsx("div",{className:"w-full bg-black/20 rounded-full h-2 mb-2",children:n.jsx("div",{style:{width:`${te}%`},className:"bg-white h-2 rounded-full shadow-[0_0_10px_rgba(255,255,255,0.5)]"})}),n.jsxs("div",{className:"flex justify-between text-xs font-medium text-white/60",children:[n.jsxs("span",{children:[te.toFixed(0),"%"]}),n.jsxs("span",{className:"truncate ml-2",children:[f("goals.goal"),": ",i(S.targetAmount)]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700",children:[n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-4",children:f("goals.new_entry")}),n.jsxs("div",{className:"flex p-1 bg-slate-100 dark:bg-slate-700/50 rounded-xl mb-4",children:[n.jsx("button",{onClick:()=>C("deposit"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition ${A==="deposit"?"bg-white dark:bg-slate-600 shadow text-emerald-600":"text-slate-500"}`,children:f("goals.deposit")}),n.jsx("button",{onClick:()=>C("withdraw"),className:`flex-1 py-2 rounded-lg text-sm font-bold transition ${A==="withdraw"?"bg-white dark:bg-slate-600 shadow text-rose-500":"text-slate-500"}`,children:f("goals.withdrawal")})]}),n.jsxs("form",{onSubmit:_,className:"space-y-3",children:[n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-3.5 text-slate-400 font-bold",children:"Kz"}),n.jsx("input",{type:"number",required:!0,min:"0",step:"0.01",value:w,onChange:H=>N(H.target.value),className:"w-full pl-10 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border-none font-bold text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 tabular-nums",placeholder:"0.00"})]}),w&&n.jsx("p",{className:"text-right text-xs font-bold text-primary-600 dark:text-primary-400",children:i(Number(w))}),n.jsx("input",{type:"text",value:v,onChange:H=>k(H.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border-none text-sm focus:ring-2 focus:ring-primary-500",placeholder:f("goals.optional_description")}),n.jsx("button",{type:"submit",className:`w-full py-3 rounded-xl text-white font-bold shadow-lg transition-transform active:scale-95 ${A==="deposit"?"bg-emerald-500 hover:bg-emerald-600 shadow-emerald-500/30":"bg-rose-500 hover:bg-rose-600 shadow-rose-500/30"}`,children:f("common.confirm")})]})]})]}),n.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 md:p-8 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 min-h-[350px]",children:[n.jsx("h3",{className:"text-sm sm:text-base md:text-lg font-bold mb-6 text-slate-800 dark:text-white truncate",children:f("goals.asset_growth")}),n.jsx("div",{className:"h-64 md:h-72",children:n.jsx(wt,{width:"100%",height:"100%",children:n.jsxs(El,{data:Y,children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"colorGoal",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:S.color,stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:S.color,stopOpacity:0})]})}),n.jsx(zt,{strokeDasharray:"3 3",stroke:"#e2e8f0",opacity:.5,vertical:!1}),n.jsx(qt,{dataKey:"date",stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:!1,dy:10,minTickGap:20}),n.jsx(Gt,{stroke:"#94a3b8",fontSize:12,tickLine:!1,axisLine:!1,tickFormatter:H=>`${H>=1e3?(H/1e3).toFixed(0)+"k":H}`}),n.jsx(_t,{contentStyle:{backgroundColor:"#1e293b",borderRadius:"12px",border:"none",color:"white"}}),n.jsx(Tl,{y:S.targetAmount,stroke:"red",strokeDasharray:"3 3",opacity:.3}),n.jsx(ws,{type:"monotone",dataKey:"amount",stroke:S.color,strokeWidth:3,fill:"url(#colorGoal)"}),n.jsx(gr,{dataKey:"deposit",fill:"#10B981",shape:"circle"}),n.jsx(gr,{dataKey:"withdrawal",fill:"#EF4444",shape:"wye"})]})})})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsx("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700",children:n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:f("goals.transaction_history")})}),n.jsx("div",{className:"max-h-80 overflow-y-auto overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left min-w-[500px]",children:[n.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 sticky top-0",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-4 text-xs font-bold text-slate-400 uppercase",children:f("common.date")}),n.jsx("th",{className:"p-4 text-xs font-bold text-slate-400 uppercase",children:f("common.description")}),n.jsx("th",{className:"p-4 text-xs font-bold text-slate-400 uppercase text-right",children:f("common.value")}),n.jsx("th",{className:"p-4 text-xs font-bold text-slate-400 uppercase text-right",children:f("common.options")})]})}),n.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:S.history.slice().reverse().map(H=>n.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30 transition group",children:[n.jsx("td",{className:"p-4 text-sm font-medium text-slate-600 dark:text-slate-300 whitespace-nowrap",children:new Date(H.date).toLocaleDateString("pt-BR")}),n.jsx("td",{className:"p-4 text-sm text-slate-600 dark:text-slate-300 min-w-[120px]",children:H.note||(H.amount>0?f("goals.deposit"):f("goals.withdrawal"))}),n.jsxs("td",{className:`p-4 text-sm font-bold text-right whitespace-nowrap tabular-nums ${H.amount>0?"text-emerald-600":"text-rose-500"}`,children:[H.amount>0?"+":"-"," ",i(Math.abs(H.amount))]}),n.jsx("td",{className:"p-4 text-right whitespace-nowrap",children:H.userId===d.id&&n.jsxs("div",{className:"flex justify-end gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition",children:[n.jsx("button",{onClick:()=>J(H),className:"p-1.5 text-indigo-500 hover:bg-indigo-50 rounded active:scale-95 transition-transform",children:n.jsx(Gs,{size:14})}),n.jsx("button",{onClick:()=>o(S.id,H.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded active:scale-95 transition-transform",children:n.jsx(Qe,{size:14})})]})})]},H.id))})]})})]})]})]})]})}return n.jsxs("div",{className:"space-y-8 animate-fade-in w-full max-w-full overflow-hidden",children:[n.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-base sm:text-lg md:text-xl lg:text-2xl font-bold text-slate-800 dark:text-white truncate",children:f("goals.title")}),n.jsx("p",{className:"text-slate-500 text-sm",children:f("goals.subtitle")})]}),n.jsxs("button",{"data-tour":"btn-new-goal",onClick:()=>g(!h),className:"w-full sm:w-auto flex items-center justify-center px-6 py-3 bg-primary-600 text-white rounded-2xl hover:bg-primary-700 transition shadow-lg shadow-primary-500/30 font-bold whitespace-nowrap active:scale-95",children:[n.jsx(Bt,{size:20,className:"mr-2"}),f("goals.new_goal")]})]}),h&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm",children:n.jsxs("form",{onSubmit:G,className:"bg-white dark:bg-slate-800 p-6 md:p-8 rounded-3xl shadow-2xl w-full max-w-2xl border border-slate-200 dark:border-slate-700 animate-scale-in max-h-[90vh] overflow-y-auto",children:[n.jsx("h3",{className:"text-sm sm:text-base md:text-lg lg:text-xl font-bold mb-6 text-slate-800 dark:text-white truncate",children:f("goals.plan_new_goal")}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("common.name")}),n.jsx("input",{type:"text",required:!0,value:U.name,onChange:te=>Q({...U,name:te.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700",placeholder:"Ex: Casa PrÃ³pria"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("goals.target_amount")}),n.jsx("input",{type:"number",required:!0,value:U.targetAmount,onChange:te=>Q({...U,targetAmount:te.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 tabular-nums",placeholder:"0.00"}),U.targetAmount&&n.jsx("p",{className:"text-right text-xs font-bold text-primary-600 dark:text-primary-400 mt-1",children:i(Number(U.targetAmount))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("goals.initial_balance")}),n.jsx("input",{type:"number",value:U.initialAmount,onChange:te=>Q({...U,initialAmount:te.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 tabular-nums",placeholder:"0.00"}),U.initialAmount&&n.jsx("p",{className:"text-right text-xs font-bold text-primary-600 dark:text-primary-400 mt-1",children:i(Number(U.initialAmount))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("goals.annual_interest")}),n.jsx("input",{type:"number",value:U.interestRate,onChange:te=>Q({...U,interestRate:te.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 tabular-nums",placeholder:"Ex: 5"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("goals.deadline")}),n.jsx("input",{type:"date",required:!0,value:U.deadline,onChange:te=>Q({...U,deadline:te.target.value}),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:f("goals.card_color")}),n.jsx("div",{className:"flex gap-2 flex-wrap",children:["#8b5cf6","#10b981","#3b82f6","#f59e0b","#ec4899","#6366f1"].map(te=>n.jsx("div",{onClick:()=>Q({...U,color:te}),className:`w-8 h-8 rounded-full cursor-pointer transition-transform hover:scale-110 active:scale-95 ${U.color===te?"ring-2 ring-offset-2 ring-slate-400":""}`,style:{backgroundColor:te}},te))})]})]}),n.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[n.jsx("button",{type:"button",onClick:()=>g(!1),className:"px-6 py-3 text-slate-600 hover:bg-slate-100 rounded-xl font-medium active:scale-95 transition-transform",children:f("common.cancel")}),n.jsx("button",{type:"submit",className:"px-6 py-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold shadow-lg active:scale-95 transition-transform",children:f("goals.create_goal")})]})]})}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6","data-tour":"goals-grid",children:t.map(te=>{const H=te.targetAmount>0?Math.min(100,te.currentAmount/te.targetAmount*100):0;return n.jsxs("div",{className:"group relative bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-soft hover:shadow-2xl transition-all duration-300 cursor-pointer border border-slate-100 dark:border-slate-700 overflow-hidden min-w-0 active:scale-[0.98]",onClick:()=>b(te.id),children:[n.jsx("div",{className:"absolute top-0 left-0 w-2 h-full",style:{backgroundColor:te.color}}),n.jsxs("div",{className:"flex justify-between items-start mb-6 pl-4",children:[n.jsx("div",{className:"p-3 rounded-2xl bg-slate-50 dark:bg-slate-700/50 text-slate-700 dark:text-white",children:n.jsx(An,{size:24})}),n.jsx("button",{onClick:ce=>{ce.stopPropagation(),confirm(f("goals.delete_confirm"))&&(m(te.id),u&&u())},className:"text-slate-300 hover:text-rose-500 p-2 rounded-full hover:bg-rose-50 transition active:scale-90",children:n.jsx(Qe,{size:18})})]}),n.jsxs("div",{className:"pl-4 mb-6",children:[n.jsx("h3",{className:"font-bold text-xs sm:text-sm md:text-base lg:text-lg text-slate-800 dark:text-white mb-1 truncate line-clamp-2",title:te.name,children:te.name}),n.jsxs("p",{className:"text-sm text-slate-400",children:[f("goals.expires_on")," ",new Date(te.deadline).toLocaleDateString("pt-BR")]})]}),n.jsxs("div",{className:"pl-4",children:[n.jsxs("div",{className:"flex justify-between items-end mb-2",children:[n.jsx("span",{className:"text-xs sm:text-sm md:text-base lg:text-lg font-bold text-slate-800 dark:text-white tracking-tight break-words min-w-0",children:i(te.currentAmount)}),n.jsxs("span",{className:"text-xs font-bold text-slate-500 uppercase truncate ml-2",children:[f("goals.of")," ",i(te.targetAmount)]})]}),n.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden",children:n.jsx("div",{className:"h-full rounded-full transition-all duration-1000",style:{width:`${H}%`,backgroundColor:te.color}})})]})]},te.id)})})]})},ix=({transactions:t,currencyFormatter:e,currentUser:s,allUsers:r,tasks:a,events:o,addTask:i,toggleTask:d,deleteTask:u,addEvent:f,deleteEvent:m,canViewData:p})=>{const{t:h}=He(),g=T.useMemo(()=>r.filter(Z=>Z.familyId===s.familyId),[r,s.familyId]),[y,b]=T.useState(g.map(Z=>Z.id)),[w,N]=T.useState(""),[v,k]=T.useState(new Date),[A,C]=T.useState(null),[P,D]=T.useState(""),[B,R]=T.useState("general"),U=Z=>{b(X=>X.includes(Z)?X.filter(me=>me!==Z):[...X,Z])},Q=T.useMemo(()=>{const Z=g.map(X=>X.id);return t.filter(X=>Z.includes(X.userId)).filter(X=>y.includes(X.userId)).map(X=>{const me=g.find(ye=>ye.id===X.userId);return me&&!p(s,me)?{...X,amount:0,isMasked:!0}:{...X,isMasked:!1}})},[t,y,s,g,p]),S=Q.filter(Z=>Z.type===Ze.INCOME&&!Z.isMasked).reduce((Z,X)=>Z+X.amount,0),G=Q.filter(Z=>Z.type===Ze.EXPENSE&&!Z.isMasked).reduce((Z,X)=>Z+X.amount,0),_=S-G,J=Q.some(Z=>Z.isMasked),ae=[{name:"Receitas",value:S},{name:"Despesas",value:G}],Y=["#10b981","#ef4444"],te=a.filter(Z=>g.some(X=>X.id===Z.assignedTo)),H=Z=>{Z.preventDefault(),w.trim()&&(i({description:w,assignedTo:s.id,isCompleted:!1}),N(""))},ce=new Date(v.getFullYear(),v.getMonth()+1,0).getDate(),j=new Date(v.getFullYear(),v.getMonth(),1).getDay(),M=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ie=()=>k(new Date(v.getFullYear(),v.getMonth()-1,1)),$=()=>k(new Date(v.getFullYear(),v.getMonth()+1,1)),F=Z=>{Z.preventDefault(),!(!A||!P)&&(f({title:P,date:A,type:B}),D(""))},ue=Z=>{const X=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(Z).padStart(2,"0")}`;return o.filter(me=>me.date===X)};return n.jsxs("div",{className:"animate-fade-in max-w-7xl mx-auto py-4 md:py-8 space-y-8 md:space-y-12",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"inline-flex items-center justify-center p-4 md:p-5 bg-blue-50 dark:bg-blue-900/20 rounded-full mb-4 md:mb-6 text-blue-600 dark:text-blue-400 shadow-glow",children:n.jsx(Ws,{size:32,className:"md:w-12 md:h-12"})}),n.jsx("h2",{className:"text-2xl md:text-4xl font-extrabold text-slate-900 dark:text-white mb-2 md:mb-3 tracking-tight",children:h("family_mode.family_hub")}),n.jsx("p",{className:"text-sm md:text-lg text-slate-500 dark:text-slate-400 max-w-2xl mx-auto",children:h("family_mode.family_hub_desc")})]}),n.jsxs("section",{children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h3",{className:"text-xl md:text-2xl font-bold text-slate-800 dark:text-white",children:h("family_mode.financial_summary")}),n.jsx("div",{className:"flex -space-x-2",children:g.map(Z=>n.jsxs("div",{className:"relative group",children:[n.jsx("img",{src:Z.avatar,onClick:()=>U(Z.id),className:`w-8 h-8 md:w-10 md:h-10 rounded-full border-2 cursor-pointer transition-transform hover:scale-110 ${y.includes(Z.id)?"border-primary-500 opacity-100":"border-slate-300 opacity-50 grayscale"}`,title:Z.name}),!p(s,Z)&&Z.id!==s.id&&n.jsx("div",{className:"absolute -top-1 -right-1 bg-slate-800 text-white rounded-full p-0.5",children:n.jsx(Ut,{size:10})})]},Z.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[n.jsxs("div",{className:"p-6 md:p-8 bg-white dark:bg-slate-800 rounded-3xl shadow-soft border-b-4 border-slate-200 dark:border-slate-700 text-center relative",children:[n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:h("family_mode.total_balance")}),n.jsxs("p",{className:`text-2xl md:text-4xl font-extrabold mt-2 ${_>=0?"text-slate-800 dark:text-white":"text-rose-500"}`,children:[e(_),J&&n.jsx("span",{className:"text-sm align-top text-slate-400",children:"*"})]})]}),n.jsxs("div",{className:"p-6 md:p-8 bg-white dark:bg-slate-800 rounded-3xl shadow-soft border-b-4 border-emerald-500/30 text-center",children:[n.jsx("p",{className:"text-xs font-bold text-emerald-500 uppercase",children:h("family_mode.income")}),n.jsx("p",{className:"text-2xl md:text-4xl font-extrabold mt-2 text-emerald-600",children:e(S)})]}),n.jsx("div",{className:"p-6 md:p-8 bg-white dark:bg-slate-800 rounded-3xl shadow-soft h-full flex items-center justify-center relative overflow-hidden",children:S===0&&G===0?n.jsx("p",{className:"text-slate-400 text-sm",children:h("family_mode.no_combined_data")}):n.jsx(wt,{width:"100%",height:120,children:n.jsxs(ko,{children:[n.jsx(So,{data:ae,cx:"50%",cy:"50%",innerRadius:35,outerRadius:50,paddingAngle:5,dataKey:"value",children:ae.map((Z,X)=>n.jsx(Co,{fill:Y[X%Y.length],strokeWidth:0},`cell-${X}`))}),n.jsx(_t,{formatter:Z=>e(Z),contentStyle:{borderRadius:"12px",border:"none",background:"#1e293b",color:"white"}})]})})})]}),J&&n.jsx("p",{className:"text-xs text-center text-slate-400 mt-2",children:"* Alguns dados estÃ£o ocultos devido a configuraÃ§Ãµes de privacidade."})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8",children:[n.jsxs("section",{"data-tour":"family-tasks",className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 p-4 md:p-6 flex flex-col h-[500px]",children:[n.jsxs("h3",{className:"text-lg md:text-xl font-bold text-slate-800 dark:text-white mb-4 md:mb-6 flex items-center",children:[n.jsx(yr,{className:"mr-3 text-primary-500"})," ",h("family_mode.tasks_plans")]}),n.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 mb-4 pr-2",children:[te.length===0&&n.jsx("p",{className:"text-center text-slate-400 py-10",children:h("family_mode.no_pending_tasks")}),te.map(Z=>{const X=g.find(me=>me.id===Z.assignedTo);return n.jsxs("div",{className:`flex items-center justify-between p-3 md:p-4 rounded-2xl transition-all ${Z.isCompleted?"bg-slate-50 dark:bg-slate-900/50 opacity-60":"bg-white dark:bg-slate-700/30 border border-slate-100 dark:border-slate-600"}`,children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{onClick:()=>d(Z.id),className:`text-xl md:text-2xl ${Z.isCompleted?"text-emerald-500":"text-slate-300 hover:text-primary-500"}`,children:Z.isCompleted?n.jsx(yr,{}):n.jsx(Mo,{})}),n.jsxs("div",{children:[n.jsx("p",{className:`text-sm md:text-base font-semibold ${Z.isCompleted?"line-through text-slate-400":"text-slate-800 dark:text-white"}`,children:Z.description}),n.jsxs("div",{className:"flex items-center mt-1",children:[n.jsx("img",{src:X?.avatar,className:"w-3 h-3 md:w-4 md:h-4 rounded-full mr-1.5"}),n.jsx("span",{className:"text-[10px] md:text-xs text-slate-500",children:X?.name})]})]})]}),n.jsx("button",{onClick:()=>u(Z.id),className:"text-slate-300 hover:text-rose-500 transition",children:n.jsx(Qe,{size:16})})]},Z.id)})]}),n.jsxs("form",{onSubmit:H,className:"mt-auto relative",children:[n.jsx("input",{type:"text",value:w,onChange:Z=>N(Z.target.value),placeholder:h("family_mode.add_new_task"),className:"w-full pl-4 pr-12 py-3 bg-slate-100 dark:bg-slate-900 rounded-xl border-none outline-none focus:ring-2 focus:ring-primary-500 text-sm md:text-base"}),n.jsx("button",{type:"submit",className:"absolute right-2 top-2 p-1.5 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition",children:n.jsx(Bt,{size:18})})]})]}),n.jsxs("section",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 p-4 md:p-6 flex flex-col h-auto md:h-[500px]",children:[n.jsxs("div",{className:"flex justify-between items-center mb-4 md:mb-6",children:[n.jsxs("h3",{className:"text-lg md:text-xl font-bold text-slate-800 dark:text-white flex items-center",children:[n.jsx(Cs,{className:"mr-2 md:mr-3 text-orange-500"})," ",h("family_mode.calendar")]}),n.jsxs("div",{className:"flex items-center gap-2 md:gap-4 bg-slate-100 dark:bg-slate-900 rounded-full px-3 py-1",children:[n.jsx("button",{onClick:ie,className:"p-1 hover:bg-white dark:hover:bg-slate-700 rounded-full",children:n.jsx(Lo,{size:16})}),n.jsxs("span",{className:"font-bold text-xs md:text-sm min-w-[90px] md:min-w-[100px] text-center",children:[M[v.getMonth()]," ",v.getFullYear()]}),n.jsx("button",{onClick:$,className:"p-1 hover:bg-white dark:hover:bg-slate-700 rounded-full",children:n.jsx(Uo,{size:16})})]})]}),n.jsxs("div",{className:"flex-1 flex flex-col",children:[n.jsx("div",{className:"grid grid-cols-7 text-center mb-2",children:["D","S","T","Q","Q","S","S"].map((Z,X)=>n.jsx("span",{className:"text-[10px] md:text-xs font-bold text-slate-400",children:Z},X))}),n.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-2 flex-1 auto-rows-fr",children:[Array.from({length:j}).map((Z,X)=>n.jsx("div",{},`empty-${X}`)),Array.from({length:ce}).map((Z,X)=>{const me=X+1,ye=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(me).padStart(2,"0")}`,be=ue(me),Ae=A===ye;return n.jsxs("div",{onClick:()=>C(ye),className:`relative rounded-xl border flex flex-col items-center justify-start pt-1 cursor-pointer transition-all hover:border-primary-300 min-h-[50px] md:min-h-0 overflow-hidden ${Ae?"bg-primary-50 border-primary-500 ring-1 ring-primary-500":"border-slate-100 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:[n.jsx("span",{className:`text-[10px] md:text-xs font-bold ${Ae?"text-primary-600":"text-slate-600 dark:text-slate-300"}`,children:me}),n.jsx("div",{className:"flex flex-wrap justify-center gap-0.5 mt-1 w-full px-0.5",children:be.map(fe=>n.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${fe.type==="bill"?"bg-rose-500":fe.type==="birthday"?"bg-purple-500":"bg-blue-500"}`},fe.id))})]},me)})]})]}),A&&n.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-100 dark:border-slate-700 animate-slide-up",children:[n.jsxs("h4",{className:"font-bold text-sm mb-3 text-slate-700 dark:text-white",children:["Eventos em ",A.split("-").reverse().join("/")]}),n.jsxs("form",{onSubmit:F,className:"mb-3 flex flex-col md:flex-row gap-2",children:[n.jsx("input",{type:"text",value:P,onChange:Z=>D(Z.target.value),placeholder:h("family_mode.new_event"),className:"flex-1 p-3 md:p-2 text-sm border rounded-xl dark:bg-slate-900 dark:text-white dark:border-slate-700 outline-none focus:ring-2 focus:ring-primary-500 min-w-0"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{value:B,onChange:Z=>R(Z.target.value),className:"p-3 md:p-2 text-sm border rounded-xl dark:bg-slate-900 dark:text-white dark:border-slate-700 outline-none flex-1 md:w-auto",children:[n.jsx("option",{value:"general",children:"Geral"}),n.jsx("option",{value:"bill",children:"Conta"}),n.jsx("option",{value:"birthday",children:"Niver"})]}),n.jsx("button",{type:"submit",className:"p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 shrink-0 shadow-lg shadow-primary-500/20",children:n.jsx(Bt,{size:18})})]})]}),ue(parseInt(A.split("-")[2])).length===0&&n.jsx("p",{className:"text-xs text-slate-400 italic",children:"Sem eventos para este dia."}),n.jsx("div",{className:"max-h-[120px] overflow-y-auto space-y-2 pr-1",children:ue(parseInt(A.split("-")[2])).map(Z=>n.jsxs("div",{className:"flex justify-between items-center bg-slate-50 dark:bg-slate-700/50 p-2.5 rounded-xl border border-slate-100 dark:border-slate-600",children:[n.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[n.jsx("div",{className:`w-2 h-2 rounded-full shrink-0 ${Z.type==="bill"?"bg-rose-500":Z.type==="birthday"?"bg-purple-500":"bg-blue-500"}`}),n.jsx("span",{className:"text-sm font-medium dark:text-white truncate",title:Z.title,children:Z.title})]}),n.jsx("button",{onClick:()=>m(Z.id),className:"text-slate-400 hover:text-rose-500 shrink-0 p-1",children:n.jsx(Qe,{size:14})})]},Z.id))})]})]})]})]})},xo={async createBackup(){const t=await fetch("/api/backup",{method:"POST"});if(!t.ok)throw new Error("Backup failed");return t.json()},async getProgress(){const t=await fetch("/api/backup/progress");if(!t.ok)throw new Error("Failed to get progress");return t.json()},async restoreBackup(t){const e=await fetch("/api/backup/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({backupData:t})});if(!e.ok)throw new Error("Restore failed");return e.json()}},bo={async checkUpdateProgress(){const t=await fetch("/api/system/update-progress");if(!t.ok)throw new Error("Failed to get update progress");return t.json()},async executeUpdate(){const t=await fetch("/api/system/update",{method:"POST"});if(!t.ok){const e=await t.json();throw new Error(e.error||"Update failed")}return t.json()}};var En={exports:{}};var yo;function lx(){return yo||(yo=1,(function(t,e){(function(s){t.exports=s()})(function(){return(function s(r,a,o){function i(f,m){if(!a[f]){if(!r[f]){var p=typeof Ps=="function"&&Ps;if(!m&&p)return p(f,!0);if(d)return d(f,!0);var h=new Error("Cannot find module '"+f+"'");throw h.code="MODULE_NOT_FOUND",h}var g=a[f]={exports:{}};r[f][0].call(g.exports,function(y){var b=r[f][1][y];return i(b||y)},g,g.exports,s,r,a,o)}return a[f].exports}for(var d=typeof Ps=="function"&&Ps,u=0;u<o.length;u++)i(o[u]);return i})({1:[function(s,r,a){var o=s("./utils"),i=s("./support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(u){for(var f,m,p,h,g,y,b,w=[],N=0,v=u.length,k=v,A=o.getTypeOf(u)!=="string";N<u.length;)k=v-N,p=A?(f=u[N++],m=N<v?u[N++]:0,N<v?u[N++]:0):(f=u.charCodeAt(N++),m=N<v?u.charCodeAt(N++):0,N<v?u.charCodeAt(N++):0),h=f>>2,g=(3&f)<<4|m>>4,y=1<k?(15&m)<<2|p>>6:64,b=2<k?63&p:64,w.push(d.charAt(h)+d.charAt(g)+d.charAt(y)+d.charAt(b));return w.join("")},a.decode=function(u){var f,m,p,h,g,y,b=0,w=0,N="data:";if(u.substr(0,N.length)===N)throw new Error("Invalid base64 input, it looks like a data url.");var v,k=3*(u=u.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(u.charAt(u.length-1)===d.charAt(64)&&k--,u.charAt(u.length-2)===d.charAt(64)&&k--,k%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=i.uint8array?new Uint8Array(0|k):new Array(0|k);b<u.length;)f=d.indexOf(u.charAt(b++))<<2|(h=d.indexOf(u.charAt(b++)))>>4,m=(15&h)<<4|(g=d.indexOf(u.charAt(b++)))>>2,p=(3&g)<<6|(y=d.indexOf(u.charAt(b++))),v[w++]=f,g!==64&&(v[w++]=m),y!==64&&(v[w++]=p);return v}},{"./support":30,"./utils":32}],2:[function(s,r,a){var o=s("./external"),i=s("./stream/DataWorker"),d=s("./stream/Crc32Probe"),u=s("./stream/DataLengthProbe");function f(m,p,h,g,y){this.compressedSize=m,this.uncompressedSize=p,this.crc32=h,this.compression=g,this.compressedContent=y}f.prototype={getContentWorker:function(){var m=new i(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new u("data_length")),p=this;return m.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),m},getCompressedWorker:function(){return new i(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},f.createWorkerFrom=function(m,p,h){return m.pipe(new d).pipe(new u("uncompressedSize")).pipe(p.compressWorker(h)).pipe(new u("compressedSize")).withStreamInfo("compression",p)},r.exports=f},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(s,r,a){var o=s("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},a.DEFLATE=s("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(s,r,a){var o=s("./utils"),i=(function(){for(var d,u=[],f=0;f<256;f++){d=f;for(var m=0;m<8;m++)d=1&d?3988292384^d>>>1:d>>>1;u[f]=d}return u})();r.exports=function(d,u){return d!==void 0&&d.length?o.getTypeOf(d)!=="string"?(function(f,m,p,h){var g=i,y=h+p;f^=-1;for(var b=h;b<y;b++)f=f>>>8^g[255&(f^m[b])];return-1^f})(0|u,d,d.length,0):(function(f,m,p,h){var g=i,y=h+p;f^=-1;for(var b=h;b<y;b++)f=f>>>8^g[255&(f^m.charCodeAt(b))];return-1^f})(0|u,d,d.length,0):0}},{"./utils":32}],5:[function(s,r,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(s,r,a){var o=null;o=typeof Promise<"u"?Promise:s("lie"),r.exports={Promise:o}},{lie:37}],7:[function(s,r,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=s("pako"),d=s("./utils"),u=s("./stream/GenericWorker"),f=o?"uint8array":"array";function m(p,h){u.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=h,this.meta={}}a.magic="\b\0",d.inherits(m,u),m.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(d.transformTo(f,p.data),!1)},m.prototype.flush=function(){u.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},m.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this._pako=null},m.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(h){p.push({data:h,meta:p.meta})}},a.compressWorker=function(p){return new m("Deflate",p)},a.uncompressWorker=function(){return new m("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(s,r,a){function o(g,y){var b,w="";for(b=0;b<y;b++)w+=String.fromCharCode(255&g),g>>>=8;return w}function i(g,y,b,w,N,v){var k,A,C=g.file,P=g.compression,D=v!==f.utf8encode,B=d.transformTo("string",v(C.name)),R=d.transformTo("string",f.utf8encode(C.name)),U=C.comment,Q=d.transformTo("string",v(U)),S=d.transformTo("string",f.utf8encode(U)),G=R.length!==C.name.length,_=S.length!==U.length,J="",ae="",Y="",te=C.dir,H=C.date,ce={crc32:0,compressedSize:0,uncompressedSize:0};y&&!b||(ce.crc32=g.crc32,ce.compressedSize=g.compressedSize,ce.uncompressedSize=g.uncompressedSize);var j=0;y&&(j|=8),D||!G&&!_||(j|=2048);var M=0,ie=0;te&&(M|=16),N==="UNIX"?(ie=798,M|=(function(F,ue){var Z=F;return F||(Z=ue?16893:33204),(65535&Z)<<16})(C.unixPermissions,te)):(ie=20,M|=(function(F){return 63&(F||0)})(C.dosPermissions)),k=H.getUTCHours(),k<<=6,k|=H.getUTCMinutes(),k<<=5,k|=H.getUTCSeconds()/2,A=H.getUTCFullYear()-1980,A<<=4,A|=H.getUTCMonth()+1,A<<=5,A|=H.getUTCDate(),G&&(ae=o(1,1)+o(m(B),4)+R,J+="up"+o(ae.length,2)+ae),_&&(Y=o(1,1)+o(m(Q),4)+S,J+="uc"+o(Y.length,2)+Y);var $="";return $+=`
\0`,$+=o(j,2),$+=P.magic,$+=o(k,2),$+=o(A,2),$+=o(ce.crc32,4),$+=o(ce.compressedSize,4),$+=o(ce.uncompressedSize,4),$+=o(B.length,2),$+=o(J.length,2),{fileRecord:p.LOCAL_FILE_HEADER+$+B+J,dirRecord:p.CENTRAL_FILE_HEADER+o(ie,2)+$+o(Q.length,2)+"\0\0\0\0"+o(M,4)+o(w,4)+B+J+Q}}var d=s("../utils"),u=s("../stream/GenericWorker"),f=s("../utf8"),m=s("../crc32"),p=s("../signature");function h(g,y,b,w){u.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=b,this.encodeFileName=w,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}d.inherits(h,u),h.prototype.push=function(g){var y=g.meta.percent||0,b=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,u.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:b?(y+100*(b-w-1))/b:100}}))},h.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var y=this.streamFiles&&!g.file.dir;if(y){var b=i(g,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(g){this.accumulate=!1;var y=this.streamFiles&&!g.file.dir,b=i(g,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),y)this.push({data:(function(w){return p.DATA_DESCRIPTOR+o(w.crc32,4)+o(w.compressedSize,4)+o(w.uncompressedSize,4)})(g),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var g=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var b=this.bytesWritten-g,w=(function(N,v,k,A,C){var P=d.transformTo("string",C(A));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(N,2)+o(N,2)+o(v,4)+o(k,4)+o(P.length,2)+P})(this.dirRecords.length,b,g,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(g){this._sources.push(g);var y=this;return g.on("data",function(b){y.processChunk(b)}),g.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),g.on("error",function(b){y.error(b)}),this},h.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(g){var y=this._sources;if(!u.prototype.error.call(this,g))return!1;for(var b=0;b<y.length;b++)try{y[b].error(g)}catch{}return!0},h.prototype.lock=function(){u.prototype.lock.call(this);for(var g=this._sources,y=0;y<g.length;y++)g[y].lock()},r.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(s,r,a){var o=s("../compressions"),i=s("./ZipFileWorker");a.generateWorker=function(d,u,f){var m=new i(u.streamFiles,f,u.platform,u.encodeFileName),p=0;try{d.forEach(function(h,g){p++;var y=(function(v,k){var A=v||k,C=o[A];if(!C)throw new Error(A+" is not a valid compression method !");return C})(g.options.compression,u.compression),b=g.options.compressionOptions||u.compressionOptions||{},w=g.dir,N=g.date;g._compressWorker(y,b).withStreamInfo("file",{name:h,dir:w,date:N,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(m)}),m.entriesCount=p}catch(h){m.error(h)}return m}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(s,r,a){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new o;for(var d in this)typeof this[d]!="function"&&(i[d]=this[d]);return i}}(o.prototype=s("./object")).loadAsync=s("./load"),o.support=s("./support"),o.defaults=s("./defaults"),o.version="3.10.1",o.loadAsync=function(i,d){return new o().loadAsync(i,d)},o.external=s("./external"),r.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(s,r,a){var o=s("./utils"),i=s("./external"),d=s("./utf8"),u=s("./zipEntries"),f=s("./stream/Crc32Probe"),m=s("./nodejsUtils");function p(h){return new i.Promise(function(g,y){var b=h.decompressed.getContentWorker().pipe(new f);b.on("error",function(w){y(w)}).on("end",function(){b.streamInfo.crc32!==h.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}r.exports=function(h,g){var y=this;return g=o.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:d.utf8decode}),m.isNode&&m.isStream(h)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",h,!0,g.optimizedBinaryString,g.base64).then(function(b){var w=new u(g);return w.load(b),w}).then(function(b){var w=[i.Promise.resolve(b)],N=b.files;if(g.checkCRC32)for(var v=0;v<N.length;v++)w.push(p(N[v]));return i.Promise.all(w)}).then(function(b){for(var w=b.shift(),N=w.files,v=0;v<N.length;v++){var k=N[v],A=k.fileNameStr,C=o.resolve(k.fileNameStr);y.file(C,k.decompressed,{binary:!0,optimizedBinaryString:!0,date:k.date,dir:k.dir,comment:k.fileCommentStr.length?k.fileCommentStr:null,unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions,createFolders:g.createFolders}),k.dir||(y.file(C).unsafeOriginalName=A)}return w.zipComment.length&&(y.comment=w.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(s,r,a){var o=s("../utils"),i=s("../stream/GenericWorker");function d(u,f){i.call(this,"Nodejs stream input adapter for "+u),this._upstreamEnded=!1,this._bindStream(f)}o.inherits(d,i),d.prototype._bindStream=function(u){var f=this;(this._stream=u).pause(),u.on("data",function(m){f.push({data:m,meta:{percent:0}})}).on("error",function(m){f.isPaused?this.generatedError=m:f.error(m)}).on("end",function(){f.isPaused?f._upstreamEnded=!0:f.end()})},d.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},d.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=d},{"../stream/GenericWorker":28,"../utils":32}],13:[function(s,r,a){var o=s("readable-stream").Readable;function i(d,u,f){o.call(this,u),this._helper=d;var m=this;d.on("data",function(p,h){m.push(p)||m._helper.pause(),f&&f(h)}).on("error",function(p){m.emit("error",p)}).on("end",function(){m.push(null)})}s("../utils").inherits(i,o),i.prototype._read=function(){this._helper.resume()},r.exports=i},{"../utils":32,"readable-stream":16}],14:[function(s,r,a){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,i);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,i)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var i=new Buffer(o);return i.fill(0),i},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(s,r,a){function o(C,P,D){var B,R=d.getTypeOf(P),U=d.extend(D||{},m);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(C=N(C)),U.createFolders&&(B=w(C))&&v.call(this,B,!0);var Q=R==="string"&&U.binary===!1&&U.base64===!1;D&&D.binary!==void 0||(U.binary=!Q),(P instanceof p&&P.uncompressedSize===0||U.dir||!P||P.length===0)&&(U.base64=!1,U.binary=!0,P="",U.compression="STORE",R="string");var S=null;S=P instanceof p||P instanceof u?P:y.isNode&&y.isStream(P)?new b(C,P):d.prepareContent(C,P,U.binary,U.optimizedBinaryString,U.base64);var G=new h(C,S,U);this.files[C]=G}var i=s("./utf8"),d=s("./utils"),u=s("./stream/GenericWorker"),f=s("./stream/StreamHelper"),m=s("./defaults"),p=s("./compressedObject"),h=s("./zipObject"),g=s("./generate"),y=s("./nodejsUtils"),b=s("./nodejs/NodejsStreamInputAdapter"),w=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var P=C.lastIndexOf("/");return 0<P?C.substring(0,P):""},N=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},v=function(C,P){return P=P!==void 0?P:m.createFolders,C=N(C),this.files[C]||o.call(this,C,null,{dir:!0,createFolders:P}),this.files[C]};function k(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var P,D,B;for(P in this.files)B=this.files[P],(D=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&C(D,B)},filter:function(C){var P=[];return this.forEach(function(D,B){C(D,B)&&P.push(B)}),P},file:function(C,P,D){if(arguments.length!==1)return C=this.root+C,o.call(this,C,P,D),this;if(k(C)){var B=C;return this.filter(function(U,Q){return!Q.dir&&B.test(U)})}var R=this.files[this.root+C];return R&&!R.dir?R:null},folder:function(C){if(!C)return this;if(k(C))return this.filter(function(R,U){return U.dir&&C.test(R)});var P=this.root+C,D=v.call(this,P),B=this.clone();return B.root=D.name,B},remove:function(C){C=this.root+C;var P=this.files[C];if(P||(C.slice(-1)!=="/"&&(C+="/"),P=this.files[C]),P&&!P.dir)delete this.files[C];else for(var D=this.filter(function(R,U){return U.name.slice(0,C.length)===C}),B=0;B<D.length;B++)delete this.files[D[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var P,D={};try{if((D=d.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");d.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var B=D.comment||this.comment||"";P=g.generateWorker(this,D,B)}catch(R){(P=new u("error")).error(R)}return new f(P,D.type||"string",D.mimeType)},generateAsync:function(C,P){return this.generateInternalStream(C).accumulate(P)},generateNodeStream:function(C,P){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(P)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(s,r,a){r.exports=s("stream")},{stream:void 0}],17:[function(s,r,a){var o=s("./DataReader");function i(d){o.call(this,d);for(var u=0;u<this.data.length;u++)d[u]=255&d[u]}s("../utils").inherits(i,o),i.prototype.byteAt=function(d){return this.data[this.zero+d]},i.prototype.lastIndexOfSignature=function(d){for(var u=d.charCodeAt(0),f=d.charCodeAt(1),m=d.charCodeAt(2),p=d.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===u&&this.data[h+1]===f&&this.data[h+2]===m&&this.data[h+3]===p)return h-this.zero;return-1},i.prototype.readAndCheckSignature=function(d){var u=d.charCodeAt(0),f=d.charCodeAt(1),m=d.charCodeAt(2),p=d.charCodeAt(3),h=this.readData(4);return u===h[0]&&f===h[1]&&m===h[2]&&p===h[3]},i.prototype.readData=function(d){if(this.checkOffset(d),d===0)return[];var u=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,u},r.exports=i},{"../utils":32,"./DataReader":18}],18:[function(s,r,a){var o=s("../utils");function i(d){this.data=d,this.length=d.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(d){this.checkIndex(this.index+d)},checkIndex:function(d){if(this.length<this.zero+d||d<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+d+"). Corrupted zip ?")},setIndex:function(d){this.checkIndex(d),this.index=d},skip:function(d){this.setIndex(this.index+d)},byteAt:function(){},readInt:function(d){var u,f=0;for(this.checkOffset(d),u=this.index+d-1;u>=this.index;u--)f=(f<<8)+this.byteAt(u);return this.index+=d,f},readString:function(d){return o.transformTo("string",this.readData(d))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var d=this.readInt(4);return new Date(Date.UTC(1980+(d>>25&127),(d>>21&15)-1,d>>16&31,d>>11&31,d>>5&63,(31&d)<<1))}},r.exports=i},{"../utils":32}],19:[function(s,r,a){var o=s("./Uint8ArrayReader");function i(d){o.call(this,d)}s("../utils").inherits(i,o),i.prototype.readData=function(d){this.checkOffset(d);var u=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,u},r.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(s,r,a){var o=s("./DataReader");function i(d){o.call(this,d)}s("../utils").inherits(i,o),i.prototype.byteAt=function(d){return this.data.charCodeAt(this.zero+d)},i.prototype.lastIndexOfSignature=function(d){return this.data.lastIndexOf(d)-this.zero},i.prototype.readAndCheckSignature=function(d){return d===this.readData(4)},i.prototype.readData=function(d){this.checkOffset(d);var u=this.data.slice(this.zero+this.index,this.zero+this.index+d);return this.index+=d,u},r.exports=i},{"../utils":32,"./DataReader":18}],21:[function(s,r,a){var o=s("./ArrayReader");function i(d){o.call(this,d)}s("../utils").inherits(i,o),i.prototype.readData=function(d){if(this.checkOffset(d),d===0)return new Uint8Array(0);var u=this.data.subarray(this.zero+this.index,this.zero+this.index+d);return this.index+=d,u},r.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(s,r,a){var o=s("../utils"),i=s("../support"),d=s("./ArrayReader"),u=s("./StringReader"),f=s("./NodeBufferReader"),m=s("./Uint8ArrayReader");r.exports=function(p){var h=o.getTypeOf(p);return o.checkSupport(h),h!=="string"||i.uint8array?h==="nodebuffer"?new f(p):i.uint8array?new m(o.transformTo("uint8array",p)):new d(o.transformTo("array",p)):new u(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(s,r,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(s,r,a){var o=s("./GenericWorker"),i=s("../utils");function d(u){o.call(this,"ConvertWorker to "+u),this.destType=u}i.inherits(d,o),d.prototype.processChunk=function(u){this.push({data:i.transformTo(this.destType,u.data),meta:u.meta})},r.exports=d},{"../utils":32,"./GenericWorker":28}],25:[function(s,r,a){var o=s("./GenericWorker"),i=s("../crc32");function d(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}s("../utils").inherits(d,o),d.prototype.processChunk=function(u){this.streamInfo.crc32=i(u.data,this.streamInfo.crc32||0),this.push(u)},r.exports=d},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(s,r,a){var o=s("../utils"),i=s("./GenericWorker");function d(u){i.call(this,"DataLengthProbe for "+u),this.propName=u,this.withStreamInfo(u,0)}o.inherits(d,i),d.prototype.processChunk=function(u){if(u){var f=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=f+u.data.length}i.prototype.processChunk.call(this,u)},r.exports=d},{"../utils":32,"./GenericWorker":28}],27:[function(s,r,a){var o=s("../utils"),i=s("./GenericWorker");function d(u){i.call(this,"DataWorker");var f=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,u.then(function(m){f.dataIsReady=!0,f.data=m,f.max=m&&m.length||0,f.type=o.getTypeOf(m),f.isPaused||f._tickAndRepeat()},function(m){f.error(m)})}o.inherits(d,i),d.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},d.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},d.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var u=null,f=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":u=this.data.substring(this.index,f);break;case"uint8array":u=this.data.subarray(this.index,f);break;case"array":case"nodebuffer":u=this.data.slice(this.index,f)}return this.index=f,this.push({data:u,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=d},{"../utils":32,"./GenericWorker":28}],28:[function(s,r,a){function o(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,d){return this._listeners[i].push(d),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,d){if(this._listeners[i])for(var u=0;u<this._listeners[i].length;u++)this._listeners[i][u].call(this,d)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var d=this;return i.on("data",function(u){d.processChunk(u)}),i.on("end",function(){d.end()}),i.on("error",function(u){d.error(u)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,d){return this.extraStreamInfo[i]=d,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},r.exports=o},{}],29:[function(s,r,a){var o=s("../utils"),i=s("./ConvertWorker"),d=s("./GenericWorker"),u=s("../base64"),f=s("../support"),m=s("../external"),p=null;if(f.nodestream)try{p=s("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(y,b){return new m.Promise(function(w,N){var v=[],k=y._internalType,A=y._outputType,C=y._mimeType;y.on("data",function(P,D){v.push(P),b&&b(D)}).on("error",function(P){v=[],N(P)}).on("end",function(){try{var P=(function(D,B,R){switch(D){case"blob":return o.newBlob(o.transformTo("arraybuffer",B),R);case"base64":return u.encode(B);default:return o.transformTo(D,B)}})(A,(function(D,B){var R,U=0,Q=null,S=0;for(R=0;R<B.length;R++)S+=B[R].length;switch(D){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Q=new Uint8Array(S),R=0;R<B.length;R++)Q.set(B[R],U),U+=B[R].length;return Q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+D+"'")}})(k,v),C);w(P)}catch(D){N(D)}v=[]}).resume()})}function g(y,b,w){var N=b;switch(b){case"blob":case"arraybuffer":N="uint8array";break;case"base64":N="string"}try{this._internalType=N,this._outputType=b,this._mimeType=w,o.checkSupport(N),this._worker=y.pipe(new i(N)),y.lock()}catch(v){this._worker=new d("error"),this._worker.error(v)}}g.prototype={accumulate:function(y){return h(this,y)},on:function(y,b){var w=this;return y==="data"?this._worker.on(y,function(N){b.call(w,N.data,N.meta)}):this._worker.on(y,function(){o.delay(b,arguments,w)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},y)}},r.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(s,r,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var o=new ArrayBuffer(0);try{a.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(o),a.blob=i.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!s("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(s,r,a){for(var o=s("./utils"),i=s("./support"),d=s("./nodejsUtils"),u=s("./stream/GenericWorker"),f=new Array(256),m=0;m<256;m++)f[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;f[254]=f[254]=1;function p(){u.call(this,"utf-8 decode"),this.leftOver=null}function h(){u.call(this,"utf-8 encode")}a.utf8encode=function(g){return i.nodebuffer?d.newBufferFrom(g,"utf-8"):(function(y){var b,w,N,v,k,A=y.length,C=0;for(v=0;v<A;v++)(64512&(w=y.charCodeAt(v)))==55296&&v+1<A&&(64512&(N=y.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(N-56320),v++),C+=w<128?1:w<2048?2:w<65536?3:4;for(b=i.uint8array?new Uint8Array(C):new Array(C),v=k=0;k<C;v++)(64512&(w=y.charCodeAt(v)))==55296&&v+1<A&&(64512&(N=y.charCodeAt(v+1)))==56320&&(w=65536+(w-55296<<10)+(N-56320),v++),w<128?b[k++]=w:(w<2048?b[k++]=192|w>>>6:(w<65536?b[k++]=224|w>>>12:(b[k++]=240|w>>>18,b[k++]=128|w>>>12&63),b[k++]=128|w>>>6&63),b[k++]=128|63&w);return b})(g)},a.utf8decode=function(g){return i.nodebuffer?o.transformTo("nodebuffer",g).toString("utf-8"):(function(y){var b,w,N,v,k=y.length,A=new Array(2*k);for(b=w=0;b<k;)if((N=y[b++])<128)A[w++]=N;else if(4<(v=f[N]))A[w++]=65533,b+=v-1;else{for(N&=v===2?31:v===3?15:7;1<v&&b<k;)N=N<<6|63&y[b++],v--;1<v?A[w++]=65533:N<65536?A[w++]=N:(N-=65536,A[w++]=55296|N>>10&1023,A[w++]=56320|1023&N)}return A.length!==w&&(A.subarray?A=A.subarray(0,w):A.length=w),o.applyFromCharCode(A)})(g=o.transformTo(i.uint8array?"uint8array":"array",g))},o.inherits(p,u),p.prototype.processChunk=function(g){var y=o.transformTo(i.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var b=y;(y=new Uint8Array(b.length+this.leftOver.length)).set(this.leftOver,0),y.set(b,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var w=(function(v,k){var A;for((k=k||v.length)>v.length&&(k=v.length),A=k-1;0<=A&&(192&v[A])==128;)A--;return A<0||A===0?k:A+f[v[A]]>k?A:k})(y),N=y;w!==y.length&&(i.uint8array?(N=y.subarray(0,w),this.leftOver=y.subarray(w,y.length)):(N=y.slice(0,w),this.leftOver=y.slice(w,y.length))),this.push({data:a.utf8decode(N),meta:g.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=p,o.inherits(h,u),h.prototype.processChunk=function(g){this.push({data:a.utf8encode(g.data),meta:g.meta})},a.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(s,r,a){var o=s("./support"),i=s("./base64"),d=s("./nodejsUtils"),u=s("./external");function f(b){return b}function m(b,w){for(var N=0;N<b.length;++N)w[N]=255&b.charCodeAt(N);return w}s("setimmediate"),a.newBlob=function(b,w){a.checkSupport("blob");try{return new Blob([b],{type:w})}catch{try{var N=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return N.append(b),N.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(b,w,N){var v=[],k=0,A=b.length;if(A<=N)return String.fromCharCode.apply(null,b);for(;k<A;)w==="array"||w==="nodebuffer"?v.push(String.fromCharCode.apply(null,b.slice(k,Math.min(k+N,A)))):v.push(String.fromCharCode.apply(null,b.subarray(k,Math.min(k+N,A)))),k+=N;return v.join("")},stringifyByChar:function(b){for(var w="",N=0;N<b.length;N++)w+=String.fromCharCode(b[N]);return w},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,d.allocBuffer(1)).length===1}catch{return!1}})()}};function h(b){var w=65536,N=a.getTypeOf(b),v=!0;if(N==="uint8array"?v=p.applyCanBeUsed.uint8array:N==="nodebuffer"&&(v=p.applyCanBeUsed.nodebuffer),v)for(;1<w;)try{return p.stringifyByChunk(b,N,w)}catch{w=Math.floor(w/2)}return p.stringifyByChar(b)}function g(b,w){for(var N=0;N<b.length;N++)w[N]=b[N];return w}a.applyFromCharCode=h;var y={};y.string={string:f,array:function(b){return m(b,new Array(b.length))},arraybuffer:function(b){return y.string.uint8array(b).buffer},uint8array:function(b){return m(b,new Uint8Array(b.length))},nodebuffer:function(b){return m(b,d.allocBuffer(b.length))}},y.array={string:h,array:f,arraybuffer:function(b){return new Uint8Array(b).buffer},uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return d.newBufferFrom(b)}},y.arraybuffer={string:function(b){return h(new Uint8Array(b))},array:function(b){return g(new Uint8Array(b),new Array(b.byteLength))},arraybuffer:f,uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return d.newBufferFrom(new Uint8Array(b))}},y.uint8array={string:h,array:function(b){return g(b,new Array(b.length))},arraybuffer:function(b){return b.buffer},uint8array:f,nodebuffer:function(b){return d.newBufferFrom(b)}},y.nodebuffer={string:h,array:function(b){return g(b,new Array(b.length))},arraybuffer:function(b){return y.nodebuffer.uint8array(b).buffer},uint8array:function(b){return g(b,new Uint8Array(b.length))},nodebuffer:f},a.transformTo=function(b,w){if(w=w||"",!b)return w;a.checkSupport(b);var N=a.getTypeOf(w);return y[N][b](w)},a.resolve=function(b){for(var w=b.split("/"),N=[],v=0;v<w.length;v++){var k=w[v];k==="."||k===""&&v!==0&&v!==w.length-1||(k===".."?N.pop():N.push(k))}return N.join("/")},a.getTypeOf=function(b){return typeof b=="string"?"string":Object.prototype.toString.call(b)==="[object Array]"?"array":o.nodebuffer&&d.isBuffer(b)?"nodebuffer":o.uint8array&&b instanceof Uint8Array?"uint8array":o.arraybuffer&&b instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(b){if(!o[b.toLowerCase()])throw new Error(b+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(b){var w,N,v="";for(N=0;N<(b||"").length;N++)v+="\\x"+((w=b.charCodeAt(N))<16?"0":"")+w.toString(16).toUpperCase();return v},a.delay=function(b,w,N){setImmediate(function(){b.apply(N||null,w||[])})},a.inherits=function(b,w){function N(){}N.prototype=w.prototype,b.prototype=new N},a.extend=function(){var b,w,N={};for(b=0;b<arguments.length;b++)for(w in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],w)&&N[w]===void 0&&(N[w]=arguments[b][w]);return N},a.prepareContent=function(b,w,N,v,k){return u.Promise.resolve(w).then(function(A){return o.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new u.Promise(function(C,P){var D=new FileReader;D.onload=function(B){C(B.target.result)},D.onerror=function(B){P(B.target.error)},D.readAsArrayBuffer(A)}):A}).then(function(A){var C=a.getTypeOf(A);return C?(C==="arraybuffer"?A=a.transformTo("uint8array",A):C==="string"&&(k?A=i.decode(A):N&&v!==!0&&(A=(function(P){return m(P,o.uint8array?new Uint8Array(P.length):new Array(P.length))})(A))),A):u.Promise.reject(new Error("Can't read the data of '"+b+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(s,r,a){var o=s("./reader/readerFor"),i=s("./utils"),d=s("./signature"),u=s("./zipEntry"),f=s("./support");function m(p){this.files=[],this.loadOptions=p}m.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(h)+", expected "+i.pretty(p)+")")}},isSignature:function(p,h){var g=this.reader.index;this.reader.setIndex(p);var y=this.reader.readString(4)===h;return this.reader.setIndex(g),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),h=f.uint8array?"uint8array":"array",g=i.transformTo(h,p);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,h,g,y=this.zip64EndOfCentralSize-44;0<y;)p=this.reader.readInt(2),h=this.reader.readInt(4),g=this.reader.readData(h),this.zip64ExtensibleData[p]={id:p,length:h,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,h;for(p=0;p<this.files.length;p++)h=this.files[p],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(d.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(d.CENTRAL_FILE_HEADER);)(p=new u({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(d.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,d.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var h=p;if(this.checkSignature(d.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,d.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(d.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var y=h-g;if(0<y)this.isSignature(h,d.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(p){this.reader=o(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=m},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(s,r,a){var o=s("./reader/readerFor"),i=s("./utils"),d=s("./compressedObject"),u=s("./crc32"),f=s("./utf8"),m=s("./compressions"),p=s("./support");function h(g,y){this.options=g,this.loadOptions=y}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var y,b;if(g.skip(22),this.fileNameLength=g.readInt(2),b=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(b),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=(function(w){for(var N in m)if(Object.prototype.hasOwnProperty.call(m,N)&&m[N].magic===w)return m[N];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new d(this.compressedSize,this.uncompressedSize,this.crc32,y,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var y=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(y),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=o(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var y,b,w,N=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<N;)y=g.readInt(2),b=g.readInt(2),w=g.readData(b),this.extraFields[y]={id:y,length:b,value:w};g.setIndex(N)},handleUTF8:function(){var g=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=f.utf8decode(this.fileName),this.fileCommentStr=f.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var b=i.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(b)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var N=i.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(N)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var y=o(g.value);return y.readInt(1)!==1||u(this.fileName)!==y.readInt(4)?null:f.utf8decode(y.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var y=o(g.value);return y.readInt(1)!==1||u(this.fileComment)!==y.readInt(4)?null:f.utf8decode(y.readData(g.length-5))}return null}},r.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(s,r,a){function o(y,b,w){this.name=y,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=b,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var i=s("./stream/StreamHelper"),d=s("./stream/DataWorker"),u=s("./utf8"),f=s("./compressedObject"),m=s("./stream/GenericWorker");o.prototype={internalStream:function(y){var b=null,w="string";try{if(!y)throw new Error("No output type specified.");var N=(w=y.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),b=this._decompressWorker();var v=!this._dataBinary;v&&!N&&(b=b.pipe(new u.Utf8EncodeWorker)),!v&&N&&(b=b.pipe(new u.Utf8DecodeWorker))}catch(k){(b=new m("error")).error(k)}return new i(b,w,"")},async:function(y,b){return this.internalStream(y).accumulate(b)},nodeStream:function(y,b){return this.internalStream(y||"nodebuffer").toNodejsStream(b)},_compressWorker:function(y,b){if(this._data instanceof f&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new u.Utf8EncodeWorker)),f.createWorkerFrom(w,y,b)},_decompressWorker:function(){return this._data instanceof f?this._data.getContentWorker():this._data instanceof m?this._data:new d(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<p.length;g++)o.prototype[p[g]]=h;r.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(s,r,a){(function(o){var i,d,u=o.MutationObserver||o.WebKitMutationObserver;if(u){var f=0,m=new u(y),p=o.document.createTextNode("");m.observe(p,{characterData:!0}),i=function(){p.data=f=++f%2}}else if(o.setImmediate||o.MessageChannel===void 0)i="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var b=o.document.createElement("script");b.onreadystatechange=function(){y(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},o.document.documentElement.appendChild(b)}:function(){setTimeout(y,0)};else{var h=new o.MessageChannel;h.port1.onmessage=y,i=function(){h.port2.postMessage(0)}}var g=[];function y(){var b,w;d=!0;for(var N=g.length;N;){for(w=g,g=[],b=-1;++b<N;)w[b]();N=g.length}d=!1}r.exports=function(b){g.push(b)!==1||d||i()}}).call(this,typeof Is<"u"?Is:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(s,r,a){var o=s("immediate");function i(){}var d={},u=["REJECTED"],f=["FULFILLED"],m=["PENDING"];function p(N){if(typeof N!="function")throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,N!==i&&b(this,N)}function h(N,v,k){this.promise=N,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}function g(N,v,k){o(function(){var A;try{A=v(k)}catch(C){return d.reject(N,C)}A===N?d.reject(N,new TypeError("Cannot resolve promise with itself")):d.resolve(N,A)})}function y(N){var v=N&&N.then;if(N&&(typeof N=="object"||typeof N=="function")&&typeof v=="function")return function(){v.apply(N,arguments)}}function b(N,v){var k=!1;function A(D){k||(k=!0,d.reject(N,D))}function C(D){k||(k=!0,d.resolve(N,D))}var P=w(function(){v(C,A)});P.status==="error"&&A(P.value)}function w(N,v){var k={};try{k.value=N(v),k.status="success"}catch(A){k.status="error",k.value=A}return k}(r.exports=p).prototype.finally=function(N){if(typeof N!="function")return this;var v=this.constructor;return this.then(function(k){return v.resolve(N()).then(function(){return k})},function(k){return v.resolve(N()).then(function(){throw k})})},p.prototype.catch=function(N){return this.then(null,N)},p.prototype.then=function(N,v){if(typeof N!="function"&&this.state===f||typeof v!="function"&&this.state===u)return this;var k=new this.constructor(i);return this.state!==m?g(k,this.state===f?N:v,this.outcome):this.queue.push(new h(k,N,v)),k},h.prototype.callFulfilled=function(N){d.resolve(this.promise,N)},h.prototype.otherCallFulfilled=function(N){g(this.promise,this.onFulfilled,N)},h.prototype.callRejected=function(N){d.reject(this.promise,N)},h.prototype.otherCallRejected=function(N){g(this.promise,this.onRejected,N)},d.resolve=function(N,v){var k=w(y,v);if(k.status==="error")return d.reject(N,k.value);var A=k.value;if(A)b(N,A);else{N.state=f,N.outcome=v;for(var C=-1,P=N.queue.length;++C<P;)N.queue[C].callFulfilled(v)}return N},d.reject=function(N,v){N.state=u,N.outcome=v;for(var k=-1,A=N.queue.length;++k<A;)N.queue[k].callRejected(v);return N},p.resolve=function(N){return N instanceof this?N:d.resolve(new this(i),N)},p.reject=function(N){var v=new this(i);return d.reject(v,N)},p.all=function(N){var v=this;if(Object.prototype.toString.call(N)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=N.length,A=!1;if(!k)return this.resolve([]);for(var C=new Array(k),P=0,D=-1,B=new this(i);++D<k;)R(N[D],D);return B;function R(U,Q){v.resolve(U).then(function(S){C[Q]=S,++P!==k||A||(A=!0,d.resolve(B,C))},function(S){A||(A=!0,d.reject(B,S))})}},p.race=function(N){var v=this;if(Object.prototype.toString.call(N)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=N.length,A=!1;if(!k)return this.resolve([]);for(var C=-1,P=new this(i);++C<k;)D=N[C],v.resolve(D).then(function(B){A||(A=!0,d.resolve(P,B))},function(B){A||(A=!0,d.reject(P,B))});var D;return P}},{immediate:36}],38:[function(s,r,a){var o={};(0,s("./lib/utils/common").assign)(o,s("./lib/deflate"),s("./lib/inflate"),s("./lib/zlib/constants")),r.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(s,r,a){var o=s("./zlib/deflate"),i=s("./utils/common"),d=s("./utils/strings"),u=s("./zlib/messages"),f=s("./zlib/zstream"),m=Object.prototype.toString,p=0,h=-1,g=0,y=8;function b(N){if(!(this instanceof b))return new b(N);this.options=i.assign({level:h,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},N||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var k=o.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(k!==p)throw new Error(u[k]);if(v.header&&o.deflateSetHeader(this.strm,v.header),v.dictionary){var A;if(A=typeof v.dictionary=="string"?d.string2buf(v.dictionary):m.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(k=o.deflateSetDictionary(this.strm,A))!==p)throw new Error(u[k]);this._dict_set=!0}}function w(N,v){var k=new b(v);if(k.push(N,!0),k.err)throw k.msg||u[k.err];return k.result}b.prototype.push=function(N,v){var k,A,C=this.strm,P=this.options.chunkSize;if(this.ended)return!1;A=v===~~v?v:v===!0?4:0,typeof N=="string"?C.input=d.string2buf(N):m.call(N)==="[object ArrayBuffer]"?C.input=new Uint8Array(N):C.input=N,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new i.Buf8(P),C.next_out=0,C.avail_out=P),(k=o.deflate(C,A))!==1&&k!==p)return this.onEnd(k),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(d.buf2binstring(i.shrinkBuf(C.output,C.next_out))):this.onData(i.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&k!==1);return A===4?(k=o.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===p):A!==2||(this.onEnd(p),!(C.avail_out=0))},b.prototype.onData=function(N){this.chunks.push(N)},b.prototype.onEnd=function(N){N===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=N,this.msg=this.strm.msg},a.Deflate=b,a.deflate=w,a.deflateRaw=function(N,v){return(v=v||{}).raw=!0,w(N,v)},a.gzip=function(N,v){return(v=v||{}).gzip=!0,w(N,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(s,r,a){var o=s("./zlib/inflate"),i=s("./utils/common"),d=s("./utils/strings"),u=s("./zlib/constants"),f=s("./zlib/messages"),m=s("./zlib/zstream"),p=s("./zlib/gzheader"),h=Object.prototype.toString;function g(b){if(!(this instanceof g))return new g(b);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},b||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||b&&b.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var N=o.inflateInit2(this.strm,w.windowBits);if(N!==u.Z_OK)throw new Error(f[N]);this.header=new p,o.inflateGetHeader(this.strm,this.header)}function y(b,w){var N=new g(w);if(N.push(b,!0),N.err)throw N.msg||f[N.err];return N.result}g.prototype.push=function(b,w){var N,v,k,A,C,P,D=this.strm,B=this.options.chunkSize,R=this.options.dictionary,U=!1;if(this.ended)return!1;v=w===~~w?w:w===!0?u.Z_FINISH:u.Z_NO_FLUSH,typeof b=="string"?D.input=d.binstring2buf(b):h.call(b)==="[object ArrayBuffer]"?D.input=new Uint8Array(b):D.input=b,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new i.Buf8(B),D.next_out=0,D.avail_out=B),(N=o.inflate(D,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&R&&(P=typeof R=="string"?d.string2buf(R):h.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,N=o.inflateSetDictionary(this.strm,P)),N===u.Z_BUF_ERROR&&U===!0&&(N=u.Z_OK,U=!1),N!==u.Z_STREAM_END&&N!==u.Z_OK)return this.onEnd(N),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&N!==u.Z_STREAM_END&&(D.avail_in!==0||v!==u.Z_FINISH&&v!==u.Z_SYNC_FLUSH)||(this.options.to==="string"?(k=d.utf8border(D.output,D.next_out),A=D.next_out-k,C=d.buf2string(D.output,k),D.next_out=A,D.avail_out=B-A,A&&i.arraySet(D.output,D.output,k,A,0),this.onData(C)):this.onData(i.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&(U=!0)}while((0<D.avail_in||D.avail_out===0)&&N!==u.Z_STREAM_END);return N===u.Z_STREAM_END&&(v=u.Z_FINISH),v===u.Z_FINISH?(N=o.inflateEnd(this.strm),this.onEnd(N),this.ended=!0,N===u.Z_OK):v!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),!(D.avail_out=0))},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===u.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Inflate=g,a.inflate=y,a.inflateRaw=function(b,w){return(w=w||{}).raw=!0,y(b,w)},a.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(s,r,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(u){for(var f=Array.prototype.slice.call(arguments,1);f.length;){var m=f.shift();if(m){if(typeof m!="object")throw new TypeError(m+"must be non-object");for(var p in m)m.hasOwnProperty(p)&&(u[p]=m[p])}}return u},a.shrinkBuf=function(u,f){return u.length===f?u:u.subarray?u.subarray(0,f):(u.length=f,u)};var i={arraySet:function(u,f,m,p,h){if(f.subarray&&u.subarray)u.set(f.subarray(m,m+p),h);else for(var g=0;g<p;g++)u[h+g]=f[m+g]},flattenChunks:function(u){var f,m,p,h,g,y;for(f=p=0,m=u.length;f<m;f++)p+=u[f].length;for(y=new Uint8Array(p),f=h=0,m=u.length;f<m;f++)g=u[f],y.set(g,h),h+=g.length;return y}},d={arraySet:function(u,f,m,p,h){for(var g=0;g<p;g++)u[h+g]=f[m+g]},flattenChunks:function(u){return[].concat.apply([],u)}};a.setTyped=function(u){u?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,i)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,d))},a.setTyped(o)},{}],42:[function(s,r,a){var o=s("./common"),i=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var u=new o.Buf8(256),f=0;f<256;f++)u[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;function m(p,h){if(h<65537&&(p.subarray&&d||!p.subarray&&i))return String.fromCharCode.apply(null,o.shrinkBuf(p,h));for(var g="",y=0;y<h;y++)g+=String.fromCharCode(p[y]);return g}u[254]=u[254]=1,a.string2buf=function(p){var h,g,y,b,w,N=p.length,v=0;for(b=0;b<N;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<N&&(64512&(y=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),v+=g<128?1:g<2048?2:g<65536?3:4;for(h=new o.Buf8(v),b=w=0;w<v;b++)(64512&(g=p.charCodeAt(b)))==55296&&b+1<N&&(64512&(y=p.charCodeAt(b+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),b++),g<128?h[w++]=g:(g<2048?h[w++]=192|g>>>6:(g<65536?h[w++]=224|g>>>12:(h[w++]=240|g>>>18,h[w++]=128|g>>>12&63),h[w++]=128|g>>>6&63),h[w++]=128|63&g);return h},a.buf2binstring=function(p){return m(p,p.length)},a.binstring2buf=function(p){for(var h=new o.Buf8(p.length),g=0,y=h.length;g<y;g++)h[g]=p.charCodeAt(g);return h},a.buf2string=function(p,h){var g,y,b,w,N=h||p.length,v=new Array(2*N);for(g=y=0;g<N;)if((b=p[g++])<128)v[y++]=b;else if(4<(w=u[b]))v[y++]=65533,g+=w-1;else{for(b&=w===2?31:w===3?15:7;1<w&&g<N;)b=b<<6|63&p[g++],w--;1<w?v[y++]=65533:b<65536?v[y++]=b:(b-=65536,v[y++]=55296|b>>10&1023,v[y++]=56320|1023&b)}return m(v,y)},a.utf8border=function(p,h){var g;for((h=h||p.length)>p.length&&(h=p.length),g=h-1;0<=g&&(192&p[g])==128;)g--;return g<0||g===0?h:g+u[p[g]]>h?g:h}},{"./common":41}],43:[function(s,r,a){r.exports=function(o,i,d,u){for(var f=65535&o|0,m=o>>>16&65535|0,p=0;d!==0;){for(d-=p=2e3<d?2e3:d;m=m+(f=f+i[u++]|0)|0,--p;);f%=65521,m%=65521}return f|m<<16|0}},{}],44:[function(s,r,a){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(s,r,a){var o=(function(){for(var i,d=[],u=0;u<256;u++){i=u;for(var f=0;f<8;f++)i=1&i?3988292384^i>>>1:i>>>1;d[u]=i}return d})();r.exports=function(i,d,u,f){var m=o,p=f+u;i^=-1;for(var h=f;h<p;h++)i=i>>>8^m[255&(i^d[h])];return-1^i}},{}],46:[function(s,r,a){var o,i=s("../utils/common"),d=s("./trees"),u=s("./adler32"),f=s("./crc32"),m=s("./messages"),p=0,h=4,g=0,y=-2,b=-1,w=4,N=2,v=8,k=9,A=286,C=30,P=19,D=2*A+1,B=15,R=3,U=258,Q=U+R+1,S=42,G=113,_=1,J=2,ae=3,Y=4;function te(x,K){return x.msg=m[K],K}function H(x){return(x<<1)-(4<x?9:0)}function ce(x){for(var K=x.length;0<=--K;)x[K]=0}function j(x){var K=x.state,W=K.pending;W>x.avail_out&&(W=x.avail_out),W!==0&&(i.arraySet(x.output,K.pending_buf,K.pending_out,W,x.next_out),x.next_out+=W,K.pending_out+=W,x.total_out+=W,x.avail_out-=W,K.pending-=W,K.pending===0&&(K.pending_out=0))}function M(x,K){d._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,K),x.block_start=x.strstart,j(x.strm)}function ie(x,K){x.pending_buf[x.pending++]=K}function $(x,K){x.pending_buf[x.pending++]=K>>>8&255,x.pending_buf[x.pending++]=255&K}function F(x,K){var W,I,E=x.max_chain_length,q=x.strstart,se=x.prev_length,re=x.nice_match,O=x.strstart>x.w_size-Q?x.strstart-(x.w_size-Q):0,oe=x.window,he=x.w_mask,de=x.prev,xe=x.strstart+U,V=oe[q+se-1],pe=oe[q+se];x.prev_length>=x.good_match&&(E>>=2),re>x.lookahead&&(re=x.lookahead);do if(oe[(W=K)+se]===pe&&oe[W+se-1]===V&&oe[W]===oe[q]&&oe[++W]===oe[q+1]){q+=2,W++;do;while(oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&oe[++q]===oe[++W]&&q<xe);if(I=U-(xe-q),q=xe-U,se<I){if(x.match_start=K,re<=(se=I))break;V=oe[q+se-1],pe=oe[q+se]}}while((K=de[K&he])>O&&--E!=0);return se<=x.lookahead?se:x.lookahead}function ue(x){var K,W,I,E,q,se,re,O,oe,he,de=x.w_size;do{if(E=x.window_size-x.lookahead-x.strstart,x.strstart>=de+(de-Q)){for(i.arraySet(x.window,x.window,de,de,0),x.match_start-=de,x.strstart-=de,x.block_start-=de,K=W=x.hash_size;I=x.head[--K],x.head[K]=de<=I?I-de:0,--W;);for(K=W=de;I=x.prev[--K],x.prev[K]=de<=I?I-de:0,--W;);E+=de}if(x.strm.avail_in===0)break;if(se=x.strm,re=x.window,O=x.strstart+x.lookahead,oe=E,he=void 0,he=se.avail_in,oe<he&&(he=oe),W=he===0?0:(se.avail_in-=he,i.arraySet(re,se.input,se.next_in,he,O),se.state.wrap===1?se.adler=u(se.adler,re,he,O):se.state.wrap===2&&(se.adler=f(se.adler,re,he,O)),se.next_in+=he,se.total_in+=he,he),x.lookahead+=W,x.lookahead+x.insert>=R)for(q=x.strstart-x.insert,x.ins_h=x.window[q],x.ins_h=(x.ins_h<<x.hash_shift^x.window[q+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[q+R-1])&x.hash_mask,x.prev[q&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=q,q++,x.insert--,!(x.lookahead+x.insert<R)););}while(x.lookahead<Q&&x.strm.avail_in!==0)}function Z(x,K){for(var W,I;;){if(x.lookahead<Q){if(ue(x),x.lookahead<Q&&K===p)return _;if(x.lookahead===0)break}if(W=0,x.lookahead>=R&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+R-1])&x.hash_mask,W=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),W!==0&&x.strstart-W<=x.w_size-Q&&(x.match_length=F(x,W)),x.match_length>=R)if(I=d._tr_tally(x,x.strstart-x.match_start,x.match_length-R),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=R){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+R-1])&x.hash_mask,W=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else I=d._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(I&&(M(x,!1),x.strm.avail_out===0))return _}return x.insert=x.strstart<R-1?x.strstart:R-1,K===h?(M(x,!0),x.strm.avail_out===0?ae:Y):x.last_lit&&(M(x,!1),x.strm.avail_out===0)?_:J}function X(x,K){for(var W,I,E;;){if(x.lookahead<Q){if(ue(x),x.lookahead<Q&&K===p)return _;if(x.lookahead===0)break}if(W=0,x.lookahead>=R&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+R-1])&x.hash_mask,W=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=R-1,W!==0&&x.prev_length<x.max_lazy_match&&x.strstart-W<=x.w_size-Q&&(x.match_length=F(x,W),x.match_length<=5&&(x.strategy===1||x.match_length===R&&4096<x.strstart-x.match_start)&&(x.match_length=R-1)),x.prev_length>=R&&x.match_length<=x.prev_length){for(E=x.strstart+x.lookahead-R,I=d._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-R),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=E&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+R-1])&x.hash_mask,W=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=R-1,x.strstart++,I&&(M(x,!1),x.strm.avail_out===0))return _}else if(x.match_available){if((I=d._tr_tally(x,0,x.window[x.strstart-1]))&&M(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return _}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(I=d._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<R-1?x.strstart:R-1,K===h?(M(x,!0),x.strm.avail_out===0?ae:Y):x.last_lit&&(M(x,!1),x.strm.avail_out===0)?_:J}function me(x,K,W,I,E){this.good_length=x,this.max_lazy=K,this.nice_length=W,this.max_chain=I,this.func=E}function ye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*D),this.dyn_dtree=new i.Buf16(2*(2*C+1)),this.bl_tree=new i.Buf16(2*(2*P+1)),ce(this.dyn_ltree),ce(this.dyn_dtree),ce(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(B+1),this.heap=new i.Buf16(2*A+1),ce(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*A+1),ce(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function be(x){var K;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=N,(K=x.state).pending=0,K.pending_out=0,K.wrap<0&&(K.wrap=-K.wrap),K.status=K.wrap?S:G,x.adler=K.wrap===2?0:1,K.last_flush=p,d._tr_init(K),g):te(x,y)}function Ae(x){var K=be(x);return K===g&&(function(W){W.window_size=2*W.w_size,ce(W.head),W.max_lazy_match=o[W.level].max_lazy,W.good_match=o[W.level].good_length,W.nice_match=o[W.level].nice_length,W.max_chain_length=o[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=R-1,W.match_available=0,W.ins_h=0})(x.state),K}function fe(x,K,W,I,E,q){if(!x)return y;var se=1;if(K===b&&(K=6),I<0?(se=0,I=-I):15<I&&(se=2,I-=16),E<1||k<E||W!==v||I<8||15<I||K<0||9<K||q<0||w<q)return te(x,y);I===8&&(I=9);var re=new ye;return(x.state=re).strm=x,re.wrap=se,re.gzhead=null,re.w_bits=I,re.w_size=1<<re.w_bits,re.w_mask=re.w_size-1,re.hash_bits=E+7,re.hash_size=1<<re.hash_bits,re.hash_mask=re.hash_size-1,re.hash_shift=~~((re.hash_bits+R-1)/R),re.window=new i.Buf8(2*re.w_size),re.head=new i.Buf16(re.hash_size),re.prev=new i.Buf16(re.w_size),re.lit_bufsize=1<<E+6,re.pending_buf_size=4*re.lit_bufsize,re.pending_buf=new i.Buf8(re.pending_buf_size),re.d_buf=1*re.lit_bufsize,re.l_buf=3*re.lit_bufsize,re.level=K,re.strategy=q,re.method=W,Ae(x)}o=[new me(0,0,0,0,function(x,K){var W=65535;for(W>x.pending_buf_size-5&&(W=x.pending_buf_size-5);;){if(x.lookahead<=1){if(ue(x),x.lookahead===0&&K===p)return _;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var I=x.block_start+W;if((x.strstart===0||x.strstart>=I)&&(x.lookahead=x.strstart-I,x.strstart=I,M(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-Q&&(M(x,!1),x.strm.avail_out===0))return _}return x.insert=0,K===h?(M(x,!0),x.strm.avail_out===0?ae:Y):(x.strstart>x.block_start&&(M(x,!1),x.strm.avail_out),_)}),new me(4,4,8,4,Z),new me(4,5,16,8,Z),new me(4,6,32,32,Z),new me(4,4,16,16,X),new me(8,16,32,32,X),new me(8,16,128,128,X),new me(8,32,128,256,X),new me(32,128,258,1024,X),new me(32,258,258,4096,X)],a.deflateInit=function(x,K){return fe(x,K,v,15,8,0)},a.deflateInit2=fe,a.deflateReset=Ae,a.deflateResetKeep=be,a.deflateSetHeader=function(x,K){return x&&x.state?x.state.wrap!==2?y:(x.state.gzhead=K,g):y},a.deflate=function(x,K){var W,I,E,q;if(!x||!x.state||5<K||K<0)return x?te(x,y):y;if(I=x.state,!x.output||!x.input&&x.avail_in!==0||I.status===666&&K!==h)return te(x,x.avail_out===0?-5:y);if(I.strm=x,W=I.last_flush,I.last_flush=K,I.status===S)if(I.wrap===2)x.adler=0,ie(I,31),ie(I,139),ie(I,8),I.gzhead?(ie(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),ie(I,255&I.gzhead.time),ie(I,I.gzhead.time>>8&255),ie(I,I.gzhead.time>>16&255),ie(I,I.gzhead.time>>24&255),ie(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ie(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(ie(I,255&I.gzhead.extra.length),ie(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(x.adler=f(x.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(ie(I,0),ie(I,0),ie(I,0),ie(I,0),ie(I,0),ie(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),ie(I,3),I.status=G);else{var se=v+(I.w_bits-8<<4)<<8;se|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(se|=32),se+=31-se%31,I.status=G,$(I,se),I.strstart!==0&&($(I,x.adler>>>16),$(I,65535&x.adler)),x.adler=1}if(I.status===69)if(I.gzhead.extra){for(E=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>E&&(x.adler=f(x.adler,I.pending_buf,I.pending-E,E)),j(x),E=I.pending,I.pending!==I.pending_buf_size));)ie(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>E&&(x.adler=f(x.adler,I.pending_buf,I.pending-E,E)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){E=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>E&&(x.adler=f(x.adler,I.pending_buf,I.pending-E,E)),j(x),E=I.pending,I.pending===I.pending_buf_size)){q=1;break}q=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,ie(I,q)}while(q!==0);I.gzhead.hcrc&&I.pending>E&&(x.adler=f(x.adler,I.pending_buf,I.pending-E,E)),q===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){E=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>E&&(x.adler=f(x.adler,I.pending_buf,I.pending-E,E)),j(x),E=I.pending,I.pending===I.pending_buf_size)){q=1;break}q=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,ie(I,q)}while(q!==0);I.gzhead.hcrc&&I.pending>E&&(x.adler=f(x.adler,I.pending_buf,I.pending-E,E)),q===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&j(x),I.pending+2<=I.pending_buf_size&&(ie(I,255&x.adler),ie(I,x.adler>>8&255),x.adler=0,I.status=G)):I.status=G),I.pending!==0){if(j(x),x.avail_out===0)return I.last_flush=-1,g}else if(x.avail_in===0&&H(K)<=H(W)&&K!==h)return te(x,-5);if(I.status===666&&x.avail_in!==0)return te(x,-5);if(x.avail_in!==0||I.lookahead!==0||K!==p&&I.status!==666){var re=I.strategy===2?(function(O,oe){for(var he;;){if(O.lookahead===0&&(ue(O),O.lookahead===0)){if(oe===p)return _;break}if(O.match_length=0,he=d._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++,he&&(M(O,!1),O.strm.avail_out===0))return _}return O.insert=0,oe===h?(M(O,!0),O.strm.avail_out===0?ae:Y):O.last_lit&&(M(O,!1),O.strm.avail_out===0)?_:J})(I,K):I.strategy===3?(function(O,oe){for(var he,de,xe,V,pe=O.window;;){if(O.lookahead<=U){if(ue(O),O.lookahead<=U&&oe===p)return _;if(O.lookahead===0)break}if(O.match_length=0,O.lookahead>=R&&0<O.strstart&&(de=pe[xe=O.strstart-1])===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]){V=O.strstart+U;do;while(de===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]&&de===pe[++xe]&&xe<V);O.match_length=U-(V-xe),O.match_length>O.lookahead&&(O.match_length=O.lookahead)}if(O.match_length>=R?(he=d._tr_tally(O,1,O.match_length-R),O.lookahead-=O.match_length,O.strstart+=O.match_length,O.match_length=0):(he=d._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++),he&&(M(O,!1),O.strm.avail_out===0))return _}return O.insert=0,oe===h?(M(O,!0),O.strm.avail_out===0?ae:Y):O.last_lit&&(M(O,!1),O.strm.avail_out===0)?_:J})(I,K):o[I.level].func(I,K);if(re!==ae&&re!==Y||(I.status=666),re===_||re===ae)return x.avail_out===0&&(I.last_flush=-1),g;if(re===J&&(K===1?d._tr_align(I):K!==5&&(d._tr_stored_block(I,0,0,!1),K===3&&(ce(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),j(x),x.avail_out===0))return I.last_flush=-1,g}return K!==h?g:I.wrap<=0?1:(I.wrap===2?(ie(I,255&x.adler),ie(I,x.adler>>8&255),ie(I,x.adler>>16&255),ie(I,x.adler>>24&255),ie(I,255&x.total_in),ie(I,x.total_in>>8&255),ie(I,x.total_in>>16&255),ie(I,x.total_in>>24&255)):($(I,x.adler>>>16),$(I,65535&x.adler)),j(x),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?g:1)},a.deflateEnd=function(x){var K;return x&&x.state?(K=x.state.status)!==S&&K!==69&&K!==73&&K!==91&&K!==103&&K!==G&&K!==666?te(x,y):(x.state=null,K===G?te(x,-3):g):y},a.deflateSetDictionary=function(x,K){var W,I,E,q,se,re,O,oe,he=K.length;if(!x||!x.state||(q=(W=x.state).wrap)===2||q===1&&W.status!==S||W.lookahead)return y;for(q===1&&(x.adler=u(x.adler,K,he,0)),W.wrap=0,he>=W.w_size&&(q===0&&(ce(W.head),W.strstart=0,W.block_start=0,W.insert=0),oe=new i.Buf8(W.w_size),i.arraySet(oe,K,he-W.w_size,W.w_size,0),K=oe,he=W.w_size),se=x.avail_in,re=x.next_in,O=x.input,x.avail_in=he,x.next_in=0,x.input=K,ue(W);W.lookahead>=R;){for(I=W.strstart,E=W.lookahead-(R-1);W.ins_h=(W.ins_h<<W.hash_shift^W.window[I+R-1])&W.hash_mask,W.prev[I&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=I,I++,--E;);W.strstart=I,W.lookahead=R-1,ue(W)}return W.strstart+=W.lookahead,W.block_start=W.strstart,W.insert=W.lookahead,W.lookahead=0,W.match_length=W.prev_length=R-1,W.match_available=0,x.next_in=re,x.input=O,x.avail_in=se,W.wrap=q,g},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(s,r,a){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(s,r,a){r.exports=function(o,i){var d,u,f,m,p,h,g,y,b,w,N,v,k,A,C,P,D,B,R,U,Q,S,G,_,J;d=o.state,u=o.next_in,_=o.input,f=u+(o.avail_in-5),m=o.next_out,J=o.output,p=m-(i-o.avail_out),h=m+(o.avail_out-257),g=d.dmax,y=d.wsize,b=d.whave,w=d.wnext,N=d.window,v=d.hold,k=d.bits,A=d.lencode,C=d.distcode,P=(1<<d.lenbits)-1,D=(1<<d.distbits)-1;e:do{k<15&&(v+=_[u++]<<k,k+=8,v+=_[u++]<<k,k+=8),B=A[v&P];t:for(;;){if(v>>>=R=B>>>24,k-=R,(R=B>>>16&255)===0)J[m++]=65535&B;else{if(!(16&R)){if((64&R)==0){B=A[(65535&B)+(v&(1<<R)-1)];continue t}if(32&R){d.mode=12;break e}o.msg="invalid literal/length code",d.mode=30;break e}U=65535&B,(R&=15)&&(k<R&&(v+=_[u++]<<k,k+=8),U+=v&(1<<R)-1,v>>>=R,k-=R),k<15&&(v+=_[u++]<<k,k+=8,v+=_[u++]<<k,k+=8),B=C[v&D];s:for(;;){if(v>>>=R=B>>>24,k-=R,!(16&(R=B>>>16&255))){if((64&R)==0){B=C[(65535&B)+(v&(1<<R)-1)];continue s}o.msg="invalid distance code",d.mode=30;break e}if(Q=65535&B,k<(R&=15)&&(v+=_[u++]<<k,(k+=8)<R&&(v+=_[u++]<<k,k+=8)),g<(Q+=v&(1<<R)-1)){o.msg="invalid distance too far back",d.mode=30;break e}if(v>>>=R,k-=R,(R=m-p)<Q){if(b<(R=Q-R)&&d.sane){o.msg="invalid distance too far back",d.mode=30;break e}if(G=N,(S=0)===w){if(S+=y-R,R<U){for(U-=R;J[m++]=N[S++],--R;);S=m-Q,G=J}}else if(w<R){if(S+=y+w-R,(R-=w)<U){for(U-=R;J[m++]=N[S++],--R;);if(S=0,w<U){for(U-=R=w;J[m++]=N[S++],--R;);S=m-Q,G=J}}}else if(S+=w-R,R<U){for(U-=R;J[m++]=N[S++],--R;);S=m-Q,G=J}for(;2<U;)J[m++]=G[S++],J[m++]=G[S++],J[m++]=G[S++],U-=3;U&&(J[m++]=G[S++],1<U&&(J[m++]=G[S++]))}else{for(S=m-Q;J[m++]=J[S++],J[m++]=J[S++],J[m++]=J[S++],2<(U-=3););U&&(J[m++]=J[S++],1<U&&(J[m++]=J[S++]))}break}}break}}while(u<f&&m<h);u-=U=k>>3,v&=(1<<(k-=U<<3))-1,o.next_in=u,o.next_out=m,o.avail_in=u<f?f-u+5:5-(u-f),o.avail_out=m<h?h-m+257:257-(m-h),d.hold=v,d.bits=k}},{}],49:[function(s,r,a){var o=s("../utils/common"),i=s("./adler32"),d=s("./crc32"),u=s("./inffast"),f=s("./inftrees"),m=1,p=2,h=0,g=-2,y=1,b=852,w=592;function N(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function k(S){var G;return S&&S.state?(G=S.state,S.total_in=S.total_out=G.total=0,S.msg="",G.wrap&&(S.adler=1&G.wrap),G.mode=y,G.last=0,G.havedict=0,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new o.Buf32(b),G.distcode=G.distdyn=new o.Buf32(w),G.sane=1,G.back=-1,h):g}function A(S){var G;return S&&S.state?((G=S.state).wsize=0,G.whave=0,G.wnext=0,k(S)):g}function C(S,G){var _,J;return S&&S.state?(J=S.state,G<0?(_=0,G=-G):(_=1+(G>>4),G<48&&(G&=15)),G&&(G<8||15<G)?g:(J.window!==null&&J.wbits!==G&&(J.window=null),J.wrap=_,J.wbits=G,A(S))):g}function P(S,G){var _,J;return S?(J=new v,(S.state=J).window=null,(_=C(S,G))!==h&&(S.state=null),_):g}var D,B,R=!0;function U(S){if(R){var G;for(D=new o.Buf32(512),B=new o.Buf32(32),G=0;G<144;)S.lens[G++]=8;for(;G<256;)S.lens[G++]=9;for(;G<280;)S.lens[G++]=7;for(;G<288;)S.lens[G++]=8;for(f(m,S.lens,0,288,D,0,S.work,{bits:9}),G=0;G<32;)S.lens[G++]=5;f(p,S.lens,0,32,B,0,S.work,{bits:5}),R=!1}S.lencode=D,S.lenbits=9,S.distcode=B,S.distbits=5}function Q(S,G,_,J){var ae,Y=S.state;return Y.window===null&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new o.Buf8(Y.wsize)),J>=Y.wsize?(o.arraySet(Y.window,G,_-Y.wsize,Y.wsize,0),Y.wnext=0,Y.whave=Y.wsize):(J<(ae=Y.wsize-Y.wnext)&&(ae=J),o.arraySet(Y.window,G,_-J,ae,Y.wnext),(J-=ae)?(o.arraySet(Y.window,G,_-J,J,0),Y.wnext=J,Y.whave=Y.wsize):(Y.wnext+=ae,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=ae))),0}a.inflateReset=A,a.inflateReset2=C,a.inflateResetKeep=k,a.inflateInit=function(S){return P(S,15)},a.inflateInit2=P,a.inflate=function(S,G){var _,J,ae,Y,te,H,ce,j,M,ie,$,F,ue,Z,X,me,ye,be,Ae,fe,x,K,W,I,E=0,q=new o.Buf8(4),se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return g;(_=S.state).mode===12&&(_.mode=13),te=S.next_out,ae=S.output,ce=S.avail_out,Y=S.next_in,J=S.input,H=S.avail_in,j=_.hold,M=_.bits,ie=H,$=ce,K=h;e:for(;;)switch(_.mode){case y:if(_.wrap===0){_.mode=13;break}for(;M<16;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(2&_.wrap&&j===35615){q[_.check=0]=255&j,q[1]=j>>>8&255,_.check=d(_.check,q,2,0),M=j=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&j)<<8)+(j>>8))%31){S.msg="incorrect header check",_.mode=30;break}if((15&j)!=8){S.msg="unknown compression method",_.mode=30;break}if(M-=4,x=8+(15&(j>>>=4)),_.wbits===0)_.wbits=x;else if(x>_.wbits){S.msg="invalid window size",_.mode=30;break}_.dmax=1<<x,S.adler=_.check=1,_.mode=512&j?10:12,M=j=0;break;case 2:for(;M<16;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(_.flags=j,(255&_.flags)!=8){S.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){S.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=j>>8&1),512&_.flags&&(q[0]=255&j,q[1]=j>>>8&255,_.check=d(_.check,q,2,0)),M=j=0,_.mode=3;case 3:for(;M<32;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}_.head&&(_.head.time=j),512&_.flags&&(q[0]=255&j,q[1]=j>>>8&255,q[2]=j>>>16&255,q[3]=j>>>24&255,_.check=d(_.check,q,4,0)),M=j=0,_.mode=4;case 4:for(;M<16;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}_.head&&(_.head.xflags=255&j,_.head.os=j>>8),512&_.flags&&(q[0]=255&j,q[1]=j>>>8&255,_.check=d(_.check,q,2,0)),M=j=0,_.mode=5;case 5:if(1024&_.flags){for(;M<16;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}_.length=j,_.head&&(_.head.extra_len=j),512&_.flags&&(q[0]=255&j,q[1]=j>>>8&255,_.check=d(_.check,q,2,0)),M=j=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(H<(F=_.length)&&(F=H),F&&(_.head&&(x=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),o.arraySet(_.head.extra,J,Y,F,x)),512&_.flags&&(_.check=d(_.check,J,F,Y)),H-=F,Y+=F,_.length-=F),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(H===0)break e;for(F=0;x=J[Y+F++],_.head&&x&&_.length<65536&&(_.head.name+=String.fromCharCode(x)),x&&F<H;);if(512&_.flags&&(_.check=d(_.check,J,F,Y)),H-=F,Y+=F,x)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(H===0)break e;for(F=0;x=J[Y+F++],_.head&&x&&_.length<65536&&(_.head.comment+=String.fromCharCode(x)),x&&F<H;);if(512&_.flags&&(_.check=d(_.check,J,F,Y)),H-=F,Y+=F,x)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;M<16;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(j!==(65535&_.check)){S.msg="header crc mismatch",_.mode=30;break}M=j=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),S.adler=_.check=0,_.mode=12;break;case 10:for(;M<32;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}S.adler=_.check=N(j),M=j=0,_.mode=11;case 11:if(_.havedict===0)return S.next_out=te,S.avail_out=ce,S.next_in=Y,S.avail_in=H,_.hold=j,_.bits=M,2;S.adler=_.check=1,_.mode=12;case 12:if(G===5||G===6)break e;case 13:if(_.last){j>>>=7&M,M-=7&M,_.mode=27;break}for(;M<3;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}switch(_.last=1&j,M-=1,3&(j>>>=1)){case 0:_.mode=14;break;case 1:if(U(_),_.mode=20,G!==6)break;j>>>=2,M-=2;break e;case 2:_.mode=17;break;case 3:S.msg="invalid block type",_.mode=30}j>>>=2,M-=2;break;case 14:for(j>>>=7&M,M-=7&M;M<32;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if((65535&j)!=(j>>>16^65535)){S.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&j,M=j=0,_.mode=15,G===6)break e;case 15:_.mode=16;case 16:if(F=_.length){if(H<F&&(F=H),ce<F&&(F=ce),F===0)break e;o.arraySet(ae,J,Y,F,te),H-=F,Y+=F,ce-=F,te+=F,_.length-=F;break}_.mode=12;break;case 17:for(;M<14;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(_.nlen=257+(31&j),j>>>=5,M-=5,_.ndist=1+(31&j),j>>>=5,M-=5,_.ncode=4+(15&j),j>>>=4,M-=4,286<_.nlen||30<_.ndist){S.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;M<3;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}_.lens[se[_.have++]]=7&j,j>>>=3,M-=3}for(;_.have<19;)_.lens[se[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,W={bits:_.lenbits},K=f(0,_.lens,0,19,_.lencode,0,_.work,W),_.lenbits=W.bits,K){S.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;me=(E=_.lencode[j&(1<<_.lenbits)-1])>>>16&255,ye=65535&E,!((X=E>>>24)<=M);){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(ye<16)j>>>=X,M-=X,_.lens[_.have++]=ye;else{if(ye===16){for(I=X+2;M<I;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(j>>>=X,M-=X,_.have===0){S.msg="invalid bit length repeat",_.mode=30;break}x=_.lens[_.have-1],F=3+(3&j),j>>>=2,M-=2}else if(ye===17){for(I=X+3;M<I;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}M-=X,x=0,F=3+(7&(j>>>=X)),j>>>=3,M-=3}else{for(I=X+7;M<I;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}M-=X,x=0,F=11+(127&(j>>>=X)),j>>>=7,M-=7}if(_.have+F>_.nlen+_.ndist){S.msg="invalid bit length repeat",_.mode=30;break}for(;F--;)_.lens[_.have++]=x}}if(_.mode===30)break;if(_.lens[256]===0){S.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,W={bits:_.lenbits},K=f(m,_.lens,0,_.nlen,_.lencode,0,_.work,W),_.lenbits=W.bits,K){S.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,W={bits:_.distbits},K=f(p,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,W),_.distbits=W.bits,K){S.msg="invalid distances set",_.mode=30;break}if(_.mode=20,G===6)break e;case 20:_.mode=21;case 21:if(6<=H&&258<=ce){S.next_out=te,S.avail_out=ce,S.next_in=Y,S.avail_in=H,_.hold=j,_.bits=M,u(S,$),te=S.next_out,ae=S.output,ce=S.avail_out,Y=S.next_in,J=S.input,H=S.avail_in,j=_.hold,M=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;me=(E=_.lencode[j&(1<<_.lenbits)-1])>>>16&255,ye=65535&E,!((X=E>>>24)<=M);){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(me&&(240&me)==0){for(be=X,Ae=me,fe=ye;me=(E=_.lencode[fe+((j&(1<<be+Ae)-1)>>be)])>>>16&255,ye=65535&E,!(be+(X=E>>>24)<=M);){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}j>>>=be,M-=be,_.back+=be}if(j>>>=X,M-=X,_.back+=X,_.length=ye,me===0){_.mode=26;break}if(32&me){_.back=-1,_.mode=12;break}if(64&me){S.msg="invalid literal/length code",_.mode=30;break}_.extra=15&me,_.mode=22;case 22:if(_.extra){for(I=_.extra;M<I;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}_.length+=j&(1<<_.extra)-1,j>>>=_.extra,M-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;me=(E=_.distcode[j&(1<<_.distbits)-1])>>>16&255,ye=65535&E,!((X=E>>>24)<=M);){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if((240&me)==0){for(be=X,Ae=me,fe=ye;me=(E=_.distcode[fe+((j&(1<<be+Ae)-1)>>be)])>>>16&255,ye=65535&E,!(be+(X=E>>>24)<=M);){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}j>>>=be,M-=be,_.back+=be}if(j>>>=X,M-=X,_.back+=X,64&me){S.msg="invalid distance code",_.mode=30;break}_.offset=ye,_.extra=15&me,_.mode=24;case 24:if(_.extra){for(I=_.extra;M<I;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}_.offset+=j&(1<<_.extra)-1,j>>>=_.extra,M-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){S.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(ce===0)break e;if(F=$-ce,_.offset>F){if((F=_.offset-F)>_.whave&&_.sane){S.msg="invalid distance too far back",_.mode=30;break}ue=F>_.wnext?(F-=_.wnext,_.wsize-F):_.wnext-F,F>_.length&&(F=_.length),Z=_.window}else Z=ae,ue=te-_.offset,F=_.length;for(ce<F&&(F=ce),ce-=F,_.length-=F;ae[te++]=Z[ue++],--F;);_.length===0&&(_.mode=21);break;case 26:if(ce===0)break e;ae[te++]=_.length,ce--,_.mode=21;break;case 27:if(_.wrap){for(;M<32;){if(H===0)break e;H--,j|=J[Y++]<<M,M+=8}if($-=ce,S.total_out+=$,_.total+=$,$&&(S.adler=_.check=_.flags?d(_.check,ae,$,te-$):i(_.check,ae,$,te-$)),$=ce,(_.flags?j:N(j))!==_.check){S.msg="incorrect data check",_.mode=30;break}M=j=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;M<32;){if(H===0)break e;H--,j+=J[Y++]<<M,M+=8}if(j!==(4294967295&_.total)){S.msg="incorrect length check",_.mode=30;break}M=j=0}_.mode=29;case 29:K=1;break e;case 30:K=-3;break e;case 31:return-4;case 32:default:return g}return S.next_out=te,S.avail_out=ce,S.next_in=Y,S.avail_in=H,_.hold=j,_.bits=M,(_.wsize||$!==S.avail_out&&_.mode<30&&(_.mode<27||G!==4))&&Q(S,S.output,S.next_out,$-S.avail_out)?(_.mode=31,-4):(ie-=S.avail_in,$-=S.avail_out,S.total_in+=ie,S.total_out+=$,_.total+=$,_.wrap&&$&&(S.adler=_.check=_.flags?d(_.check,ae,$,S.next_out-$):i(_.check,ae,$,S.next_out-$)),S.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(ie==0&&$===0||G===4)&&K===h&&(K=-5),K)},a.inflateEnd=function(S){if(!S||!S.state)return g;var G=S.state;return G.window&&(G.window=null),S.state=null,h},a.inflateGetHeader=function(S,G){var _;return S&&S.state?(2&(_=S.state).wrap)==0?g:((_.head=G).done=!1,h):g},a.inflateSetDictionary=function(S,G){var _,J=G.length;return S&&S.state?(_=S.state).wrap!==0&&_.mode!==11?g:_.mode===11&&i(1,G,J,0)!==_.check?-3:Q(S,G,J,J)?(_.mode=31,-4):(_.havedict=1,h):g},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(s,r,a){var o=s("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(m,p,h,g,y,b,w,N){var v,k,A,C,P,D,B,R,U,Q=N.bits,S=0,G=0,_=0,J=0,ae=0,Y=0,te=0,H=0,ce=0,j=0,M=null,ie=0,$=new o.Buf16(16),F=new o.Buf16(16),ue=null,Z=0;for(S=0;S<=15;S++)$[S]=0;for(G=0;G<g;G++)$[p[h+G]]++;for(ae=Q,J=15;1<=J&&$[J]===0;J--);if(J<ae&&(ae=J),J===0)return y[b++]=20971520,y[b++]=20971520,N.bits=1,0;for(_=1;_<J&&$[_]===0;_++);for(ae<_&&(ae=_),S=H=1;S<=15;S++)if(H<<=1,(H-=$[S])<0)return-1;if(0<H&&(m===0||J!==1))return-1;for(F[1]=0,S=1;S<15;S++)F[S+1]=F[S]+$[S];for(G=0;G<g;G++)p[h+G]!==0&&(w[F[p[h+G]]++]=G);if(D=m===0?(M=ue=w,19):m===1?(M=i,ie-=257,ue=d,Z-=257,256):(M=u,ue=f,-1),S=_,P=b,te=G=j=0,A=-1,C=(ce=1<<(Y=ae))-1,m===1&&852<ce||m===2&&592<ce)return 1;for(;;){for(B=S-te,U=w[G]<D?(R=0,w[G]):w[G]>D?(R=ue[Z+w[G]],M[ie+w[G]]):(R=96,0),v=1<<S-te,_=k=1<<Y;y[P+(j>>te)+(k-=v)]=B<<24|R<<16|U|0,k!==0;);for(v=1<<S-1;j&v;)v>>=1;if(v!==0?(j&=v-1,j+=v):j=0,G++,--$[S]==0){if(S===J)break;S=p[h+w[G]]}if(ae<S&&(j&C)!==A){for(te===0&&(te=ae),P+=_,H=1<<(Y=S-te);Y+te<J&&!((H-=$[Y+te])<=0);)Y++,H<<=1;if(ce+=1<<Y,m===1&&852<ce||m===2&&592<ce)return 1;y[A=j&C]=ae<<24|Y<<16|P-b|0}}return j!==0&&(y[P+j]=S-te<<24|64<<16|0),N.bits=ae,0}},{"../utils/common":41}],51:[function(s,r,a){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(s,r,a){var o=s("../utils/common"),i=0,d=1;function u(E){for(var q=E.length;0<=--q;)E[q]=0}var f=0,m=29,p=256,h=p+1+m,g=30,y=19,b=2*h+1,w=15,N=16,v=7,k=256,A=16,C=17,P=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(h+2));u(Q);var S=new Array(2*g);u(S);var G=new Array(512);u(G);var _=new Array(256);u(_);var J=new Array(m);u(J);var ae,Y,te,H=new Array(g);function ce(E,q,se,re,O){this.static_tree=E,this.extra_bits=q,this.extra_base=se,this.elems=re,this.max_length=O,this.has_stree=E&&E.length}function j(E,q){this.dyn_tree=E,this.max_code=0,this.stat_desc=q}function M(E){return E<256?G[E]:G[256+(E>>>7)]}function ie(E,q){E.pending_buf[E.pending++]=255&q,E.pending_buf[E.pending++]=q>>>8&255}function $(E,q,se){E.bi_valid>N-se?(E.bi_buf|=q<<E.bi_valid&65535,ie(E,E.bi_buf),E.bi_buf=q>>N-E.bi_valid,E.bi_valid+=se-N):(E.bi_buf|=q<<E.bi_valid&65535,E.bi_valid+=se)}function F(E,q,se){$(E,se[2*q],se[2*q+1])}function ue(E,q){for(var se=0;se|=1&E,E>>>=1,se<<=1,0<--q;);return se>>>1}function Z(E,q,se){var re,O,oe=new Array(w+1),he=0;for(re=1;re<=w;re++)oe[re]=he=he+se[re-1]<<1;for(O=0;O<=q;O++){var de=E[2*O+1];de!==0&&(E[2*O]=ue(oe[de]++,de))}}function X(E){var q;for(q=0;q<h;q++)E.dyn_ltree[2*q]=0;for(q=0;q<g;q++)E.dyn_dtree[2*q]=0;for(q=0;q<y;q++)E.bl_tree[2*q]=0;E.dyn_ltree[2*k]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function me(E){8<E.bi_valid?ie(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function ye(E,q,se,re){var O=2*q,oe=2*se;return E[O]<E[oe]||E[O]===E[oe]&&re[q]<=re[se]}function be(E,q,se){for(var re=E.heap[se],O=se<<1;O<=E.heap_len&&(O<E.heap_len&&ye(q,E.heap[O+1],E.heap[O],E.depth)&&O++,!ye(q,re,E.heap[O],E.depth));)E.heap[se]=E.heap[O],se=O,O<<=1;E.heap[se]=re}function Ae(E,q,se){var re,O,oe,he,de=0;if(E.last_lit!==0)for(;re=E.pending_buf[E.d_buf+2*de]<<8|E.pending_buf[E.d_buf+2*de+1],O=E.pending_buf[E.l_buf+de],de++,re===0?F(E,O,q):(F(E,(oe=_[O])+p+1,q),(he=D[oe])!==0&&$(E,O-=J[oe],he),F(E,oe=M(--re),se),(he=B[oe])!==0&&$(E,re-=H[oe],he)),de<E.last_lit;);F(E,k,q)}function fe(E,q){var se,re,O,oe=q.dyn_tree,he=q.stat_desc.static_tree,de=q.stat_desc.has_stree,xe=q.stat_desc.elems,V=-1;for(E.heap_len=0,E.heap_max=b,se=0;se<xe;se++)oe[2*se]!==0?(E.heap[++E.heap_len]=V=se,E.depth[se]=0):oe[2*se+1]=0;for(;E.heap_len<2;)oe[2*(O=E.heap[++E.heap_len]=V<2?++V:0)]=1,E.depth[O]=0,E.opt_len--,de&&(E.static_len-=he[2*O+1]);for(q.max_code=V,se=E.heap_len>>1;1<=se;se--)be(E,oe,se);for(O=xe;se=E.heap[1],E.heap[1]=E.heap[E.heap_len--],be(E,oe,1),re=E.heap[1],E.heap[--E.heap_max]=se,E.heap[--E.heap_max]=re,oe[2*O]=oe[2*se]+oe[2*re],E.depth[O]=(E.depth[se]>=E.depth[re]?E.depth[se]:E.depth[re])+1,oe[2*se+1]=oe[2*re+1]=O,E.heap[1]=O++,be(E,oe,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],(function(pe,_e){var Fe,Ie,qe,ve,Oe,We,Ge=_e.dyn_tree,Xe=_e.max_code,gt=_e.stat_desc.static_tree,yt=_e.stat_desc.has_stree,jt=_e.stat_desc.extra_bits,xt=_e.stat_desc.extra_base,dt=_e.stat_desc.max_length,et=0;for(ve=0;ve<=w;ve++)pe.bl_count[ve]=0;for(Ge[2*pe.heap[pe.heap_max]+1]=0,Fe=pe.heap_max+1;Fe<b;Fe++)dt<(ve=Ge[2*Ge[2*(Ie=pe.heap[Fe])+1]+1]+1)&&(ve=dt,et++),Ge[2*Ie+1]=ve,Xe<Ie||(pe.bl_count[ve]++,Oe=0,xt<=Ie&&(Oe=jt[Ie-xt]),We=Ge[2*Ie],pe.opt_len+=We*(ve+Oe),yt&&(pe.static_len+=We*(gt[2*Ie+1]+Oe)));if(et!==0){do{for(ve=dt-1;pe.bl_count[ve]===0;)ve--;pe.bl_count[ve]--,pe.bl_count[ve+1]+=2,pe.bl_count[dt]--,et-=2}while(0<et);for(ve=dt;ve!==0;ve--)for(Ie=pe.bl_count[ve];Ie!==0;)Xe<(qe=pe.heap[--Fe])||(Ge[2*qe+1]!==ve&&(pe.opt_len+=(ve-Ge[2*qe+1])*Ge[2*qe],Ge[2*qe+1]=ve),Ie--)}})(E,q),Z(oe,V,E.bl_count)}function x(E,q,se){var re,O,oe=-1,he=q[1],de=0,xe=7,V=4;for(he===0&&(xe=138,V=3),q[2*(se+1)+1]=65535,re=0;re<=se;re++)O=he,he=q[2*(re+1)+1],++de<xe&&O===he||(de<V?E.bl_tree[2*O]+=de:O!==0?(O!==oe&&E.bl_tree[2*O]++,E.bl_tree[2*A]++):de<=10?E.bl_tree[2*C]++:E.bl_tree[2*P]++,oe=O,V=(de=0)===he?(xe=138,3):O===he?(xe=6,3):(xe=7,4))}function K(E,q,se){var re,O,oe=-1,he=q[1],de=0,xe=7,V=4;for(he===0&&(xe=138,V=3),re=0;re<=se;re++)if(O=he,he=q[2*(re+1)+1],!(++de<xe&&O===he)){if(de<V)for(;F(E,O,E.bl_tree),--de!=0;);else O!==0?(O!==oe&&(F(E,O,E.bl_tree),de--),F(E,A,E.bl_tree),$(E,de-3,2)):de<=10?(F(E,C,E.bl_tree),$(E,de-3,3)):(F(E,P,E.bl_tree),$(E,de-11,7));oe=O,V=(de=0)===he?(xe=138,3):O===he?(xe=6,3):(xe=7,4)}}u(H);var W=!1;function I(E,q,se,re){$(E,(f<<1)+(re?1:0),3),(function(O,oe,he,de){me(O),ie(O,he),ie(O,~he),o.arraySet(O.pending_buf,O.window,oe,he,O.pending),O.pending+=he})(E,q,se)}a._tr_init=function(E){W||((function(){var q,se,re,O,oe,he=new Array(w+1);for(O=re=0;O<m-1;O++)for(J[O]=re,q=0;q<1<<D[O];q++)_[re++]=O;for(_[re-1]=O,O=oe=0;O<16;O++)for(H[O]=oe,q=0;q<1<<B[O];q++)G[oe++]=O;for(oe>>=7;O<g;O++)for(H[O]=oe<<7,q=0;q<1<<B[O]-7;q++)G[256+oe++]=O;for(se=0;se<=w;se++)he[se]=0;for(q=0;q<=143;)Q[2*q+1]=8,q++,he[8]++;for(;q<=255;)Q[2*q+1]=9,q++,he[9]++;for(;q<=279;)Q[2*q+1]=7,q++,he[7]++;for(;q<=287;)Q[2*q+1]=8,q++,he[8]++;for(Z(Q,h+1,he),q=0;q<g;q++)S[2*q+1]=5,S[2*q]=ue(q,5);ae=new ce(Q,D,p+1,h,w),Y=new ce(S,B,0,g,w),te=new ce(new Array(0),R,0,y,v)})(),W=!0),E.l_desc=new j(E.dyn_ltree,ae),E.d_desc=new j(E.dyn_dtree,Y),E.bl_desc=new j(E.bl_tree,te),E.bi_buf=0,E.bi_valid=0,X(E)},a._tr_stored_block=I,a._tr_flush_block=function(E,q,se,re){var O,oe,he=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=(function(de){var xe,V=4093624447;for(xe=0;xe<=31;xe++,V>>>=1)if(1&V&&de.dyn_ltree[2*xe]!==0)return i;if(de.dyn_ltree[18]!==0||de.dyn_ltree[20]!==0||de.dyn_ltree[26]!==0)return d;for(xe=32;xe<p;xe++)if(de.dyn_ltree[2*xe]!==0)return d;return i})(E)),fe(E,E.l_desc),fe(E,E.d_desc),he=(function(de){var xe;for(x(de,de.dyn_ltree,de.l_desc.max_code),x(de,de.dyn_dtree,de.d_desc.max_code),fe(de,de.bl_desc),xe=y-1;3<=xe&&de.bl_tree[2*U[xe]+1]===0;xe--);return de.opt_len+=3*(xe+1)+5+5+4,xe})(E),O=E.opt_len+3+7>>>3,(oe=E.static_len+3+7>>>3)<=O&&(O=oe)):O=oe=se+5,se+4<=O&&q!==-1?I(E,q,se,re):E.strategy===4||oe===O?($(E,2+(re?1:0),3),Ae(E,Q,S)):($(E,4+(re?1:0),3),(function(de,xe,V,pe){var _e;for($(de,xe-257,5),$(de,V-1,5),$(de,pe-4,4),_e=0;_e<pe;_e++)$(de,de.bl_tree[2*U[_e]+1],3);K(de,de.dyn_ltree,xe-1),K(de,de.dyn_dtree,V-1)})(E,E.l_desc.max_code+1,E.d_desc.max_code+1,he+1),Ae(E,E.dyn_ltree,E.dyn_dtree)),X(E),re&&me(E)},a._tr_tally=function(E,q,se){return E.pending_buf[E.d_buf+2*E.last_lit]=q>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&q,E.pending_buf[E.l_buf+E.last_lit]=255&se,E.last_lit++,q===0?E.dyn_ltree[2*se]++:(E.matches++,q--,E.dyn_ltree[2*(_[se]+p+1)]++,E.dyn_dtree[2*M(q)]++),E.last_lit===E.lit_bufsize-1},a._tr_align=function(E){$(E,2,3),F(E,k,Q),(function(q){q.bi_valid===16?(ie(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):8<=q.bi_valid&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)})(E)}},{"../utils/common":41}],53:[function(s,r,a){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(s,r,a){(function(o){(function(i,d){if(!i.setImmediate){var u,f,m,p,h=1,g={},y=!1,b=i.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(i);w=w&&w.setTimeout?w:i,u={}.toString.call(i.process)==="[object process]"?function(A){process.nextTick(function(){v(A)})}:(function(){if(i.postMessage&&!i.importScripts){var A=!0,C=i.onmessage;return i.onmessage=function(){A=!1},i.postMessage("","*"),i.onmessage=C,A}})()?(p="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",k,!1):i.attachEvent("onmessage",k),function(A){i.postMessage(p+A,"*")}):i.MessageChannel?((m=new MessageChannel).port1.onmessage=function(A){v(A.data)},function(A){m.port2.postMessage(A)}):b&&"onreadystatechange"in b.createElement("script")?(f=b.documentElement,function(A){var C=b.createElement("script");C.onreadystatechange=function(){v(A),C.onreadystatechange=null,f.removeChild(C),C=null},f.appendChild(C)}):function(A){setTimeout(v,0,A)},w.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var C=new Array(arguments.length-1),P=0;P<C.length;P++)C[P]=arguments[P+1];var D={callback:A,args:C};return g[h]=D,u(h),h++},w.clearImmediate=N}function N(A){delete g[A]}function v(A){if(y)setTimeout(v,0,A);else{var C=g[A];if(C){y=!0;try{(function(P){var D=P.callback,B=P.args;switch(B.length){case 0:D();break;case 1:D(B[0]);break;case 2:D(B[0],B[1]);break;case 3:D(B[0],B[1],B[2]);break;default:D.apply(d,B)}})(C)}finally{N(A),y=!1}}}}function k(A){A.source===i&&typeof A.data=="string"&&A.data.indexOf(p)===0&&v(+A.data.slice(p.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Is<"u"?Is:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(En)),En.exports}var dx=lx();const vo=_o(dx),ll=({currentUser:t})=>{const{t:e}=He(),[s,r]=T.useState([]),[a,o]=T.useState(["pt","en","es","um","ln","fr"]),[i,d]=T.useState([]),[u,f]=T.useState(""),[m,p]=T.useState(""),[h,g]=T.useState(""),[y,b]=T.useState(!1),[w,N]=T.useState(!1),[v,k]=T.useState(!1),[A,C]=T.useState(null),[P,D]=T.useState({}),[B,R]=T.useState(null),[U,Q]=T.useState(!1),[S,G]=T.useState("editor"),[_,J]=T.useState(""),[ae,Y]=T.useState("en"),[te,H]=T.useState("pt"),[ce,j]=T.useState(""),[M,ie]=T.useState(!1),[$,F]=T.useState(""),[ue,Z]=T.useState([]),[X,me]=T.useState({language:"",key:""}),[ye,be]=T.useState(!1),Ae={pt:"PortuguÃªs",en:"English",es:"EspaÃ±ol",um:"Umbundu",ln:"Lingala",fr:"FranÃ§ais",de:"Deutsch",it:"Italiano",ja:"æ—¥æœ¬èªž",zh:"ä¸­æ–‡",ar:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",ru:"Ð ÑƒÑÑÐºÐ¸Ð¹"},fe=V=>Ae[V]||V.toUpperCase(),x=t?.role===Re.TRANSLATOR||t?.role===Re.SUPER_ADMIN;T.useEffect(()=>{x&&(K(),W(),I())},[]);const K=async()=>{N(!0);try{const V=await fetch("/api/translations/editor/all");if(V.ok){const pe=await V.json();r(pe)}}catch(V){console.error("Erro ao carregar traduÃ§Ãµes:",V)}finally{N(!1)}},W=async()=>{try{const V=await fetch("/api/translations/languages");if(V.ok){const pe=await V.json();o(pe)}}catch(V){console.error("Erro ao carregar idiomas:",V)}},I=async()=>{try{const V=await fetch("/api/translations/stats");if(V.ok){const pe=await V.json();d(pe)}}catch(V){console.error("Erro ao carregar estatÃ­sticas:",V)}},E=async()=>{be(!0);try{const V=new URLSearchParams;X.language&&V.set("language",X.language),X.key&&V.set("key",X.key),V.set("limit","50");const pe=await fetch(`/api/translations/history?${V.toString()}`);if(pe.ok){const _e=await pe.json();Z(_e)}}catch(V){console.error("Erro ao carregar histÃ³rico:",V)}finally{be(!1)}},q=async()=>{if(_.trim()){ie(!0),j("");try{const V=await fetch("/api/translations/ai-translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:_,fromLang:ae,toLang:te})});if(V.ok){const pe=await V.json();j(pe.translation),F(pe.provider)}}catch(V){console.error("Erro na traduÃ§Ã£o AI:",V)}finally{ie(!1)}}};T.useEffect(()=>{S==="history"&&E()},[S,X]);const se=async V=>{k(!0);try{for(const pe of a){const _e=P[`${pe}-${V}`];_e!==void 0&&await fetch("/api/translations/save-with-history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:pe,key:V,value:_e})})}C(null),D({}),K(),I()}catch(pe){console.error("Erro ao salvar traduÃ§Ã£o:",pe)}finally{k(!1)}},re=async()=>{if(u.trim()){k(!0);try{(await fetch("/api/translations/language/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:u,baseLanguage:"pt"})})).ok&&(f(""),W(),K())}catch(V){console.error("Erro ao adicionar idioma:",V)}finally{k(!1)}}},O=async()=>{try{k(!0);let V=s;if(V.length===0){console.log("Translations vazio no state, carregando do backend...");const ve=await fetch("/api/translations/editor/all");if(ve.ok)V=await ve.json(),console.log("Dados carregados do backend:",V.length,"chaves");else throw new Error("Falha ao carregar traduÃ§Ãµes")}const pe=new vo,_e=[...new Set(V.map(ve=>ve.key))];console.log("Total de chaves:",_e.length);for(const ve of a){const Oe={};_e.forEach(We=>{const Ge=V.find(Xe=>Xe.language===ve&&Xe.key===We);Oe[We]=Ge?.value||""}),console.log(`JSON para ${ve}:`,Object.keys(Oe).length,"chaves"),pe.file(`${ve}.json`,JSON.stringify(Oe,null,2))}const Fe=await pe.generateAsync({type:"blob"});if(console.log("ZIP size:",Fe.size,"bytes"),Fe.size===0){R({type:"error",text:"ZIP vazio! Dados nÃ£o foram carregados."});return}const Ie=window.URL.createObjectURL(Fe),qe=document.createElement("a");qe.href=Ie,qe.download=`traducoes-${new Date().toISOString().split("T")[0]}.zip`,document.body.appendChild(qe),qe.click(),window.URL.revokeObjectURL(Ie),document.body.removeChild(qe),R({type:"success",text:e("translations.export_success")+` (${_e.length} chaves)`}),setTimeout(()=>R(null),3e3)}catch(V){console.error("Erro ao exportar:",V),R({type:"error",text:e("translations.export_error")+": "+V.message})}finally{k(!1)}},oe=async V=>{const pe=V.target.files?.[0];if(pe){Q(!0);try{console.log("Import iniciado com arquivo:",pe.name);const Fe=await new vo().loadAsync(pe);console.log("ZIP carregado com",Object.keys(Fe.files).length,"ficheiros");let Ie=0;const qe=[...new Set(s.map(ve=>ve.key))];console.log("Total de chaves esperadas:",qe.length);for(const ve of a){const Oe=Fe.file(`${ve}.json`);if(Oe){const We=await Oe.async("text"),Ge=JSON.parse(We);console.log(`Importando ${ve}:`,Object.keys(Ge).length,"chaves no arquivo");for(const Xe of qe)Ge[Xe]&&Ge[Xe].trim()&&(await fetch("/api/translations/save-with-history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({language:ve,key:Xe,value:Ge[Xe]})})).ok&&Ie++}else console.warn(`Ficheiro ${ve}.json nÃ£o encontrado no ZIP`)}console.log("Total importado:",Ie),R({type:"success",text:e("translations.import_success")+` (${Ie} ${e("translations.keys")})`}),K(),I(),setTimeout(()=>R(null),3e3)}catch(_e){console.error("Erro ao importar:",_e),R({type:"error",text:e("translations.import_error")+": "+_e.message})}finally{Q(!1)}}},he=[...new Set(s.map(V=>V.key))],de=[...new Set(he.map(V=>V.split(".")[0]))];let xe=he.filter(V=>(m===""||V.toLowerCase().includes(m.toLowerCase()))&&(h===""||V.startsWith(h+".")));return y&&(xe=xe.filter(V=>a.some(pe=>!s.find(_e=>_e.language===pe&&_e.key===V&&_e.value.trim())))),x?n.jsxs("div",{className:"space-y-6 animate-fade-in",children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("h1",{className:"text-4xl font-bold text-slate-900 dark:text-white mb-2",children:["ðŸŒ ",e("sidebar.translations")]}),n.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:e("translations.manager_title")})]}),n.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[n.jsx(Ks,{className:"text-primary-600",size:24}),n.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:e("translations.manager_title")})]}),B&&n.jsxs("div",{className:`p-4 rounded-lg flex items-center gap-2 ${B.type==="success"?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-300 border border-emerald-200 dark:border-emerald-800":"bg-rose-50 dark:bg-rose-900/20 text-rose-700 dark:text-rose-300 border border-rose-200 dark:border-rose-800"}`,children:[n.jsx(vt,{size:20}),n.jsx("span",{className:"text-sm font-bold",children:B.text})]}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:i.map(V=>n.jsxs("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100/50 dark:from-primary-900/30 dark:to-primary-800/20 rounded-2xl p-4 border border-primary-200 dark:border-primary-800",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-xs font-bold text-primary-700 dark:text-primary-300 uppercase",children:V.language}),n.jsx(In,{size:14,className:"text-primary-600"})]}),n.jsxs("div",{className:"text-2xl font-bold text-primary-900 dark:text-primary-100",children:[V.percentage,"%"]}),n.jsxs("p",{className:"text-xs text-primary-600 dark:text-primary-400",children:[V.translated,"/",V.total," ",e("translations.keys")]}),n.jsx("div",{className:"mt-2 bg-primary-200 dark:bg-primary-900/50 rounded-full h-1",children:n.jsx("div",{className:"bg-primary-600 h-1 rounded-full transition-all",style:{width:`${V.percentage}%`}})})]},V.language))}),n.jsxs("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-700",children:[n.jsxs("button",{onClick:()=>G("editor"),className:`px-6 py-3 font-bold text-sm rounded-t-lg transition flex items-center gap-2 ${S==="editor"?"bg-white dark:bg-slate-800 text-primary-600 border-b-2 border-primary-600":"text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[n.jsx(Ks,{size:18}),e("translations.editor")||"Editor"]}),n.jsxs("button",{onClick:()=>G("ai-assistant"),className:`px-6 py-3 font-bold text-sm rounded-t-lg transition flex items-center gap-2 ${S==="ai-assistant"?"bg-white dark:bg-slate-800 text-primary-600 border-b-2 border-primary-600":"text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[n.jsx(st,{size:18}),e("translations.ai_assistant")||"AI Assistant"]}),n.jsxs("button",{onClick:()=>G("history"),className:`px-6 py-3 font-bold text-sm rounded-t-lg transition flex items-center gap-2 ${S==="history"?"bg-white dark:bg-slate-800 text-primary-600 border-b-2 border-primary-600":"text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200"}`,children:[n.jsx(Xs,{size:18}),e("translations.history")||"History"]})]}),S==="ai-assistant"&&n.jsxs("div",{className:"bg-gradient-to-br from-violet-50 to-purple-50 dark:from-violet-900/20 dark:to-purple-900/20 rounded-2xl p-6 border border-violet-200 dark:border-violet-800 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(st,{className:"text-violet-600",size:24}),n.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:e("translations.ai_assistant")||"AI Translation Assistant"})]}),n.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:e("translations.ai_assistant_desc")||"Use AI to help translate text between languages. Enter text and select the source and target languages."}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.source_language")||"Source Language"}),n.jsx("select",{value:ae,onChange:V=>Y(V.target.value),className:"w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white",children:a.map(V=>n.jsx("option",{value:V,children:fe(V)},V))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.target_language")||"Target Language"}),n.jsx("select",{value:te,onChange:V=>H(V.target.value),className:"w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white",children:a.map(V=>n.jsx("option",{value:V,children:fe(V)},V))})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.source_text")||"Text to Translate"}),n.jsx("textarea",{value:_,onChange:V=>J(V.target.value),placeholder:e("translations.enter_text")||"Enter text to translate...",className:"w-full p-4 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white resize-none",rows:3})]}),n.jsx("button",{onClick:q,disabled:M||!_.trim(),className:"w-full px-6 py-3 bg-violet-600 text-white rounded-lg hover:bg-violet-700 disabled:opacity-50 flex items-center justify-center gap-2 font-bold transition",children:M?n.jsxs(n.Fragment,{children:[n.jsx(ze,{size:18,className:"animate-spin"}),e("translations.translating")||"Translating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(st,{size:18}),e("translations.translate_with_ai")||"Translate with AI"]})}),ce&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 border border-violet-200 dark:border-violet-700",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-sm font-bold text-slate-600 dark:text-slate-400",children:e("translations.translation_result")||"Translation Result"}),$&&n.jsxs("span",{className:"text-xs px-2 py-1 bg-violet-100 dark:bg-violet-900/50 text-violet-700 dark:text-violet-300 rounded-full",children:["via ",$]})]}),n.jsx("p",{className:"text-lg text-slate-800 dark:text-white",children:ce}),n.jsx("button",{onClick:()=>navigator.clipboard.writeText(ce),className:"mt-2 text-sm text-violet-600 hover:text-violet-700 font-medium",children:e("translations.copy")||"Copy to clipboard"})]})]}),S==="history"&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[n.jsx(Xs,{className:"text-amber-600",size:24}),n.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:e("translations.history")||"Translation History"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.filter_language")||"Filter by Language"}),n.jsxs("select",{value:X.language,onChange:V=>me({...X,language:V.target.value}),className:"w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white",children:[n.jsx("option",{value:"",children:e("translations.all_languages")||"All Languages"}),a.map(V=>n.jsx("option",{value:V,children:fe(V)},V))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.filter_key")||"Filter by Key"}),n.jsx("input",{type:"text",value:X.key,onChange:V=>me({...X,key:V.target.value}),placeholder:e("translations.search_key")||"Search key...",className:"w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white"})]})]}),ye?n.jsx("div",{className:"text-center py-8",children:n.jsx(ze,{className:"animate-spin mx-auto text-amber-600",size:32})}):ue.length===0?n.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400",children:e("translations.no_history")||"No translation history found"}):n.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:ue.map(V=>n.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4 border border-slate-200 dark:border-slate-600",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-xs font-bold px-2 py-1 bg-primary-100 dark:bg-primary-900/50 text-primary-700 dark:text-primary-300 rounded uppercase",children:V.language}),n.jsx("span",{className:"text-sm font-mono text-slate-600 dark:text-slate-400",children:V.key})]}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400",children:[n.jsx(zo,{size:12}),new Date(V.changed_at).toLocaleString()]})]}),n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx("span",{className:"text-slate-500 dark:text-slate-400 line-through",children:V.old_value||"(empty)"}),n.jsx(Rn,{size:14,className:"text-slate-400"}),n.jsx("span",{className:"text-slate-800 dark:text-white font-medium",children:V.new_value})]}),V.user_name&&n.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-2",children:["by ",V.user_name]})]},V.id))})]}),S==="editor"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-2xl p-6 border border-purple-200 dark:border-purple-800 space-y-4",children:[n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-4",children:e("translations.import_export")}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("button",{onClick:O,disabled:v,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2 font-bold transition",children:[v?n.jsx(ze,{size:18,className:"animate-spin"}):n.jsx(er,{size:18}),e("translations.export_json")]}),n.jsxs("label",{className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 flex items-center justify-center gap-2 font-bold transition cursor-pointer",children:[U?n.jsx(ze,{size:18,className:"animate-spin"}):n.jsx(Zs,{size:18}),e("translations.import_json"),n.jsx("input",{type:"file",accept:".zip",onChange:oe,disabled:U,className:"hidden"})]})]}),n.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:e("translations.import_export_tip")})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700 space-y-4",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.add_language")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:u,onChange:V=>f(V.target.value.toLowerCase()),placeholder:e("translations.language_code_placeholder"),className:"flex-1 p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none"}),n.jsx("button",{onClick:re,disabled:v,className:"px-4 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50 flex items-center gap-2",children:v?n.jsx(ze,{size:18,className:"animate-spin"}):n.jsx(Bt,{size:18})})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.search_keys")}),n.jsxs("div",{className:"relative",children:[n.jsx(Fo,{size:18,className:"absolute left-3 top-3 text-slate-400"}),n.jsx("input",{type:"text",value:m,onChange:V=>p(V.target.value),placeholder:e("translations.search_placeholder"),className:"w-full pl-10 p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none"})]})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:e("translations.filter_category")}),n.jsxs("select",{value:h,onChange:V=>g(V.target.value),className:"w-full p-3 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none",children:[n.jsx("option",{value:"",children:e("translations.all_categories")}),de.map(V=>n.jsx("option",{value:V,children:V},V))]})]}),n.jsx("div",{className:"flex items-end",children:n.jsxs("label",{className:"flex items-center gap-3 cursor-pointer flex-1 p-3 rounded-lg border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsx("input",{type:"checkbox",checked:y,onChange:V=>b(V.target.checked),className:"w-4 h-4 rounded"}),n.jsx("span",{className:"text-sm font-bold text-slate-600 dark:text-slate-400",children:e("translations.show_untranslated")})]})})]})]}),n.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 overflow-x-auto",children:w?n.jsx("div",{className:"text-center py-8",children:n.jsx(ze,{className:"animate-spin mx-auto text-primary-600",size:32})}):xe.length===0?n.jsx("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400",children:e("translations.no_results")}):n.jsxs("table",{className:"w-full",children:[n.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-6 py-3 text-left text-xs font-bold text-slate-600 dark:text-slate-400 sticky left-0 bg-slate-50 dark:bg-slate-900/50 z-10",children:e("translations.key")}),a.map(V=>n.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-600 dark:text-slate-400 whitespace-nowrap",children:fe(V)},V)),n.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-slate-600 dark:text-slate-400",children:e("translations.actions")})]})}),n.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:xe.map(V=>n.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsx("td",{className:"px-6 py-3 text-sm font-mono text-slate-700 dark:text-slate-300 sticky left-0 bg-white dark:bg-slate-800 z-10",children:V}),a.map(pe=>{const _e=s.find(ve=>ve.language===pe&&ve.key===V),Fe=A===V,Ie=P[`${pe}-${V}`]!==void 0?P[`${pe}-${V}`]:_e?.value||"",qe=!_e?.value?.trim();return n.jsx("td",{className:"px-4 py-3 text-sm",children:Fe?n.jsx("textarea",{value:Ie,onChange:ve=>D({...P,[`${pe}-${V}`]:ve.target.value}),className:"w-full p-2 rounded border border-primary-300 dark:border-primary-700 dark:bg-slate-700 dark:text-white text-sm resize-none",rows:2}):n.jsx("div",{className:`p-2 rounded ${qe?"bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-300":"bg-slate-50 dark:bg-slate-700/50 text-slate-700 dark:text-slate-300"}`,children:Ie||n.jsx("span",{className:"italic",children:e("translations.missing")})})},`${pe}-${V}`)}),n.jsx("td",{className:"px-4 py-3",children:A===V?n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>se(V),disabled:v,className:"px-3 py-1 bg-emerald-600 text-white rounded text-xs font-bold hover:bg-emerald-700 disabled:opacity-50 flex items-center gap-1",children:[v?n.jsx(ze,{size:14,className:"animate-spin"}):n.jsx(ut,{size:14}),e("translations.save")]}),n.jsx("button",{onClick:()=>C(null),className:"px-3 py-1 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded text-xs font-bold hover:bg-slate-300 dark:hover:bg-slate-600",children:e("translations.cancel")})]}):n.jsx("button",{onClick:()=>{C(V);const pe={};a.forEach(_e=>{const Fe=s.find(Ie=>Ie.language===_e&&Ie.key===V);pe[`${_e}-${V}`]=Fe?.value||""}),D(pe)},className:"px-3 py-1 bg-primary-600 text-white rounded text-xs font-bold hover:bg-primary-700",children:e("translations.edit")})})]},V))})]})})]})]}):n.jsxs("div",{className:"bg-rose-50 dark:bg-rose-900/20 border border-rose-200 dark:border-rose-800 rounded-2xl p-8 text-center",children:[n.jsx(is,{className:"mx-auto text-rose-600 mb-4",size:32}),n.jsx("h3",{className:"text-lg font-bold text-rose-700 dark:text-rose-300 mb-2",children:e("translations.access_denied")}),n.jsx("p",{className:"text-sm text-rose-600 dark:text-rose-400",children:e("translations.translator_only")})]})},cx=({currentProvider:t,onProviderChange:e})=>{const{t:s}=He(),[r,a]=T.useState(t),[o,i]=T.useState(!1),[d,u]=T.useState(!1),f=["EXCHANGERATE_API","FAWAZ_AHMED","BNA","FOREX","PARALLEL"],m={EXCHANGERATE_API:{name:"ExchangeRate-API",description:"Open Access - Sem limites",icon:"ðŸŒ"},FAWAZ_AHMED:{name:"Fawaz Ahmed",description:"Open Source - Sem limites",icon:"âš¡"},BNA:{name:"BNA",description:"Banco Nacional de Angola",icon:"ðŸ¦"},FOREX:{name:"FOREX",description:"Mercado Forex",icon:"ðŸ’±"},PARALLEL:{name:"Mercado Paralelo",description:"Taxa de mercado negro",icon:"ðŸ“Š"}},p=async()=>{i(!0);try{(await fetch("/api/settings/default-currency-provider",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({provider:r})})).ok&&(e(r),u(!0),setTimeout(()=>u(!1),3e3))}catch(h){console.error("Error saving currency provider:",h)}finally{i(!1)}};return n.jsxs("div",{className:"space-y-4",children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-3",children:"Seleccione o Provedor"}),n.jsx("div",{className:"flex flex-col sm:flex-row gap-3 flex-wrap",children:f.map(h=>n.jsxs("button",{onClick:()=>a(h),className:`flex items-center justify-center px-4 py-3 rounded-xl border-2 font-bold transition active:scale-95 flex-1 min-w-max ${r===h?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400":"border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[n.jsx("span",{className:"mr-2",children:m[h].icon}),m[h].name]},h))}),n.jsx("div",{className:"bg-slate-50 dark:bg-slate-900/30 p-4 rounded-lg border border-slate-200 dark:border-slate-700",children:n.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:[n.jsxs("strong",{children:[m[r].name,":"]})," ",m[r].description]})}),n.jsxs("button",{onClick:p,disabled:o||r===t,className:`w-full py-3 rounded-lg font-bold text-white transition flex items-center justify-center gap-2 ${o||r===t?"bg-slate-400 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700"}`,children:[o&&n.jsx(ze,{size:18,className:"animate-spin"}),"âœ“ ",o?"Salvando...":"Confirmar SeleÃ§Ã£o"]}),d&&n.jsxs("div",{className:"bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-700 text-green-700 dark:text-green-400 px-4 py-2 rounded-lg flex items-center gap-2",children:[n.jsx(Et,{size:16})," Provedor actualizado com sucesso!"]})]})},ux=({appName:t,setAppName:e,backupConfig:s,updateBackupConfig:r,triggerManualBackup:a,users:o,currentUser:i,onAddUser:d,onUpdateUser:u,onDeleteUser:f,onRestoreBackup:m,onRefresh:p})=>{const{t:h}=He(),{mutate:g}=tx(),[y,b]=T.useState("users"),[w,N]=T.useState(t),[v,k]=T.useState(s),[A,C]=T.useState(!1),[P,D]=T.useState(null),[B,R]=T.useState(!1),[U,Q]=T.useState({current:"",new:"",confirm:"",question:"",answer:""}),[S,G]=T.useState(null),[_,J]=T.useState(""),[ae,Y]=T.useState(()=>localStorage.getItem("ai_provider")||"gemini"),[te,H]=T.useState("BNA");T.useEffect(()=>{(async()=>{try{const Te=await fetch("/api/settings/default-currency-provider",{credentials:"include"});if(Te.ok){const $e=await Te.json();H($e.provider||"BNA")}}catch(Te){console.error("Error loading currency provider:",Te)}})()},[]);const[ce,j]=T.useState(""),[M,ie]=T.useState(""),[$,F]=T.useState(()=>localStorage.getItem("openrouter_model")||"openai/gpt-3.5-turbo"),[ue,Z]=T.useState(""),[X,me]=T.useState(!1),[ye,be]=T.useState([]),[Ae,fe]=T.useState(!1),[x,K]=T.useState(""),[W,I]=T.useState(""),[E,q]=T.useState([]),[se,re]=T.useState(!1),[O,oe]=T.useState(null),[he,de]=T.useState(""),[xe,V]=T.useState(""),[pe,_e]=T.useState(""),[Fe,Ie]=T.useState(!1),[qe,ve]=T.useState("idle"),[Oe,We]=T.useState(()=>localStorage.getItem("repo_url")||"https://github.com/SEU_USUARIO/gestor-financeiro"),[Ge,Xe]=T.useState(""),[gt,yt]=T.useState({current:0,total:100,status:"idle"}),[jt,xt]=T.useState(!1),[dt,et]=T.useState(!1),[Mt,Dt]=T.useState({current:0,total:100,status:"idle"}),[us,Wt]=T.useState(!1),[Ft,le]=T.useState({current:0,total:100,status:"idle"}),[ee,Ne]=T.useState({name:"",email:"",username:"",password:"",role:Re.MEMBER,avatar:"",birthDate:"",allowParentView:!1}),je=z=>b(y===z?null:z),Ee=i?.role===Re.SUPER_ADMIN,Be=i?.role===Re.ADMIN||Ee,Ue=i?.role===Re.MANAGER,fs=i?.role===Re.MEMBER;T.useEffect(()=>{Ee&&(Kt(),L())},[Ee]);const Kt=async()=>{fe(!0);try{const z=await Xa.getAll();be(z)}catch(z){console.error("Error loading families:",z)}finally{fe(!1)}},L=async()=>{re(!0);try{const z=await fetch("/api/settings/api-configs",{credentials:"include"});if(z.ok){const Te=await z.json();q(Te)}}catch(z){console.error("Error loading API configs:",z)}finally{re(!1)}},ne=async()=>{if(console.log("handleSaveApiConfig called"),console.log("Provider:",he),console.log("Key:",xe?"***"+xe.slice(-4):"EMPTY"),!he||!xe){alert("Preenchimento obrigatÃ³rio: Provedor e Chave de API");return}try{const z={id:O?.id||null,provider:he,apiKey:xe,model:pe};console.log("Payload to send:",{...z,apiKey:"***"});const Te=await fetch("/api/settings/api-configs",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)});if(console.log("Response status:",Te.status),console.log("Response ok:",Te.ok),Te.ok){const $e=await Te.json();console.log("Success response:",$e),me(!0),setTimeout(()=>me(!1),2e3),de(""),V(""),_e(""),oe(null),L()}else{const $e=await Te.text();console.error("Save API Config Error:",Te.status,$e),alert("Erro ao salvar chave: "+$e)}}catch(z){console.error("Save API Config Exception:",z),alert("Erro ao salvar chave: "+z.message)}},ke=async z=>{if(confirm("Tem certeza que deseja deletar esta configuraÃ§Ã£o?"))try{(await fetch(`/api/settings/api-configs/${z}`,{method:"DELETE",credentials:"include"})).ok?L():alert("Erro ao deletar configuraÃ§Ã£o")}catch(Te){alert("Erro ao deletar: "+Te.message)}},we=async z=>{if(confirm(`Tem certeza que deseja APAGAR esta famÃ­lia e TODOS os seus dados?

Esta aÃ§Ã£o Ã© irreversÃ­vel!`))try{await Xa.delete(z),alert("FamÃ­lia apagada com sucesso!"),Kt()}catch(Te){alert("Erro ao apagar famÃ­lia: "+Te.message)}},Me=async()=>{Ie(!0);try{const z=await bt.getSetting("terms_of_service");K(z.value||""),I(z.value||"")}catch(z){console.error("Error loading terms:",z)}finally{Ie(!1)}},tt=async()=>{if(!W.trim()){alert("Termos nÃ£o podem estar vazios");return}try{await bt.setSetting("terms_of_service",W),K(W),alert("Termos e CondiÃ§Ãµes salvos com sucesso!")}catch(z){alert("Erro ao salvar termos: "+z.message)}},xn=o.filter(z=>Ee||Be?!0:Ue?z.familyId===i.familyId:fs?z.id===i.id:!1),bn=o.filter(z=>z.status===bs.PENDING),mr=z=>z.id===i.id?!1:Be?z.role!==Re.MEMBER:Ue?z.role===Re.MEMBER&&z.familyId===i.familyId:!1,fl=()=>{e(w),C(!0),setTimeout(()=>C(!1),2e3)},hr=async()=>{if(ae==="gemini")if(ce.trim().length>10)try{await Yp(ce.trim()),localStorage.setItem("ai_provider","gemini"),pr(),j(""),alert("Chave Gemini salva e serÃ¡ usada por todos os usuÃ¡rios!")}catch(z){alert("Erro ao salvar chave: "+z)}else alert("Chave Gemini invÃ¡lida ou muito curta.");else if(M.trim().length>10)try{await bt.saveApiConfig("openrouter",M.trim(),$.trim()||"openai/gpt-3.5-turbo"),localStorage.setItem("ai_provider","openrouter"),pr(),ie(""),alert("Chave OpenRouter salva e serÃ¡ usada por todos os usuÃ¡rios!")}catch(z){alert("Erro ao salvar chave: "+z)}else alert("Chave OpenRouter invÃ¡lida.")},pr=()=>{me(!0),setTimeout(()=>me(!1),3e3)},ml=()=>!!localStorage.getItem("openrouter_api_key"),hl=async()=>{if(!("Notification"in window))return alert("Navegador sem suporte.");await Notification.requestPermission()==="granted"&&new Notification(t,{body:"NotificaÃ§Ãµes ativadas!"})},pl=()=>{confirm("PERIGO: Isso apagarÃ¡ TODOS os dados, incluindo todos os usuÃ¡rios e transaÃ§Ãµes. Esta aÃ§Ã£o Ã© irreversÃ­vel. Confirmar?")&&(localStorage.clear(),window.location.reload())},gl=z=>{if(z.preventDefault(),P)u({...P,name:ee.name,email:ee.email,username:ee.username,avatar:ee.avatar,birthDate:ee.birthDate,allowParentView:ee.allowParentView,role:Be?ee.role:P.role});else{if(!ee.password)return alert("Senha Ã© obrigatÃ³ria para novos usuÃ¡rios.");d({...ee,role:Ue?Re.MEMBER:ee.role,status:bs.APPROVED,createdBy:i.id,familyId:Ue?i.familyId:void 0,allowParentView:ee.allowParentView})}R(!1)},xl=z=>{if(z.preventDefault(),U.current!==i.password)return alert("Senha atual incorreta.");if(U.new!==U.confirm)return alert("Novas senhas nÃ£o coincidem.");u({...i,password:U.new,securityQuestion:U.question?{question:U.question,answer:U.answer}:i.securityQuestion}),alert("Senha e seguranÃ§a atualizadas!"),Q({current:"",new:"",confirm:"",question:"",answer:""})},bl=z=>{z.preventDefault(),!(!S||!_)&&(u({...S,password:_}),alert(`Senha de ${S.name} redefinida com sucesso.`),G(null),J(""))},yl=(z,Te)=>{confirm(`Tem certeza que deseja excluir o usuÃ¡rio "${Te}"?`)&&(g(z),p&&p())},vl=z=>{u({...z,status:bs.APPROVED})},wl=z=>{confirm("Rejeitar e remover este usuÃ¡rio?")&&(g(z.id),p&&p())},_l=z=>{if(z.target.files&&z.target.files[0]){const Te=z.target.files[0],$e=new FileReader;$e.onloadend=()=>{Ne(ot=>({...ot,avatar:$e.result}))},$e.readAsDataURL(Te)}},Nl=z=>{if(!z)return 0;const Te=Date.now()-new Date(z).getTime();return Math.floor(Te/(1e3*60*60*24*365.25))},kl=async()=>{if(!Oe.includes("github.com")){alert('URL do GitHub invÃ¡lida. Deve incluir "github.com"');return}try{await bt.setSetting("github_repo_url",Oe),alert("URL do repositÃ³rio GitHub salva com sucesso!")}catch(z){alert("Erro ao salvar URL: "+z.message)}},Ve="w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none transition-all";return n.jsxs("div",{className:"space-y-8 animate-fade-in max-w-5xl mx-auto pb-20 w-full overflow-hidden",children:[n.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[n.jsx("div",{className:"p-4 bg-slate-800 text-white rounded-2xl shadow-lg shadow-slate-500/20 shrink-0",children:Ee?n.jsx(Jl,{size:32}):n.jsx(vr,{size:32})}),n.jsxs("div",{children:[n.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-slate-800 dark:text-white",children:Ue?"GestÃ£o Familiar":"Admin"}),n.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium text-sm md:text-base",children:Ee?"Controle Total (Super Admin)":Be?"GestÃ£o de Membros":"Gerencie sua famÃ­lia"})]})]}),n.jsxs("div",{className:"space-y-6",children:[Be&&bn.length>0&&n.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-3xl p-6",children:[n.jsxs("h3",{className:"text-lg font-bold text-amber-800 dark:text-amber-400 mb-4 flex items-center",children:[n.jsx(Wl,{className:"mr-2"})," ",h("admin.pending_approvals")," (",bn.length,")"]}),n.jsx("div",{className:"space-y-2",children:bn.map(z=>n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between bg-white dark:bg-slate-800 p-3 rounded-xl shadow-sm border border-amber-100 dark:border-amber-800 gap-3",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("img",{src:z.avatar,className:"w-8 h-8 rounded-full"}),n.jsxs("span",{className:"text-slate-800 dark:text-white font-medium",children:[z.name," ",n.jsxs("span",{className:"text-xs text-slate-400",children:["(",z.role,")"]})]})]}),n.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[n.jsxs("button",{onClick:()=>vl(z),className:"flex-1 sm:flex-none p-1.5 bg-emerald-100 text-emerald-600 rounded-lg hover:bg-emerald-200 font-bold text-xs flex items-center justify-center",children:[n.jsx(Et,{size:14,className:"mr-1"})," Aprovar"]}),n.jsxs("button",{onClick:()=>wl(z),className:"flex-1 sm:flex-none p-1.5 bg-rose-100 text-rose-600 rounded-lg hover:bg-rose-200 font-bold text-xs flex items-center justify-center",children:[n.jsx(at,{size:14,className:"mr-1"})," Rejeitar"]})]})]},z.id))})]}),Be&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("general"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-orange-100 text-orange-600 rounded-lg mr-4 shrink-0",children:n.jsx(vr,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h("admin.general")})]}),y==="general"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="general"&&n.jsxs("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:[n.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Nome do App"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("input",{type:"text",value:w,onChange:z=>N(z.target.value),className:Ve}),n.jsx("button",{onClick:fl,className:"bg-slate-800 text-white px-6 rounded-xl font-bold hover:bg-slate-700 transition shadow-lg shadow-slate-500/20",children:A?"OK":"Salvar"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Logo do App"}),n.jsx("input",{type:"file",accept:"image/*",onChange:z=>{if(z.target.files?.[0]){const Te=new FileReader;Te.onload=$e=>{const ot=$e.target?.result;fetch("/api/reports/logo",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({logo:ot})}).then(()=>alert("Logo salvo com sucesso!")).catch(Yt=>alert("Erro: "+Yt.message))},Te.readAsDataURL(z.target.files[0])}},className:Ve})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Alertas"}),n.jsxs("button",{onClick:hl,className:"w-full p-3 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-white font-bold rounded-xl hover:bg-slate-200 flex items-center justify-center gap-2",children:[n.jsx(It,{size:18})," Testar NotificaÃ§Ãµes"]})]})]}),Ee&&n.jsxs("div",{className:"mt-8 pt-8 border-t border-slate-100 dark:border-slate-700",children:[n.jsx("p",{className:"text-xs font-bold text-rose-500 uppercase mb-2",children:h("admin.danger_zone")}),n.jsxs("button",{onClick:pl,className:"flex items-center text-rose-600 hover:text-rose-700 font-bold text-sm bg-rose-50 dark:bg-rose-900/20 px-4 py-2 rounded-lg border border-rose-200 dark:border-rose-800",children:[n.jsx(is,{size:16,className:"mr-2"})," Resetar Dados de FÃ¡brica"]})]})]})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("families"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-purple-100 text-purple-600 rounded-lg mr-4 shrink-0",children:n.jsx(Ws,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h("admin.manage_families")})]}),y==="families"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="families"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:Ae?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"inline-block animate-spin",children:n.jsx(ze,{size:24,className:"text-slate-400"})}),n.jsx("p",{className:"text-slate-400 mt-2",children:h("admin.loading_families")})]}):ye.length===0?n.jsx("p",{className:"text-slate-400 text-center py-8",children:h("admin.no_families")}):n.jsx("div",{className:"grid gap-3",children:ye.map(z=>n.jsxs("div",{className:"flex items-center justify-between bg-slate-50 dark:bg-slate-900 p-4 rounded-xl border border-slate-200 dark:border-slate-700",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-bold text-slate-800 dark:text-white",children:z.name}),n.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[z.member_count," membro",z.member_count!==1?"s":""," â€¢ Criada em ",new Date(z.created_at).toLocaleDateString("pt-BR")]})]}),n.jsx("button",{onClick:()=>we(z.id),disabled:z.id==="fam_admin",className:"p-2 text-rose-600 hover:text-rose-700 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed",title:z.id==="fam_admin"?"NÃ£o pode deletar famÃ­lia padrÃ£o":"Deletar famÃ­lia",children:n.jsx(Qe,{size:18})})]},z.id))})})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>{je("terms"),y!=="terms"&&Me()},className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg mr-4 shrink-0",children:n.jsx(Do,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Termos e CondiÃ§Ãµes / Contratos"})]}),y==="terms"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="terms"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:Fe?n.jsxs("div",{className:"text-center py-8",children:[n.jsx("div",{className:"inline-block animate-spin",children:n.jsx(ze,{size:24,className:"text-slate-400"})}),n.jsx("p",{className:"text-slate-400 mt-2",children:h("admin.loading_families")})]}):n.jsxs("div",{className:"space-y-4",children:[n.jsx("p",{className:"text-sm text-slate-500",children:"Edite os Termos e CondiÃ§Ãµes que aparecerÃ£o durante o registro de novas famÃ­lias:"}),n.jsx("textarea",{value:W,onChange:z=>I(z.target.value),placeholder:"Digite os Termos e CondiÃ§Ãµes aqui...",className:"w-full h-64 p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white font-mono text-sm resize-none"}),n.jsxs("button",{onClick:tt,className:"w-full py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition shadow-lg flex items-center justify-center gap-2",children:[n.jsx(ut,{size:18})," Salvar Termos e CondiÃ§Ãµes"]})]})})]}),Be&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("integrations"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-indigo-100 text-indigo-600 rounded-lg mr-4 shrink-0",children:n.jsx(Kl,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"IntegraÃ§Ãµes & IA"})]}),y==="integrations"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="integrations"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:n.jsxs("div",{className:"max-w-2xl",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-3",children:"Selecione a IA PadrÃ£o"}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[n.jsxs("button",{onClick:()=>Y("gemini"),className:`flex items-center justify-center px-4 py-3 rounded-xl border-2 font-bold transition active:scale-95 ${ae==="gemini"?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400":"border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[n.jsx(st,{size:18,className:"mr-2"})," Google Gemini"]}),n.jsxs("button",{onClick:()=>Y("openrouter"),className:`flex items-center justify-center px-4 py-3 rounded-xl border-2 font-bold transition active:scale-95 ${ae==="openrouter"?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400":"border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[n.jsx(vn,{size:18,className:"mr-2"})," OpenRouter"]}),n.jsxs("button",{onClick:()=>Y("puter"),className:`flex items-center justify-center px-4 py-3 rounded-xl border-2 font-bold transition active:scale-95 ${ae==="puter"?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400":"border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[n.jsx(wn,{size:18,className:"mr-2"})," Puter (Gratuito)"]}),n.jsxs("button",{onClick:()=>Y("groq"),className:`flex items-center justify-center px-4 py-3 rounded-xl border-2 font-bold transition active:scale-95 ${ae==="groq"?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400":"border-slate-200 dark:border-slate-700 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[n.jsx(vn,{size:18,className:"mr-2"})," Groq âš¡"]})]}),n.jsx("button",{onClick:async()=>{try{await fetch("/api/settings/default-ai-provider",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({provider:ae})}),me(!0),setTimeout(()=>me(!1),2e3),alert(`âœ… ${ae==="gemini"?"Gemini":ae==="openrouter"?"OpenRouter":ae==="groq"?"Groq":"Puter"} definido como IA padrÃ£o!`)}catch{alert("Erro ao confirmar seleÃ§Ã£o")}},className:"w-full mt-3 bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-emerald-700 transition shadow-lg",children:"âœ“ Confirmar SeleÃ§Ã£o"})]}),ae==="gemini"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("h4",{className:"font-bold mb-2 text-slate-700 dark:text-white flex items-center",children:[n.jsx(st,{className:"mr-2 text-yellow-500",size:18})," ",h("admin.gemini_config")]}),n.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Utilize a API oficial do Google para anÃ¡lise inteligente e categorizaÃ§Ã£o."}),n.jsxs("div",{className:"flex gap-3 flex-col sm:flex-row",children:[n.jsx("input",{type:"password",placeholder:"Cole sua API Key do Gemini aqui",value:ce,onChange:z=>j(z.target.value),className:Ve}),n.jsx("button",{onClick:hr,className:`bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg flex items-center justify-center ${X?"bg-emerald-600 hover:bg-emerald-700":""}`,children:X?n.jsx(Et,{size:20}):"Salvar"}),n.jsx("button",{onClick:async()=>{try{await bt.deleteApiConfig("google_gemini"),j(""),alert("Chave Gemini deletada com sucesso!")}catch(z){alert("Erro ao deletar chave: "+z)}},className:"bg-red-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-red-700 transition shadow-lg flex items-center justify-center",title:"Deletar chave salva",children:n.jsx(Qe,{size:20})})]}),Xp()&&n.jsxs("p",{className:"mt-2 text-xs font-bold text-emerald-600 flex items-center",children:[n.jsx(vt,{className:"mr-1",size:12})," Chave Gemini configurada e ativa."]}),n.jsxs("p",{className:"mt-4 text-xs text-slate-400",children:["NÃ£o tem uma chave? ",n.jsx("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noreferrer",className:"text-indigo-500 hover:underline",children:"Obter gratuitamente no Google AI Studio"}),"."]})]}),ae==="openrouter"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("h4",{className:"font-bold mb-2 text-slate-700 dark:text-white flex items-center",children:[n.jsx(wn,{className:"mr-2 text-purple-500",size:18})," ",h("admin.openrouter_config")]}),n.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Acesse diversos modelos como GPT-4, Claude 3 e Llama atravÃ©s do OpenRouter."}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"API Key"}),n.jsx("input",{type:"password",placeholder:"sk-or-v1-...",value:M,onChange:z=>ie(z.target.value),className:Ve})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Modelo de IA"}),n.jsx("input",{type:"text",placeholder:"openai/gpt-3.5-turbo",value:$,onChange:z=>F(z.target.value),className:Ve}),n.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"PadrÃ£o: openai/gpt-3.5-turbo"})]}),n.jsxs("button",{onClick:hr,className:`w-full sm:w-auto bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg flex items-center justify-center ${X?"bg-emerald-600 hover:bg-emerald-700":""}`,children:[X?n.jsx(Et,{size:20,className:"mr-2"}):null,X?"ConfiguraÃ§Ã£o Salva":"Salvar ConfiguraÃ§Ã£o OpenRouter"]})]}),ml()&&n.jsxs("p",{className:"mt-2 text-xs font-bold text-emerald-600 flex items-center",children:[n.jsx(vt,{className:"mr-1",size:12})," Chave OpenRouter configurada e ativa."]})]}),ae==="puter"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("h4",{className:"font-bold mb-2 text-slate-700 dark:text-white flex items-center",children:[n.jsx(wn,{className:"mr-2 text-emerald-500",size:18})," ",h("admin.puter_config")]}),n.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"Acesso grÃ¡tis e ilimitado a 400+ modelos de IA (GPT, Claude, Gemini, etc). Sem configuraÃ§Ã£o necessÃ¡ria!"}),n.jsx("div",{className:"space-y-4 bg-emerald-50 dark:bg-emerald-900/10 p-4 rounded-xl border border-emerald-200 dark:border-emerald-800",children:n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-emerald-900 dark:text-emerald-100 mb-2",children:"âœ¨ Recursos DisponÃ­veis:"}),n.jsxs("ul",{className:"text-xs text-emerald-800 dark:text-emerald-300 space-y-1",children:[n.jsx("li",{children:"ðŸ¤– Chat com GPT-5, Claude, Gemini e 400+ modelos"}),n.jsx("li",{children:"ðŸŽ™ï¸ ConversÃ£o de Ã¡udio em texto (Speech-to-Text)"}),n.jsx("li",{children:"ðŸ–¼ï¸ GeraÃ§Ã£o e anÃ¡lise de imagens"}),n.jsx("li",{children:"ðŸ”Š SÃ­ntese de voz (Text-to-Speech)"}),n.jsx("li",{children:"ðŸ’¾ Cloud storage seguro"}),n.jsx("li",{children:"ðŸ—„ï¸ Banco de dados NoSQL"}),n.jsx("li",{children:"ðŸ†“ Totalmente gratuito para desenvolvedores"})]})]})}),n.jsxs("button",{onClick:()=>{localStorage.setItem("ai_provider","puter"),me(!0),setTimeout(()=>me(!1),1500)},className:`w-full mt-4 bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-emerald-700 transition shadow-lg flex items-center justify-center ${X?"bg-emerald-700":""}`,children:[X?n.jsx(Et,{size:20,className:"mr-2"}):null,X?"Puter Ativado!":"Ativar Puter"]}),d0()&&n.jsxs("p",{className:"mt-2 text-xs font-bold text-emerald-600 dark:text-emerald-400 flex items-center",children:[n.jsx(vt,{className:"mr-1",size:12})," Puter configurado e pronto para uso."]}),n.jsxs("p",{className:"mt-4 text-xs text-slate-400",children:["ðŸ“š Saiba mais em ",n.jsx("a",{href:"https://puter.com/",target:"_blank",rel:"noreferrer",className:"text-emerald-500 hover:underline",children:"puter.com"})," ou ",n.jsx("a",{href:"https://docs.puter.com/",target:"_blank",rel:"noreferrer",className:"text-emerald-500 hover:underline",children:"documentaÃ§Ã£o"}),"."]})]}),ae==="groq"&&n.jsxs("div",{className:"animate-fade-in",children:[n.jsxs("h4",{className:"font-bold mb-2 text-slate-700 dark:text-white flex items-center",children:[n.jsx(vn,{className:"mr-2 text-blue-500",size:18})," ",h("admin.groq_config")]}),n.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:"IA ultra-rÃ¡pida e gratuita. Llama 3.3 (70B), Mixtral 8x7B e mais. Requisitos: API key do Groq (grÃ¡tis em groq.com)."}),n.jsxs("div",{className:"flex gap-3 flex-col",children:[n.jsx("input",{type:"password",placeholder:"Cole sua API Key do Groq aqui",value:ue,onChange:z=>Z(z.target.value),className:Ve}),n.jsxs("button",{onClick:async()=>{if(ue.trim().length>10)try{await Z(ue.trim()),me(!0),setTimeout(()=>me(!1),2e3),alert("Chave Groq salva e serÃ¡ usada por todos os usuÃ¡rios!")}catch(z){alert("Erro ao salvar chave: "+z)}else alert("Chave Groq invÃ¡lida ou muito curta.")},className:`w-full bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg flex items-center justify-center ${X?"bg-emerald-600 hover:bg-emerald-700":""}`,children:[X?n.jsx(Et,{size:20,className:"mr-2"}):null,X?"Chave Salva!":"Salvar Chave Groq"]}),n.jsx("button",{onClick:async()=>{try{await bt.deleteApiConfig("groq"),Z(""),alert("Chave Groq deletada com sucesso!")}catch(z){alert("Erro ao deletar chave: "+z)}},className:"w-full bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 px-6 py-3 rounded-xl font-bold hover:bg-slate-300 dark:hover:bg-slate-600 transition",children:"Deletar Chave"})]}),n.jsxs("div",{className:"mt-4 bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-200 dark:border-blue-800",children:[n.jsx("p",{className:"text-xs font-bold text-blue-900 dark:text-blue-100 mb-2",children:"âš¡ Vantagens Groq:"}),n.jsxs("ul",{className:"text-xs text-blue-800 dark:text-blue-300 space-y-1",children:[n.jsx("li",{children:"ðŸš€ 10x mais rÃ¡pido que Gemini"}),n.jsx("li",{children:"ðŸ†“ Gratuito com limite generoso"}),n.jsx("li",{children:"ðŸ§  Llama 3.3 (70B) - melhor custo-benefÃ­cio"}),n.jsx("li",{children:"âš™ï¸ Sem limite de requisiÃ§Ãµes"}),n.jsx("li",{children:"âŒ NÃƒO suporta: Ãudio, Imagens (use Gemini para isso)"})]})]}),n.jsxs("p",{className:"mt-4 text-xs text-slate-400",children:["ðŸ“š Obter chave em ",n.jsx("a",{href:"https://console.groq.com/",target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:underline",children:"console.groq.com"})," (criar conta grÃ¡tis)."]})]})]})})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("security"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-rose-100 text-rose-600 rounded-lg mr-4 shrink-0",children:n.jsx(Ut,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h("admin.security_passwords")})]}),y==="security"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="security"&&n.jsxs("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h4",{className:"font-bold mb-4 text-slate-700 dark:text-white",children:"Alterar Minha Senha"}),n.jsxs("form",{onSubmit:xl,className:"grid md:grid-cols-2 gap-4",children:[n.jsx("input",{type:"password",placeholder:"Senha Atual",required:!0,value:U.current,onChange:z=>Q({...U,current:z.target.value}),className:Ve}),n.jsx("div",{className:"hidden md:block"}),n.jsx("input",{type:"password",placeholder:"Nova Senha",required:!0,value:U.new,onChange:z=>Q({...U,new:z.target.value}),className:Ve}),n.jsx("input",{type:"password",placeholder:"Confirmar Nova Senha",required:!0,value:U.confirm,onChange:z=>Q({...U,confirm:z.target.value}),className:Ve}),n.jsxs("div",{className:"md:col-span-2 mt-4 p-4 bg-slate-50 dark:bg-slate-900/50 rounded-2xl border border-slate-200 dark:border-slate-700",children:[n.jsx("p",{className:"text-xs text-slate-500 mb-3 font-bold uppercase",children:h("admin.setup_recovery_optional")}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsx("input",{type:"text",placeholder:"Pergunta de SeguranÃ§a",value:U.question,onChange:z=>Q({...U,question:z.target.value}),className:Ve}),n.jsx("input",{type:"text",placeholder:"Resposta",value:U.answer,onChange:z=>Q({...U,answer:z.target.value}),className:Ve})]})]}),n.jsx("button",{type:"submit",className:"md:col-span-2 bg-slate-800 text-white py-3 rounded-xl font-bold mt-2 shadow-lg hover:bg-slate-700 transition",children:"Atualizar SeguranÃ§a"})]})]}),n.jsxs("div",{className:"pt-8 border-t border-slate-100 dark:border-slate-700",children:[n.jsxs("h4",{className:"font-bold mb-4 text-slate-700 dark:text-white flex items-center",children:[n.jsx(qs,{className:"mr-2",size:18})," RedefiniÃ§Ã£o de Senha (GestÃ£o)"]}),S?n.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-6 rounded-2xl border border-orange-100 dark:border-orange-800",children:[n.jsxs("p",{className:"text-sm font-bold text-orange-800 dark:text-orange-400 mb-2",children:["Redefinindo senha para: ",S.name]}),n.jsxs("form",{onSubmit:bl,className:"flex flex-col sm:flex-row gap-2",children:[n.jsx("input",{type:"text",placeholder:"Nova Senha",required:!0,value:_,onChange:z=>J(z.target.value),className:Ve}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("button",{type:"submit",className:"flex-1 sm:flex-none bg-orange-600 text-white px-4 py-2 rounded-xl font-bold hover:bg-orange-700 transition",children:"Salvar"}),n.jsx("button",{type:"button",onClick:()=>G(null),className:"flex-1 sm:flex-none text-slate-500 px-4 hover:text-slate-700 font-medium",children:"Cancelar"})]})]})]}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:xn.filter(z=>mr(z)).length>0?xn.filter(z=>mr(z)).map(z=>n.jsxs("button",{onClick:()=>G(z),className:"p-3 border border-slate-200 dark:border-slate-700 rounded-xl text-left hover:bg-slate-50 dark:hover:bg-slate-700 transition text-sm flex justify-between items-center group bg-slate-50 dark:bg-slate-900/50",children:[n.jsxs("span",{className:"font-medium text-slate-700 dark:text-slate-200 truncate pr-2",children:[z.name," ",n.jsxs("span",{className:"text-xs text-slate-400",children:["(",z.role,")"]})]}),n.jsx(qs,{size:14,className:"text-slate-400 group-hover:text-primary-500 shrink-0"})]},z.id)):n.jsx("p",{className:"text-sm text-slate-400 italic col-span-3 bg-slate-50 dark:bg-slate-900 p-4 rounded-xl text-center",children:"Nenhum usuÃ¡rio disponÃ­vel para redefiniÃ§Ã£o."})})]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("users"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-purple-100 text-purple-600 rounded-lg mr-4 shrink-0",children:n.jsx(Ws,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h(Ue?"admin.family_members":"admin.user_management")})]}),y==="users"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="users"&&n.jsxs("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:[B?n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl mb-6 border border-slate-200 dark:border-slate-700 animate-scale-in p-4 sm:p-6 shadow-lg shadow-slate-200/50 dark:shadow-none max-h-[80vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex justify-between mb-4 sm:mb-6 sticky top-0 bg-white dark:bg-slate-800 py-2 -mt-2 z-10",children:[n.jsx("h4",{className:"font-bold text-base sm:text-lg text-slate-800 dark:text-white",children:P?"Editar Perfil":"Novo Perfil"}),n.jsx("button",{type:"button",onClick:()=>R(!1),className:"text-slate-400 hover:text-slate-600 p-1",children:n.jsx(at,{size:22})})]}),n.jsxs("form",{onSubmit:gl,children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nome"}),n.jsx("input",{type:"text",required:!0,value:ee.name,onChange:z=>Ne({...ee,name:z.target.value}),className:Ve})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Email (Opcional)"}),n.jsx("input",{type:"email",value:ee.email,onChange:z=>Ne({...ee,email:z.target.value}),className:Ve,placeholder:"usuario@exemplo.com"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"UsuÃ¡rio (Login)"}),n.jsx("input",{type:"text",required:!0,value:ee.username,onChange:z=>Ne({...ee,username:z.target.value}),className:Ve})]}),!P&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Senha Inicial"}),n.jsx("input",{type:"password",required:!0,value:ee.password,onChange:z=>Ne({...ee,password:z.target.value}),className:Ve})]}),Be&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"PermissÃ£o"}),n.jsxs("select",{value:ee.role,onChange:z=>Ne({...ee,role:z.target.value}),className:Ve,children:[n.jsx("option",{value:Re.MEMBER,children:h("admin.role_member")}),n.jsx("option",{value:Re.MANAGER,children:h("admin.role_family_manager")}),n.jsx("option",{value:Re.ADMIN,children:h("admin.role_admin")}),n.jsx("option",{value:Re.TRANSLATOR,children:h("admin.role_translator")}),Ee&&n.jsx("option",{value:Re.SUPER_ADMIN,children:h("admin.role_super_admin")})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Data de Nascimento"}),n.jsx("input",{type:"date",value:ee.birthDate,onChange:z=>Ne({...ee,birthDate:z.target.value}),className:Ve})]}),n.jsxs("div",{className:"flex items-center p-3 sm:p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-200 dark:border-slate-700 col-span-1 sm:col-span-2",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("span",{className:"block text-sm font-bold text-slate-700 dark:text-white flex items-center",children:[n.jsx(Ut,{size:14,className:"mr-1 shrink-0"})," Privacidade"]}),n.jsx("span",{className:"text-xs text-slate-400 block truncate",children:"Permitir que o gestor visualize finanÃ§as (se > 18)"})]}),n.jsx("input",{type:"checkbox",checked:ee.allowParentView,onChange:z=>Ne({...ee,allowParentView:z.target.checked}),className:"w-5 h-5 rounded border-slate-300 text-primary-600 focus:ring-primary-500 ml-2 shrink-0"})]}),n.jsxs("div",{className:"col-span-1 sm:col-span-2",children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-2",children:"Avatar / Foto"}),n.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 sm:gap-4 p-3 sm:p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-200 dark:border-slate-700",children:[n.jsx("div",{className:"relative group w-14 h-14 sm:w-16 sm:h-16 rounded-full overflow-hidden bg-white border-2 border-slate-200 shrink-0",children:n.jsx("img",{src:ee.avatar||"/default-avatar.svg",className:"w-full h-full object-cover"})}),n.jsx("div",{className:"flex-1 w-full sm:w-auto",children:n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"file",accept:"image/*",onChange:_l,className:"hidden",id:"avatar-upload"}),n.jsxs("label",{htmlFor:"avatar-upload",className:"cursor-pointer inline-flex items-center justify-center w-full sm:w-auto px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-xl hover:bg-white dark:hover:bg-slate-700 transition text-slate-600 dark:text-slate-300 font-bold text-sm",children:[n.jsx(Zs,{size:16,className:"mr-2"}),"Escolher arquivo"]})]})})]})]})]}),n.jsx("button",{type:"submit",className:"mt-4 sm:mt-6 bg-primary-600 text-white w-full py-3 rounded-xl font-bold hover:bg-primary-700 shadow-lg shadow-primary-500/30 transition text-sm sm:text-base",children:"Salvar AlteraÃ§Ãµes"})]})]}):n.jsxs("button",{onClick:()=>{D(null),Ne({name:"",email:"",username:"",password:"",role:Re.MEMBER,avatar:"/default-avatar.svg",birthDate:"",allowParentView:!0}),R(!0)},className:"mb-6 flex items-center gap-2 px-6 py-3 bg-primary-50 text-primary-700 dark:bg-primary-900/20 dark:text-primary-300 rounded-xl font-bold hover:bg-primary-100 dark:hover:bg-primary-900/40 transition w-full sm:w-auto justify-center",children:[n.jsx(qo,{size:18})," ",Ue?"Adicionar Membro":"Adicionar UsuÃ¡rio"]}),n.jsx("div",{className:"space-y-3",children:xn.map(z=>{const Te=Nl(z.birthDate),ot=Te<18||z.allowParentView;return n.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 bg-white dark:bg-slate-900/30 rounded-2xl hover:bg-slate-50 dark:hover:bg-slate-700/50 transition border border-slate-200 dark:border-slate-700 shadow-sm gap-4",children:[n.jsxs("div",{className:"flex items-center gap-4 min-w-0",children:[n.jsx("img",{src:z.avatar,className:"w-12 h-12 rounded-full border-2 border-slate-100 dark:border-slate-600 object-cover shrink-0"}),n.jsxs("div",{className:"min-w-0",children:[n.jsxs("p",{className:"font-bold text-slate-800 dark:text-white flex items-center text-lg truncate",children:[z.name,z.id===i.id&&n.jsx("span",{className:"ml-2 text-[10px] bg-primary-100 text-primary-600 px-2 py-0.5 rounded-full uppercase tracking-wider shrink-0",children:"Eu"})]}),n.jsxs("div",{className:"flex gap-2 text-xs mt-1",children:[n.jsx("span",{className:"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-2 py-0.5 rounded-full font-medium whitespace-nowrap",children:z.role}),z.birthDate&&n.jsxs("span",{className:"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 px-2 py-0.5 rounded-full font-medium whitespace-nowrap",children:[Te," anos"]})]})]})]}),n.jsxs("div",{className:"flex gap-2 items-center w-full sm:w-auto justify-end",children:[z.createdBy===i.id&&n.jsx("span",{title:ot?"VisÃ­vel para vocÃª":"Privado",className:`p-2 rounded-lg ${ot?"bg-emerald-50 text-emerald-500":"bg-slate-100 text-slate-400"}`,children:ot?n.jsx(Yl,{size:18}):n.jsx(Ut,{size:18})}),n.jsx("button",{onClick:()=>{D(z),Ne({name:z.name,email:z.email||"",username:z.username,password:"",role:z.role,avatar:z.avatar,birthDate:z.birthDate||"",allowParentView:z.allowParentView||!1}),R(!0)},className:"p-2 text-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-lg transition",children:n.jsx(wr,{size:18})}),(Ee||Be&&z.role!==Re.SUPER_ADMIN&&z.role!==Re.ADMIN||Ue&&z.role===Re.MEMBER&&z.familyId===i.familyId)&&z.id!==i.id&&n.jsx("button",{onClick:()=>yl(z.id,z.name),className:"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded-lg transition",children:n.jsx(Qe,{size:18})})]})]},z.id)})})]})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("github"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400 rounded-lg mr-4 shrink-0",children:n.jsx(Xl,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"RepositÃ³rio GitHub"})]}),y==="github"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="github"&&n.jsxs("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:[n.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:["Configure o repositÃ³rio GitHub que serÃ¡ usado para atualizar o sistema. Use o formato completo: ",n.jsx("code",{className:"bg-slate-100 dark:bg-slate-900 px-2 py-1 rounded text-xs",children:"https://github.com/usuario/repo"})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("input",{type:"text",value:Oe,onChange:z=>We(z.target.value),placeholder:"https://github.com/seu-usuario/seu-repositorio",className:Ve}),n.jsxs("button",{onClick:kl,className:"bg-slate-800 text-white px-6 rounded-xl font-bold hover:bg-slate-700 transition shadow-lg shadow-slate-500/20 shrink-0 flex items-center gap-2",children:[n.jsx(ut,{size:18})," Salvar"]})]})]})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("update"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-emerald-100 text-emerald-600 rounded-lg mr-4 shrink-0",children:n.jsx(_s,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"AtualizaÃ§Ã£o do Sistema"})]}),y==="update"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="update"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:n.jsxs("div",{className:"grid gap-6",children:[n.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/30 dark:to-emerald-800/20 p-6 rounded-2xl border border-emerald-200 dark:border-emerald-800",children:[n.jsx("h4",{className:"font-bold text-emerald-800 dark:text-emerald-400 text-lg mb-4",children:"ðŸš€ AtualizaÃ§Ã£o AutomÃ¡tica"}),n.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-300 mb-4",children:"Atualize seu sistema diretamente pela interface. O processo inclui: git pull, npm install, build e restart."}),us?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-sm font-bold text-emerald-700 dark:text-emerald-300",children:Ft.status}),n.jsxs("span",{className:"text-sm font-bold text-emerald-700 dark:text-emerald-300",children:[Ft.current,"%"]})]}),n.jsx("div",{className:"w-full bg-emerald-200 dark:bg-emerald-900/50 rounded-full h-4 overflow-hidden",children:n.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 h-full transition-all duration-300",style:{width:`${Ft.current}%`}})})]}):n.jsxs("button",{onClick:async()=>{if(confirm(`âš ï¸ Seu sistema serÃ¡ reiniciado!

Deseja atualizar agora?`)){Wt(!0);try{const z=setInterval(async()=>{try{const Te=await bo.checkUpdateProgress();le(Te)}catch{}},500);await bo.executeUpdate(),clearInterval(z),le({current:100,total:100,status:"AtualizaÃ§Ã£o concluÃ­da! Recarregando..."}),setTimeout(()=>{window.location.reload()},2e3)}catch(z){alert("Erro na atualizaÃ§Ã£o: "+z.message),Wt(!1),le({current:0,total:100,status:"Erro"})}}},className:"w-full py-3 px-4 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 transition flex items-center justify-center gap-2 shadow-lg",children:[n.jsx(_s,{size:18})," Atualizar Agora"]})]}),n.jsx("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-slate-200 dark:border-slate-700",children:n.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["âš ï¸ ",n.jsx("strong",{children:"AtenÃ§Ã£o:"})," A atualizaÃ§Ã£o pode levar alguns minutos. O sistema serÃ¡ reiniciado automaticamente. Todos os usuÃ¡rios serÃ£o desconectados."]})})]})})]}),Be&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("backup"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg mr-4 shrink-0",children:n.jsx(Zl,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h("admin.backup_restore")})]}),y==="backup"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="backup"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:n.jsxs("div",{className:"grid gap-8",children:[n.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/20 p-6 rounded-2xl border border-blue-200 dark:border-blue-800",children:[n.jsxs("h4",{className:"font-bold text-blue-800 dark:text-blue-400 text-lg mb-4",children:["ðŸ“¥ ",h("admin.manual_database_backup")]}),n.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mb-4",children:"Cria um arquivo JSON com todos os seus dados. Pode ser restaurado depois."}),jt?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-sm font-bold text-blue-700 dark:text-blue-300",children:gt.status}),n.jsxs("span",{className:"text-sm font-bold text-blue-700 dark:text-blue-300",children:[gt.current,"%"]})]}),n.jsx("div",{className:"w-full bg-blue-200 dark:bg-blue-900/50 rounded-full h-3 overflow-hidden",children:n.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full transition-all duration-300",style:{width:`${gt.current}%`}})})]}):n.jsxs("button",{onClick:async()=>{xt(!0);try{const z=await xo.createBackup();yt({current:100,total:100,status:"Completo!"});const Te=JSON.stringify(z.data,null,2),$e=new Blob([Te],{type:"application/json"}),ot=URL.createObjectURL($e),Yt=document.createElement("a");Yt.href=ot,Yt.download=`backup-${new Date().toISOString().split("T")[0]}.json`,Yt.click(),URL.revokeObjectURL(ot),setTimeout(()=>{xt(!1),yt({current:0,total:100,status:"idle"})},1500)}catch(z){alert("Erro no backup: "+z.message),xt(!1),yt({current:0,total:100,status:"Erro"})}},className:"w-full py-3 px-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition flex items-center justify-center gap-2 shadow-lg",children:[n.jsx(er,{size:18})," Fazer Backup Agora"]})]}),n.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/20 p-6 rounded-2xl border border-orange-200 dark:border-orange-800",children:[n.jsx("h4",{className:"font-bold text-orange-800 dark:text-orange-400 text-lg mb-4",children:"ðŸ“¤ Restaurar Base de Dados"}),n.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300 mb-4",children:"âš ï¸ SubstituirÃ¡ TODOS os dados atuais. Esta aÃ§Ã£o Ã© irreversÃ­vel!"}),dt?n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"text-sm font-bold text-orange-700 dark:text-orange-300",children:Mt.status}),n.jsxs("span",{className:"text-sm font-bold text-orange-700 dark:text-orange-300",children:[Mt.current,"%"]})]}),n.jsx("div",{className:"w-full bg-orange-200 dark:bg-orange-900/50 rounded-full h-3 overflow-hidden",children:n.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 h-full transition-all duration-300",style:{width:`${Mt.current}%`}})})]}):n.jsxs("label",{className:"w-full py-3 px-4 bg-orange-600 text-white font-bold rounded-xl hover:bg-orange-700 transition flex items-center justify-center gap-2 cursor-pointer shadow-lg",children:[n.jsx(Zs,{size:18})," Escolher Arquivo JSON",n.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:async z=>{const Te=z.target.files?.[0];if(Te&&confirm(`âš ï¸ CUIDADO!

Todos os seus dados atuais serÃ£o perdidos!
Tem certeza que deseja restaurar?`)){et(!0);try{const $e=await Te.text(),ot=JSON.parse($e);Dt({current:30,total:100,status:"Validando backup..."});const Yt=await xo.restoreBackup(ot);Dt({current:100,total:100,status:"Restauro completo!"}),setTimeout(()=>{alert(`Dados restaurados com sucesso!
A pÃ¡gina serÃ¡ recarregada.`),window.location.reload()},1500)}catch($e){alert("Erro na restauraÃ§Ã£o: "+$e.message),et(!1),Dt({current:0,total:100,status:"Erro"})}}}})]})]}),n.jsx("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 rounded-xl border border-slate-200 dark:border-slate-700",children:n.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["ðŸ’¡ ",n.jsx("strong",{children:"Dica:"})," FaÃ§a backups regularmente! Em produÃ§Ã£o, recomendamos backups automÃ¡ticos diÃ¡rios."]})})]})})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("notifications"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-purple-100 text-purple-600 rounded-lg mr-4 shrink-0",children:n.jsx(It,{size:20})}),n.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:["ðŸŒ ",h("admin.notification_settings")]})]}),y==="notifications"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="notifications"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:n.jsx(Qi,{isSuperAdmin:!0})})]}),(Ee||i.role===Re.TRANSLATOR)&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("translations"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-purple-100 text-purple-600 rounded-lg mr-4 shrink-0",children:n.jsx(Ks,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h("translations.manager_title")})]}),y==="translations"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="translations"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:n.jsx(ll,{currentUser:i})})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("api-configs"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-blue-100 text-blue-600 rounded-lg mr-4 shrink-0",children:n.jsx(qs,{size:20})}),n.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:["ðŸ”‘ ",h("admin.api_settings")]})]}),y==="api-configs"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="api-configs"&&n.jsxs("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down space-y-6",children:[n.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/30 p-6 rounded-2xl space-y-4",children:[n.jsx("h4",{className:"font-bold text-slate-800 dark:text-white",children:h(O?"admin.edit_config":"admin.add_new_config")}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-2",children:"Provedor"}),n.jsxs("select",{value:he,onChange:z=>de(z.target.value),disabled:!!O,className:"w-full px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white disabled:opacity-50",children:[n.jsx("option",{value:"",children:"Selecione um provedor"}),n.jsx("option",{value:"google_gemini",children:"Google Gemini"}),n.jsx("option",{value:"openrouter",children:"OpenRouter"}),n.jsx("option",{value:"puter",children:"Puter"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-2",children:"API Key"}),n.jsx("input",{type:"password",value:xe,onChange:z=>V(z.target.value),placeholder:"Sua chave de API",className:"w-full px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-600 dark:text-slate-400 mb-2",children:"Modelo (Opcional)"}),n.jsx("input",{type:"text",value:pe,onChange:z=>_e(z.target.value),placeholder:"Ex: openai/gpt-4-turbo",className:"w-full px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-800 dark:text-white"})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:ne,className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition flex items-center justify-center gap-2",children:[n.jsx(ut,{size:16})," ",O?"Atualizar":"Salvar"]}),O&&n.jsx("button",{onClick:()=>{oe(null),de(""),V(""),_e("")},className:"px-4 py-2 bg-slate-300 hover:bg-slate-400 text-slate-800 rounded-lg font-bold transition",children:"Cancelar"})]}),X&&n.jsxs("div",{className:"bg-green-100 border border-green-300 text-green-700 px-4 py-2 rounded-lg flex items-center gap-2",children:[n.jsx(vt,{size:16})," ConfiguraÃ§Ã£o salva com sucesso!"]})]}),se?n.jsxs("div",{className:"text-center py-4 text-slate-600",children:[n.jsx(ze,{className:"animate-spin inline",size:20})," Carregando..."]}):E.length===0?n.jsx("p",{className:"text-center text-slate-600 dark:text-slate-400 py-4",children:"Nenhuma configuraÃ§Ã£o de API cadastrada"}):n.jsx("div",{className:"space-y-3",children:E.map(z=>n.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/30 p-4 rounded-lg flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-slate-800 dark:text-white capitalize",children:z.provider.replace("_"," ")}),z.model&&n.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["Modelo: ",z.model]}),n.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-500",children:["Criado em: ",new Date(z.created_at).toLocaleDateString()]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>{oe(z),de(z.provider),V(""),_e(z.model||"")},className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-bold transition",children:[n.jsx(wr,{size:16,className:"inline mr-1"})," Editar"]}),n.jsxs("button",{onClick:()=>ke(z.id),className:"px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-bold transition",children:[n.jsx(Qe,{size:16,className:"inline mr-1"})," Deletar"]})]})]},z.id))})]}),Ee&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsxs("div",{onClick:()=>je("currency"),className:"p-6 flex justify-between items-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:"p-2 bg-emerald-100 text-emerald-600 rounded-lg mr-4 shrink-0",children:n.jsx(Pn,{size:20})}),n.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:h("common.conversion_providers")||"Provedores de ConversÃ£o"})]}),y==="currency"?n.jsx(nt,{size:20}):n.jsx(rt,{size:20})]}),y==="currency"&&n.jsx("div",{className:"p-8 border-t border-slate-100 dark:border-slate-700 animate-slide-down",children:n.jsx(cx,{currentProvider:te,onProviderChange:z=>H(z)})})]})]})]})]})},fx=({transactions:t,budgets:e,saveBudget:s,currencyFormatter:r})=>{const{t:a}=He(),[o,i]=T.useState(null),[d,u]=T.useState(""),[f,m]=T.useState(!1),[p,h]=T.useState(!1),[g,y]=T.useState(""),[b,w]=T.useState(""),[N,v]=T.useState(!1),[k,A]=T.useState({}),[C,P]=T.useState(""),[D,B]=T.useState([]),[R,U]=T.useState([]),[Q,S]=T.useState([]),[G,_]=T.useState(!0),J=()=>new Date().toISOString().slice(0,7),ae=T.useMemo(()=>new Set(e.map(F=>F.category)),[e]);T.useEffect(()=>{(async()=>{try{const[ue,Z]=await Promise.all([Qt.getSummary(),Qt.getHistory()]);U(ue),A(Z);const X=Object.keys(Z).sort().reverse(),me=J();X.includes(me)||X.unshift(me),B(X),P(me)}catch(ue){console.error("Erro ao carregar orÃ§amentos:",ue)}})()},[t,e]),T.useEffect(()=>{const F=J(),ue=C===F;if(_(ue),ue)S(R);else if(k[C]){const Z=k[C].map(X=>({category:X.category,limit:X.limit,spent:X.spent,percentage:X.limit>0?Math.round(X.spent/X.limit*100):0}));S(Z)}else S([])},[C,R,k]);const Y=T.useMemo(()=>{const F={};return Q.forEach(ue=>{F[ue.category]=ue.spent}),F},[Q]),te=(F,ue)=>{i(F),u(ue.toString())},H=F=>{s({category:F,limit:Number(d)}),i(null)},ce=async()=>{m(!0);try{const F=await r0(t);if(F.length===0){alert(a("ai.no_sufficient_data"));return}window.confirm(`${a("ai.suggested_budgets")} ${F.length} ${a("ai.based_on_history")}?

`+F.map(Z=>`${Z.category}: ${r(Z.limit)}`).join(`
`))&&F.forEach(Z=>s(Z))}catch{alert(a("ai.error_generating_suggestions"))}finally{m(!1)}},j=async F=>{if(e.find(X=>X.category===F&&X.isDefault)){alert(a("budget.cannot_delete_default"));return}if(window.confirm(`${a("budget.confirm_delete")} "${F}"?

${a("budget.delete_warning")}`))try{const X=await fetch(`/api/budget/limits/${encodeURIComponent(F)}`,{method:"DELETE"});if(X.ok)alert(a("budget.delete_success")),window.location.reload();else{const me=await X.json();console.error("Delete error:",me),alert(a("budget.delete_error")+": "+(me?.error||"Unknown error"))}}catch(X){console.error("Erro ao deletar:",X),alert(a("budget.delete_error")+": "+(X instanceof Error?X.message:String(X)))}},M=()=>{if(!g.trim()||!b.trim()){alert(a("budget.define_category_value"));return}if(ae.has(g.trim())){alert(a("budget.already_exists")+` "${g}"`);return}const F=Number(b);if(F<=0){alert(a("budget.value_greater_than_zero"));return}s({category:g.trim(),limit:F}),y(""),w(""),h(!1)},ie=async()=>{try{const F=await Qt.getHistory();A(F);const ue=Object.keys(F).sort().reverse();ue.length>0&&P(ue[0])}catch(F){console.error("Erro ao carregar histÃ³rico:",F)}},$=async()=>{try{const F=await Qt.saveHistory();alert(F.message),ie()}catch(F){alert("Erro ao salvar histÃ³rico: "+F.message)}};return n.jsxs("div",{className:"space-y-8 animate-fade-in",children:[n.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 p-8 rounded-3xl text-white shadow-lg shadow-blue-500/20 relative overflow-hidden",children:[n.jsx("div",{className:"absolute -right-10 -top-10 w-64 h-64 bg-white opacity-10 rounded-full blur-3xl"}),n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-2xl md:text-3xl font-bold flex items-center mb-2",children:[n.jsx(rn,{className:"mr-3"})," ",a("budget.monthly_budget"),n.jsx(hn,{text:"Defina um teto mÃ¡ximo de gastos para cada categoria. O app te avisa quando vocÃª estiver perto de estourar o limite.",className:"text-white ml-3"})]}),n.jsx("p",{className:"text-blue-100 font-medium max-w-xl text-sm md:text-base",children:"Defina tetos de gastos para cada categoria. Manter-se dentro do orÃ§amento Ã© o primeiro passo para a liberdade financeira."})]}),n.jsxs("div",{className:"flex gap-2 flex-wrap md:flex-nowrap",children:[n.jsxs("button",{onClick:()=>{v(!0),ie()},className:"bg-white/20 backdrop-blur-md border border-white/30 text-white px-4 md:px-5 py-3 rounded-2xl font-bold flex items-center gap-2 hover:bg-white/30 transition text-sm md:text-base",children:[n.jsx(Xs,{size:18}),a("common.history")]}),n.jsxs("button",{"data-tour":"ai-budget-suggest",onClick:ce,disabled:f,className:"bg-white/20 backdrop-blur-md border border-white/30 text-white px-4 md:px-5 py-3 rounded-2xl font-bold flex items-center gap-2 hover:bg-white/30 transition disabled:opacity-70 text-sm md:text-base",children:[f?n.jsx(ze,{className:"animate-spin",size:18}):n.jsx(st,{size:18,className:"text-yellow-300"}),a("budget.suggest_ai")]})]})]})]}),N&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 p-6 animate-slide-in-left",children:[n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white text-lg flex items-center gap-2",children:[n.jsx(Xs,{size:20,className:"text-primary-600"}),a("budget.history")]}),n.jsx("button",{onClick:()=>v(!1),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:n.jsx(at,{size:20})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsxs("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:[a("budget.select_month"),":"]}),n.jsxs("select",{value:C,onChange:F=>P(F.target.value),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm",children:[n.jsxs("option",{value:"",children:[a("budget.choose_month"),"..."]}),Object.keys(k).sort().reverse().map(F=>n.jsx("option",{value:F,children:F},F))]})]}),C&&k[C]&&n.jsx("div",{className:"space-y-3",children:k[C].map(F=>{const ue=F.limit>0?F.spent/F.limit*100:0,Z=F.limit>0&&F.spent>F.limit,X=F.category.startsWith("budget.category.")?a(F.category):F.category;return n.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/50 rounded-xl border border-slate-200 dark:border-slate-700",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsx("h4",{className:"font-bold text-slate-800 dark:text-white",children:X}),n.jsxs("span",{className:`text-xs font-bold px-2 py-1 rounded-full ${Z?"bg-rose-100 text-rose-700":"bg-emerald-100 text-emerald-700"}`,children:[ue.toFixed(0),"%"]})]}),n.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[n.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:[a("budget.limit"),": ",n.jsxs("span",{className:"font-bold",children:[F.limit.toFixed(2)," Kz"]})]}),n.jsxs("span",{className:`font-bold ${Z?"text-rose-600":"text-slate-800 dark:text-white"}`,children:[a("budget.spent"),": ",F.spent.toFixed(2)," Kz"]})]}),n.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2 overflow-hidden",children:n.jsx("div",{className:`h-2 transition-all duration-300 ${Z?"bg-rose-500":"bg-emerald-500"}`,style:{width:`${Math.min(ue,100)}%`}})})]},F.category)})}),Object.keys(k).length===0&&n.jsx("p",{className:"text-center text-slate-400 py-8",children:a("budget.no_history")}),n.jsxs("button",{onClick:$,className:"w-full p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold transition flex items-center justify-center gap-2",children:[n.jsx(ut,{size:18}),a("budget.save_current_history")]})]})]}),p&&G&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 p-6 animate-slide-in-left",children:[n.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white text-lg mb-4 flex items-center gap-2",children:[n.jsx(Bt,{size:20,className:"text-primary-600"}),a("budget.new_budget")]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:a("budget.category_name")}),n.jsx("input",{type:"text",value:g,onChange:F=>y(F.target.value),placeholder:a("budget.placeholder"),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:a("budget.unique_category_hint")})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 block mb-2",children:a("budget.monthly_limit")}),n.jsx("input",{type:"number",value:b,onChange:F=>w(F.target.value),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm",placeholder:"0.00",min:"0",step:"0.01"}),b&&n.jsx("p",{className:"text-right text-xs font-bold text-primary-600 dark:text-primary-400 mt-1",children:r(Number(b))})]}),n.jsxs("div",{className:"flex gap-2 pt-2",children:[n.jsxs("button",{onClick:M,className:"flex-1 p-3 bg-primary-600 text-white rounded-xl hover:bg-primary-700 font-bold transition flex items-center justify-center gap-2",children:[n.jsx(ut,{size:18}),a("budget.create_budget")]}),n.jsxs("button",{onClick:()=>{h(!1),y(""),w("")},className:"flex-1 p-3 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 font-bold transition flex items-center justify-center gap-2",children:[n.jsx(at,{size:18}),a("common.cancel")]})]})]})]}),n.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-4 sm:p-6 mb-6",children:n.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4",children:[n.jsxs("label",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 whitespace-nowrap",children:[a("budget.select_month"),":"]}),n.jsxs("div",{className:"relative flex-1 sm:max-w-xs",children:[n.jsx("select",{value:C,onChange:F=>P(F.target.value),className:"w-full p-3 rounded-xl border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm font-semibold bg-white dark:bg-slate-700 appearance-none cursor-pointer pr-10",children:D.map(F=>{const ue=J(),X=F===ue?`${F} ${a("budget.this_month")}`:F;return n.jsx("option",{value:F,children:X},F)})}),n.jsx(Cs,{size:16,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 pointer-events-none"})]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6","data-tour":"budget-cards",children:[!p&&G&&n.jsxs("button",{onClick:()=>h(!0),className:"h-full min-h-[280px] bg-gradient-to-br from-primary-50 dark:from-primary-900/20 to-primary-100/50 dark:to-primary-900/10 border-2 border-dashed border-primary-300 dark:border-primary-700 rounded-3xl flex flex-col items-center justify-center hover:border-primary-500 dark:hover:border-primary-500 transition hover:shadow-md dark:hover:shadow-primary-500/20",children:[n.jsx(Bt,{size:40,className:"text-primary-500 mb-2"}),n.jsx("span",{className:"font-bold text-primary-600 dark:text-primary-400",children:a("budget.add_budget")})]}),Q.length===0&&n.jsx("div",{className:"col-span-full text-center py-12",children:n.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-medium",children:a("budget.no_data")})}),e.map(F=>{const ue=F.limit,Z=F.category,X=F.translationKey,me=F.isDefault||!1,ye=X?a(X):Z,be=Y[Z]||Y[X||""]||0,Ae=ue>0?be/ue*100:0,fe=ue>0&&be>ue,x=ue>0&&be>ue*.9&&!fe;return n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 p-4 sm:p-6 flex flex-col justify-between transition-transform hover:-translate-y-1 duration-300",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex justify-between items-start mb-4 gap-2",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm sm:text-base md:text-lg line-clamp-2 break-words",children:ye}),me&&n.jsx("span",{className:"text-xs font-bold px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full whitespace-nowrap flex-shrink-0",children:a("budget.default")})]}),fe&&n.jsx(is,{className:"text-rose-500 animate-pulse",size:22}),!fe&&ue>0&&n.jsx(vt,{className:"text-emerald-500",size:22})]}),n.jsxs("div",{className:"flex justify-between items-end mb-2 gap-2 min-w-0",children:[n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-xs uppercase",children:a("budget.spent")}),n.jsx("span",{className:`text-base sm:text-lg md:text-xl lg:text-2xl font-bold truncate ${fe?"text-rose-600":"text-slate-800 dark:text-white"}`,children:r(be)})]}),n.jsxs("div",{className:"text-right flex flex-col min-w-0",children:[n.jsx("span",{className:"text-slate-600 dark:text-slate-400 text-xs uppercase",children:a("budget.target")}),n.jsx("span",{className:"block text-slate-400 font-medium text-xs sm:text-sm truncate",children:r(ue)})]})]}),n.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-700 rounded-full h-4 mb-6 overflow-hidden",children:n.jsx("div",{className:`h-4 rounded-full transition-all duration-700 ease-out ${fe?"bg-rose-500":x?"bg-amber-400":"bg-emerald-500"}`,style:{width:`${Math.min(Ae,100)}%`}})})]}),n.jsx("div",{className:"border-t border-slate-50 dark:border-slate-700 pt-3 sm:pt-4 space-y-2",children:o===Z&&G?n.jsxs("div",{className:"flex items-center space-x-2 animate-fade-in gap-1 sm:gap-2",children:[n.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[n.jsx("input",{type:"number",value:d,onChange:K=>u(K.target.value),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 dark:bg-slate-700 dark:text-white text-xs sm:text-sm focus:ring-2 focus:ring-primary-500 outline-none",autoFocus:!0,placeholder:a("budget.new_limit_placeholder")}),d&&n.jsx("p",{className:"text-right text-xs font-bold text-primary-600 dark:text-primary-400 mt-1 truncate",children:r(Number(d))})]}),n.jsx("button",{onClick:()=>H(Z),className:"p-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 shadow flex-shrink-0",children:n.jsx(ut,{size:16,className:"sm:w-18"})})]}):n.jsx("div",{className:"flex justify-between items-center gap-2 min-w-0",children:G?n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>te(Z,ue),className:"flex items-center text-xs sm:text-sm font-bold text-slate-400 hover:text-primary-600 transition truncate",children:[n.jsx(Ql,{size:14,className:"sm:w-16 mr-1 flex-shrink-0"}),n.jsx("span",{className:"hidden sm:inline",children:a(ue===0?"budget.set_limit":"budget.adjust_target")}),n.jsx("span",{className:"sm:hidden",children:a(ue===0?"budget.set_limit":"budget.adjust_target")})]}),!me&&n.jsx("button",{onClick:()=>j(Z),className:"p-1.5 text-slate-400 hover:text-rose-600 transition hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded-lg flex-shrink-0",title:a("budget.delete"),children:n.jsx(Qe,{size:14,className:"sm:w-16"})})]}):n.jsx("p",{className:"text-xs sm:text-sm text-slate-400 italic",children:a("budget.view_only_history")})})})]},Z)})]})]})},ct={USD:926.5,EUR:1003.2,BRL:188.1,GBP:1168,CNY:127.3,ZAR:49.1,JPY:6.35},dl={USD:930.1,EUR:1008.5,BRL:189.5,GBP:1175.2,CNY:128,ZAR:49.5,JPY:6.4},cl={USD:1150,EUR:1240,BRL:230,GBP:1450,CNY:160,ZAR:60,JPY:8},mx=async(t="EXCHANGERATE_API")=>{try{const s=await fetch(`/api/settings/rates/${t}`);if(s.ok){const r=await s.json();return{AOA:r.AOA||1,USD:r.USD||ct.USD,EUR:r.EUR||ct.EUR,BRL:r.BRL||ct.BRL,GBP:r.GBP||ct.GBP,CNY:r.CNY||ct.CNY,ZAR:r.ZAR||ct.ZAR,JPY:r.JPY||ct.JPY,lastUpdate:r.lastUpdate||new Date().toISOString(),source:r.source}}}catch(s){console.warn("Error fetching live exchange rates, using fallback:",s)}let e=ct;return t==="FOREX"&&(e=dl),t==="PARALLEL"&&(e=cl),t==="EXCHANGERATE_API"&&(e=ct),t==="FAWAZ_AHMED"&&(e=ct),{AOA:1,USD:e.USD,EUR:e.EUR,BRL:e.BRL,GBP:e.GBP,CNY:e.CNY,ZAR:e.ZAR,JPY:e.JPY,lastUpdate:new Date().toISOString(),source:"fallback"}};let ps=null;const hx=720*60*1e3,px=async()=>{const t=Date.now();if(ps&&t-ps.timestamp<hx)return ps.data;try{const e=await fetch("https://api.worldbank.org/v2/country/AO/indicator/FP.CPI.TOTL.ZG?format=json&per_page=100&date=2020:2025");if(!e.ok)throw new Error("Failed to fetch World Bank inflation data");const a=((await e.json())[1]||[]).filter(p=>p.value!==null&&p.date).sort((p,h)=>parseInt(p.date)-parseInt(h.date));if(a.length===0)throw new Error("No inflation data available");const o=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],i=new Date().getFullYear(),d=a[a.length-1],u=parseFloat(d.value);let f=[],m=u;return o.forEach((p,h)=>{const g=u/12+Math.sin(h)*.5;f.push({month:p,rate:Number(Math.max(0,g).toFixed(2)),accumulated:Number(m.toFixed(2))})}),ps={data:f,timestamp:t},f}catch(e){console.warn("Error fetching World Bank inflation data, using fallback:",e);const s=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],r=42;let a=24.5;const o=s.map((i,d)=>{const u=Yn(r+d),f=Yn(r+d+100),m=u*1+1.5;return a+=f*.4+.1,{month:i,rate:Number(m.toFixed(2)),accumulated:Number(a.toFixed(2))}});return ps={data:o,timestamp:t},o}},Yn=t=>{const e=Math.sin(t)*1e4;return e-Math.floor(e)},gx=(t,e,s,r="BNA")=>{const a=s==="1A"?12:s==="2A"?24:60,o=[],i=new Date;let d=ct;r==="FOREX"&&(d=dl),r==="PARALLEL"&&(d=cl);const u=t==="AOA"?1:d[t]||1,f=e==="AOA"?1:d[e]||1;let p=u/f,h=.015;r==="PARALLEL"&&(h=.035),r==="FOREX"&&(h=.02);const g=t.charCodeAt(0)+e.charCodeAt(0)+(r==="BNA"?1:r==="FOREX"?2:3)*100+(s==="1A"?1:s==="2A"?2:3)*1e3;o.push({date:"Atual",rate:Number(p.toFixed(4))});for(let y=1;y<=a;y++){const b=new Date(i.getFullYear(),i.getMonth()-y,1),N=1+(Yn(g+y)*h*2-h);p=p/N,o.unshift({date:b.toLocaleDateString("pt-BR",{month:"short",year:"2-digit"}),rate:Number(p.toFixed(4))})}return o},xx=({rateProvider:t="EXCHANGERATE_API",setRateProvider:e,currencyFormatter:s=r=>`${r.toFixed(2)}`})=>{const{t:r}=He(),[a,o]=T.useState([]),[i,d]=T.useState(0),[u,f]=T.useState(1e4),[m,p]=T.useState(1e4),[h,g]=T.useState("Aguardando dados de mercado..."),[y,b]=T.useState("USD"),[w,N]=T.useState("AOA"),[v,k]=T.useState("1A"),[A,C]=T.useState([]);T.useEffect(()=>{(async()=>{try{const G=await px();o(G);const _=G[G.length-1].accumulated;d(_)}catch(G){console.error("Error loading inflation history:",G)}})();const U=["BNA mantÃ©m taxas inalteradas.","Cesta bÃ¡sica sobe 2.3%.","Alta volatilidade no mercado paralelo.","Transportes impulsionam inflaÃ§Ã£o."];let Q=0;const S=setInterval(()=>{g(U[Q%U.length]),Q++},5e3);return()=>clearInterval(S)},[]),T.useEffect(()=>{const R=u/(1+i/100);p(R)},[u,i]),T.useEffect(()=>{const R=gx(y,w,v,t);C(R)},[y,w,v,t]);const P=()=>{const R=y;b(w),N(R)},D=["AOA","USD","EUR","BRL","GBP","CNY","ZAR","JPY"],B=u-m;return n.jsxs("div",{className:"space-y-6 md:space-y-8 animate-fade-in pb-10 w-full max-w-full overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-rose-600 to-pink-600 p-6 md:p-8 rounded-3xl text-white shadow-lg shadow-rose-500/20 relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"}),n.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center relative z-10 gap-4 w-full",children:[n.jsxs("div",{className:"max-w-xl min-w-0",children:[n.jsxs("h2",{className:"text-2xl md:text-3xl font-bold flex items-center mb-2 flex-wrap truncate",children:[n.jsx(At,{className:"mr-3 shrink-0"})," ",r("inflation_control.inflation_control")]}),n.jsx("p",{className:"text-rose-100 font-medium text-sm md:text-base leading-relaxed break-words",children:r("inflation_control.protect_purchasing_power")})]}),n.jsxs("div",{className:"w-full lg:w-auto mt-2 lg:mt-0 bg-white/20 backdrop-blur-md p-3 rounded-xl border border-white/30 shrink-0","data-tour":"inflation-source",children:[n.jsxs("label",{className:"flex items-center text-xs font-bold text-rose-100 uppercase mb-1 px-1",children:[r("inflation_control.data_source"),n.jsx(hn,{text:"Escolha entre a taxa oficial do BNA, Forex ou Paralelo.",className:"text-rose-100"})]}),n.jsxs("select",{value:t,onChange:R=>e(R.target.value),className:"bg-transparent text-white font-bold outline-none cursor-pointer w-full text-sm md:text-base appearance-none",children:[n.jsx("option",{className:"text-slate-800",value:"BNA",children:r("inflation_control.bna_official")}),n.jsx("option",{className:"text-slate-800",value:"FOREX",children:r("inflation_control.forex_global")}),n.jsx("option",{className:"text-slate-800",value:"PARALLEL",children:r("inflation_control.parallel_street")})]})]})]}),n.jsxs("div",{className:"mt-6 flex items-center bg-black/20 backdrop-blur-sm p-3 rounded-xl w-full md:w-fit max-w-full overflow-hidden",children:[n.jsx(os,{size:20,className:"text-yellow-400 mr-2 animate-pulse shrink-0"}),n.jsx("span",{className:"font-mono text-xs md:text-sm truncate w-full block",children:h})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 flex flex-col justify-center items-center text-center min-h-[200px] min-w-0",children:[n.jsx("p",{className:"text-slate-500 dark:text-slate-400 font-bold text-xs md:text-sm uppercase tracking-wider mb-2 truncate max-w-full",children:r("inflation_control.accumulated_inflation_12m")}),n.jsxs("h3",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold text-slate-800 dark:text-white tracking-tighter mb-2 tabular-nums break-words max-w-full",children:[i.toFixed(2),"%"]}),n.jsxs("div",{className:"flex items-center text-rose-500 bg-rose-50 dark:bg-rose-900/20 px-3 py-1 rounded-full text-xs md:text-sm font-bold whitespace-nowrap",children:[n.jsx(At,{size:16,className:"mr-1"})," ",r("inflation_control.uptrend_indicator")]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 flex flex-col justify-center min-w-0",children:[n.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white mb-6 flex items-center text-sm md:text-base whitespace-nowrap overflow-hidden text-ellipsis","data-tour":"purchasing-power",children:[n.jsx(ed,{className:"mr-2 text-indigo-500 shrink-0"})," ",r("inflation_control.purchasing_power_calc")]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 items-center",children:[n.jsxs("div",{className:"flex-1 w-full min-w-0",children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-2 block truncate",children:r("inflation_control.nominal_value_kz")}),n.jsxs("div",{className:"relative",children:[n.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold text-lg",children:"Kz"}),n.jsx("input",{type:"number",value:u,onChange:R=>f(Number(R.target.value)),className:"w-full pl-12 pr-4 py-3 bg-slate-50 dark:bg-slate-900 rounded-2xl border-2 border-slate-100 dark:border-slate-700 text-lg md:text-xl font-bold text-slate-800 dark:text-white focus:border-indigo-500 focus:ring-0 outline-none transition-all tabular-nums"})]}),u>0&&n.jsx("p",{className:"text-right text-xs md:text-sm font-bold text-indigo-600 dark:text-indigo-400 mt-1 animate-fade-in truncate",children:s(u)})]}),n.jsx("div",{className:"hidden sm:block text-slate-300 shrink-0",children:n.jsx(Pn,{size:24})}),n.jsxs("div",{className:"flex-1 w-full bg-slate-50 dark:bg-slate-900/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 flex flex-col items-center justify-center text-center min-w-0",children:[n.jsx("p",{className:"text-[10px] text-slate-500 font-bold uppercase mb-1 truncate max-w-full",children:"Valor Real (Ajustado)"}),n.jsx("p",{className:"text-xl md:text-2xl font-extrabold text-emerald-600 dark:text-emerald-400 tracking-tight tabular-nums mb-2 break-all",children:s(m)}),B>0&&n.jsxs("div",{className:"flex items-center justify-center text-rose-500 font-bold text-[10px] md:text-xs bg-rose-100 dark:bg-rose-900/30 px-3 py-1 rounded-full animate-pulse w-full max-w-[90%]",children:[n.jsx(Ys,{size:14,className:"mr-1 shrink-0"}),n.jsxs("span",{className:"truncate",children:[r("inflation_control.loss_label"),s(B)]})]})]})]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 md:p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 h-80 min-w-0",children:[n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-4 text-sm md:text-base",children:r("inflation_control.inflation_history")}),n.jsx("div",{className:"w-full h-[85%]",children:n.jsx(wt,{width:"100%",height:"100%",children:n.jsxs(No,{data:a,margin:{top:10,right:10,left:-20,bottom:0},children:[n.jsx("defs",{children:n.jsxs("linearGradient",{id:"colorRate",x1:"0",y1:"0",x2:"0",y2:"1",children:[n.jsx("stop",{offset:"5%",stopColor:"#f43f5e",stopOpacity:.3}),n.jsx("stop",{offset:"95%",stopColor:"#f43f5e",stopOpacity:0})]})}),n.jsx(zt,{strokeDasharray:"3 3",vertical:!1,opacity:.3}),n.jsx(qt,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8"},interval:"preserveStartEnd"}),n.jsx(Gt,{axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8"}}),n.jsx(_t,{contentStyle:{borderRadius:"12px",border:"none",backgroundColor:"#1e293b",color:"white",fontSize:"12px"},labelStyle:{color:"#94a3b8"}}),n.jsx(Zn,{wrapperStyle:{fontSize:"12px",paddingTop:"10px"}}),n.jsx(ws,{type:"monotone",dataKey:"accumulated",name:r("inflation_control.accumulated_percent"),stroke:"#f43f5e",strokeWidth:3,fillOpacity:1,fill:"url(#colorRate)"}),n.jsx(ws,{type:"monotone",dataKey:"rate",name:r("inflation_control.monthly_percent"),stroke:"#fbbf24",strokeWidth:3,fill:"transparent"})]})})})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 md:p-8 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 min-w-0",children:[n.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-center mb-6 gap-4",children:[n.jsxs("div",{className:"flex items-center gap-2 md:gap-4 bg-slate-100 dark:bg-slate-900 p-2 rounded-2xl w-full lg:w-auto justify-center overflow-x-auto",children:[n.jsx("select",{value:y,onChange:R=>b(R.target.value),className:"bg-transparent font-bold p-2 outline-none dark:text-white cursor-pointer text-sm",children:D.map(R=>n.jsx("option",{value:R,children:R},R))}),n.jsx("button",{onClick:P,className:"p-2 bg-white dark:bg-slate-700 rounded-full shadow-sm hover:scale-110 transition shrink-0",children:n.jsx(Pn,{size:16})}),n.jsx("select",{value:w,onChange:R=>N(R.target.value),className:"bg-transparent font-bold p-2 outline-none dark:text-white cursor-pointer text-sm",children:D.map(R=>n.jsx("option",{value:R,children:R},R))})]}),n.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-xl w-full lg:w-auto justify-center",children:["1A","2A","5A"].map(R=>n.jsx("button",{onClick:()=>k(R),className:`px-3 md:px-4 py-2 rounded-lg text-xs md:text-sm font-bold transition flex-1 ${v===R?"bg-white dark:bg-slate-700 shadow text-indigo-600 dark:text-white":"text-slate-400"}`,children:R},R))})]}),n.jsx("div",{className:"h-64 md:h-80 w-full",children:n.jsx(wt,{width:"100%",height:"100%",children:n.jsxs(Eo,{data:A,margin:{top:10,right:10,left:-20,bottom:0},children:[n.jsx(zt,{strokeDasharray:"3 3",vertical:!1,opacity:.3}),n.jsx(qt,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8"}}),n.jsx(Gt,{domain:["auto","auto"],axisLine:!1,tickLine:!1,tick:{fontSize:10,fill:"#94a3b8"}}),n.jsx(_t,{contentStyle:{borderRadius:"12px",border:"none",backgroundColor:"#1e293b",color:"white",fontSize:"12px"},formatter:R=>R.toFixed(4)}),n.jsx(To,{type:"monotone",dataKey:"rate",stroke:"#6366f1",strokeWidth:3,dot:!1,activeDot:{r:6}})]})})})]})]})},bx=({currencyFormatter:t,savedSimulations:e,onSaveSimulation:s,onDeleteSimulation:r})=>{const{t:a}=He(),[o,i]=T.useState(!1),[d,u]=T.useState([]),[f,m]=T.useState(""),[p,h]=T.useState(!1),[g,y]=T.useState({loanAmount:1e6,interestRateAnnual:18,termMonths:12,system:"PRICE"}),b=async C=>{if(!C.target.files||!C.target.files[0])return;const P=C.target.files[0];i(!0);try{const D=window.pdfjsLib;if(!D)throw new Error("Biblioteca PDF nÃ£o carregada.");const B=await P.arrayBuffer(),R=await D.getDocument({data:B}).promise;let U="";const Q=Math.min(R.numPages,5);for(let G=1;G<=Q;G++){const ae=(await(await R.getPage(G)).getTextContent()).items.map(Y=>Y.str).join(" ");U+=ae+" "}console.log("Texto extraÃ­do:",U.substring(0,100)+"...");const S=await e0(U);y(G=>({...G,loanAmount:S.loanAmount||G.loanAmount,interestRateAnnual:S.interestRateAnnual||G.interestRateAnnual,termMonths:S.termMonths||G.termMonths,system:S.system||G.system})),alert("Dados extraÃ­dos e preenchidos pela IA!")}catch(D){console.error(D),alert("Erro ao processar PDF. Verifique se Ã© um documento vÃ¡lido.")}finally{i(!1)}},w=()=>{const C=[],P=g.interestRateAnnual/100/12,D=g.termMonths;let B=g.loanAmount;if(g.system==="PRICE"){const R=g.loanAmount*(P*Math.pow(1+P,D))/(Math.pow(1+P,D)-1);for(let U=1;U<=D;U++){const Q=B*P,S=R-Q;B-=S,C.push({month:U,payment:R,interest:Q,principal:S,balance:B>0?B:0})}}else{const R=g.loanAmount/D;for(let U=1;U<=D;U++){const Q=B*P,S=R+Q;B-=R,C.push({month:U,payment:S,interest:Q,principal:R,balance:B>0?B:0})}}u(C)},N=()=>{if(!f.trim())return alert(a("simulations.save_name_required"));s(g,f),m(""),h(!0)},v=C=>{y({loanAmount:C.loanAmount,interestRateAnnual:C.interestRateAnnual,termMonths:C.termMonths,system:C.system}),u([])},k=d.reduce((C,P)=>C+P.interest,0),A=d.reduce((C,P)=>C+P.payment,0);return n.jsxs("div",{className:"space-y-8 animate-fade-in relative w-full max-w-full overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 p-6 md:p-8 rounded-3xl text-white shadow-lg shadow-purple-500/20 relative overflow-hidden flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-2xl md:text-3xl font-bold flex items-center mb-2",children:[n.jsx(Po,{className:"mr-3 shrink-0"})," ",a("simulations.intelligent_simulation")]}),n.jsx("p",{className:"text-purple-100 font-medium max-w-xl text-sm md:text-base",children:a("simulations.upload_pdf_instructions")})]}),n.jsxs("button",{"data-tour":"saved-simulations",onClick:()=>h(!p),className:"bg-white/20 backdrop-blur-sm p-3 rounded-xl hover:bg-white/30 transition flex items-center gap-2 whitespace-nowrap self-start sm:self-auto",children:[n.jsx(zo,{size:20})," ",a("simulations.saved_simulations")]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700",children:[n.jsx("div",{className:"mb-6",children:n.jsxs("label",{"data-tour":"pdf-upload",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-2xl cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition bg-slate-50 dark:bg-slate-800/50",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6 text-center px-4",children:[o?n.jsx(ze,{className:"animate-spin text-primary-500 mb-2"}):n.jsx(Zs,{className:"text-slate-400 mb-2"}),n.jsx("p",{className:"mb-2 text-sm text-slate-500 dark:text-slate-400 font-semibold",children:a(o?"simulations.analyzing_pdf":"simulations.upload_pdf_bank")}),n.jsx("p",{className:"text-xs text-slate-400",children:a("simulations.pdf_formats")})]}),n.jsx("input",{type:"file",className:"hidden",accept:"application/pdf",onChange:b,disabled:o})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:a("simulations.loan_amount")}),n.jsxs("div",{className:"relative",children:[n.jsx(Go,{size:16,className:"absolute left-3 top-3.5 text-slate-400"}),n.jsx("input",{type:"number",value:g.loanAmount,onChange:C=>y({...g,loanAmount:Number(C.target.value)}),className:"w-full pl-9 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 tabular-nums"})]}),n.jsx("div",{className:"text-xs text-primary-600 dark:text-primary-400 font-bold mt-1 text-right truncate",children:t(g.loanAmount)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:a("simulations.annual_rate_percent")}),n.jsxs("div",{className:"relative",children:[n.jsx(td,{size:16,className:"absolute left-3 top-3.5 text-slate-400"}),n.jsx("input",{type:"number",step:"0.1",value:g.interestRateAnnual,onChange:C=>y({...g,interestRateAnnual:Number(C.target.value)}),className:"w-full pl-9 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 tabular-nums"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:a("simulations.term_months")}),n.jsxs("div",{className:"relative",children:[n.jsx(Cs,{size:16,className:"absolute left-3 top-3.5 text-slate-400"}),n.jsx("input",{type:"number",value:g.termMonths,onChange:C=>y({...g,termMonths:Number(C.target.value)}),className:"w-full pl-9 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 tabular-nums"})]})]}),n.jsxs("div",{children:[n.jsxs("label",{className:"flex items-center text-xs font-bold text-slate-500 uppercase mb-1",children:[a("simulations.system_label"),n.jsx(hn,{text:"PRICE: Parcelas fixas, juros maiores no final. SAC: Parcelas decrescentes, paga-se menos juros no total."})]}),n.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-xl",children:[n.jsx("button",{onClick:()=>y({...g,system:"PRICE"}),className:`flex-1 py-2 rounded-lg text-sm font-bold transition ${g.system==="PRICE"?"bg-white dark:bg-slate-700 shadow text-primary-600":"text-slate-400"}`,children:"PRICE"}),n.jsx("button",{onClick:()=>y({...g,system:"SAC"}),className:`flex-1 py-2 rounded-lg text-sm font-bold transition ${g.system==="SAC"?"bg-white dark:bg-slate-700 shadow text-primary-600":"text-slate-400"}`,children:"SAC"})]})]}),n.jsxs("button",{onClick:w,className:"w-full bg-primary-600 hover:bg-primary-700 text-white font-bold py-3 rounded-xl shadow-lg shadow-primary-500/30 flex justify-center items-center",children:[a("simulations.calculate_button")," ",n.jsx(Rn,{size:18,className:"ml-2"})]}),n.jsxs("div",{className:"pt-4 border-t border-slate-100 dark:border-slate-700",children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1 block",children:a("simulations.save_scenario")}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:f,onChange:C=>m(C.target.value),placeholder:"Nome (ex: Banco X)",className:"flex-1 p-2 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm min-w-0"}),n.jsx("button",{onClick:N,className:"bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 p-2 rounded-xl text-slate-600 dark:text-slate-300 shrink-0",children:n.jsx(ut,{size:20})})]})]})]})]}),n.jsx("div",{className:"lg:col-span-2 space-y-6",children:d.length>0?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700",children:[n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:a("simulations.total_paid")}),n.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-white tabular-nums truncate",children:t(A)})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-5 rounded-2xl border border-slate-100 dark:border-slate-700",children:[n.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:a("simulations.total_interest")}),n.jsx("p",{className:"text-2xl font-bold text-rose-500 tabular-nums truncate",children:t(k)})]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 h-80 min-w-0",children:[n.jsx("h3",{className:"text-sm font-bold text-slate-500 mb-4 uppercase",children:"ComposiÃ§Ã£o da Parcela"}),n.jsx(wt,{width:"100%",height:"100%",children:n.jsxs(Ao,{data:d,children:[n.jsx(zt,{strokeDasharray:"3 3",opacity:.3,vertical:!1}),n.jsx(qt,{dataKey:"month",hide:!0}),n.jsx(Gt,{fontSize:10,tickFormatter:C=>`${C/1e3}k`}),n.jsx(_t,{contentStyle:{backgroundColor:"#1e293b",border:"none",borderRadius:"8px",color:"white"},formatter:C=>t(C)}),n.jsx(Zn,{}),n.jsx(Js,{dataKey:"principal",name:"AmortizaÃ§Ã£o",stackId:"a",fill:"#10b981"}),n.jsx(Js,{dataKey:"interest",name:"Juros",stackId:"a",fill:"#ef4444"})]})})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-soft border border-slate-100 dark:border-slate-700 overflow-hidden",children:[n.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-700/50 border-b dark:border-slate-700 font-bold text-sm text-slate-600 dark:text-slate-300",children:"Tabela de AmortizaÃ§Ã£o"}),n.jsx("div",{className:"max-h-60 overflow-y-auto overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm text-left min-w-[500px]",children:[n.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/30 sticky top-0 text-slate-400 text-xs uppercase",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:"MÃªs"}),n.jsx("th",{className:"p-3 text-right",children:"PrestaÃ§Ã£o"}),n.jsx("th",{className:"p-3 text-right",children:"Juros"}),n.jsx("th",{className:"p-3 text-right",children:"AmortizaÃ§Ã£o"}),n.jsx("th",{className:"p-3 text-right",children:"Saldo"})]})}),n.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:d.map(C=>n.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-700/30",children:[n.jsx("td",{className:"p-3 font-bold",children:C.month}),n.jsx("td",{className:"p-3 text-slate-800 dark:text-white font-medium text-right whitespace-nowrap tabular-nums",children:t(C.payment)}),n.jsx("td",{className:"p-3 text-rose-500 text-right whitespace-nowrap tabular-nums",children:t(C.interest)}),n.jsx("td",{className:"p-3 text-emerald-600 text-right whitespace-nowrap tabular-nums",children:t(C.principal)}),n.jsx("td",{className:"p-3 text-slate-500 text-right whitespace-nowrap tabular-nums",children:t(C.balance)})]},C.month))})]})})]})]}):n.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 opacity-50 min-h-[300px]",children:[n.jsx(rn,{size:64,className:"mb-4"}),n.jsx("p",{children:"Preencha os dados e calcule para ver o resultado."})]})})]}),p&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 z-40 bg-slate-900/30 backdrop-blur-sm",onClick:()=>h(!1)}),n.jsxs("div",{className:"fixed top-0 right-0 bottom-0 w-80 max-w-[85vw] bg-white dark:bg-slate-800 z-50 shadow-2xl p-6 overflow-y-auto border-l border-slate-100 dark:border-slate-700 animate-slide-left",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsx("h3",{className:"font-bold text-lg dark:text-white",children:"CenÃ¡rios Salvos"}),n.jsx("button",{onClick:()=>h(!1),className:"text-slate-400 hover:text-slate-600",children:n.jsx(Rn,{size:20})})]}),n.jsxs("div",{className:"space-y-3",children:[e.length===0&&n.jsx("p",{className:"text-slate-400 text-sm italic",children:"Nenhum cenÃ¡rio salvo."}),e.map(C=>n.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-700 hover:border-primary-300 transition group",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsx("h4",{className:"font-bold text-slate-800 dark:text-white truncate pr-2",children:C.name}),n.jsx("button",{onClick:()=>r(C.id),className:"text-slate-300 hover:text-rose-500 shrink-0",children:n.jsx(Qe,{size:14})})]}),n.jsxs("div",{className:"text-xs text-slate-500 space-y-1",children:[n.jsxs("p",{children:["Valor: ",t(C.loanAmount)]}),n.jsxs("p",{children:["Taxa: ",C.interestRateAnnual,"% | ",C.termMonths," meses"]}),n.jsxs("p",{children:["Sistema: ",C.system]})]}),n.jsx("button",{onClick:()=>{v(C),h(!1)},className:"w-full mt-3 bg-white dark:bg-slate-600 text-primary-600 dark:text-white text-xs font-bold py-2 rounded-lg shadow-sm hover:bg-primary-50",children:"Carregar"})]},C.id))]})]})]})]})},yx=({appName:t,onLogin:e})=>{const{t:s,language:r,setLanguage:a}=He(),[o,i]=T.useState("login"),[d,u]=T.useState(["pt","en","es","um","ln","fr"]);Xn.useEffect(()=>{(async()=>{try{const x=await fetch("/api/translations/languages");if(x.ok){const K=await x.json();u(K)}}catch(x){console.error("Erro ao carregar idiomas:",x)}})()},[]);const f=fe=>({pt:{pt:"PortuguÃªs",en:"Portuguese",es:"PortuguÃ©s",um:"Potogo",ln:"Lopoto",fr:"PortuguÃªs"},en:{pt:"InglÃªs",en:"English",es:"InglÃ©s",um:"Linglisi",ln:"Lingleza",fr:"Anglais"},es:{pt:"Espanhol",en:"Spanish",es:"EspaÃ±ol",um:"Sipe",ln:"Sepaniya",fr:"Espagnol"},um:{pt:"Umbundu",en:"Umbundu",es:"Umbundu",um:"Umbundu",ln:"Umbundu",fr:"Umbundu"},ln:{pt:"Lingala",en:"Lingala",es:"Lingala",um:"Lingala",ln:"Lingala",fr:"Lingala"},fr:{pt:"FrancÃªs",en:"French",es:"FrancÃ©s",um:"FrancÃªs",ln:"FrancÃªs",fr:"FranÃ§ais"},de:{pt:"AlemÃ£o",en:"German",es:"AlemÃ¡n",um:"AlemÃ£o",ln:"AlemÃ£o",fr:"Allemand"},it:{pt:"Italiano",en:"Italian",es:"Italiano",um:"Italiano",ln:"Italiano",fr:"Italien"},ja:{pt:"JaponÃªs",en:"Japanese",es:"JaponÃ©s",um:"JaponÃªs",ln:"JaponÃªs",fr:"Japonais"},zh:{pt:"ChinÃªs",en:"Chinese",es:"Chino",um:"ChinÃªs",ln:"ChinÃªs",fr:"Chinois"},ar:{pt:"Ãrabe",en:"Arabic",es:"Ãrabe",um:"Ãrabe",ln:"Ãrabe",fr:"Arabe"},ru:{pt:"Russo",en:"Russian",es:"Ruso",um:"Russo",ln:"Russo",fr:"Russe"}})[fe]?.[r]||fe.toUpperCase(),m=fe=>({pt:"ðŸ‡µðŸ‡¹",en:"ðŸ‡¬ðŸ‡§",es:"ðŸ‡ªðŸ‡¸",um:"ðŸ‡¦ðŸ‡´",ln:"ðŸ‡¨ðŸ‡©",fr:"ðŸ‡«ðŸ‡·",de:"ðŸ‡©ðŸ‡ª",it:"ðŸ‡®ðŸ‡¹",ja:"ðŸ‡¯ðŸ‡µ",zh:"ðŸ‡¨ðŸ‡³",ar:"ðŸ‡¸ðŸ‡¦",ru:"ðŸ‡·ðŸ‡º"})[fe]||"ðŸŒ",[p,h]=T.useState(""),[g,y]=T.useState(""),[b,w]=T.useState(""),[N,v]=T.useState(!1),[k,A]=T.useState(""),[C,P]=T.useState(""),[D,B]=T.useState(""),[R,U]=T.useState(""),[Q,S]=T.useState(""),[G,_]=T.useState(""),[J,ae]=T.useState(!1),[Y,te]=T.useState(!1),[H,ce]=T.useState(""),[j,M]=T.useState(""),[ie,$]=T.useState(""),[F,ue]=T.useState(""),[Z,X]=T.useState(1),me=async fe=>{fe.preventDefault(),w(""),v(!0);try{const K={...(await Vs.login(p,g)).user,languagePreference:r};await fetch(`${window.location.origin}/api/users/language`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({languagePreference:r})}).catch(()=>{}),e(K)}catch(x){let K="login.error_logging_in";x.message==="Invalid credentials"&&(K="login.invalid_credentials"),w(s(K))}finally{v(!1)}},ye=async fe=>{if(fe.preventDefault(),w(""),!J){w(s("login.must_accept_terms"));return}v(!0);try{await Vs.register({username:C,password:D,name:k,familyName:R,securityQuestion:Q,securityAnswer:G}),alert(s("login.family_registered_success")),i("login"),A(""),P(""),B(""),U(""),S(""),_(""),ae(!1)}catch(x){w(x.message||s("login.error_registering"))}finally{v(!1)}},be=async()=>{try{const x=await(await fetch(`${window.location.origin}/api/settings/terms_of_service`)).json();ce(x.value||"Nenhum termo definido ainda.")}catch{ce("Erro ao carregar termos.")}},Ae=async()=>{w(""),v(!0);try{await Vs.recoverPassword(j,ie,F),alert("Senha redefinida com sucesso!"),i("login"),X(1),M(""),$(""),ue("")}catch(fe){w(fe.message||"Erro ao recuperar senha")}finally{v(!1)}};return o==="register"?n.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 p-4",children:[n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-4 sm:p-8 w-full max-w-md border border-slate-200 dark:border-slate-700 max-h-[calc(100vh-2rem)] sm:max-h-[90vh] overflow-y-auto",children:[n.jsxs("div",{className:"flex items-center mb-6",children:[n.jsx("button",{onClick:()=>i("login"),className:"p-2 -ml-2 text-slate-400 hover:text-slate-600",children:n.jsx(Tn,{size:20})}),n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white ml-2",children:"Criar Nova FamÃ­lia"})]}),b&&n.jsxs("div",{className:"mb-4 p-4 bg-rose-50 dark:bg-rose-900/20 text-rose-600 rounded-xl text-sm flex items-center",children:[n.jsx(_n,{size:18,className:"mr-2"}),b]}),n.jsxs("form",{onSubmit:ye,className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nome Completo"}),n.jsx("input",{type:"text",value:k,onChange:fe=>A(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Seu nome",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"UsuÃ¡rio"}),n.jsx("input",{type:"text",value:C,onChange:fe=>P(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Nome de usuÃ¡rio",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Senha"}),n.jsx("input",{type:"password",autoComplete:"new-password",value:D,onChange:fe=>B(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nome da FamÃ­lia"}),n.jsx("input",{type:"text",value:R,onChange:fe=>U(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Ex: FamÃ­lia Silva",required:!0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Pergunta de SeguranÃ§a (Opcional)"}),n.jsx("input",{type:"text",value:Q,onChange:fe=>S(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Ex: Nome do primeiro animal"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Resposta de SeguranÃ§a"}),n.jsx("input",{type:"text",value:G,onChange:fe=>_(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Sua resposta"})]}),n.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700",children:[n.jsx("input",{type:"checkbox",id:"terms",checked:J,onChange:fe=>ae(fe.target.checked),className:"mt-1 w-4 h-4 accent-emerald-600"}),n.jsxs("label",{htmlFor:"terms",className:"text-sm text-slate-600 dark:text-slate-300 flex-1",children:["Aceito os"," ",n.jsx("button",{type:"button",onClick:()=>{be(),te(!0)},className:"text-emerald-600 dark:text-emerald-400 font-bold hover:underline",children:"Termos e CondiÃ§Ãµes"})]})]}),n.jsx("button",{type:"submit",disabled:N||!J,className:"w-full py-3 bg-emerald-600 text-white font-bold rounded-xl hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:N?"Registrando...":"Criar FamÃ­lia"})]})]}),Y&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl max-w-2xl w-full max-h-[80vh] flex flex-col border border-slate-200 dark:border-slate-700",children:[n.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700",children:[n.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Termos e CondiÃ§Ãµes"}),n.jsx("button",{onClick:()=>te(!1),className:"text-slate-400 hover:text-slate-600",children:n.jsx(at,{size:24})})]}),n.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n.jsx("div",{className:"text-slate-700 dark:text-slate-300 whitespace-pre-wrap text-sm leading-relaxed",children:H})}),n.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 flex gap-3 justify-end",children:n.jsx("button",{onClick:()=>te(!1),className:"px-6 py-2 bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-white rounded-xl font-bold hover:bg-slate-300",children:"Fechar"})})]})})]}):o==="recovery"?n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-100 dark:bg-slate-900 p-4",children:n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-8 w-full max-w-md border border-slate-200 dark:border-slate-700",children:[n.jsxs("div",{className:"flex items-center mb-6",children:[n.jsx("button",{onClick:()=>{i("login"),X(1)},className:"p-2 -ml-2 text-slate-400 hover:text-slate-600",children:n.jsx(Tn,{size:20})}),n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white ml-2",children:"Recuperar Senha"})]}),b&&n.jsxs("div",{className:"mb-4 p-4 bg-rose-50 dark:bg-rose-900/20 text-rose-600 rounded-xl text-sm flex items-center",children:[n.jsx(_n,{size:18,className:"mr-2"}),b]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"UsuÃ¡rio"}),n.jsx("input",{type:"text",value:j,onChange:fe=>M(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Seu usuÃ¡rio"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Resposta de SeguranÃ§a"}),n.jsx("input",{type:"text",value:ie,onChange:fe=>$(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"Sua resposta"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Nova Senha"}),n.jsx("input",{type:"password",autoComplete:"new-password",value:F,onChange:fe=>ue(fe.target.value),className:"w-full p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢"})]}),n.jsx("button",{onClick:Ae,disabled:N,className:"w-full py-3 bg-slate-800 text-white font-bold rounded-xl hover:bg-slate-700 disabled:opacity-50",children:N?"Recuperando...":"Redefinir Senha"})]})]})}):n.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-100 to-slate-50 dark:from-slate-900 dark:to-slate-800 p-4 overflow-hidden relative",children:[n.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[n.jsx("div",{className:"absolute top-10 left-10 w-40 h-40 bg-primary-200 dark:bg-primary-900/20 rounded-full blur-3xl opacity-30 animate-pulse"}),n.jsx("div",{className:"absolute bottom-10 right-10 w-40 h-40 bg-emerald-200 dark:bg-emerald-900/20 rounded-full blur-3xl opacity-30 animate-pulse"})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-2xl p-8 w-full max-w-md border border-slate-200 dark:border-slate-700 animate-bounce-in relative z-10",children:[n.jsx("div",{className:"absolute top-4 right-4",children:n.jsx("select",{value:r,onChange:fe=>{const x=fe.target.value;a(x)},className:"px-3 py-1.5 text-xs bg-slate-100 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-800 cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors",children:d.map(fe=>n.jsxs("option",{value:fe,children:[m(fe)," ",f(fe)]},fe))},r)}),n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary-500 to-primary-700 rounded-2xl mx-auto flex items-center justify-center text-white shadow-lg shadow-primary-500/50 mb-4 animate-bounce-in hover:shadow-xl hover:shadow-primary-500/70 transition-all duration-300 cursor-pointer",children:n.jsx(Ut,{size:32})}),n.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary-600 to-emerald-600 bg-clip-text text-transparent dark:from-primary-400 dark:to-emerald-400 mb-2",children:t}),n.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-sm font-medium",children:s("login.subtitle")})]}),b&&n.jsxs("div",{className:"mb-6 p-4 bg-rose-50 dark:bg-rose-900/20 text-rose-600 rounded-xl text-sm flex items-center animate-shake",children:[n.jsx(_n,{size:18,className:"mr-2 shrink-0"}),b]}),n.jsxs("form",{onSubmit:me,className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:s("login.username")}),n.jsxs("div",{className:"relative",children:[n.jsx(Qn,{className:"absolute left-3 top-3.5 text-slate-400",size:18}),n.jsx("input",{type:"text",value:p,onChange:fe=>h(fe.target.value),className:"w-full pl-10 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white outline-none focus:ring-2 focus:ring-primary-500",placeholder:s("login.username")})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:s("login.password")}),n.jsxs("div",{className:"relative",children:[n.jsx(Ut,{className:"absolute left-3 top-3.5 text-slate-400",size:18}),n.jsx("input",{type:"password",autoComplete:"current-password",value:g,onChange:fe=>y(fe.target.value),className:"w-full pl-10 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white outline-none focus:ring-2 focus:ring-primary-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢"})]})]}),n.jsx("button",{type:"submit",disabled:N,className:"w-full py-3 bg-primary-600 text-white font-bold rounded-xl hover:bg-primary-700 shadow-lg shadow-primary-500/30 flex justify-center items-center active:scale-95 transition-transform disabled:opacity-50",children:N?s("login.enter")+"...":n.jsxs(n.Fragment,{children:[n.jsx(sd,{className:"mr-2",size:20})," ",s("login.enter")]})}),n.jsxs("div",{className:"flex justify-between items-center mt-4",children:[n.jsx("button",{type:"button",onClick:()=>{i("recovery"),w("")},className:"text-sm text-slate-400 hover:text-primary-600 font-medium",children:s("login.forgotPassword")}),n.jsxs("button",{type:"button",onClick:()=>i("register"),className:"text-sm text-emerald-600 font-bold hover:text-emerald-700 flex items-center",children:[s("login.createFamily")," ",n.jsx(qo,{size:14,className:"ml-1"})]})]})]})]})]})},vx=({isOpen:t,onClose:e,transactions:s,goals:r,currencyFormatter:a})=>{const{t:o}=He(),[i,d]=T.useState(!1),[u,f]=T.useState([{role:"ai",content:o("ai.assistant_greeting")}]),[m,p]=T.useState(""),[h,g]=T.useState(!1),y=T.useRef(null),b=()=>{y.current?.scrollIntoView({behavior:"smooth"})};T.useEffect(()=>{t&&b()},[u,t,i]);const w=async N=>{if(N.preventDefault(),!m.trim()||h)return;const v=m;p(""),f(P=>[...P,{role:"user",content:v}]),g(!0);const k=s.filter(P=>P.type==="RECEITA").reduce((P,D)=>P+D.amount,0),A=s.filter(P=>P.type==="DESPESA").reduce((P,D)=>P+D.amount,0),C={};s.filter(P=>P.type==="DESPESA").forEach(P=>{C[P.category]=(C[P.category]||0)+P.amount}),a(k-A),s.slice(0,5).map(P=>`${P.date}: ${P.description} (${a(P.amount)})`),Object.entries(C).map(([P,D])=>`${P}: ${a(D)}`),r.map(P=>`${P.name}: ${a(P.currentAmount)} de ${a(P.targetAmount)}`);try{let P="";const D=await xg(v);f(B=>[...B,{role:"ai",content:""}]);for await(const B of D)P+=B,f(R=>{const U=[...R];return U[U.length-1]={role:"ai",content:P},U})}catch{f(D=>[...D,{role:"ai",content:o("ai.error_processing")}])}finally{g(!1)}};return t?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[90] md:hidden",onClick:e}),n.jsxs("div",{className:`
        fixed z-[100] transition-all duration-300 flex flex-col overflow-hidden 
        bg-white dark:bg-slate-800 border-t md:border border-slate-200 dark:border-slate-700 
        shadow-2xl
        
        /* Mobile: Full Screen / Sheet */
        inset-x-0 bottom-0 top-10 md:top-auto rounded-t-3xl md:rounded-3xl
        
        /* Desktop: Floating Widget */
        md:left-auto md:right-6 md:bottom-6 md:w-96
        
        ${i&&window.innerWidth>=768?"md:h-16":"h-[calc(100%-40px)] md:h-[550px]"}
      `,children:[n.jsxs("div",{className:"p-4 bg-gradient-to-r from-indigo-600 to-purple-600 flex justify-between items-center cursor-pointer shrink-0",onClick:()=>window.innerWidth>=768&&d(!i),children:[n.jsxs("div",{className:"flex items-center text-white",children:[n.jsx(st,{size:18,className:"mr-2 text-yellow-300"}),n.jsx("h3",{className:"font-bold",children:o("ai.assistant_title")})]}),n.jsxs("div",{className:"flex items-center gap-2 text-white/80",children:[n.jsx("button",{className:"hidden md:block hover:text-white",onClick:N=>{N.stopPropagation(),d(!i)},children:i?n.jsx(nd,{size:16}):n.jsx(rd,{size:16})}),n.jsx("button",{className:"hover:text-white p-1",onClick:N=>{N.stopPropagation(),e()},children:n.jsx(at,{size:20})})]})]}),(!i||window.innerWidth<768)&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-slate-900/50",children:[u.map((N,v)=>n.jsx("div",{className:`flex ${N.role==="user"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-[85%] p-3 rounded-2xl text-sm leading-relaxed shadow-sm ${N.role==="user"?"bg-indigo-600 text-white rounded-tr-sm":"bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-tl-sm border border-slate-100 dark:border-slate-600"}`,children:N.content})},v)),h&&n.jsx("div",{className:"flex justify-start",children:n.jsx("div",{className:"bg-white dark:bg-slate-700 p-3 rounded-2xl rounded-tl-sm shadow-sm border border-slate-100 dark:border-slate-600",children:n.jsx(ze,{size:16,className:"animate-spin text-indigo-500"})})}),n.jsx("div",{ref:y})]}),n.jsxs("form",{onSubmit:w,className:"p-3 bg-white dark:bg-slate-800 border-t border-slate-100 dark:border-slate-700 flex gap-2 shrink-0 pb-safe",children:[n.jsx("input",{type:"text",value:m,onChange:N=>p(N.target.value),placeholder:o("ai.placeholder_question"),className:"flex-1 p-3 bg-slate-100 dark:bg-slate-900 rounded-xl text-sm outline-none focus:ring-2 focus:ring-indigo-500 dark:text-white transition-all",autoFocus:window.innerWidth>=768}),n.jsx("button",{type:"submit",disabled:h||!m.trim(),className:"p-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 disabled:opacity-50 transition shadow-lg shadow-indigo-500/20 active:scale-95",children:n.jsx(ad,{size:18})})]})]})]})]}):null},wx=({transactions:t,budgets:e,goals:s,currencyFormatter:r})=>{const{t:a}=He(),[o,i]=T.useState("overview"),[d,u]=T.useState(null),[f,m]=T.useState(!0),[p,h]=T.useState(null),[g,y]=T.useState(!1);T.useEffect(()=>{g||(async()=>{try{m(!0),h(null);const k=await Ya.analyze();u(k),console.log("[AIPlanning] Loaded analysis:",k)}catch(k){const A=k instanceof Error?k.message:"Erro desconhecido ao carregar anÃ¡lise";console.error("Erro ao carregar anÃ¡lise IA:",A),h(A)}finally{m(!1),y(!0)}})()},[]);const b=v=>v>=90?"text-green-600":v>=70?"text-blue-600":v>=50?"text-yellow-600":"text-red-600",w=v=>v>=90?"bg-green-100 dark:bg-green-900/30":v>=70?"bg-blue-100 dark:bg-blue-900/30":v>=50?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30",N=v=>v==="increasing"?n.jsx(At,{className:"text-red-500",size:20}):v==="decreasing"?n.jsx(Ys,{className:"text-green-500",size:20}):n.jsx(At,{className:"text-blue-500",size:20});return p&&!g?n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-4 sm:p-6 md:p-8",children:n.jsx("div",{className:"max-w-2xl mx-auto",children:n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-6",children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(os,{className:"text-red-600 dark:text-red-400 flex-shrink-0 mt-1",size:24}),n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-red-900 dark:text-red-100 mb-1",children:"Erro ao carregar PlanificaÃ§Ã£o IA"}),n.jsx("p",{className:"text-red-700 dark:text-red-300 mb-4",children:p}),n.jsx("button",{onClick:()=>{h(null),y(!1)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",children:"Tentar Novamente"})]})]})})})}):n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 p-4 sm:p-6 md:p-8",children:n.jsxs("div",{className:"max-w-6xl mx-auto",children:[p&&n.jsx("div",{className:"mb-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:n.jsxs("p",{className:"text-yellow-800 dark:text-yellow-200 text-sm",children:["Aviso: ",p]})}),n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[n.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl",children:n.jsx(st,{size:24,className:"text-white"})}),n.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-slate-900 dark:text-white",children:a("ai_planning.title")})]}),n.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-sm md:text-base",children:a("ai_planning.subtitle")})]}),n.jsx("div",{className:"flex gap-2 mb-6 overflow-x-auto",children:[{id:"overview",label:a("ai_planning.overview"),icon:od},{id:"suggestions",label:a("ai_planning.suggestions"),icon:jo},{id:"goals",label:a("ai_planning.goals"),icon:An},{id:"comparisons",label:"GrÃ¡ficos",icon:In}].map(v=>{const k=v.icon,A=o===v.id;return n.jsxs("button",{onClick:()=>i(v.id),className:`
                  px-4 py-2.5 rounded-lg font-semibold text-sm md:text-base flex items-center gap-2 whitespace-nowrap
                  transition-all duration-300 flex-shrink-0
                  ${A?"bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-400 border border-slate-200 dark:border-slate-700 hover:border-purple-400 dark:hover:border-purple-500"}
                `,children:[n.jsx(k,{size:16}),v.label]},v.id)})}),f?n.jsx("div",{className:"flex justify-center items-center py-20",children:n.jsx(ze,{className:"animate-spin text-purple-600",size:32})}):d?n.jsxs(n.Fragment,{children:[o==="overview"&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:a("ai_planning.financial_health")}),n.jsx(vt,{className:b(d.health_score),size:24})]}),n.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:a("ai_planning.health_description")}),n.jsxs("div",{className:`${w(d.health_score)} rounded-lg p-3 flex items-center justify-between`,children:[n.jsx("span",{className:`text-3xl font-bold ${b(d.health_score)}`,children:d.health_grade}),n.jsxs("span",{className:`text-sm font-semibold ${b(d.health_score)}`,children:[d.health_score,"/100"]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:a("ai_planning.spending_trends")}),N(d.spending_trends.trend)]}),n.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:a("ai_planning.trends_description")}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:a("ai_planning.month_avg")}),n.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:r(d.spending_trends.month_avg)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:"MudanÃ§a"}),n.jsxs("span",{className:`font-bold ${d.spending_trends.change_percent>0?"text-red-600":"text-green-600"}`,children:[d.spending_trends.change_percent>0?"+":"",Math.round(d.spending_trends.change_percent),"%"]})]})]})]}),n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:a("ai_planning.savings_potential")}),n.jsx(os,{className:"text-amber-500",size:24})]}),n.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:a("ai_planning.savings_description")}),n.jsxs("div",{className:"flex items-center justify-between bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3",children:[n.jsx("span",{className:"text-2xl font-bold text-amber-600",children:r(d.savings_potential)}),n.jsx("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:a("ai_planning.possible")})]})]})]}),d.at_risk_categories.length>0&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[n.jsx(is,{size:20,className:"text-red-500"}),"Categorias em Risco"]}),n.jsx("div",{className:"space-y-3",children:d.at_risk_categories.map(v=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-slate-900 dark:text-white",children:v.category}),n.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:[r(v.spent)," / ",r(v.limit)]})]}),n.jsxs("span",{className:"font-bold text-red-600",children:[v.percentage,"%"]})]},v.category))})]})]}),o==="suggestions"&&n.jsx("div",{className:"space-y-4",children:d.suggestions.map(v=>n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-start justify-between mb-3",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-bold text-slate-900 dark:text-white mb-1",children:v.title}),n.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:v.description})]}),n.jsx("span",{className:`
                        px-3 py-1 text-xs font-bold rounded-full whitespace-nowrap ml-3 flex-shrink-0
                        ${v.priority==="high"?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":""}
                        ${v.priority==="medium"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400":""}
                        ${v.priority==="low"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":""}
                      `,children:v.priority==="high"?a("ai_planning.high"):v.priority==="medium"?a("ai_planning.medium"):a("ai_planning.low")})]}),n.jsxs("div",{className:"flex justify-between items-end pt-3 border-t border-slate-100 dark:border-slate-700",children:[n.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:a("ai_planning.potential_savings")}),n.jsx("span",{className:"text-lg font-bold text-green-600",children:r(v.potential_savings)})]})]},v.id))}),o==="comparisons"&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("button",{onClick:()=>{m(!0),h(null),Ya.analyze().then(u).catch(v=>{const k=v instanceof Error?v.message:"Erro ao atualizar";h(k),console.error("Erro ao atualizar anÃ¡lise:",k)}).finally(()=>m(!1))},className:"flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition",children:[n.jsx(_s,{size:16}),"Atualizar Dados"]}),d?.monthly_comparison&&d.monthly_comparison.length>0&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[n.jsx(At,{size:20,className:"text-blue-600"}),"Gasto Mensal (Ãšltimos 12 Meses)"]}),n.jsx(wt,{width:"100%",height:300,children:n.jsxs(Eo,{data:d.monthly_comparison.map(v=>({month:v.date.slice(-2),spent:Math.round(v.spent)})),children:[n.jsx(zt,{strokeDasharray:"3 3"}),n.jsx(qt,{dataKey:"month"}),n.jsx(Gt,{}),n.jsx(_t,{formatter:v=>r(Number(v))}),n.jsx(To,{type:"monotone",dataKey:"spent",stroke:"#8b5cf6",strokeWidth:2,dot:{fill:"#8b5cf6",r:4},activeDot:{r:6}})]})})]}),d&&n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2",children:[n.jsx(In,{size:20,className:"text-green-600"}),"Categorias - Limite vs Gasto"]}),n.jsx(wt,{width:"100%",height:300,children:n.jsxs(Ao,{data:d.at_risk_categories.length>0?d.at_risk_categories:[],children:[n.jsx(zt,{strokeDasharray:"3 3"}),n.jsx(qt,{dataKey:"category",angle:-45,textAnchor:"end",height:100}),n.jsx(Gt,{}),n.jsx(_t,{formatter:v=>r(Number(v))}),n.jsx(Zn,{}),n.jsx(Js,{dataKey:"limit",fill:"#10b981",name:"Limite"}),n.jsx(Js,{dataKey:"spent",fill:"#ef4444",name:"Gasto"})]})})]})]}),o==="goals"&&n.jsxs("div",{className:"space-y-4",children:[d.goals_progress.map((v,k)=>{const A=v.progress_percent;return n.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-soft border border-slate-100 dark:border-slate-700 p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("h3",{className:"font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[n.jsx(Cs,{size:16,className:"text-purple-600"}),v.name]}),n.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:[v.months_to_target," ",v.months_to_target===1?"mÃªs":"meses"," para atingir"]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:[Math.round(A),"%"]}),v.on_track&&n.jsxs("div",{className:"text-xs font-bold text-green-600 flex items-center gap-1 justify-end",children:[n.jsx(vt,{size:12}),"No caminho"]}),!v.on_track&&n.jsxs("div",{className:"text-xs font-bold text-red-600 flex items-center gap-1 justify-end",children:[n.jsx(is,{size:12}),"Em risco"]})]})]}),n.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3 overflow-hidden",children:n.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${v.on_track?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-gradient-to-r from-red-500 to-orange-500"}`,style:{width:`${A}%`}})})]},k)}),d.goals_progress.length===0&&n.jsx("div",{className:"text-center py-12",children:n.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:a("ai_planning.no_goals")})})]})]}):null]})})},_x=({notifications:t,onNotificationClick:e,onClearAll:s})=>{const[r,a]=T.useState(!1),o=T.useRef(null),i=t.filter(u=>!u.read).length;T.useEffect(()=>{const u=f=>{o.current&&!o.current.contains(f.target)&&a(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const d=u=>u.includes("OrÃ§amento")?n.jsx(is,{size:16,className:"text-rose-500"}):u.includes("Meta")?n.jsx(vt,{size:16,className:"text-emerald-500"}):n.jsx(id,{size:16,className:"text-blue-500"});return n.jsxs("div",{className:"relative",ref:o,children:[n.jsxs("button",{onClick:()=>a(!r),className:"relative p-2.5 rounded-full bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 transition group",title:"NotificaÃ§Ãµes",children:[n.jsx(It,{size:20,className:r?"text-primary-500":""}),i>0&&n.jsx("span",{className:"absolute top-0 right-0 w-3 h-3 bg-rose-500 rounded-full border-2 border-white dark:border-slate-900 animate-pulse"})]}),r&&n.jsxs("div",{className:"absolute right-0 top-full mt-3 w-80 md:w-96 bg-white dark:bg-slate-800 rounded-2xl shadow-2xl border border-slate-100 dark:border-slate-700 overflow-hidden z-50 animate-scale-in origin-top-right",children:[n.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[n.jsx("h3",{className:"font-bold text-slate-800 dark:text-white text-sm",children:"NotificaÃ§Ãµes"}),t.length>0&&n.jsxs("button",{onClick:s,className:"text-xs font-bold text-slate-400 hover:text-rose-500 flex items-center transition",children:[n.jsx(Qe,{size:12,className:"mr-1"})," Limpar"]})]}),n.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:t.length===0?n.jsxs("div",{className:"p-8 text-center text-slate-400 flex flex-col items-center",children:[n.jsx("div",{className:"bg-slate-100 dark:bg-slate-700/50 p-4 rounded-full mb-3",children:n.jsx(It,{size:24,className:"opacity-50"})}),n.jsx("p",{className:"text-sm",children:"Tudo limpo por aqui!"})]}):n.jsx("div",{className:"divide-y divide-slate-50 dark:divide-slate-700/50",children:t.map(u=>n.jsxs("div",{onClick:()=>{e(u),a(!1)},className:`p-4 hover:bg-slate-50 dark:hover:bg-slate-700/30 transition cursor-pointer flex gap-3 ${u.read?"":"bg-blue-50/50 dark:bg-blue-900/10"}`,children:[n.jsx("div",{className:`mt-1 p-2 rounded-full shrink-0 h-fit ${u.read?"bg-slate-100 dark:bg-slate-700":"bg-white dark:bg-slate-800 shadow-sm"}`,children:d(u.title)}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex justify-between items-start",children:[n.jsx("h4",{className:`text-sm font-bold ${u.read?"text-slate-500 dark:text-slate-400":"text-slate-800 dark:text-white"}`,children:u.title}),!u.read&&n.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-1.5"})]}),n.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1 leading-relaxed",children:u.message}),n.jsx("p",{className:"text-[10px] text-slate-400 mt-2 font-medium",children:new Date(u.date).toLocaleDateString()})]})]},u.id))})})]})]})},Nx={dashboard:"common.view_dashboard",simulations:"common.view_simulations",transactions:"common.view_transactions",budget:"common.view_budget",goals:"common.view_goals",inflation:"common.view_inflation",admin:"common.view_admin",family:"common.view_family",translations:"common.view_translations"},kx=({appName:t,currentView:e,isMobileMenuOpen:s,setIsMobileMenuOpen:r,currency:a,setCurrency:o,isAiOpen:i,setIsAiOpen:d,notifications:u,onNotificationClick:f,onClearAll:m,darkMode:p,handleThemeToggle:h})=>{const{t:g}=He(),y=Nx[e]||"common.view_dashboard";return n.jsxs("header",{className:"flex items-center justify-between px-4 md:px-6 py-2 md:py-4 z-20 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md sticky top-0 border-b border-slate-200 dark:border-slate-700/50 shadow-sm transition-colors duration-300",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("button",{onClick:()=>r(!0),className:"mr-2 md:mr-3 text-slate-500 md:hidden hover:text-primary-500 transition active:scale-95",children:n.jsx(ld,{size:20,className:"md:hidden"})}),n.jsx("h2",{className:"text-base sm:text-lg md:text-2xl font-bold text-slate-800 dark:text-white capitalize truncate max-w-[120px] sm:max-w-[150px] md:max-w-none",children:g(y)})]}),n.jsxs("div",{className:"flex items-center space-x-1 md:space-x-3",children:[n.jsxs("div",{className:"flex items-center bg-slate-100 dark:bg-slate-800 rounded-lg md:rounded-xl px-1.5 md:px-3 py-1 md:py-1.5 border border-slate-200 dark:border-slate-700",children:[n.jsx(Go,{size:14,className:"md:hidden text-primary-500 mr-1"}),n.jsx(dd,{size:14,className:"hidden md:block text-primary-500 mr-1 md:mr-2"}),n.jsxs("select",{value:a,onChange:b=>o(b.target.value),className:"bg-transparent border-none text-xs md:text-sm font-bold text-slate-700 dark:text-slate-200 outline-none cursor-pointer max-w-[60px] md:max-w-none",children:[n.jsx("option",{value:"AOA",children:"AOA (Kz)"}),n.jsx("option",{value:"USD",children:"USD ($)"}),n.jsx("option",{value:"EUR",children:"EUR (â‚¬)"}),n.jsx("option",{value:"BRL",children:"BRL (R$)"}),n.jsx("option",{value:"GBP",children:"GBP (Â£)"}),n.jsx("option",{value:"JPY",children:"JPY (Â¥)"}),n.jsx("option",{value:"CNY",children:"CNY (Â¥)"}),n.jsx("option",{value:"INR",children:"INR (â‚¹)"}),n.jsx("option",{value:"ZAR",children:"ZAR (R)"}),n.jsx("option",{value:"MZN",children:"MZN (MT)"}),n.jsx("option",{value:"AUD",children:"AUD (A$)"}),n.jsx("option",{value:"CAD",children:"CAD (C$)"})]})]}),n.jsx("button",{onClick:()=>d(!i),className:`p-2 md:p-2.5 rounded-full transition group active:scale-95 ${i?"bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400":"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"}`,title:"Assistente Gemini",children:n.jsx(st,{size:18,className:`md:w-5 md:h-5 ${i?"fill-current":""}`})}),n.jsx(_x,{notifications:u,onNotificationClick:f,onClearAll:m}),n.jsx("button",{"data-tour":"theme-toggle",onClick:h,className:"p-2 md:p-2.5 rounded-full bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 transition active:scale-95",children:p?n.jsx(cd,{size:18,className:"md:w-5 md:h-5"}):n.jsx(ud,{size:18,className:"md:w-5 md:h-5"})})]})]})};let zs=null;const Sx=async()=>{if(zs)return zs;try{const t=await fetch("/api/settings/default-currency-provider",{credentials:"include"});if(t.ok)return zs=(await t.json()).provider||"BNA",zs}catch(t){console.error("Error getting default currency provider:",t)}return"BNA"};Re.SUPER_ADMIN,bs.APPROVED;const wo=(t,e)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):e}catch{return console.warn(`Dados corrompidos em ${t}. Resetando para padrÃ£o.`),e}},Cx=()=>{const[t,e]=T.useState(()=>{const le=localStorage.getItem("theme");return le?le==="dark":window.matchMedia("(prefers-color-scheme: dark)").matches}),[s,r]=T.useState(()=>localStorage.getItem("appName")||"GestÃ£o Financeira"),[a,o]=T.useState(!1),[i,d]=T.useState(!0),[u,f]=T.useState("dashboard"),[m,p]=T.useState(!1),[h,g]=T.useState(!1),[y,b]=T.useState("pt"),[w,N]=T.useState("AOA"),[v,k]=T.useState("EXCHANGERATE_API"),[A,C]=T.useState(null),[P,D]=T.useState(!1),[B,R]=T.useState(null),[U,Q]=T.useState(new Date().toISOString().split("T")[0].substring(0,8)+"01"),[S,G]=T.useState(new Date().toISOString().split("T")[0]),[_,J]=T.useState([]),[ae,Y]=T.useState(null),[te,H]=T.useState([]),[ce,j]=T.useState([]),[M,ie]=T.useState([]),[$,F]=T.useState({networkPath:"",rootDataFolder:"",frequency:"manual",lastBackup:null}),[ue,Z]=T.useState([]),[X,me]=T.useState([]),[ye,be]=T.useState(()=>wo("savedSimulations",[])),[Ae,fe]=T.useState(()=>wo("notifications",[]));T.useEffect(()=>{const le=window.matchMedia("(prefers-color-scheme: dark)"),ee=Ne=>{localStorage.getItem("theme")||e(Ne.matches)};if(le.addEventListener)return le.addEventListener("change",ee),()=>le.removeEventListener("change",ee);if(le.addListener)return le.addListener(ee),()=>le.removeListener(ee)},[]),T.useEffect(()=>{(async()=>{try{const ee=await Vs.me();Y(ee.user),b(ee.user.languagePreference||"pt"),o(!0),await x()}catch{o(!1)}finally{d(!1)}})()},[]);const x=async()=>{try{const[le,ee,Ne,je,Ee,Be]=await Promise.all([gs.getAll(),es.getAll(),$s.getAll(),Lt.getTasks(),Lt.getEvents(),Qt.getLimits()]);H(le),j(ee),J(Ne),Z(je),me(Ee),ie(Be)}catch(le){console.error("Error loading data:",le)}};T.useEffect(()=>{const le=async()=>{try{let Ne=v;(!v||v==="BNA")&&(Ne=await Sx(),k(Ne));const je=await mx(Ne);C(je)}catch(Ne){console.error("Erro ao carregar taxas",Ne)}};le();const ee=setInterval(le,3e5);return()=>clearInterval(ee)},[v]);const K=T.useRef(null),W=()=>(K.current||(K.current=new(window.AudioContext||window.webkitAudioContext)),K.current.state==="suspended"&&K.current.resume(),K.current),I=()=>{try{const le=W(),ee=le.createOscillator(),Ne=le.createGain();ee.type="sine",ee.frequency.setValueAtTime(600,le.currentTime),ee.frequency.exponentialRampToValueAtTime(200,le.currentTime+.1),Ne.gain.setValueAtTime(.3,le.currentTime),Ne.gain.exponentialRampToValueAtTime(.01,le.currentTime+.1),ee.connect(Ne),Ne.connect(le.destination),ee.start(le.currentTime),ee.stop(le.currentTime+.1)}catch{}},E=(le,ee=w)=>{let Ne=le;if(A&&ee!=="AOA"){const Ee=A[ee];Ee&&Ee>0&&(Ne=le*Ee)}return new Intl.NumberFormat(y||"pt-BR",{style:"currency",currency:ee,minimumFractionDigits:2}).format(Ne)},q=()=>{I(),e(!t),localStorage.setItem("theme",t?"light":"dark")},se=()=>{o(!1),Y(null),localStorage.removeItem("currentUser")},re=le=>{Y(le),J(_.map(ee=>ee.id===le.id?le:ee))},O=async le=>{try{const ee=await gs.create(le);H([...te,ee])}catch(ee){console.error("Error adding transaction:",ee)}},oe=async le=>{try{await gs.update(le.id,le),H(te.map(ee=>ee.id===le.id?le:ee))}catch(ee){console.error("Error updating transaction:",ee)}},he=async le=>{try{console.log("Deleting transaction:",le);const ee=await gs.delete(le);console.log("Delete response:",ee),H(Ne=>{const je=Ne.filter(Ee=>Ee.id!==le);return console.log("Transactions updated. Before:",Ne.length,"After:",je.length),je})}catch(ee){console.error("Error deleting transaction:",ee)}},de=async le=>{try{const ee=await es.create(le);j([...ce,ee])}catch(ee){console.error("Error adding goal:",ee)}},xe=async le=>{try{await es.delete(le),j(ce.filter(ee=>ee.id!==le))}catch(ee){console.error("Error deleting goal:",ee)}},V=async(le,ee,Ne)=>{try{await es.contribute(le,ee,Ne),await x()}catch(je){console.error("Error adding contribution:",je)}},pe=async(le,ee)=>{try{await x()}catch(Ne){console.error("Error updating contribution:",Ne)}},_e=async le=>{try{await x()}catch(ee){console.error("Error deleting contribution:",ee)}},Fe=async le=>{try{const ee=await Qt.saveBudget(le);ie([...M.filter(Ne=>Ne!==le),ee])}catch(ee){console.error("Error saving budget:",ee)}},Ie=le=>{R(le),D(!0)},qe=async()=>{B&&(await ve(B,U,S),D(!1))},ve=async(le,ee,Ne)=>{const je=te.filter(Ee=>Ee.date>=ee&&Ee.date<=Ne);if(le==="PDF"){const Ee=new Bo,Be=je.map(Ue=>[Ue.description,Ue.category,Ue.date,E(Ue.amount),Ue.type]);Oo(Ee,{head:[["DescriÃ§Ã£o","Categoria","Data","Valor","Tipo"]],body:Be,startY:10}),Ee.save("transacoes.pdf")}else if(le==="CSV"){const Ee=["DescriÃ§Ã£o","Categoria","Data","Valor","Tipo"],Be=je.map(ne=>[ne.description,ne.category,ne.date,ne.amount,ne.type]),Ue=[Ee,...Be].map(ne=>ne.join(",")).join(`
`),fs=new Blob([Ue],{type:"text/csv"}),Kt=window.URL.createObjectURL(fs),L=document.createElement("a");L.href=Kt,L.download="transacoes.csv",L.click()}},Oe=async le=>{try{const ee=await $s.create(le);J([..._,ee])}catch(ee){console.error("Error adding user:",ee)}},We=async le=>{try{await $s.delete(le),J(_.filter(ee=>ee.id!==le))}catch(ee){console.error("Error deleting user:",ee)}},Ge=le=>{F(le),localStorage.setItem("backupConfig",JSON.stringify(le))},Xe=async()=>{console.log("Manual backup triggered")},gt=async()=>{console.log("Restore backup triggered")},yt=()=>ae?(ae.role===Re.SUPER_ADMIN||ae.role===Re.ADMIN,!0):!1,jt=async le=>{try{const ee=await Lt.createTask(le);Z([...ue,ee])}catch(ee){console.error("Error adding task:",ee)}},xt=async le=>{try{await Lt.updateTask(le,{}),await x()}catch(ee){console.error("Error toggling task:",ee)}},dt=async le=>{try{await Lt.deleteTask(le),Z(ue.filter(ee=>ee.id!==le))}catch(ee){console.error("Error deleting task:",ee)}},et=async le=>{try{const ee=await Lt.createEvent(le);me([...X,ee])}catch(ee){console.error("Error adding event:",ee)}},Mt=async le=>{try{await Lt.deleteEvent(le),me(X.filter(ee=>ee.id!==le))}catch(ee){console.error("Error deleting event:",ee)}},Dt=async le=>{be([...ye,le]),localStorage.setItem("savedSimulations",JSON.stringify([...ye,le]))},us=async le=>{const ee=ye.filter(Ne=>Ne.id!==le);be(ee),localStorage.setItem("savedSimulations",JSON.stringify(ee))},Wt=()=>{fe([])},Ft=le=>{fe(Ae.filter(ee=>ee.id!==le.id))};return n.jsx(bd,{initialLanguage:y,children:n.jsxs("div",{className:`${t?"dark":""}`,children:[i&&n.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-br from-primary-500 to-primary-600",children:n.jsx(ze,{size:48,className:"animate-spin text-white"})}),!a&&!i&&n.jsx(yx,{appName:s,onLogin:le=>{Y(le),o(!0),b(le.languagePreference||"pt")}}),a&&!i&&n.jsxs("div",{className:"flex h-screen bg-slate-50 dark:bg-[#09090b] overflow-hidden font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300",children:[n.jsx(vd,{appName:s,currentUser:ae,currentView:u,setCurrentView:f,isMobileOpen:m,setIsMobileOpen:p,logout:se,onUpdateUser:re}),n.jsx(vx,{isOpen:h,onClose:()=>g(!1),transactions:te,goals:ce,currencyFormatter:E}),n.jsxs("div",{className:"flex-1 flex flex-col h-full md:h-full overflow-hidden relative w-full",children:[n.jsx(kx,{appName:s,currentView:u,isMobileMenuOpen:m,setIsMobileMenuOpen:p,currency:w,setCurrency:N,isAiOpen:h,setIsAiOpen:g,notifications:Ae,onNotificationClick:Ft,onClearAll:Wt,darkMode:t,handleThemeToggle:q}),n.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8 scroll-smooth md:pb-32",children:n.jsxs("div",{className:"max-w-7xl mx-auto",children:[u==="dashboard"&&n.jsx(kg,{transactions:te,savingsGoals:ce,budgets:M,currencyFormatter:E}),u==="ai_planning"&&n.jsx(wx,{transactions:te,budgets:M,goals:ce,currencyFormatter:E}),u==="transactions"&&ae&&n.jsx(ax,{transactions:te,addTransaction:O,updateTransaction:oe,deleteTransaction:he,currentUserId:ae.id,currencyFormatter:E,onExport:Ie,onRefresh:x}),u==="budget"&&n.jsx(fx,{transactions:te,budgets:M,saveBudget:Fe,currencyFormatter:E}),u==="goals"&&ae&&n.jsx(ox,{goals:ce,addGoal:de,deleteGoal:xe,addContribution:V,editContribution:pe,deleteContribution:_e,currencyFormatter:E,currentUser:ae,onRefresh:x}),u==="inflation"&&n.jsx(xx,{rateProvider:v,setRateProvider:k,currencyFormatter:E}),u==="simulations"&&n.jsx(bx,{currencyFormatter:E,savedSimulations:ye,onSaveSimulation:Dt,onDeleteSimulation:us}),u==="family"&&ae&&n.jsx(ix,{transactions:te,currencyFormatter:E,currentUser:ae,allUsers:_,tasks:ue,events:X,addTask:jt,toggleTask:xt,deleteTask:dt,addEvent:et,deleteEvent:Mt,canViewData:yt}),u==="admin"&&ae&&n.jsx(ux,{appName:s,setAppName:r,backupConfig:$,updateBackupConfig:Ge,triggerManualBackup:Xe,users:_,currentUser:ae,onAddUser:Oe,onUpdateUser:re,onDeleteUser:We,onRestoreBackup:gt,onRefresh:x}),u==="translations"&&ae&&n.jsx(ll,{currentUser:ae})]})})]}),P&&n.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in",children:n.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl w-full max-w-md border border-slate-100 dark:border-slate-700 animate-scale-in",children:[n.jsxs("h3",{className:"text-xl font-bold mb-4 text-slate-800 dark:text-white",children:["Exportar ",B]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Data Inicial"}),n.jsx("input",{type:"date",value:U,onChange:le=>Q(le.target.value),className:"w-full mt-1 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white outline-none focus:ring-2 focus:ring-primary-500"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"Data Final"}),n.jsx("input",{type:"date",value:S,onChange:le=>G(le.target.value),className:"w-full mt-1 p-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white outline-none focus:ring-2 focus:ring-primary-500"})]}),n.jsxs("div",{className:"flex gap-3 pt-2",children:[n.jsx("button",{onClick:()=>D(!1),className:"flex-1 py-3 text-slate-500 font-bold hover:bg-slate-100 dark:hover:bg-slate-700 rounded-xl transition active:scale-95",children:"Cancelar"}),n.jsx("button",{onClick:qe,className:"flex-1 py-3 bg-primary-600 text-white font-bold rounded-xl hover:bg-primary-700 shadow-lg shadow-primary-500/20 transition active:scale-95",children:"Confirmar"})]})]})]})})]})]})})},Ex=new Zg({defaultOptions:{queries:{staleTime:3e4,gcTime:300*1e3,retry:1},mutations:{retry:1}}}),Tx=({children:t})=>n.jsx(Qg,{client:Ex,children:t}),ul=document.getElementById("root");if(!ul)throw new Error("Could not find root element to mount to");const Ax=gd.createRoot(ul);Ax.render(n.jsx(Xn.StrictMode,{children:n.jsx(Tx,{children:n.jsx(Cx,{})})}));
