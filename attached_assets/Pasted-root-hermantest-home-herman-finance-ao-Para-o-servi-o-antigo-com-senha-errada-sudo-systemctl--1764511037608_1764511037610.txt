root@hermantest:/home/herman/finance.ao# # Para o serviÃ§o antigo (com senha errada)
sudo systemctl stop gestor-financeiro
# Limpa a base de dados antiga
sudo -u postgres psql <<EOF
DROP DATABASE IF EXISTS gestor_financeiro;
DROP USER IF EXISTS gestor_user;
EOF
# Executa deploy.sh novamente (gerarÃ¡ nova senha sem caracteres especiais)
sudo bash deploy.sh
# Testa
sudo bash diagnose.sh
DROP DATABASE
DROP ROLE
>>> [1/7] Atualizando sistema...
Hit:1 http://security.ubuntu.com/ubuntu noble-security InRelease
Hit:2 http://ao.archive.ubuntu.com/ubuntu noble InRelease
Hit:3 http://ao.archive.ubuntu.com/ubuntu noble-updates InRelease
Hit:4 https://deb.nodesource.com/node_20.x nodistro InRelease
Hit:5 http://ao.archive.ubuntu.com/ubuntu noble-backports InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (8.5.0-2ubuntu10.6).
git is already the newest version (1:2.43.0-1ubuntu7.3).
build-essential is already the newest version (12.10ubuntu1).
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
>>> [2/7] Configurando Git globalmente...
>>> [3/7] Verificando Node.js...
Node.js jÃ¡ instalado: v20.19.6
>>> [4/7] Preparando diretÃ³rio da aplicaÃ§Ã£o...
>>> [5/7] Clonando/Copiando cÃ³digo e instalando dependÃªncias...
npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
npm warn deprecated rimraf@2.7.1: Rimraf versions prior to v4 are no longer supported
npm warn deprecated lodash.isequal@4.5.0: This package is deprecated. Use require('node:util').isDeepStrictEqual instead.
npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
npm warn deprecated fstream@1.0.12: This package is no longer supported.
npm warn deprecated node-domexception@1.0.0: Use your platform's native DOMException instead

added 716 packages, and audited 717 packages in 4m

105 packages are looking for funding
  run `npm fund` for details

5 vulnerabilities (3 moderate, 2 high)

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

> gestor-financeiro-familiar@1.0.3 build
> vite build

NODE_ENV=production is not supported in the .env file. Only NODE_ENV=development is supported to create a development build of your project. If you need to set process.env.NODE_ENV, you can set it in the Vite config instead.
vite v5.4.21 building for production...
âœ“ 2696 modules transformed.
Generated an empty chunk: "auth".
dist/index.html                            7.23 kB â”‚ gzip:   2.45 kB
dist/assets/index-BccavMXV.css            95.58 kB â”‚ gzip:  13.86 kB
dist/assets/auth-l0sNRNKZ.js               0.00 kB â”‚ gzip:   0.02 kB
dist/assets/purify.es-C_uT9hQ1.js         21.98 kB â”‚ gzip:   8.74 kB
dist/assets/ui-icons-BmRcAUOu.js          36.05 kB â”‚ gzip:   6.72 kB
dist/assets/react-vendor-AIrFsuJV.js     141.46 kB â”‚ gzip:  45.43 kB
dist/assets/index.es-CrDVOCaO.js         150.48 kB â”‚ gzip:  51.44 kB
dist/assets/html2canvas.esm-CBrSDip1.js  201.42 kB â”‚ gzip:  48.03 kB
dist/assets/pdf-D1kK-7Cp.js              398.49 kB â”‚ gzip: 131.01 kB
dist/assets/charts-DAehIZ_w.js           433.39 kB â”‚ gzip: 114.73 kB
dist/assets/index-Cnd6yIsW.js            723.88 kB â”‚ gzip: 166.05 kB
âœ“ built in 9.65s
>>> [6/7] Configurando PostgreSQL e serviÃ§o systemd...
Iniciando PostgreSQL...
Synchronizing state of postgresql.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.
Executing: /usr/lib/systemd/systemd-sysv-install enable postgresql
Configurando base de dados PostgreSQL...
CREATE ROLE
ALTER ROLE
NOTICE:  database "gestor_financeiro" does not exist, skipping
DROP DATABASE
CREATE DATABASE
ALTER DATABASE
GRANT

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ“ PostgreSQL configurado automaticamente!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREDENCIAIS GERADAS:
  Utilizador: gestor_user
  Senha: IC28se3JdfF8/tz1qTW9ng==
  String de conexÃ£o: postgresql://gestor_user:IC28se3JdfF8/tz1qTW9ng==@localhost:5432/gestor_financeiro

>>> [7/7] Iniciando serviÃ§o...

âœ“ SUCESSO! ServiÃ§o iniciado com sucesso!
âœ“ Acesse a aplicaÃ§Ã£o em: http://192.168.5.49:5000

Credenciais padrÃ£o:
  UsuÃ¡rio: admin
  Senha: admin

Comandos Ãºteis:
  Ver logs: sudo journalctl -u gestor-financeiro -f
  Restart: sudo systemctl restart gestor-financeiro
  Status: sudo systemctl status gestor-financeiro
ğŸ” DIAGNÃ“STICO DO GESTOR FINANCEIRO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  Status do ServiÃ§o:
     Active: active (running) since Sun 2025-11-30 13:56:24 UTC; 3s ago

2ï¸âƒ£  VariÃ¡veis de Ambiente:
  âœ“ Arquivo .env.production existe
  DATABASE_URL estÃ¡ configurado:
DATABASE_URL=postgresql://gestor_user:IC28se3JdfF8/tz1qTW9ng==@localhost:5432/gestor_financeiro

3ï¸âƒ£  PostgreSQL:
  âœ“ PostgreSQL instalado
     Active: active (exited) since Sun 2025-11-30 13:33:21 UTC; 23min ago

4ï¸âƒ£  AplicaÃ§Ã£o Node.js:
  âœ“ Node.js: v20.19.6
  âœ“ NPM: 10.8.2

5ï¸âƒ£  Teste de ConexÃ£o com Banco de Dados:
  âœ— Falha ao conectar ao banco de dados
  Verifique se PostgreSQL estÃ¡ rodando e as credenciais estÃ£o corretas

6ï¸âƒ£  Ãšltimos Erros (Ãºltimos 10 linhas):
Nov 30 13:56:26 hermantest npm[2631]: [Budget Scheduler] Initial run error: TypeError: Cannot read properties of undefined (reading 'searchParams')
Nov 30 13:56:26 hermantest npm[2631]:     at parse (/var/www/gestor-financeiro/node_modules/pg-connection-string/index.js:39:30)
Nov 30 13:56:26 hermantest npm[2631]:     at new ConnectionParameters (/var/www/gestor-financeiro/node_modules/pg/lib/connection-parameters.js:56:42)
Nov 30 13:56:26 hermantest npm[2631]:     at new Client (/var/www/gestor-financeiro/node_modules/pg/lib/client.js:18:33)
Nov 30 13:56:26 hermantest npm[2631]:     at BoundPool.newClient (/var/www/gestor-financeiro/node_modules/pg-pool/index.js:233:20)
Nov 30 13:56:26 hermantest npm[2631]:     at BoundPool.connect (/var/www/gestor-financeiro/node_modules/pg-pool/index.js:227:10)
Nov 30 13:56:26 hermantest npm[2631]:     at BoundPool.query (/var/www/gestor-financeiro/node_modules/pg-pool/index.js:411:10)
Nov 30 13:56:26 hermantest npm[2631]:     at Timeout._onTimeout (/var/www/gestor-financeiro/server/routes/budget.ts:166:40)
Nov 30 13:56:26 hermantest npm[2631]:     at listOnTimeout (node:internal/timers:581:17)
Nov 30 13:56:26 hermantest npm[2631]:     at process.processTimers (node:internal/timers:519:7)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Se tiver problemas, execute:
  sudo journalctl -u gestor-financeiro -f
para ver os logs em tempo real
root@hermantest:/home/herman/finance.ao#